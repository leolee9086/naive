<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- 导入 Vue 3 -->
    <link rel="stylesheet" href="//unpkg.com/element-plus/dist/index.css" />
    <script src="https://unpkg.com/vue@3.2.33/dist/vue.global.js"></script>
    <!-- 导入组件库 -->
    <script src="https://unpkg.com/element-plus"></script>

</head>

<body>
    <div id="app"></div>
</body>
<template style="display: false;" id="template">
    <el-container>
        <el-header>主题样式设置</el-header>
        <el-main>
            <el-form :model="config" label-width="120px">

                <el-form-item label="编辑器外观样式">
                    <el-input v-model="config.编辑器样式" />
                </el-form-item>
                <el-form-item label="笔记内主题片段">
                    <el-switch v-model="config.笔记内样式片段" />
                </el-form-item>
                <el-form-item label="增强的行内样式">
                    <el-switch v-model="config.增强的行内样式" />
                </el-form-item> 
                <el-form-item label="笔记内行内样式">
                    <el-switch v-model="config.笔记内行内样式" />
                </el-form-item>
            </el-form>
        </el-main>
        <el-footer>

            <el-button @click="重置()">
                重置
            </el-button>
            <el-button @click="保存()">
                保存
            </el-button>
        </el-footer>
    </el-container>
</template>
<script>

    let customfig = {}
    async function 向思源请求数据(url, apitoken, data) {
        let resData = null
        await fetch(url, {
            body: JSON.stringify(data),
            method: 'POST',
            headers: { 'Authorization': 'Token ' + apitoken },
        }).then(function (response) { resData = response.json() })
        return resData
    }
    const app = Vue.createApp({
        template: document.getElementById('template').innerHTML,
        data() {
            return {
                config: {}
            }
        },
        mounted() {
            this.config = customfig
        },
        methods: {
            重置() {
                fetch('.././config/style.json').then((response) => response.json()).then(json => {
                    this.config = Vue.reactive(json)
                })
            },
            保存() {
                const formData = new FormData()
                data = JSON.stringify(this.config, undefined, 4)
                var blob = new Blob([data], { type: 'text/json' })
                formData.append('path', 'conf\\appearance\\themes\\naive\\config\\style.json')
                formData.append('modTime', Date.now())
                formData.append('file', blob)
                let url = '/api/file/putFile'
                fetch(url, {
                    body: formData,
                    method: "POST",
                })
            }
        },
        watch: {
            config: {
                handler(val) {
                    console.log(val)
                },
                deep: true
            }
        }
    })
    app.use(ElementPlus);

    const readJson = function () {
        console.log(this)
        let vm = this
        fetch('.././config/style.json').then((response) => response.json()).then(json => {
            customfig = Vue.reactive(json)
            const vm = app.mount('#app')
        })
    }
    readJson()

</script>

</html>