(()=>{var e={4920:e=>{self,e.exports=(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.d(t,{default:()=>L});var n={};function i(e,t,n,i,a={}){t instanceof HTMLCollection||t instanceof NodeList?t=Array.from(t):Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]);for(const o of t)for(const t of n)o[e](t,i,{capture:!1,...a});return Array.prototype.slice.call(arguments,1)}e.r(n),e.d(n,{adjustableInputNumbers:()=>u,createElementFromString:()=>s,createFromTemplate:()=>r,eventPath:()=>l,off:()=>o,on:()=>a,resolveElement:()=>c});const a=i.bind(null,"addEventListener"),o=i.bind(null,"removeEventListener");function s(e){const t=document.createElement("div");return t.innerHTML=e.trim(),t.firstElementChild}function r(e){const t=(e,t)=>{const n=e.getAttribute(t);return e.removeAttribute(t),n},n=(e,i={})=>{const a=t(e,":obj"),o=t(e,":ref"),s=a?i[a]={}:i;o&&(i[o]=e);for(const i of Array.from(e.children)){const e=t(i,":arr"),a=n(i,e?{}:s);e&&(s[e]||(s[e]=[])).push(Object.keys(a).length?a:i)}return i};return n(s(e))}function l(e){let t=e.path||e.composedPath&&e.composedPath();if(t)return t;let n=e.target.parentElement;for(t=[e.target,n];n=n.parentElement;)t.push(n);return t.push(document,window),t}function c(e){return e instanceof Element?e:"string"==typeof e?e.split(/>>/g).reduce(((e,t,n,i)=>(e=e.querySelector(t),n<i.length-1?e.shadowRoot:e)),document):null}function u(e,t=(e=>e)){function n(n){const i=[.001,.01,.1][Number(n.shiftKey||2*n.ctrlKey)]*(n.deltaY<0?1:-1);let a=0,o=e.selectionStart;e.value=e.value.replace(/[\d.]+/g,((e,n)=>n<=o&&n+e.length>=o?(o=n,t(Number(e),i,a)):(a++,e))),e.focus(),e.setSelectionRange(o,o),n.preventDefault(),e.dispatchEvent(new Event("input"))}a(e,"focus",(()=>a(window,"wheel",n,{passive:!1}))),a(e,"blur",(()=>o(window,"wheel",n)))}const{min:d,max:p,floor:h,round:f}=Math;function g(e,t,n){t/=100,n/=100;const i=h(e=e/360*6),a=e-i,o=n*(1-t),s=n*(1-a*t),r=n*(1-(1-a)*t),l=i%6;return[255*[n,s,o,o,r,n][l],255*[r,n,n,s,o,o][l],255*[o,o,r,n,n,s][l]]}function m(e,t,n){const i=(2-(t/=100))*(n/=100)/2;return 0!==i&&(t=1===i?0:i<.5?t*n/(2*i):t*n/(2-2*i)),[e,100*t,100*i]}function y(e,t,n){const i=d(e/=255,t/=255,n/=255),a=p(e,t,n),o=a-i;let s,r;if(0===o)s=r=0;else{r=o/a;const i=((a-e)/6+o/2)/o,l=((a-t)/6+o/2)/o,c=((a-n)/6+o/2)/o;e===a?s=c-l:t===a?s=1/3+i-c:n===a&&(s=2/3+l-i),s<0?s+=1:s>1&&(s-=1)}return[360*s,100*r,100*a]}function b(e,t,n,i){return t/=100,n/=100,[...y(255*(1-d(1,(e/=100)*(1-(i/=100))+i)),255*(1-d(1,t*(1-i)+i)),255*(1-d(1,n*(1-i)+i)))]}function v(e,t,n){t/=100;const i=2*(t*=(n/=100)<.5?n:1-n)/(n+t)*100,a=100*(n+t);return[e,isNaN(i)?0:i,a]}function w(e){return y(...e.match(/.{2}/g).map((e=>parseInt(e,16))))}function _(e){e=e.match(/^[a-zA-Z]+$/)?function(e){if("black"===e.toLowerCase())return"#000";const t=document.createElement("canvas").getContext("2d");return t.fillStyle=e,"#000"===t.fillStyle?null:t.fillStyle}(e):e;const t={cmyk:/^cmyk[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)/i,rgba:/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,hsla:/^((hsla)|hsl)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,hsva:/^((hsva)|hsv)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,hexa:/^#?(([\dA-Fa-f]{3,4})|([\dA-Fa-f]{6})|([\dA-Fa-f]{8}))$/i},n=e=>e.map((e=>/^(|\d+)\.\d+|\d+$/.test(e)?Number(e):void 0));let i;e:for(const a in t){if(!(i=t[a].exec(e)))continue;const o=e=>!!i[2]==("number"==typeof e);switch(a){case"cmyk":{const[,e,t,o,s]=n(i);if(e>100||t>100||o>100||s>100)break e;return{values:b(e,t,o,s),type:a}}case"rgba":{const[,,,e,t,s,r]=n(i);if(e>255||t>255||s>255||r<0||r>1||!o(r))break e;return{values:[...y(e,t,s),r],a:r,type:a}}case"hexa":{let[,e]=i;4!==e.length&&3!==e.length||(e=e.split("").map((e=>e+e)).join(""));const t=e.substring(0,6);let n=e.substring(6);return n=n?parseInt(n,16)/255:void 0,{values:[...w(t),n],a:n,type:a}}case"hsla":{const[,,,e,t,s,r]=n(i);if(e>360||t>100||s>100||r<0||r>1||!o(r))break e;return{values:[...v(e,t,s),r],a:r,type:a}}case"hsva":{const[,,,e,t,s,r]=n(i);if(e>360||t>100||s>100||r<0||r>1||!o(r))break e;return{values:[e,t,s,r],a:r,type:a}}}}return{values:null,type:null}}function E(e=0,t=0,n=0,i=1){const a=(e,t)=>(n=-1)=>t(~n?e.map((e=>Number(e.toFixed(n)))):e),o={h:e,s:t,v:n,a:i,toHSVA(){const e=[o.h,o.s,o.v,o.a];return e.toString=a(e,(e=>`hsva(${e[0]}, ${e[1]}%, ${e[2]}%, ${o.a})`)),e},toHSLA(){const e=[...m(o.h,o.s,o.v),o.a];return e.toString=a(e,(e=>`hsla(${e[0]}, ${e[1]}%, ${e[2]}%, ${o.a})`)),e},toRGBA(){const e=[...g(o.h,o.s,o.v),o.a];return e.toString=a(e,(e=>`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${o.a})`)),e},toCMYK(){const e=function(e,t,n){const i=g(e,t,n),a=i[0]/255,o=i[1]/255,s=i[2]/255,r=d(1-a,1-o,1-s);return[100*(1===r?0:(1-a-r)/(1-r)),100*(1===r?0:(1-o-r)/(1-r)),100*(1===r?0:(1-s-r)/(1-r)),100*r]}(o.h,o.s,o.v);return e.toString=a(e,(e=>`cmyk(${e[0]}%, ${e[1]}%, ${e[2]}%, ${e[3]}%)`)),e},toHEXA(){const e=function(e,t,n){return g(e,t,n).map((e=>f(e).toString(16).padStart(2,"0")))}(o.h,o.s,o.v),t=o.a>=1?"":Number((255*o.a).toFixed(0)).toString(16).toUpperCase().padStart(2,"0");return t&&e.push(t),e.toString=()=>`#${e.join("").toUpperCase()}`,e},clone:()=>E(o.h,o.s,o.v,o.a)};return o}const k=e=>Math.max(Math.min(e,1),0);function C(e){const t={options:Object.assign({lock:null,onchange:()=>0,onstop:()=>0},e),_keyboard(e){const{options:n}=t,{type:i,key:a}=e;if(document.activeElement===n.wrapper){const{lock:n}=t.options,o="ArrowUp"===a,s="ArrowRight"===a,r="ArrowDown"===a,l="ArrowLeft"===a;if("keydown"===i&&(o||s||r||l)){let i=0,a=0;"v"===n?i=o||s?1:-1:"h"===n?i=o||s?-1:1:(a=o?-1:r?1:0,i=l?-1:s?1:0),t.update(k(t.cache.x+.01*i),k(t.cache.y+.01*a)),e.preventDefault()}else a.startsWith("Arrow")&&(t.options.onstop(),e.preventDefault())}},_tapstart(e){a(document,["mouseup","touchend","touchcancel"],t._tapstop),a(document,["mousemove","touchmove"],t._tapmove),e.cancelable&&e.preventDefault(),t._tapmove(e)},_tapmove(e){const{options:n,cache:i}=t,{lock:a,element:o,wrapper:s}=n,r=s.getBoundingClientRect();let l=0,c=0;if(e){const t=e&&e.touches&&e.touches[0];l=e?(t||e).clientX:0,c=e?(t||e).clientY:0,l<r.left?l=r.left:l>r.left+r.width&&(l=r.left+r.width),c<r.top?c=r.top:c>r.top+r.height&&(c=r.top+r.height),l-=r.left,c-=r.top}else i&&(l=i.x*r.width,c=i.y*r.height);"h"!==a&&(o.style.left=`calc(${l/r.width*100}% - ${o.offsetWidth/2}px)`),"v"!==a&&(o.style.top=`calc(${c/r.height*100}% - ${o.offsetHeight/2}px)`),t.cache={x:l/r.width,y:c/r.height};const u=k(l/r.width),d=k(c/r.height);switch(a){case"v":return n.onchange(u);case"h":return n.onchange(d);default:return n.onchange(u,d)}},_tapstop(){t.options.onstop(),o(document,["mouseup","touchend","touchcancel"],t._tapstop),o(document,["mousemove","touchmove"],t._tapmove)},trigger(){t._tapmove()},update(e=0,n=0){const{left:i,top:a,width:o,height:s}=t.options.wrapper.getBoundingClientRect();"h"===t.options.lock&&(n=e),t._tapmove({clientX:i+o*e,clientY:a+s*n})},destroy(){const{options:e,_tapstart:n,_keyboard:i}=t;o(document,["keydown","keyup"],i),o([e.wrapper,e.element],"mousedown",n),o([e.wrapper,e.element],"touchstart",n,{passive:!1})}},{options:n,_tapstart:i,_keyboard:s}=t;return a([n.wrapper,n.element],"mousedown",i),a([n.wrapper,n.element],"touchstart",i,{passive:!1}),a(document,["keydown","keyup"],s),t}function D(e={}){e=Object.assign({onchange:()=>0,className:"",elements:[]},e);const t=a(e.elements,"click",(t=>{e.elements.forEach((n=>n.classList[t.target===n?"add":"remove"](e.className))),e.onchange(t),t.stopPropagation()}));return{destroy:()=>o(...t)}}const x={variantFlipOrder:{start:"sme",middle:"mse",end:"ems"},positionFlipOrder:{top:"tbrl",right:"rltb",bottom:"btrl",left:"lrbt"},position:"bottom",margin:8},S=(e,t,n)=>{const{container:i,margin:a,position:o,variantFlipOrder:s,positionFlipOrder:r}={container:document.documentElement.getBoundingClientRect(),...x,...n},{left:l,top:c}=t.style;t.style.left="0",t.style.top="0";const u=e.getBoundingClientRect(),d=t.getBoundingClientRect(),p={t:u.top-d.height-a,b:u.bottom+a,r:u.right+a,l:u.left-d.width-a},h={vs:u.left,vm:u.left+u.width/2+-d.width/2,ve:u.left+u.width-d.width,hs:u.top,hm:u.bottom-u.height/2-d.height/2,he:u.bottom-d.height},[f,g="middle"]=o.split("-"),m=r[f],y=s[g],{top:b,left:v,bottom:w,right:_}=i;for(const e of m){const n="t"===e||"b"===e,i=p[e],[a,o]=n?["top","left"]:["left","top"],[s,r]=n?[d.height,d.width]:[d.width,d.height],[l,c]=n?[w,_]:[_,w],[u,f]=n?[b,v]:[v,b];if(!(i<u||i+s>l))for(const s of y){const l=h[(n?"v":"h")+s];if(!(l<f||l+r>c))return t.style[o]=l-d[o]+"px",t.style[a]=i-d[a]+"px",e+s}}return t.style.left=l,t.style.top=c,null};function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class L{constructor(e){A(this,"_initializingActive",!0),A(this,"_recalc",!0),A(this,"_nanopop",null),A(this,"_root",null),A(this,"_color",E()),A(this,"_lastColor",E()),A(this,"_swatchColors",[]),A(this,"_setupAnimationFrame",null),A(this,"_eventListener",{init:[],save:[],hide:[],show:[],clear:[],change:[],changestop:[],cancel:[],swatchselect:[]}),this.options=e=Object.assign({...L.DEFAULT_OPTIONS},e);const{swatches:t,components:n,theme:i,sliders:a,lockOpacity:o,padding:s}=e;["nano","monolith"].includes(i)&&!a&&(e.sliders="h"),n.interaction||(n.interaction={});const{preview:r,opacity:l,hue:c,palette:u}=n;n.opacity=!o&&l,n.palette=u||r||l||c,this._preBuild(),this._buildComponents(),this._bindEvents(),this._finalBuild(),t&&t.length&&t.forEach((e=>this.addSwatch(e)));const{button:d,app:p}=this._root;this._nanopop=((e,t,n)=>{const i="object"!=typeof e||e instanceof HTMLElement?{reference:e,popper:t,...n}:e;return{update(e=i){const{reference:t,popper:n}=Object.assign(i,e);if(!n||!t)throw new Error("Popper- or reference-element missing.");return S(t,n,i)}}})(d,p,{margin:s}),d.setAttribute("role","button"),d.setAttribute("aria-label",this._t("btn:toggle"));const h=this;this._setupAnimationFrame=requestAnimationFrame((function t(){if(!p.offsetWidth)return requestAnimationFrame(t);h.setColor(e.default),h._rePositioningPicker(),e.defaultRepresentation&&(h._representation=e.defaultRepresentation,h.setColorRepresentation(h._representation)),e.showAlways&&h.show(),h._initializingActive=!1,h._emit("init")}))}_preBuild(){const{options:e}=this;for(const t of["el","container"])e[t]=c(e[t]);this._root=(e=>{const{components:t,useAsButton:n,inline:i,appClass:a,theme:o,lockOpacity:s}=e.options,l=e=>e?"":'style="display:none" hidden',c=t=>e._t(t),u=r(`\n      <div :ref="root" class="pickr">\n\n        ${n?"":'<button type="button" :ref="button" class="pcr-button"></button>'}\n\n        <div :ref="app" class="pcr-app ${a||""}" data-theme="${o}" ${i?'style="position: unset"':""} aria-label="${c("ui:dialog")}" role="window">\n          <div class="pcr-selection" ${l(t.palette)}>\n            <div :obj="preview" class="pcr-color-preview" ${l(t.preview)}>\n              <button type="button" :ref="lastColor" class="pcr-last-color" aria-label="${c("btn:last-color")}"></button>\n              <div :ref="currentColor" class="pcr-current-color"></div>\n            </div>\n\n            <div :obj="palette" class="pcr-color-palette">\n              <div :ref="picker" class="pcr-picker"></div>\n              <div :ref="palette" class="pcr-palette" tabindex="0" aria-label="${c("aria:palette")}" role="listbox"></div>\n            </div>\n\n            <div :obj="hue" class="pcr-color-chooser" ${l(t.hue)}>\n              <div :ref="picker" class="pcr-picker"></div>\n              <div :ref="slider" class="pcr-hue pcr-slider" tabindex="0" aria-label="${c("aria:hue")}" role="slider"></div>\n            </div>\n\n            <div :obj="opacity" class="pcr-color-opacity" ${l(t.opacity)}>\n              <div :ref="picker" class="pcr-picker"></div>\n              <div :ref="slider" class="pcr-opacity pcr-slider" tabindex="0" aria-label="${c("aria:opacity")}" role="slider"></div>\n            </div>\n          </div>\n\n          <div class="pcr-swatches ${t.palette?"":"pcr-last"}" :ref="swatches"></div>\n\n          <div :obj="interaction" class="pcr-interaction" ${l(Object.keys(t.interaction).length)}>\n            <input :ref="result" class="pcr-result" type="text" spellcheck="false" ${l(t.interaction.input)} aria-label="${c("aria:input")}">\n\n            <input :arr="options" class="pcr-type" data-type="HEXA" value="${s?"HEX":"HEXA"}" type="button" ${l(t.interaction.hex)}>\n            <input :arr="options" class="pcr-type" data-type="RGBA" value="${s?"RGB":"RGBA"}" type="button" ${l(t.interaction.rgba)}>\n            <input :arr="options" class="pcr-type" data-type="HSLA" value="${s?"HSL":"HSLA"}" type="button" ${l(t.interaction.hsla)}>\n            <input :arr="options" class="pcr-type" data-type="HSVA" value="${s?"HSV":"HSVA"}" type="button" ${l(t.interaction.hsva)}>\n            <input :arr="options" class="pcr-type" data-type="CMYK" value="CMYK" type="button" ${l(t.interaction.cmyk)}>\n\n            <input :ref="save" class="pcr-save" value="${c("btn:save")}" type="button" ${l(t.interaction.save)} aria-label="${c("aria:btn:save")}">\n            <input :ref="cancel" class="pcr-cancel" value="${c("btn:cancel")}" type="button" ${l(t.interaction.cancel)} aria-label="${c("aria:btn:cancel")}">\n            <input :ref="clear" class="pcr-clear" value="${c("btn:clear")}" type="button" ${l(t.interaction.clear)} aria-label="${c("aria:btn:clear")}">\n          </div>\n        </div>\n      </div>\n    `),d=u.interaction;return d.options.find((e=>!e.hidden&&!e.classList.add("active"))),d.type=()=>d.options.find((e=>e.classList.contains("active"))),u})(this),e.useAsButton&&(this._root.button=e.el),e.container.appendChild(this._root.root)}_finalBuild(){const e=this.options,t=this._root;if(e.container.removeChild(t.root),e.inline){const n=e.el.parentElement;e.el.nextSibling?n.insertBefore(t.app,e.el.nextSibling):n.appendChild(t.app)}else e.container.appendChild(t.app);e.useAsButton?e.inline&&e.el.remove():e.el.parentNode.replaceChild(t.root,e.el),e.disabled&&this.disable(),e.comparison||(t.button.style.transition="none",e.useAsButton||(t.preview.lastColor.style.transition="none")),this.hide()}_buildComponents(){const e=this,t=this.options.components,n=(e.options.sliders||"v").repeat(2),[i,a]=n.match(/^[vh]+$/g)?n:[],o=()=>this._color||(this._color=this._lastColor.clone()),s={palette:C({element:e._root.palette.picker,wrapper:e._root.palette.palette,onstop:()=>e._emit("changestop","slider",e),onchange(n,i){if(!t.palette)return;const a=o(),{_root:s,options:r}=e,{lastColor:l,currentColor:c}=s.preview;e._recalc&&(a.s=100*n,a.v=100-100*i,a.v<0&&(a.v=0),e._updateOutput("slider"));const u=a.toRGBA().toString(0);this.element.style.background=u,this.wrapper.style.background=`\n                        linear-gradient(to top, rgba(0, 0, 0, ${a.a}), transparent),\n                        linear-gradient(to left, hsla(${a.h}, 100%, 50%, ${a.a}), rgba(255, 255, 255, ${a.a}))\n                    `,r.comparison?r.useAsButton||e._lastColor||l.style.setProperty("--pcr-color",u):(s.button.style.setProperty("--pcr-color",u),s.button.classList.remove("clear"));const d=a.toHEXA().toString();for(const{el:t,color:n}of e._swatchColors)t.classList[d===n.toHEXA().toString()?"add":"remove"]("pcr-active");c.style.setProperty("--pcr-color",u)}}),hue:C({lock:"v"===a?"h":"v",element:e._root.hue.picker,wrapper:e._root.hue.slider,onstop:()=>e._emit("changestop","slider",e),onchange(n){if(!t.hue||!t.palette)return;const i=o();e._recalc&&(i.h=360*n),this.element.style.backgroundColor=`hsl(${i.h}, 100%, 50%)`,s.palette.trigger()}}),opacity:C({lock:"v"===i?"h":"v",element:e._root.opacity.picker,wrapper:e._root.opacity.slider,onstop:()=>e._emit("changestop","slider",e),onchange(n){if(!t.opacity||!t.palette)return;const i=o();e._recalc&&(i.a=Math.round(100*n)/100),this.element.style.background=`rgba(0, 0, 0, ${i.a})`,s.palette.trigger()}}),selectable:D({elements:e._root.interaction.options,className:"active",onchange(t){e._representation=t.target.getAttribute("data-type").toUpperCase(),e._recalc&&e._updateOutput("swatch")}})};this._components=s}_bindEvents(){const{_root:e,options:t}=this,n=[a(e.interaction.clear,"click",(()=>this._clearColor())),a([e.interaction.cancel,e.preview.lastColor],"click",(()=>{this.setHSVA(...(this._lastColor||this._color).toHSVA(),!0),this._emit("cancel")})),a(e.interaction.save,"click",(()=>{!this.applyColor()&&!t.showAlways&&this.hide()})),a(e.interaction.result,["keyup","input"],(e=>{this.setColor(e.target.value,!0)&&!this._initializingActive&&(this._emit("change",this._color,"input",this),this._emit("changestop","input",this)),e.stopImmediatePropagation()})),a(e.interaction.result,["focus","blur"],(e=>{this._recalc="blur"===e.type,this._recalc&&this._updateOutput(null)})),a([e.palette.palette,e.palette.picker,e.hue.slider,e.hue.picker,e.opacity.slider,e.opacity.picker],["mousedown","touchstart"],(()=>this._recalc=!0),{passive:!0})];if(!t.showAlways){const i=t.closeWithKey;n.push(a(e.button,"click",(()=>this.isOpen()?this.hide():this.show())),a(document,"keyup",(e=>this.isOpen()&&(e.key===i||e.code===i)&&this.hide())),a(document,["touchstart","mousedown"],(t=>{this.isOpen()&&!l(t).some((t=>t===e.app||t===e.button))&&this.hide()}),{capture:!0}))}if(t.adjustableNumbers){const t={rgba:[255,255,255,1],hsva:[360,100,100,1],hsla:[360,100,100,1],cmyk:[100,100,100,100]};u(e.interaction.result,((e,n,i)=>{const a=t[this.getColorRepresentation().toLowerCase()];if(a){const t=a[i],o=e+(t>=100?1e3*n:n);return o<=0?0:Number((o<t?o:t).toPrecision(3))}return e}))}if(t.autoReposition&&!t.inline){let e=null;const i=this;n.push(a(window,["scroll","resize"],(()=>{i.isOpen()&&(t.closeOnScroll&&i.hide(),null===e?(e=setTimeout((()=>e=null),100),requestAnimationFrame((function t(){i._rePositioningPicker(),null!==e&&requestAnimationFrame(t)}))):(clearTimeout(e),e=setTimeout((()=>e=null),100)))}),{capture:!0}))}this._eventBindings=n}_rePositioningPicker(){const{options:e}=this;if(!e.inline&&!this._nanopop.update({container:document.body.getBoundingClientRect(),position:e.position})){const e=this._root.app,t=e.getBoundingClientRect();e.style.top=(window.innerHeight-t.height)/2+"px",e.style.left=(window.innerWidth-t.width)/2+"px"}}_updateOutput(e){const{_root:t,_color:n,options:i}=this;if(t.interaction.type()){const e=`to${t.interaction.type().getAttribute("data-type")}`;t.interaction.result.value="function"==typeof n[e]?n[e]().toString(i.outputPrecision):""}!this._initializingActive&&this._recalc&&this._emit("change",n,e,this)}_clearColor(e=!1){const{_root:t,options:n}=this;n.useAsButton||t.button.style.setProperty("--pcr-color","rgba(0, 0, 0, 0.15)"),t.button.classList.add("clear"),n.showAlways||this.hide(),this._lastColor=null,this._initializingActive||e||(this._emit("save",null),this._emit("clear"))}_parseLocalColor(e){const{values:t,type:n,a:i}=_(e),{lockOpacity:a}=this.options,o=void 0!==i&&1!==i;return t&&3===t.length&&(t[3]=void 0),{values:!t||a&&o?null:t,type:n}}_t(e){return this.options.i18n[e]||L.I18N_DEFAULTS[e]}_emit(e,...t){this._eventListener[e].forEach((e=>e(...t,this)))}on(e,t){return this._eventListener[e].push(t),this}off(e,t){const n=this._eventListener[e]||[],i=n.indexOf(t);return~i&&n.splice(i,1),this}addSwatch(e){const{values:t}=this._parseLocalColor(e);if(t){const{_swatchColors:e,_root:n}=this,i=E(...t),o=s(`<button type="button" style="--pcr-color: ${i.toRGBA().toString(0)}" aria-label="${this._t("btn:swatch")}"/>`);return n.swatches.appendChild(o),e.push({el:o,color:i}),this._eventBindings.push(a(o,"click",(()=>{this.setHSVA(...i.toHSVA(),!0),this._emit("swatchselect",i),this._emit("change",i,"swatch",this)}))),!0}return!1}removeSwatch(e){const t=this._swatchColors[e];if(t){const{el:n}=t;return this._root.swatches.removeChild(n),this._swatchColors.splice(e,1),!0}return!1}applyColor(e=!1){const{preview:t,button:n}=this._root,i=this._color.toRGBA().toString(0);return t.lastColor.style.setProperty("--pcr-color",i),this.options.useAsButton||n.style.setProperty("--pcr-color",i),n.classList.remove("clear"),this._lastColor=this._color.clone(),this._initializingActive||e||this._emit("save",this._color),this}destroy(){cancelAnimationFrame(this._setupAnimationFrame),this._eventBindings.forEach((e=>o(...e))),Object.keys(this._components).forEach((e=>this._components[e].destroy()))}destroyAndRemove(){this.destroy();const{root:e,app:t}=this._root;e.parentElement&&e.parentElement.removeChild(e),t.parentElement.removeChild(t),Object.keys(this).forEach((e=>this[e]=null))}hide(){return!!this.isOpen()&&(this._root.app.classList.remove("visible"),this._emit("hide"),!0)}show(){return!this.options.disabled&&!this.isOpen()&&(this._root.app.classList.add("visible"),this._rePositioningPicker(),this._emit("show",this._color),this)}isOpen(){return this._root.app.classList.contains("visible")}setHSVA(e=360,t=0,n=0,i=1,a=!1){const o=this._recalc;if(this._recalc=!1,e<0||e>360||t<0||t>100||n<0||n>100||i<0||i>1)return!1;this._color=E(e,t,n,i);const{hue:s,opacity:r,palette:l}=this._components;return s.update(e/360),r.update(i),l.update(t/100,1-n/100),a||this.applyColor(),o&&this._updateOutput(),this._recalc=o,!0}setColor(e,t=!1){if(null===e)return this._clearColor(t),!0;const{values:n,type:i}=this._parseLocalColor(e);if(n){const e=i.toUpperCase(),{options:a}=this._root.interaction,o=a.find((t=>t.getAttribute("data-type")===e));if(o&&!o.hidden)for(const e of a)e.classList[e===o?"add":"remove"]("active");return!!this.setHSVA(...n,t)&&this.setColorRepresentation(e)}return!1}setColorRepresentation(e){return e=e.toUpperCase(),!!this._root.interaction.options.find((t=>t.getAttribute("data-type").startsWith(e)&&!t.click()))}getColorRepresentation(){return this._representation}getColor(){return this._color}getSelectedColor(){return this._lastColor}getRoot(){return this._root}disable(){return this.hide(),this.options.disabled=!0,this._root.button.classList.add("disabled"),this}enable(){return this.options.disabled=!1,this._root.button.classList.remove("disabled"),this}}return A(L,"utils",n),A(L,"version","1.8.2"),A(L,"I18N_DEFAULTS",{"ui:dialog":"color picker dialog","btn:toggle":"toggle color picker dialog","btn:swatch":"color swatch","btn:last-color":"use previous color","btn:save":"Save","btn:cancel":"Cancel","btn:clear":"Clear","aria:btn:save":"save and close","aria:btn:cancel":"cancel and close","aria:btn:clear":"clear and close","aria:input":"color input field","aria:palette":"color selection area","aria:hue":"hue selection slider","aria:opacity":"selection slider"}),A(L,"DEFAULT_OPTIONS",{appClass:null,theme:"classic",useAsButton:!1,padding:8,disabled:!1,comparison:!0,closeOnScroll:!1,outputPrecision:0,lockOpacity:!1,autoReposition:!0,container:"body",components:{interaction:{}},i18n:{},swatches:null,inline:!1,sliders:null,default:"#42445a",defaultRepresentation:null,position:"bottom-middle",adjustableNumbers:!0,showAlways:!1,closeWithKey:"Escape"}),A(L,"create",(e=>new L(e))),t.default})()},9444:(e,t,n)=>{"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,a,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return o}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}n.r(t),n.d(t,{PDFPrintServiceFactory:()=>ld,PDFViewerApplication:()=>fu,webViewerPageNumberChanged:()=>qu});var c="auto",u=1.1,d=.1,p=10,h=0,f=1,g=2,m=3,y=0,b=1,v=2,w=3,_=-1,E=0,k=1,C=2,D=3,x=4,S="canvas",A="svg",L=0,T=1,B=2,P={UNKNOWN:-1,VERTICAL:0,HORIZONTAL:1,WRAPPED:2,PAGE:3},I={UNKNOWN:-1,NONE:0,ODD:1,EVEN:2},M=/\bprint\s*\(/,F=function(){function e(){s(this,e);var t=window.devicePixelRatio||1;this.sx=t,this.sy=t}return l(e,[{key:"scaled",get:function(){return 1!==this.sx||1!==this.sy}}]),e}();function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.offsetParent;if(i){for(var a=e.offsetTop+e.clientTop,o=e.offsetLeft+e.clientLeft;i.clientHeight===i.scrollHeight&&i.clientWidth===i.scrollWidth||n&&(i.classList.contains("markedContent")||"hidden"===getComputedStyle(i).overflow);)if(a+=i.offsetTop,o+=i.offsetLeft,!(i=i.offsetParent))return;t&&(void 0!==t.top&&(a+=t.top),void 0!==t.left&&(o+=t.left,i.scrollLeft=o)),i.scrollTop=a}else console.error("offsetParent is not set -- cannot scroll")}function $(e,t){var n=function(n){a||(a=window.requestAnimationFrame((function(){a=null;var n=e.scrollLeft,o=i.lastX;n!==o&&(i.right=n>o),i.lastX=n;var s=e.scrollTop,r=i.lastY;s!==r&&(i.down=s>r),i.lastY=s,t(i)})))},i={right:!0,down:!0,lastX:e.scrollLeft,lastY:e.scrollTop,_eventHandler:n},a=null;return e.addEventListener("scroll",n,!0),i}function O(e){var t,n=new Map,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){l=!0,s=e},f:function(){try{r||null==n.return||n.return()}finally{if(l)throw s}}}}(new URLSearchParams(e));try{for(o.s();!(t=o.n()).done;){var s=i(t.value,2),r=s[0],l=s[1];n.set(r.toLowerCase(),l)}}catch(e){o.e(e)}finally{o.f()}return n}var H=/\x00/g,R=/[\x01-\x1F]/g;function q(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"string"!=typeof e?(console.error("The argument must be a string."),e):(t&&(e=e.replace(R," ")),e.replace(H,""))}function j(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=n,a=e.length-1;if(a<0||!t(e[a]))return e.length;if(t(e[i]))return i;for(;i<a;){var o=i+a>>1,s=e[o];t(s)?a=o:i=o+1}return i}function U(e){if(Math.floor(e)===e)return[e,1];var t=1/e;if(t>8)return[1,8];if(Math.floor(t)===t)return[1,t];for(var n=e>1?t:e,i=0,a=1,o=1,s=1;;){var r=i+o,l=a+s;if(l>8)break;n<=r/l?(o=r,s=l):(i=r,a=l)}return n-i/a<o/s-n?n===e?[i,a]:[a,i]:n===e?[o,s]:[s,o]}function z(e,t){var n=e%t;return 0===n?e:Math.round(e-n+t)}function W(e){var t=e.scrollEl,n=e.views,i=e.sortByVisibility,a=void 0!==i&&i,o=e.horizontal,s=void 0!==o&&o,r=e.rtl,l=void 0!==r&&r,c=t.scrollTop,u=c+t.clientHeight,d=t.scrollLeft,p=d+t.clientWidth;var h=[],f=new Set,g=n.length,m=j(n,s?function(e){var t=e.div,n=t.offsetLeft+t.clientLeft,i=n+t.clientWidth;return l?n<p:i>d}:function(e){var t=e.div;return t.offsetTop+t.clientTop+t.clientHeight>c});m>0&&m<g&&!s&&(m=function(e,t,n){if(e<2)return e;var i=t[e].div,a=i.offsetTop+i.clientTop;a>=n&&(a=(i=t[e-1].div).offsetTop+i.clientTop);for(var o=e-2;o>=0&&!((i=t[o].div).offsetTop+i.clientTop+i.clientHeight<=a);--o)e=o;return e}(m,n,c));for(var y=s?p:-1,b=m;b<g;b++){var v=n[b],w=v.div,_=w.offsetLeft+w.clientLeft,E=w.offsetTop+w.clientTop,k=w.clientWidth,C=w.clientHeight,D=_+k,x=E+C;if(-1===y)x>=u&&(y=x);else if((s?_:E)>y)break;if(!(x<=c||E>=u||D<=d||_>=p)){var S=Math.max(0,c-E)+Math.max(0,x-u),A=(k-(Math.max(0,d-_)+Math.max(0,D-p)))/k,L=(C-S)/C*A*100|0;h.push({id:v.id,x:_,y:E,view:v,percent:L,widthPercent:100*A|0}),f.add(v.id)}}var T=h[0],B=h[h.length-1];return a&&h.sort((function(e,t){var n=e.percent-t.percent;return Math.abs(n)>.001?-n:e.id-t.id})),{first:T,last:B,views:h,ids:f}}function G(e){e.preventDefault()}function V(e){var t=Math.hypot(e.deltaX,e.deltaY),n=Math.atan2(e.deltaY,e.deltaX);return-.25*Math.PI<n&&n<.75*Math.PI&&(t=-t),t}function Y(e){return Number.isInteger(e)&&e%90==0}function K(e){return Number.isInteger(e)&&Object.values(P).includes(e)&&e!==P.UNKNOWN}function Z(e){return Number.isInteger(e)&&Object.values(I).includes(e)&&e!==I.UNKNOWN}function J(e){return e.width<=e.height}var X=new Promise((function(e){"undefined"!=typeof PDFJSDev&&PDFJSDev.test("LIB")&&"undefined"==typeof window?setTimeout(e,20):window.requestAnimationFrame(e)}));var Q=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.height,a=n.width,o=n.units;s(this,e),this.visible=!0,this.div=t.querySelector("#loadingBar .progress"),this.bar=this.div.parentNode,this.height=i||100,this.width=a||100,this.units=o||"%",this.div.style.height=this.height+this.units,this.percent=0}return l(e,[{key:"_updateBar",value:function(){if(this._indeterminate)return this.div.classList.add("indeterminate"),void(this.div.style.width=this.width+this.units);this.div.classList.remove("indeterminate");var e=this.width*this._percent/100;this.div.style.width=e+this.units}},{key:"percent",get:function(){return this._percent},set:function(e){var t,n,i;this._indeterminate=isNaN(e),this._percent=(t=e,n=0,i=100,Math.min(Math.max(t,n),i)),this._updateBar()}},{key:"setWidth",value:function(e){if(e){var t=e.parentNode.offsetWidth-e.offsetWidth;if(t>0)document.documentElement.style.setProperty("--loadingBar-end-offset","".concat(t,"px"))}}},{key:"hide",value:function(){this.visible&&(this.visible=!1,this.bar.classList.add("fn__hidden"))}},{key:"show",value:function(){this.visible||(this.visible=!0,this.bar.classList.remove("fn__hidden"))}}]),e}();function ee(e){var t=P.VERTICAL,n=I.NONE;switch(e){case"SinglePage":t=P.PAGE;break;case"OneColumn":break;case"TwoPageLeft":t=P.PAGE;case"TwoColumnLeft":n=I.ODD;break;case"TwoPageRight":t=P.PAGE;case"TwoColumnRight":n=I.EVEN}return{scrollMode:t,spreadMode:n}}function te(e){switch(e){case"UseNone":return E;case"UseThumbs":return k;case"UseOutlines":return C;case"UseAttachments":return D;case"UseOC":return x}return E}var ne=n(5e3);function ie(){return ie="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=ae(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},ie.apply(this,arguments)}function ae(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=le(e)););return e}function oe(e,t){return oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},oe(e,t)}function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=le(e);if(t){var a=le(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return re(this,n)}}function re(e,t){if(t&&("object"===fe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function le(e){return le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},le(e)}function ce(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ue(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function he(e,t,n){return t&&pe(e.prototype,t),n&&pe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}var ge="event",me="timeout";var ye=function(){function e(){de(this,e),this._listeners=Object.create(null)}return he(e,[{key:"on",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._on(e,t,{external:!0,once:null==n?void 0:n.once})}},{key:"off",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._off(e,t,{external:!0,once:null==n?void 0:n.once})}},{key:"dispatch",value:function(e,t){var n=this._listeners[e];if(n&&0!==n.length){var i,a,o=ce(n.slice(0));try{for(o.s();!(a=o.n()).done;){var s=a.value,r=s.listener,l=s.external;s.once&&this._off(e,r),l?(i||(i=[])).push(r):r(t)}}catch(e){o.e(e)}finally{o.f()}if(i){var c,u=ce(i);try{for(u.s();!(c=u.n()).done;){(0,c.value)(t)}}catch(e){u.e(e)}finally{u.f()}i=null}}}},{key:"_on",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=(n=this._listeners)[e]||(n[e]=[]);a.push({listener:t,external:!0===(null==i?void 0:i.external),once:!0===(null==i?void 0:i.once)})}},{key:"_off",value:function(e,t){var n=this._listeners[e];if(n)for(var i=0,a=n.length;i<a;i++)if(n[i].listener===t)return void n.splice(i,1)}}]),e}(),be=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oe(e,t)}(n,e);var t=se(n);function n(){return de(this,n),t.apply(this,arguments)}return he(n,[{key:"dispatch",value:function(e,t){if("undefined"!=typeof PDFJSDev&&!PDFJSDev.test("MOZCENTRAL"))throw new Error("Not implemented: AutomationEventBus.dispatch");ie(le(n.prototype),"dispatch",this).call(this,e,t);var i=Object.create(null);if(t)for(var a in t){var o=t[a];if("source"!==a)i[a]=o;else if(o===window||o===document)return}var s=document.createEvent("CustomEvent");s.initCustomEvent(e,!0,!0,i),document.dispatchEvent(s)}}]),n}(ye),ve=n(2843);function we(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _e(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function Ee(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var ke="grab-to-pan-grab",Ce=new WeakSet,De=new WeakSet,xe=new WeakSet,Se=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_e(this,xe),_e(this,De),_e(this,Ce),this.element=t.element,this.document=t.element.ownerDocument,"function"==typeof t.ignoreTarget&&(this.ignoreTarget=t.ignoreTarget),this.onActiveChanged=t.onActiveChanged,this.activate=this.activate.bind(this),this.deactivate=this.deactivate.bind(this),this.toggle=this.toggle.bind(this),this._onMouseDown=Ee(this,Ce,Ae).bind(this),this._onMouseMove=Ee(this,De,Le).bind(this),this._endPan=Ee(this,xe,Te).bind(this),(this.overlay=document.createElement("div")).className="grab-to-pan-grabbing"}var t,n,i;return t=e,(n=[{key:"activate",value:function(){var e;this.active||(this.active=!0,this.element.addEventListener("mousedown",this._onMouseDown,!0),this.element.classList.add(ke),null===(e=this.onActiveChanged)||void 0===e||e.call(this,!0))}},{key:"deactivate",value:function(){var e;this.active&&(this.active=!1,this.element.removeEventListener("mousedown",this._onMouseDown,!0),this._endPan(),this.element.classList.remove(ke),null===(e=this.onActiveChanged)||void 0===e||e.call(this,!1))}},{key:"toggle",value:function(){this.active?this.deactivate():this.activate()}},{key:"ignoreTarget",value:function(e){return e.matches("a[href], a[href] *, input, textarea, button, button *, select, option")}}])&&we(t.prototype,n),i&&we(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ae(e){if(0===e.button&&!this.ignoreTarget(e.target)){if(e.originalTarget)try{e.originalTarget.tagName}catch(e){return}this.scrollLeftStart=this.element.scrollLeft,this.scrollTopStart=this.element.scrollTop,this.clientXStart=e.clientX,this.clientYStart=e.clientY,this.document.addEventListener("mousemove",this._onMouseMove,!0),this.document.addEventListener("mouseup",this._endPan,!0),this.element.addEventListener("scroll",this._endPan,!0),e.preventDefault(),e.stopPropagation();var t=document.activeElement;t&&!t.contains(e.target)&&t.blur()}}function Le(e){if(this.element.removeEventListener("scroll",this._endPan,!0),1&e.buttons){var t=e.clientX-this.clientXStart,n=e.clientY-this.clientYStart,i=this.scrollTopStart-n,a=this.scrollLeftStart-t;this.element.scrollTo?this.element.scrollTo({top:i,left:a,behavior:"instant"}):(this.element.scrollTop=i,this.element.scrollLeft=a),this.overlay.parentNode||document.body.appendChild(this.overlay)}else this._endPan()}function Te(){this.element.removeEventListener("scroll",this._endPan,!0),this.document.removeEventListener("mousemove",this._onMouseMove,!0),this.document.removeEventListener("mouseup",this._endPan,!0),this.overlay.remove()}function Be(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Pe(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function Ie(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var Me=0,Fe=1,Ne=new WeakSet,$e=new WeakSet,Oe=function(){function e(t){var n=this,i=t.container,a=t.eventBus,o=t.cursorToolOnLoad,s=void 0===o?Me:o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Pe(this,$e),Pe(this,Ne),this.container=i,this.eventBus=a,this.active=Me,this.activeBeforePresentationMode=null,this.handTool=new Se({element:this.container}),Ie(this,$e,Re).call(this),Promise.resolve().then((function(){n.switchTool(s)}))}var t,n,i;return t=e,(n=[{key:"activeTool",get:function(){return this.active}},{key:"switchTool",value:function(e){var t=this;if(null===this.activeBeforePresentationMode&&e!==this.active){var n=function(){switch(t.active){case Me:break;case Fe:t.handTool.deactivate()}};switch(e){case Me:n();break;case Fe:n(),this.handTool.activate();break;default:return void console.error('switchTool: "'.concat(e,'" is an unsupported value.'))}this.active=e,Ie(this,Ne,He).call(this)}}}])&&Be(t.prototype,n),i&&Be(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function He(){this.eventBus.dispatch("cursortoolchanged",{source:this,tool:this.active})}function Re(){var e=this;this.eventBus._on("switchcursortool",(function(t){e.switchTool(t.tool)})),this.eventBus._on("presentationmodechanged",(function(t){switch(t.state){case w:var n=e.active;e.switchTool(Me),e.activeBeforePresentationMode=n;break;case b:var i=e.activeBeforePresentationMode;e.activeBeforePresentationMode=null,e.switchTool(i)}}))}function qe(e){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(e)}function je(){je=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==qe(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ue(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function ze(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){Ue(o,i,a,s,r,"next",e)}function r(e){Ue(o,i,a,s,r,"throw",e)}s(void 0)}))}}function We(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ge(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ve(e,t,n){return t&&Ge(e.prototype,t),n&&Ge(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ye(e,t){Ze(e,t),t.add(e)}function Ke(e,t,n){Ze(e,t),t.set(e,n)}function Ze(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Je(e,t,n){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),n}function Xe(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function Qe(e,t){var n=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,n)}var et="noopener noreferrer nofollow",tt=0,nt=1,it=2,at=3,ot=4;function st(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.url,i=t.target,a=t.rel,o=t.enabled,s=void 0===o||o;if(!n||"string"!=typeof n)throw new Error('A valid "url" parameter must provided.');var r=q(n);s?e.href=e.title=r:(e.href="",e.title="Disabled: ".concat(r),e.onclick=function(){return!1});var l="";switch(i){case tt:break;case nt:l="_self";break;case it:l="_blank";break;case at:l="_parent";break;case ot:l="_top"}e.target=l,e.rel="string"==typeof a?a:et}var rt=new WeakMap,lt=new WeakSet,ct=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.eventBus,i=t.externalLinkTarget,a=void 0===i?null:i,o=t.externalLinkRel,s=void 0===o?null:o,r=t.ignoreDestinationZoom,l=void 0!==r&&r;We(this,e),Ye(this,lt),Ke(this,rt,{writable:!0,value:new Map}),this.eventBus=n,this.externalLinkTarget=a,this.externalLinkRel=s,this.externalLinkEnabled=!0,this._ignoreDestinationZoom=l,this.baseUrl=null,this.pdfDocument=null,this.pdfViewer=null,this.pdfHistory=null}var t;return Ve(e,[{key:"setDocument",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.baseUrl=t,this.pdfDocument=e,Qe(this,rt).clear()}},{key:"setViewer",value:function(e){this.pdfViewer=e}},{key:"setHistory",value:function(e){this.pdfHistory=e}},{key:"pagesCount",get:function(){return this.pdfDocument?this.pdfDocument.numPages:0}},{key:"page",get:function(){return this.pdfViewer.currentPageNumber},set:function(e){this.pdfViewer.currentPageNumber=e}},{key:"rotation",get:function(){return this.pdfViewer.pagesRotation},set:function(e){this.pdfViewer.pagesRotation=e}},{key:"goToDestination",value:(t=ze(je().mark((function e(t){var n,i;return je().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pdfDocument){e.next=2;break}return e.abrupt("return");case 2:if("string"!=typeof t){e.next=9;break}return n=t,e.next=6,this.pdfDocument.getDestination(t);case 6:i=e.sent,e.next=13;break;case 9:return n=null,e.next=12,t;case 12:i=e.sent;case 13:if(Array.isArray(i)){e.next=16;break}return console.error('PDFLinkService.goToDestination: "'.concat(i,'" is not ')+'a valid destination array, for dest="'.concat(t,'".')),e.abrupt("return");case 16:Xe(this,lt,ut).call(this,t,n,i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"goToPage",value:function(e){if(this.pdfDocument){var t="string"==typeof e&&this.pdfViewer.pageLabelToPageNumber(e)||0|e;Number.isInteger(t)&&t>0&&t<=this.pagesCount?(this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.pushPage(t)),this.pdfViewer.scrollPageIntoView({pageNumber:t})):console.error('PDFLinkService.goToPage: "'.concat(e,'" is not a valid page.'))}}},{key:"addLinkAttributes",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];st(e,{url:t,target:n?it:this.externalLinkTarget,rel:this.externalLinkRel,enabled:this.externalLinkEnabled})}},{key:"getDestinationHash",value:function(e){if("string"==typeof e){if(e.length>0)return this.getAnchorUrl("#"+escape(e))}else if(Array.isArray(e)){var t=JSON.stringify(e);if(t.length>0)return this.getAnchorUrl("#"+escape(t))}return this.getAnchorUrl("")}},{key:"getAnchorUrl",value:function(e){return(this.baseUrl||"")+e}},{key:"setHash",value:function(t){var n,i;if(this.pdfDocument)if(t.includes("=")){var a=O(t);if(a.has("search")&&this.eventBus.dispatch("findfromurlhash",{source:this,query:a.get("search").replace(/"/g,""),phraseSearch:"true"===a.get("phrase")}),a.has("page")&&(n=0|a.get("page")||1),a.has("zoom")){var o=a.get("zoom").split(","),s=o[0],r=parseFloat(s);s.includes("Fit")?"Fit"===s||"FitB"===s?i=[null,{name:s}]:"FitH"===s||"FitBH"===s||"FitV"===s||"FitBV"===s?i=[null,{name:s},o.length>1?0|o[1]:null]:"FitR"===s?5!==o.length?console.error('PDFLinkService.setHash: Not enough parameters for "FitR".'):i=[null,{name:s},0|o[1],0|o[2],0|o[3],0|o[4]]:console.error('PDFLinkService.setHash: "'.concat(s,'" is not a valid zoom value.')):i=[null,{name:"XYZ"},o.length>1?0|o[1]:null,o.length>2?0|o[2]:null,r?r/100:s]}i?this.pdfViewer.scrollPageIntoView({pageNumber:n||this.page,destArray:i,allowNegativeOffset:!0}):n&&(this.page=n),a.has("pagemode")&&this.eventBus.dispatch("pagemode",{source:this,mode:a.get("pagemode")}),a.has("nameddest")&&this.goToDestination(a.get("nameddest"))}else{i=unescape(t);try{i=JSON.parse(i),Array.isArray(i)||(i=i.toString())}catch(e){}if("string"==typeof i||Je(e,e,dt).call(e,i))return void this.goToDestination(i);console.error('PDFLinkService.setHash: "'.concat(unescape(t),'" is not a valid destination.'))}}},{key:"executeNamedAction",value:function(e){var t,n;switch(e){case"GoBack":null===(t=this.pdfHistory)||void 0===t||t.back();break;case"GoForward":null===(n=this.pdfHistory)||void 0===n||n.forward();break;case"NextPage":this.pdfViewer.nextPage();break;case"PrevPage":this.pdfViewer.previousPage();break;case"LastPage":this.page=this.pagesCount;break;case"FirstPage":this.page=1}this.eventBus.dispatch("namedaction",{source:this,action:e})}},{key:"cachePageRef",value:function(e,t){if(t){var n=0===t.gen?"".concat(t.num,"R"):"".concat(t.num,"R").concat(t.gen);Qe(this,rt).set(n,e)}}},{key:"_cachedPageNumber",value:function(e){if(!e)return null;var t=0===e.gen?"".concat(e.num,"R"):"".concat(e.num,"R").concat(e.gen);return Qe(this,rt).get(t)||null}},{key:"isPageVisible",value:function(e){return this.pdfViewer.isPageVisible(e)}},{key:"isPageCached",value:function(e){return this.pdfViewer.isPageCached(e)}}]),e}();function ut(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,o=a[0];if("object"===qe(o)&&null!==o){if(!(t=this._cachedPageNumber(o)))return void this.pdfDocument.getPageIndex(o).then((function(t){n.cachePageRef(t+1,o),Xe(n,lt,ut).call(n,e,i,a)})).catch((function(){console.error('PDFLinkService.#goToDestinationHelper: "'.concat(o,'" is not ')+'a valid page reference, for dest="'.concat(e,'".'))}))}else{if(!Number.isInteger(o))return void console.error('PDFLinkService.#goToDestinationHelper: "'.concat(o,'" is not ')+'a valid destination reference, for dest="'.concat(e,'".'));t=o+1}!t||t<1||t>this.pagesCount?console.error('PDFLinkService.#goToDestinationHelper: "'.concat(t,'" is not ')+'a valid page number, for dest="'.concat(e,'".')):(this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.push({namedDest:i,explicitDest:a,pageNumber:t})),this.pdfViewer.scrollPageIntoView({pageNumber:t,destArray:a,ignoreDestinationZoom:this._ignoreDestinationZoom}))}function dt(e){if(!Array.isArray(e))return!1;var t=e.length;if(t<2)return!1;var n=e[0];if(!("object"===qe(n)&&Number.isInteger(n.num)&&Number.isInteger(n.gen)||Number.isInteger(n)&&n>=0))return!1;var i=e[1];if("object"!==qe(i)||"string"!=typeof i.name)return!1;var a=!0;switch(i.name){case"XYZ":if(5!==t)return!1;break;case"Fit":case"FitB":return 2===t;case"FitH":case"FitBH":case"FitV":case"FitBV":if(3!==t)return!1;break;case"FitR":if(6!==t)return!1;a=!1;break;default:return!1}for(var o=2;o<t;o++){var s=e[o];if(!("number"==typeof s||a&&null===s))return!1}return!0}var pt=function(){function e(){We(this,e),this.externalLinkEnabled=!0}var t;return Ve(e,[{key:"pagesCount",get:function(){return 0}},{key:"page",get:function(){return 0},set:function(e){}},{key:"rotation",get:function(){return 0},set:function(e){}},{key:"goToDestination",value:(t=ze(je().mark((function e(t){return je().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"goToPage",value:function(e){}},{key:"addLinkAttributes",value:function(e,t){st(e,{url:t,enabled:this.externalLinkEnabled})}},{key:"getDestinationHash",value:function(e){return"#"}},{key:"getAnchorUrl",value:function(e){return"#"}},{key:"setHash",value:function(e){}},{key:"executeNamedAction",value:function(e){}},{key:"cachePageRef",value:function(e,t){}},{key:"isPageVisible",value:function(e){return!0}},{key:"isPageCached",value:function(e){return!0}}]),e}();function ht(e){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ht(e)}function ft(){ft=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==ht(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function gt(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function mt(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){gt(o,i,a,s,r,"next",e)}function r(e){gt(o,i,a,s,r,"throw",e)}s(void 0)}))}}function yt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function bt(e,t){wt(e,t),t.add(e)}function vt(e,t,n){wt(e,t),t.set(e,n)}function wt(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _t(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Ct(e,t,"set"),n),n}function Et(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function kt(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Ct(e,t,"get"))}function Ct(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var Dt=new WeakMap,xt=new WeakMap,St=new WeakMap,At=new WeakSet,Lt=new WeakSet,Tt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),bt(this,Lt),bt(this,At),vt(this,Dt,{writable:!0,value:Object.create(null)}),vt(this,xt,{writable:!0,value:null}),vt(this,St,{writable:!0,value:null})}var t,n,i,a,o,s,r;return t=e,n=[{key:"active",get:function(){return kt(this,xt)}},{key:"register",value:(r=mt(ft().mark((function e(t,n){var i,a,o,s=arguments;return ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.length>2&&void 0!==s[2]?s[2]:null,a=s.length>3&&void 0!==s[3]&&s[3],t&&n&&(o=n.parentNode)){e.next=6;break}throw new Error("Not enough parameters.");case 6:if(!kt(this,Dt)[t]){e.next=8;break}throw new Error("The overlay is already registered.");case 8:kt(this,Dt)[t]={element:n,container:o,callerCloseMethod:i,canForceClose:a};case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"unregister",value:(s=mt(ft().mark((function e(t){return ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(this,Dt)[t]){e.next=4;break}throw new Error("The overlay does not exist.");case 4:if(kt(this,xt)!==t){e.next=6;break}throw new Error("The overlay cannot be removed while it is active.");case 6:delete kt(this,Dt)[t];case 7:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"open",value:(o=mt(ft().mark((function e(t){return ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(this,Dt)[t]){e.next=4;break}throw new Error("The overlay does not exist.");case 4:if(!kt(this,xt)){e.next=14;break}if(kt(this,xt)!==t){e.next=9;break}throw new Error("The overlay is already active.");case 9:if(!kt(this,Dt)[t].canForceClose){e.next=13;break}Et(this,Lt,Pt).call(this),e.next=14;break;case 13:throw new Error("Another overlay is currently active.");case 14:_t(this,xt,t),kt(this,Dt)[kt(this,xt)].element.classList.remove("fn__hidden"),kt(this,Dt)[kt(this,xt)].container.classList.remove("fn__hidden"),_t(this,St,Et(this,At,Bt).bind(this)),window.addEventListener("keydown",kt(this,St));case 19:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"close",value:(a=mt(ft().mark((function e(t){return ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt(this,Dt)[t]){e.next=4;break}throw new Error("The overlay does not exist.");case 4:if(kt(this,xt)){e.next=8;break}throw new Error("The overlay is currently not active.");case 8:if(kt(this,xt)===t){e.next=10;break}throw new Error("Another overlay is currently active.");case 10:kt(this,Dt)[kt(this,xt)].container.classList.add("fn__hidden"),kt(this,Dt)[kt(this,xt)].element.classList.add("fn__hidden"),_t(this,xt,null),window.removeEventListener("keydown",kt(this,St)),_t(this,St,null);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})}],n&&yt(t.prototype,n),i&&yt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Bt(e){kt(this,xt)&&27===e.keyCode&&(Et(this,Lt,Pt).call(this),e.preventDefault())}function Pt(){kt(this,Dt)[kt(this,xt)].callerCloseMethod&&kt(this,Dt)[kt(this,xt)].callerCloseMethod(),kt(this,xt)&&this.close(kt(this,xt))}function It(e){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},It(e)}function Mt(){Mt=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==It(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ft(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function Nt(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){Ft(o,i,a,s,r,"next",e)}function r(e){Ft(o,i,a,s,r,"throw",e)}s(void 0)}))}}function $t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ot(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ht(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function Rt(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var qt=new WeakSet,jt=new WeakSet,Ut=function(){function e(t,n,i){var a=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];$t(this,e),Ht(this,jt),Ht(this,qt),this.overlayName=t.overlayName,this.container=t.container,this.label=t.label,this.input=t.input,this.submitButton=t.submitButton,this.cancelButton=t.cancelButton,this.overlayManager=n,this.l10n=i,this._isViewerEmbedded=o,this.updateCallback=null,this.reason=null,this.submitButton.addEventListener("click",Rt(this,qt,zt).bind(this)),this.cancelButton.addEventListener("click",Rt(this,jt,Wt).bind(this)),this.input.addEventListener("keydown",(function(e){13===e.keyCode&&Rt(a,qt,zt).call(a)})),this.overlayManager.register(this.overlayName,this.container,Rt(this,jt,Wt).bind(this),!0)}var t,n,i,a,o;return t=e,n=[{key:"open",value:(o=Nt(Mt().mark((function e(){var t;return Mt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.overlayManager.open(this.overlayName);case 2:t=this.reason===ve.PasswordResponses.INCORRECT_PASSWORD,this._isViewerEmbedded&&!t||this.input.focus(),this.label.textContent=window.siyuan.languages["password_".concat(t?"invalid":"label")];case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"close",value:(a=Nt(Mt().mark((function e(){return Mt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.overlayManager.close(this.overlayName);case 2:this.input.value="";case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"setUpdateCallback",value:function(e,t){this.updateCallback=e,this.reason=t}}],n&&Ot(t.prototype,n),i&&Ot(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function zt(){var e=this.input.value;(null==e?void 0:e.length)>0&&(this.close(),this.updateCallback(e))}function Wt(){this.close(),this.updateCallback(new Error("PasswordPrompt cancelled."))}function Gt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Vt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function Vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Yt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Kt="selected",Zt=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructor===e)throw new Error("Cannot initialize BaseTreeViewer.");this.container=t.container,this.eventBus=t.eventBus,this.reset()}var t,n,i;return t=e,n=[{key:"reset",value:function(){this._pdfDocument=null,this._lastToggleIsShow=!0,this._currentTreeItem=null,this.container.textContent="",this.container.classList.remove("treeWithDeepNesting")}},{key:"_dispatchEvent",value:function(e){throw new Error("Not implemented: _dispatchEvent")}},{key:"_bindLink",value:function(e,t){throw new Error("Not implemented: _bindLink")}},{key:"_normalizeTextContent",value:function(e){return q(e,!0)||"–"}},{key:"_addToggleButton",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=document.createElement("div");i.innerHTML='<svg><use xlink:href="#iconDown"></use></svg>',i.className="treeItemToggler",n&&i.classList.add("treeItemsHidden"),i.onclick=function(n){if(n.stopPropagation(),i.classList.toggle("treeItemsHidden"),n.shiftKey){var a=!i.classList.contains("treeItemsHidden");t._toggleTreeItem(e,a)}},e.insertBefore(i,e.firstChild)}},{key:"_toggleTreeItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._lastToggleIsShow=t;var n,i=Gt(e.querySelectorAll(".treeItemToggler"));try{for(i.s();!(n=i.n()).done;){var a=n.value;a.classList.toggle("treeItemsHidden",!t)}}catch(e){i.e(e)}finally{i.f()}}},{key:"_toggleAllTreeItems",value:function(){this._toggleTreeItem(this.container,!this._lastToggleIsShow)}},{key:"_finishRendering",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n&&(this.container.classList.add("treeWithDeepNesting"),this._lastToggleIsShow=!e.querySelector(".treeItemsHidden")),this.container.appendChild(e),this._dispatchEvent(t)}},{key:"render",value:function(e){throw new Error("Not implemented: render")}},{key:"_updateCurrentTreeItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._currentTreeItem&&(this._currentTreeItem.classList.remove(Kt),this._currentTreeItem=null),e&&(e.classList.add(Kt),this._currentTreeItem=e)}},{key:"_scrollToCurrentTreeItem",value:function(e){if(e){for(var t=e.parentNode;t&&t!==this.container;){if(t.classList.contains("treeItem")){var n=t.firstElementChild;null==n||n.classList.remove("treeItemsHidden")}t=t.parentNode}this._updateCurrentTreeItem(e),this.container.scrollTo(e.offsetLeft,e.offsetTop+-100+e.offsetParent.offsetTop)}}}],n&&Yt(t.prototype,n),i&&Yt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function Xt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Qt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function en(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function tn(){return tn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=nn(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},tn.apply(this,arguments)}function nn(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ln(e)););return e}function an(e,t){return an=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},an(e,t)}function on(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=ln(e);if(t){var a=ln(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return sn(this,n)}}function sn(e,t){if(t&&("object"===Jt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return rn(e)}function rn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ln(e){return ln=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ln(e)}var cn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&an(e,t)}(o,e);var t,n,i,a=on(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=a.call(this,e)).downloadManager=e.downloadManager,t.eventBus._on("fileattachmentannotation",t._appendAttachment.bind(rn(t))),t}return t=o,n=[{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];tn(ln(o.prototype),"reset",this).call(this),this._attachments=null,e||(this._renderedCapability=(0,ve.createPromiseCapability)()),this._pendingDispatchEvent&&clearTimeout(this._pendingDispatchEvent),this._pendingDispatchEvent=null}},{key:"_dispatchEvent",value:function(e){var t=this;this._renderedCapability.resolve(),this._pendingDispatchEvent&&(clearTimeout(this._pendingDispatchEvent),this._pendingDispatchEvent=null),0!==e?this.eventBus.dispatch("attachmentsloaded",{source:this,attachmentsCount:e}):this._pendingDispatchEvent=setTimeout((function(){t.eventBus.dispatch("attachmentsloaded",{source:t,attachmentsCount:0}),t._pendingDispatchEvent=null}))}},{key:"_bindLink",value:function(e,t){var n=this,i=t.content,a=t.filename;e.onclick=function(){return n.downloadManager.openOrDownloadData(e,i,a),!1}}},{key:"render",value:function(e){var t=e.attachments,n=e.keepRenderedCapability,i=void 0!==n&&n;if(this._attachments&&this.reset(i),this._attachments=t||null,t){var a,o=Object.keys(t).sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})),s=document.createDocumentFragment(),r=0,l=Xt(o);try{for(l.s();!(a=l.n()).done;){var c=t[a.value],u=c.content,d=(0,ve.getFilenameFromUrl)(c.filename),p=document.createElement("div");p.className="treeItem";var h=document.createElement("a");this._bindLink(h,{content:u,filename:d}),h.textContent=this._normalizeTextContent(d),p.appendChild(h),s.appendChild(p),r++}}catch(e){l.e(e)}finally{l.f()}this._finishRendering(s,r)}else this._dispatchEvent(0)}},{key:"_appendAttachment",value:function(e){var t=this,n=e.id,i=e.filename,a=e.content,o=this._renderedCapability.promise;o.then((function(){if(o===t._renderedCapability.promise){var e=t._attachments;if(e){for(var s in e)if(n===s)return}else e=Object.create(null);e[n]={filename:i,content:a},t.render({attachments:e,keepRenderedCapability:!0})}}))}}],n&&en(t.prototype,n),i&&en(t,i),Object.defineProperty(t,"prototype",{writable:!1}),o}(Zt);function un(e){return un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},un(e)}function dn(){dn=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==un(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function pn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,a,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return hn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function fn(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function gn(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){fn(o,i,a,s,r,"next",e)}function r(e){fn(o,i,a,s,r,"throw",e)}s(void 0)}))}}function mn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function yn(e,t){bn(e,t),t.add(e)}function bn(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function vn(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,_n(e,t,"set"),n),n}function wn(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,_n(e,t,"get"))}function _n(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function En(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var kn="-",Cn={"8.5x11":"Letter","8.5x14":"Legal"},Dn={"297x420":"A3","210x297":"A4"};function xn(e,t,n){var i=t?e.width:e.height,a=t?e.height:e.width;return n["".concat(i,"x").concat(a)]}var Sn=new WeakMap,An=new WeakSet,Ln=new WeakSet,Tn=new WeakSet,Bn=new WeakSet,Pn=new WeakSet,In=new WeakSet,Mn=function(){function e(t,n,i,a){var o,s,r,l=this,c=t.overlayName,u=t.fields,d=t.container,p=t.closeButton;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),yn(this,In),yn(this,Pn),yn(this,Bn),yn(this,Tn),yn(this,Ln),yn(this,An),r={writable:!0,value:null},bn(o=this,s=Sn),s.set(o,r),this.overlayName=c,this.fields=u,this.container=d,this.overlayManager=n,this.l10n=a,En(this,An,Fn).call(this),p.addEventListener("click",this.close.bind(this)),this.overlayManager.register(this.overlayName,this.container,this.close.bind(this)),i._on("pagechanging",(function(e){l._currentPageNumber=e.pageNumber})),i._on("rotationchanging",(function(e){l._pagesRotation=e.pagesRotation})),this._isNonMetricLocale=!0}var t,n,a,o;return t=e,n=[{key:"open",value:(o=gn(dn().mark((function e(){var t,n,a,o,s,r,l,c,u,d,p,h,f,g,m,y,b,v=this;return dn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.overlayManager.open(this.overlayName),this._dataAvailableCapability.promise]);case 2:if(t=this._currentPageNumber,n=this._pagesRotation,!wn(this,Sn)||t!==wn(this,Sn)._currentPageNumber||n!==wn(this,Sn)._pagesRotation){e.next=7;break}return En(this,Ln,Nn).call(this),e.abrupt("return");case 7:return e.next=9,this.pdfDocument.getMetadata();case 9:return a=e.sent,o=a.info,s=a.contentDispositionFilename,r=a.contentLength,e.next=15,Promise.all([s||(0,ve.getPdfFilenameFromUrl)(this.url),En(this,Tn,$n).call(this,r),En(this,Pn,qn).call(this,o.CreationDate),En(this,Pn,qn).call(this,o.ModDate),this.pdfDocument.getPage(t).then((function(e){return En(v,Bn,Hn).call(v,(a=(t=e).view,o=t.userUnit,s=t.rotate,r=i(a,4),l=r[0],c=r[1],u=s%180!=0,d=(r[2]-l)/72*o,p=(r[3]-c)/72*o,{width:u?p:d,height:u?d:p}),n);var t,a,o,s,r,l,c,u,d,p})),En(this,In,Un).call(this,o.IsLinearized)]);case 15:return l=e.sent,c=pn(l,6),u=c[0],d=c[1],p=c[2],h=c[3],f=c[4],g=c[5],vn(this,Sn,Object.freeze({fileName:u,fileSize:d,title:o.Title,author:o.Author,subject:o.Subject,keywords:o.Keywords,creationDate:p,modificationDate:h,creator:o.Creator,producer:o.Producer,version:o.PDFFormatVersion,pageCount:this.pdfDocument.numPages,pageSize:f,linearized:g,_currentPageNumber:t,_pagesRotation:n})),En(this,Ln,Nn).call(this),e.next=27,this.pdfDocument.getDownloadInfo();case 27:if(m=e.sent,y=m.length,r!==y){e.next=31;break}return e.abrupt("return");case 31:return b=Object.assign(Object.create(null),wn(this,Sn)),e.next=34,En(this,Tn,$n).call(this,y);case 34:b.fileSize=e.sent,vn(this,Sn,Object.freeze(b)),En(this,Ln,Nn).call(this);case 37:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"close",value:function(){this.overlayManager.close(this.overlayName)}},{key:"setDocument",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.pdfDocument&&(En(this,An,Fn).call(this),En(this,Ln,Nn).call(this,!0)),e&&(this.pdfDocument=e,this.url=t,this._dataAvailableCapability.resolve())}}],n&&mn(t.prototype,n),a&&mn(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Fn(){this.pdfDocument=null,this.url=null,vn(this,Sn,null),this._dataAvailableCapability=(0,ve.createPromiseCapability)(),this._currentPageNumber=1,this._pagesRotation=0}function Nn(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!e&&wn(this,Sn)){if(this.overlayManager.active===this.overlayName)for(var t in this.fields){var n=wn(this,Sn)[t];this.fields[t].textContent=n||0===n?n:kn}}else for(var i in this.fields)this.fields[i].textContent=kn}function $n(){return On.apply(this,arguments)}function On(){return On=gn(dn().mark((function e(){var t,n,i,a=arguments;return dn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:0,i=(n=t/1024)/1024,n){e.next=4;break}return e.abrupt("return",void 0);case 4:if(!(i>=1)){e.next=6;break}return e.abrupt("return","".concat(i>=1&&(+i.toPrecision(3)).toLocaleString()," MB ").concat(t.toLocaleString()," bytes)"));case 6:return e.abrupt("return","".concat(i<1&&(+n.toPrecision(3)).toLocaleString()," KB (").concat(t.toLocaleString()," bytes)"));case 7:case"end":return e.stop()}}),e)}))),On.apply(this,arguments)}function Hn(e,t){return Rn.apply(this,arguments)}function Rn(){return(Rn=gn(dn().mark((function e(t,n){var i,a,o,s,r,l,c,u,d,p,h,f,g,m;return dn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",void 0);case 2:return n%180!=0&&(t={width:t.height,height:t.width}),i=J(t),a={width:Math.round(100*t.width)/100,height:Math.round(100*t.height)/100},o={width:Math.round(25.4*t.width*10)/10,height:Math.round(25.4*t.height*10)/10},(s=xn(a,i,Cn)||xn(o,i,Dn))||Number.isInteger(o.width)&&Number.isInteger(o.height)||(r={width:25.4*t.width,height:25.4*t.height},l={width:Math.round(o.width),height:Math.round(o.height)},Math.abs(r.width-l.width)<.1&&Math.abs(r.height-l.height)<.1&&(s=xn(l,i,Dn))&&(a={width:Math.round(l.width/25.4*100)/100,height:Math.round(l.height/25.4*100)/100},o=l)),e.next=10,Promise.all([this._isNonMetricLocale?a:o,this._isNonMetricLocale?window.siyuan.languages.unitInches:window.siyuan.languages.unitMillimeters,s&&window.siyuan.languages["document_properties_page_size_name_".concat(s.toLowerCase())],window.siyuan.languages["document_properties_page_size_orientation_".concat(i?"portrait":"landscape")]]);case 10:if(c=e.sent,u=pn(c,4),d=u[0],p=d.width,h=d.height,f=u[1],g=u[2],m=u[3],!g){e.next=20;break}return e.abrupt("return","".concat(p.toLocaleString()," × ").concat(h.toLocaleString()," ").concat(f," (").concat(g,", ").concat(m,")"));case 20:return e.abrupt("return","".concat(p.toLocaleString()," × ").concat(h.toLocaleString()," ").concat(f," (").concat(m,")"));case 21:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function qn(e){return jn.apply(this,arguments)}function jn(){return(jn=gn(dn().mark((function e(t){var n;return dn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ve.PDFDateString.toDateObject(t)){e.next=3;break}return e.abrupt("return",void 0);case 3:return e.abrupt("return","".concat(n.toLocaleDateString(),", ").concat(n.toLocaleTimeString()));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Un(e){return e?"Yes":"No"}var zn=0,Wn=1,Gn=2,Vn=3,Yn=4,Kn=5,Zn=6,Jn=7;function Xn(e){return function(e){return e<11904}(e)?function(e){return 0==(65408&e)}(e)?function(e){return 32===e||9===e||13===e||10===e}(e)?zn:function(e){return e>=97&&e<=122||e>=65&&e<=90}(e)||function(e){return e>=48&&e<=57}(e)||95===e?Wn:Gn:function(e){return 3584==(65408&e)}(e)?Jn:160===e?zn:Wn:function(e){return e>=13312&&e<=40959||e>=63744&&e<=64255}(e)?Vn:function(e){return e>=12448&&e<=12543}(e)?Yn:function(e){return e>=12352&&e<=12447}(e)?Kn:function(e){return e>=65376&&e<=65439}(e)?Zn:Wn}function Qn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,a,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return o}(e,t)||oi(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ei(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ti(e,t){ni(e,t),t.add(e)}function ni(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ii(e,t){var n=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,n)}function ai(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function oi(e,t){if(e){if("string"==typeof e)return si(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?si(e,t):void 0}}function si(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var ri,li=0,ci=1,ui=2,di=3,pi={"‐":"-","‘":"'","’":"'","‚":"'","‛":"'","“":'"',"”":'"',"„":'"',"‟":'"',"¼":"1/4","½":"1/2","¾":"3/4"},hi=new Set([12441,12442,2381,2509,2637,2765,2893,3021,3149,3277,3387,3388,3405,3530,3642,3770,3972,4153,4154,5908,5940,6098,6752,6980,7082,7083,7154,7155,11647,43014,43052,43204,43347,43456,43766,44013,3158,3953,3954,3962,3963,3964,3965,3968,3956]),fi=(ri=hi.values(),function(e){if(Array.isArray(e))return si(e)}(ri)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(ri)||oi(ri)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){return String.fromCharCode(e)})).join(""),gi=/(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u0898-\u089F\u08CA-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3C\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1715\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u180F\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ACE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC70\uDC73\uDC74\uDC7F-\uDC82\uDCB0-\uDCBA\uDCC2\uDD00-\uDD02\uDD27-\uDD34\uDD45\uDD46\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDDC9-\uDDCC\uDDCE\uDDCF\uDE2C-\uDE37\uDE3E\uDEDF-\uDEEA\uDF00-\uDF03\uDF3B\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC35-\uDC46\uDC5E\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDDDC\uDDDD\uDE30-\uDE40\uDEAB-\uDEB7\uDF1D-\uDF2B]|\uD806[\uDC2C-\uDC3A\uDD30-\uDD35\uDD37\uDD38\uDD3B-\uDD3E\uDD40\uDD42\uDD43\uDDD1-\uDDD7\uDDDA-\uDDE0\uDDE4\uDE01-\uDE0A\uDE33-\uDE39\uDE3B-\uDE3E\uDE47\uDE51-\uDE5B\uDE8A-\uDE99]|\uD807[\uDC2F-\uDC36\uDC38-\uDC3F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD8A-\uDD8E\uDD90\uDD91\uDD93-\uDD97\uDEF3-\uDEF6]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF51-\uDF87\uDF8F-\uDF92\uDFE4\uDFF0\uDFF1]|\uD82F[\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF])+/g,mi=/([\$\(-\+\.\?\[-\^\{-\}])|((?:[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))|([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+)|((?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u0898-\u089F\u08CA-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3C\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1715\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u180F\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ACE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC70\uDC73\uDC74\uDC7F-\uDC82\uDCB0-\uDCBA\uDCC2\uDD00-\uDD02\uDD27-\uDD34\uDD45\uDD46\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDDC9-\uDDCC\uDDCE\uDDCF\uDE2C-\uDE37\uDE3E\uDEDF-\uDEEA\uDF00-\uDF03\uDF3B\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC35-\uDC46\uDC5E\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDDDC\uDDDD\uDE30-\uDE40\uDEAB-\uDEB7\uDF1D-\uDF2B]|\uD806[\uDC2C-\uDC3A\uDD30-\uDD35\uDD37\uDD38\uDD3B-\uDD3E\uDD40\uDD42\uDD43\uDDD1-\uDDD7\uDDDA-\uDDE0\uDDE4\uDE01-\uDE0A\uDE33-\uDE39\uDE3B-\uDE3E\uDE47\uDE51-\uDE5B\uDE8A-\uDE99]|\uD807[\uDC2F-\uDC36\uDC38-\uDC3F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD8A-\uDD8E\uDD90\uDD91\uDD93-\uDD97\uDEF3-\uDEF6]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF51-\uDF87\uDF8F-\uDF92\uDFE4\uDFF0\uDFF1]|\uD82F[\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF]))|((?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]))/g,yi=/((?:(?![\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u0898-\u089F\u08CA-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3C\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1715\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u180F\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ACE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC70\uDC73\uDC74\uDC7F-\uDC82\uDCB0-\uDCBA\uDCC2\uDD00-\uDD02\uDD27-\uDD34\uDD45\uDD46\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDDC9-\uDDCC\uDDCE\uDDCF\uDE2C-\uDE37\uDE3E\uDEDF-\uDEEA\uDF00-\uDF03\uDF3B\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC35-\uDC46\uDC5E\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDDDC\uDDDD\uDE30-\uDE40\uDEAB-\uDEB7\uDF1D-\uDF2B]|\uD806[\uDC2C-\uDC3A\uDD30-\uDD35\uDD37\uDD38\uDD3B-\uDD3E\uDD40\uDD42\uDD43\uDDD1-\uDDD7\uDDDA-\uDDE0\uDDE4\uDE01-\uDE0A\uDE33-\uDE39\uDE3B-\uDE3E\uDE47\uDE51-\uDE5B\uDE8A-\uDE99]|\uD807[\uDC2F-\uDC36\uDC38-\uDC3F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD8A-\uDD8E\uDD90\uDD91\uDD93-\uDD97\uDEF3-\uDEF6]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF51-\uDF87\uDF8F-\uDF92\uDFE4\uDFF0\uDFF1]|\uD82F[\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF])[\s\S]))(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u0898-\u089F\u08CA-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3C\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1715\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u180F\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ACE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC70\uDC73\uDC74\uDC7F-\uDC82\uDCB0-\uDCBA\uDCC2\uDD00-\uDD02\uDD27-\uDD34\uDD45\uDD46\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDDC9-\uDDCC\uDDCE\uDDCF\uDE2C-\uDE37\uDE3E\uDEDF-\uDEEA\uDF00-\uDF03\uDF3B\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC35-\uDC46\uDC5E\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDDDC\uDDDD\uDE30-\uDE40\uDEAB-\uDEB7\uDF1D-\uDF2B]|\uD806[\uDC2C-\uDC3A\uDD30-\uDD35\uDD37\uDD38\uDD3B-\uDD3E\uDD40\uDD42\uDD43\uDDD1-\uDDD7\uDDDA-\uDDE0\uDDE4\uDE01-\uDE0A\uDE33-\uDE39\uDE3B-\uDE3E\uDE47\uDE51-\uDE5B\uDE8A-\uDE99]|\uD807[\uDC2F-\uDC36\uDC38-\uDC3F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD8A-\uDD8E\uDD90\uDD91\uDD93-\uDD97\uDEF3-\uDEF6]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF51-\uDF87\uDF8F-\uDF92\uDFE4\uDFF0\uDFF1]|\uD82F[\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF])*$/,bi=/^(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u0898-\u089F\u08CA-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3C\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1715\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u180F\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ACE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC70\uDC73\uDC74\uDC7F-\uDC82\uDCB0-\uDCBA\uDCC2\uDD00-\uDD02\uDD27-\uDD34\uDD45\uDD46\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDDC9-\uDDCC\uDDCE\uDDCF\uDE2C-\uDE37\uDE3E\uDEDF-\uDEEA\uDF00-\uDF03\uDF3B\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC35-\uDC46\uDC5E\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDDDC\uDDDD\uDE30-\uDE40\uDEAB-\uDEB7\uDF1D-\uDF2B]|\uD806[\uDC2C-\uDC3A\uDD30-\uDD35\uDD37\uDD38\uDD3B-\uDD3E\uDD40\uDD42\uDD43\uDDD1-\uDDD7\uDDDA-\uDDE0\uDDE4\uDE01-\uDE0A\uDE33-\uDE39\uDE3B-\uDE3E\uDE47\uDE51-\uDE5B\uDE8A-\uDE99]|\uD807[\uDC2F-\uDC36\uDC38-\uDC3F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD8A-\uDD8E\uDD90\uDD91\uDD93-\uDD97\uDEF3-\uDEF6]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF51-\uDF87\uDF8F-\uDF92\uDFE4\uDFF0\uDFF1]|\uD82F[\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF])*((?:(?![\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u0898-\u089F\u08CA-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3C\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1715\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u180F\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ACE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC70\uDC73\uDC74\uDC7F-\uDC82\uDCB0-\uDCBA\uDCC2\uDD00-\uDD02\uDD27-\uDD34\uDD45\uDD46\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDDC9-\uDDCC\uDDCE\uDDCF\uDE2C-\uDE37\uDE3E\uDEDF-\uDEEA\uDF00-\uDF03\uDF3B\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC35-\uDC46\uDC5E\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDDDC\uDDDD\uDE30-\uDE40\uDEAB-\uDEB7\uDF1D-\uDF2B]|\uD806[\uDC2C-\uDC3A\uDD30-\uDD35\uDD37\uDD38\uDD3B-\uDD3E\uDD40\uDD42\uDD43\uDDD1-\uDDD7\uDDDA-\uDDE0\uDDE4\uDE01-\uDE0A\uDE33-\uDE39\uDE3B-\uDE3E\uDE47\uDE51-\uDE5B\uDE8A-\uDE99]|\uD807[\uDC2F-\uDC36\uDC38-\uDC3F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD8A-\uDD8E\uDD90\uDD91\uDD93-\uDD97\uDEF3-\uDEF6]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF51-\uDF87\uDF8F-\uDF92\uDFE4\uDFF0\uDFF1]|\uD82F[\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF])[\s\S]))/,vi=null;function wi(e){if(!vi){var t=Object.keys(pi).join("");vi=new RegExp("([".concat(t,"])|(\\p{M}+(?:-\\n)?)|(\\S-\\n)|(\\n)"),"gum")}for(var n,i=[];null!==(n=gi.exec(e));)i.push([n[0].length,n.index]);var a=e.normalize("NFD"),o=[[0,0]],s=0,r=0,l=0,c=0,u=!1;return a=a.replace(vi,(function(e,t,n,a,d,p){if(p-=l,t){for(var h=pi[e],f=h.length,g=1;g<f;g++)o.push([p-r+g,r-g]);return r-=f-1,h}if(n){var m,y=n.endsWith("\n"),b=y?n.length-2:n.length;u=!0;var v=b;p+c===(null===(m=i[s])||void 0===m?void 0:m[1])&&(v-=i[s][0],++s);for(var w=1;w<v+1;w++)o.push([p-1-r+w,r-w]);return r-=v,l+=v,y?(p+=b-1,o.push([p-r+1,1+r]),r+=1,l+=1,c+=1,n.slice(0,b)):n}return a?(o.push([p-r+1,1+r]),r+=1,l+=1,c+=1,a.charAt(0)):(o.push([p-r+1,r-1]),r-=1,l+=1,c+=1," ")})),o.push([a.length,r]),[a,o,u]}function _i(e,t,n){if(!e)return[t,n];var i=t,a=t+n,o=j(e,(function(e){return e[0]>=i}));e[o][0]>i&&--o;var s=j(e,(function(e){return e[0]>=a}),o);return e[s][0]>a&&--s,[i+e[o][1],n+e[s][1]-e[o][1]]}var Ei=new WeakSet,ki=new WeakSet,Ci=new WeakMap,Di=new WeakSet,xi=new WeakSet,Si=new WeakSet,Ai=new WeakSet,Li=new WeakSet,Ti=new WeakSet,Bi=new WeakSet,Pi=new WeakSet,Ii=new WeakSet,Mi=new WeakSet,Fi=new WeakSet,Ni=new WeakSet,$i=new WeakSet,Oi=new WeakSet,Hi=new WeakSet,Ri=new WeakSet,qi=new WeakSet,ji=function(){function e(t){var n,i,a,o=t.linkService,s=t.eventBus;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ti(this,qi),ti(this,Ri),ti(this,Hi),ti(this,Oi),ti(this,$i),ti(this,Ni),ti(this,Fi),ti(this,Mi),ti(this,Ii),ti(this,Pi),ti(this,Bi),ti(this,Ti),ti(this,Li),ti(this,Ai),ti(this,Si),ti(this,xi),ti(this,Di),a={get:Wi,set:void 0},ni(n=this,i=Ci),i.set(n,a),ti(this,ki),ti(this,Ei),this._linkService=o,this._eventBus=s,ai(this,ki,zi).call(this),s._on("find",ai(this,Ei,Ui).bind(this)),s._on("findbarclose",ai(this,Oi,oa).bind(this))}var t,n,i;return t=e,(n=[{key:"highlightMatches",get:function(){return this._highlightMatches}},{key:"pageMatches",get:function(){return this._pageMatches}},{key:"pageMatchesLength",get:function(){return this._pageMatchesLength}},{key:"selected",get:function(){return this._selected}},{key:"state",get:function(){return this._state}},{key:"setDocument",value:function(e){this._pdfDocument&&ai(this,ki,zi).call(this),e&&(this._pdfDocument=e,this._firstPageCapability.resolve())}},{key:"scrollMatchIntoView",value:function(e){var t=e.element,n=void 0===t?null:t,i=e.selectedLeft,a=void 0===i?0:i,o=e.pageIndex,s=void 0===o?-1:o,r=e.matchIndex,l=void 0===r?-1:r;this._scrollMatches&&n&&-1!==l&&l===this._selected.matchIdx&&-1!==s&&s===this._selected.pageIdx&&(this._scrollMatches=!1,N(n,{top:-50,left:a+-400},!0))}}])&&ei(t.prototype,n),i&&ei(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ui(e){var t=this;if(e){var n=this._pdfDocument,i=e.type;(null===this._state||ai(this,Di,Gi).call(this,e))&&(this._dirtyMatch=!0),this._state=e,"highlightallchange"!==i&&ai(this,qi,la).call(this,di),this._firstPageCapability.promise.then((function(){if(t._pdfDocument&&(!n||t._pdfDocument===n)){ai(t,Ti,Ji).call(t);var e=!t._highlightMatches,a=!!t._findTimeout;t._findTimeout&&(clearTimeout(t._findTimeout),t._findTimeout=null),i?t._dirtyMatch?ai(t,Ii,ea).call(t):"again"===i?(ai(t,Ii,ea).call(t),e&&t._state.highlightAll&&ai(t,Pi,Qi).call(t)):"highlightallchange"===i?(a?ai(t,Ii,ea).call(t):t._highlightMatches=!0,ai(t,Pi,Qi).call(t)):ai(t,Ii,ea).call(t):t._findTimeout=setTimeout((function(){ai(t,Ii,ea).call(t),t._findTimeout=null}),250)}}))}}function zi(){this._highlightMatches=!1,this._scrollMatches=!1,this._pdfDocument=null,this._pageMatches=[],this._pageMatchesLength=[],this._state=null,this._selected={pageIdx:-1,matchIdx:-1},this._offset={pageIdx:null,matchIdx:null,wrapped:!1},this._extractTextPromises=[],this._pageContents=[],this._pageDiffs=[],this._hasDiacritics=[],this._matchesCountTotal=0,this._pagesToSearch=null,this._pendingFindMatches=new Set,this._resumePageIdx=null,this._dirtyMatch=!1,clearTimeout(this._findTimeout),this._findTimeout=null,this._firstPageCapability=(0,ve.createPromiseCapability)()}function Wi(){if(this._state.query!==this._rawQuery){this._rawQuery=this._state.query;var e=Qn(wi(this._state.query),1);this._normalizedQuery=e[0]}return this._normalizedQuery}function Gi(e){if(e.query!==this._state.query)return!0;switch(e.type){case"again":var t=this._selected.pageIdx+1,n=this._linkService;return t>=1&&t<=n.pagesCount&&t!==n.page&&!n.isPageVisible(t);case"highlightallchange":return!1}return!0}function Vi(e,t,n){var i=e.slice(0,t).match(yi);if(i){var a=e.charCodeAt(t),o=i[1].charCodeAt(0);if(Xn(a)===Xn(o))return!1}if(i=e.slice(t+n).match(bi)){var s=e.charCodeAt(t+n-1),r=i[1].charCodeAt(0);if(Xn(s)===Xn(r))return!1}return!0}function Yi(e,t,n,i){for(var a,o=[],s=[],r=this._pageDiffs[n];null!==(a=e.exec(i));)if(!t||ai(this,xi,Vi).call(this,i,a.index,a[0].length)){var l=Qn(_i(r,a.index,a[0].length),2),c=l[0],u=l[1];u&&(o.push(c),s.push(u))}this._pageMatches[n]=o,this._pageMatchesLength[n]=s}function Ki(e,t){var n=this._state.matchDiacritics,i=!1,a="[ ]*";return(e=e.replace(mi,(function(e,a,o,s,r,l){return a?"[ ]*\\".concat(a,"[ ]*"):o?"[ ]*".concat(o,"[ ]*"):s?"[ ]+":n?r||l:r?hi.has(r.charCodeAt(0))?r:"":t?(i=!0,"".concat(l,"\\p{M}*")):l}))).endsWith(a)&&(e=e.slice(0,e.length-a.length)),n&&t&&(i=!0,e="".concat(e,"(?=[").concat(fi,"]|[^\\p{M}]|$)")),[i,e]}function Zi(e){var t=this,n=ii(this,Ci);if(0!==n.length){var i=this._state,a=i.caseSensitive,o=i.entireWord,s=i.phraseSearch,r=this._pageContents[e],l=this._hasDiacritics[e],c=!1;if(s){var u=Qn(ai(this,Ai,Ki).call(this,n,l),2);c=u[0],n=u[1]}else{var d=n.match(/\S+/g);d&&(n=d.sort().reverse().map((function(e){var n=Qn(ai(t,Ai,Ki).call(t,e,l),2),i=n[0],a=n[1];return c||(c=i),"(".concat(a,")")})).join("|"))}var p="g".concat(c?"u":"").concat(a?"":"i");n=new RegExp(n,p),ai(this,Si,Yi).call(this,n,o,e,r),this._state.highlightAll&&ai(this,Bi,Xi).call(this,e),this._resumePageIdx===e&&(this._resumePageIdx=null,ai(this,Fi,na).call(this));var h=this._pageMatches[e].length;h>0&&(this._matchesCountTotal+=h,ai(this,Ri,ra).call(this))}}function Ji(){var e=this;if(!(this._extractTextPromises.length>0))for(var t=Promise.resolve(),n=function(n,i){var a=(0,ve.createPromiseCapability)();e._extractTextPromises[n]=a.promise,t=t.then((function(){return e._pdfDocument.getPage(n+1).then((function(e){return e.getTextContent()})).then((function(t){var i,o=[],s=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=oi(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}(t.items);try{for(s.s();!(i=s.n()).done;){var r=i.value;o.push(r.str),r.hasEOL&&o.push("\n")}}catch(e){s.e(e)}finally{s.f()}var l=Qn(wi(o.join("")),3);e._pageContents[n]=l[0],e._pageDiffs[n]=l[1],e._hasDiacritics[n]=l[2],a.resolve()}),(function(t){console.error("Unable to get text content for page ".concat(n+1),t),e._pageContents[n]="",e._pageDiffs[n]=null,e._hasDiacritics[n]=!1,a.resolve()}))}))},i=0,a=this._linkService.pagesCount;i<a;i++)n(i)}function Xi(e){this._scrollMatches&&this._selected.pageIdx===e&&(this._linkService.page=e+1),this._eventBus.dispatch("updatetextlayermatches",{source:this,pageIndex:e})}function Qi(){this._eventBus.dispatch("updatetextlayermatches",{source:this,pageIndex:-1})}function ea(){var e=this,t=this._state.findPrevious,n=this._linkService.page-1,i=this._linkService.pagesCount;if(this._highlightMatches=!0,this._dirtyMatch){this._dirtyMatch=!1,this._selected.pageIdx=this._selected.matchIdx=-1,this._offset.pageIdx=n,this._offset.matchIdx=null,this._offset.wrapped=!1,this._resumePageIdx=null,this._pageMatches.length=0,this._pageMatchesLength.length=0,this._matchesCountTotal=0,ai(this,Pi,Qi).call(this);for(var a=function(t){if(e._pendingFindMatches.has(t))return"continue";e._pendingFindMatches.add(t),e._extractTextPromises[t].then((function(){e._pendingFindMatches.delete(t),ai(e,Li,Zi).call(e,t)}))},o=0;o<i;o++)a(o)}if(""!==ii(this,Ci)){if(!this._resumePageIdx){var s=this._offset;if(this._pagesToSearch=i,null!==s.matchIdx){var r=this._pageMatches[s.pageIdx].length;if(!t&&s.matchIdx+1<r||t&&s.matchIdx>0)return s.matchIdx=t?s.matchIdx-1:s.matchIdx+1,void ai(this,$i,aa).call(this,!0);ai(this,Ni,ia).call(this,t)}ai(this,Fi,na).call(this)}}else ai(this,qi,la).call(this,li)}function ta(e){var t=this._offset,n=e.length,i=this._state.findPrevious;return n?(t.matchIdx=i?n-1:0,ai(this,$i,aa).call(this,!0),!0):(ai(this,Ni,ia).call(this,i),!!(t.wrapped&&(t.matchIdx=null,this._pagesToSearch<0))&&(ai(this,$i,aa).call(this,!1),!0))}function na(){null!==this._resumePageIdx&&console.error("There can only be one pending page.");var e=null;do{var t=this._offset.pageIdx;if(!(e=this._pageMatches[t])){this._resumePageIdx=t;break}}while(!ai(this,Mi,ta).call(this,e))}function ia(e){var t=this._offset,n=this._linkService.pagesCount;t.pageIdx=e?t.pageIdx-1:t.pageIdx+1,t.matchIdx=null,this._pagesToSearch--,(t.pageIdx>=n||t.pageIdx<0)&&(t.pageIdx=e?n-1:0,t.wrapped=!0)}function aa(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=ci,n=this._offset.wrapped;if(this._offset.wrapped=!1,e){var i=this._selected.pageIdx;this._selected.pageIdx=this._offset.pageIdx,this._selected.matchIdx=this._offset.matchIdx,t=n?ui:li,-1!==i&&i!==this._selected.pageIdx&&ai(this,Bi,Xi).call(this,i)}ai(this,qi,la).call(this,t,this._state.findPrevious),-1!==this._selected.pageIdx&&(this._scrollMatches=!0,ai(this,Bi,Xi).call(this,this._selected.pageIdx))}function oa(e){var t=this,n=this._pdfDocument;this._firstPageCapability.promise.then((function(){!t._pdfDocument||n&&t._pdfDocument!==n||(t._findTimeout&&(clearTimeout(t._findTimeout),t._findTimeout=null),t._resumePageIdx&&(t._resumePageIdx=null,t._dirtyMatch=!0),ai(t,qi,la).call(t,li),t._highlightMatches=!1,ai(t,Pi,Qi).call(t))}))}function sa(){var e=this._selected,t=e.pageIdx,n=e.matchIdx,i=0,a=this._matchesCountTotal;if(-1!==n){for(var o=0;o<t;o++){var s;i+=(null===(s=this._pageMatches[o])||void 0===s?void 0:s.length)||0}i+=n+1}return(i<1||i>a)&&(i=a=0),{current:i,total:a}}function ra(){this._eventBus.dispatch("updatefindmatchescount",{source:this,matchesCount:ai(this,Hi,sa).call(this)})}function la(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._eventBus.dispatch("updatefindcontrolstate",{source:this,state:e,previous:i,matchesCount:ai(this,Hi,sa).call(this),rawQuery:null!==(t=null===(n=this._state)||void 0===n?void 0:n.query)&&void 0!==t?t:null})}function ca(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ua(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function da(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var pa=new WeakSet,ha=function(){function e(t,n,i){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ua(this,pa),this.opened=!1,this.bar=t.bar,this.toggleButton=t.toggleButton,this.findField=t.findField,this.highlightAll=t.highlightAllCheckbox,this.caseSensitive=t.caseSensitiveCheckbox,this.matchDiacritics=t.matchDiacriticsCheckbox,this.entireWord=t.entireWordCheckbox,this.findMsg=t.findMsg,this.findResultsCount=t.findResultsCount,this.findPreviousButton=t.findPreviousButton,this.findNextButton=t.findNextButton,this.eventBus=n,this.l10n=i,this.toggleButton.addEventListener("click",(function(){a.toggle()})),this.findField.addEventListener("input",(function(){a.dispatchEvent("")})),this.bar.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:e.target===a.findField&&a.dispatchEvent("again",e.shiftKey);break;case 27:a.close()}})),this.findPreviousButton.addEventListener("click",(function(){a.dispatchEvent("again",!0)})),this.findNextButton.addEventListener("click",(function(){a.dispatchEvent("again",!1)})),this.highlightAll.addEventListener("click",(function(){a.dispatchEvent("highlightallchange"),a.highlightAll.checked?a.highlightAll.parentElement.classList.remove("b3-button--outline"):a.highlightAll.parentElement.classList.add("b3-button--outline")})),this.caseSensitive.addEventListener("click",(function(){a.dispatchEvent("casesensitivitychange"),a.caseSensitive.checked?a.caseSensitive.parentElement.classList.remove("b3-button--outline"):a.caseSensitive.parentElement.classList.add("b3-button--outline")})),this.entireWord.addEventListener("click",(function(){a.dispatchEvent("entirewordchange"),a.entireWord.checked?a.entireWord.parentElement.classList.remove("b3-button--outline"):a.entireWord.parentElement.classList.add("b3-button--outline")})),this.matchDiacritics.addEventListener("click",(function(){a.dispatchEvent("diacriticmatchingchange"),a.matchDiacritics.checked?a.matchDiacritics.parentElement.classList.remove("b3-button--outline"):a.matchDiacritics.parentElement.classList.add("b3-button--outline")})),this.eventBus._on("resize",da(this,pa,fa).bind(this))}var t,n,i;return t=e,n=[{key:"reset",value:function(){this.updateUIState()}},{key:"dispatchEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.eventBus.dispatch("find",{source:this,type:e,query:this.findField.value,phraseSearch:!0,caseSensitive:this.caseSensitive.checked,entireWord:this.entireWord.checked,highlightAll:this.highlightAll.checked,findPrevious:t,matchDiacritics:this.matchDiacritics.checked})}},{key:"updateUIState",value:function(e,t,n){var i="",a="";switch(e){case li:break;case di:a="pending";break;case ci:i=window.siyuan.languages.find_not_found,a="notFound";break;case ui:i=window.siyuan.languages.find_not_found["find_reached_".concat(t?"top":"bottom")]}this.findField.setAttribute("data-status",a),this.findMsg.textContent=i,da(this,pa,fa).call(this),this.updateResultsCount(n)}},{key:"updateResultsCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.current,n=void 0===t?0:t,i=e.total,a=void 0===i?0:i,o=1e3,s="";a>0&&(s=a>o?window.siyuan.languages.find_match_count_limit.replace("{{limit}}",o):window.siyuan.languages.find_match_count.replace("{{current}}",n).replace("{{total}}",a)),this.findResultsCount.textContent=s,this.findResultsCount.classList.toggle("fn__hidden",!a),da(this,pa,fa).call(this)}},{key:"open",value:function(){this.opened||(this.opened=!0,this.toggleButton.classList.add("toggled"),this.toggleButton.setAttribute("aria-expanded","true"),this.bar.classList.remove("fn__hidden")),this.findField.select(),this.findField.focus(),da(this,pa,fa).call(this)}},{key:"close",value:function(){this.opened&&(this.opened=!1,this.toggleButton.classList.remove("toggled"),this.toggleButton.setAttribute("aria-expanded","false"),this.bar.classList.add("fn__hidden"),this.eventBus.dispatch("findbarclose",{source:this}))}},{key:"toggle",value:function(){this.opened?this.close():this.open()}}],n&&ca(t.prototype,n),i&&ca(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function fa(){this.opened&&(this.bar.classList.remove("wrapContainers"),this.bar.clientHeight>this.bar.firstElementChild.clientHeight&&this.bar.classList.add("wrapContainers"))}function ga(e){return ga="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ga(e)}function ma(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,a,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ya(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ya(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ya(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ba(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function va(){return document.location.hash}var wa=function(){function e(t){var n=this,i=t.linkService,a=t.eventBus;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.linkService=i,this.eventBus=a,this._initialized=!1,this._fingerprint="",this.reset(),this._boundEvents=null,this._isViewerInPresentationMode=!1,this.eventBus._on("presentationmodechanged",(function(e){n._isViewerInPresentationMode=e.state!==b})),this.eventBus._on("pagesinit",(function(){n._isPagesLoaded=!1,n.eventBus._on("pagesloaded",(function(e){n._isPagesLoaded=!!e.pagesCount}),{once:!0})}))}var t,n,i;return t=e,n=[{key:"initialize",value:function(e){var t=e.fingerprint,n=e.resetHistory,i=void 0!==n&&n,a=e.updateUrl,o=void 0!==a&&a;if(t&&"string"==typeof t){this._initialized&&this.reset();var s=""!==this._fingerprint&&this._fingerprint!==t;this._fingerprint=t,this._updateUrl=!0===o,this._initialized=!0,this._bindEvents();var r=window.history.state;if(this._popStateInProgress=!1,this._blockHashChange=0,this._currentHash=va(),this._numPositionUpdates=0,this._uid=this._maxUid=0,this._destination=null,this._position=null,!this._isValidState(r,!0)||i){var l=this._parseCurrentHash(!0),c=l.hash,u=l.page,d=l.rotation;return!c||s||i?void this._pushOrReplaceState(null,!0):void this._pushOrReplaceState({hash:c,page:u,rotation:d},!0)}var p=r.destination;this._updateInternalState(p,r.uid,!0),void 0!==p.rotation&&(this._initialRotation=p.rotation),p.dest?(this._initialBookmark=JSON.stringify(p.dest),this._destination.page=null):p.hash?this._initialBookmark=p.hash:p.page&&(this._initialBookmark="page=".concat(p.page))}else console.error('PDFHistory.initialize: The "fingerprint" must be a non-empty string.')}},{key:"reset",value:function(){this._initialized&&(this._pageHide(),this._initialized=!1,this._unbindEvents()),this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),this._initialBookmark=null,this._initialRotation=null}},{key:"push",value:function(e){var t,n,i=this,a=e.namedDest,o=void 0===a?null:a,s=e.explicitDest,r=e.pageNumber;if(this._initialized)if(o&&"string"!=typeof o)console.error("PDFHistory.push: "+'"'.concat(o,'" is not a valid namedDest parameter.'));else if(Array.isArray(s))if(this._isValidPage(r)||null===r&&!this._destination){var l=o||JSON.stringify(s);if(l){var c=!1;if(this._destination&&(t=this._destination.hash,n=l,"string"==typeof t&&"string"==typeof n&&(t===n||O(t).get("nameddest")===n)||function(e,t){function n(e,t){if(ga(e)!==ga(t))return!1;if(Array.isArray(e)||Array.isArray(t))return!1;if(null!==e&&"object"===ga(e)&&null!==t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var i in e)if(!n(e[i],t[i]))return!1;return!0}return e===t||Number.isNaN(e)&&Number.isNaN(t)}if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var i=0,a=e.length;i<a;i++)if(!n(e[i],t[i]))return!1;return!0}(this._destination.dest,s))){if(this._destination.page)return;c=!0}this._popStateInProgress&&!c||(this._pushOrReplaceState({dest:s,hash:l,page:r,rotation:this.linkService.rotation},c),this._popStateInProgress||(this._popStateInProgress=!0,Promise.resolve().then((function(){i._popStateInProgress=!1}))))}}else console.error("PDFHistory.push: "+'"'.concat(r,'" is not a valid pageNumber parameter.'));else console.error("PDFHistory.push: "+'"'.concat(s,'" is not a valid explicitDest parameter.'))}},{key:"pushPage",value:function(e){var t,n=this;this._initialized&&(this._isValidPage(e)?(null===(t=this._destination)||void 0===t?void 0:t.page)!==e&&(this._popStateInProgress||(this._pushOrReplaceState({dest:null,hash:"page=".concat(e),page:e,rotation:this.linkService.rotation}),this._popStateInProgress||(this._popStateInProgress=!0,Promise.resolve().then((function(){n._popStateInProgress=!1}))))):console.error('PDFHistory.pushPage: "'.concat(e,'" is not a valid page number.')))}},{key:"pushCurrentPosition",value:function(){this._initialized&&!this._popStateInProgress&&this._tryPushCurrentPosition()}},{key:"back",value:function(){if(this._initialized&&!this._popStateInProgress){var e=window.history.state;this._isValidState(e)&&e.uid>0&&window.history.back()}}},{key:"forward",value:function(){if(this._initialized&&!this._popStateInProgress){var e=window.history.state;this._isValidState(e)&&e.uid<this._maxUid&&window.history.forward()}}},{key:"popStateInProgress",get:function(){return this._initialized&&(this._popStateInProgress||this._blockHashChange>0)}},{key:"initialBookmark",get:function(){return this._initialized?this._initialBookmark:null}},{key:"initialRotation",get:function(){return this._initialized?this._initialRotation:null}},{key:"_pushOrReplaceState",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=i||!this._destination,o={fingerprint:this._fingerprint,uid:a?this._uid:this._uid+1,destination:e};if("undefined"!=typeof PDFJSDev&&PDFJSDev.test("CHROME")&&null!==(t=window.history.state)&&void 0!==t&&t.chromecomState&&(o.chromecomState=window.history.state.chromecomState),this._updateInternalState(e,o.uid),this._updateUrl&&null!=e&&e.hash){var s=document.location.href.split("#")[0];s.startsWith("file://")||(n="".concat(s,"#").concat(e.hash))}a?window.history.replaceState(o,"",n):window.history.pushState(o,"",n),"undefined"!=typeof PDFJSDev&&PDFJSDev.test("CHROME")&&top===window&&chrome.runtime.sendMessage("showPageAction")}},{key:"_tryPushCurrentPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._position){var t=this._position;if(e&&((t=Object.assign(Object.create(null),this._position)).temporary=!0),this._destination){if(this._destination.temporary)this._pushOrReplaceState(t,!0);else if(this._destination.hash!==t.hash&&(this._destination.page||!(this._numPositionUpdates<=50))){var n=!1;if(this._destination.page>=t.first&&this._destination.page<=t.page){if(void 0!==this._destination.dest||!this._destination.first)return;n=!0}this._pushOrReplaceState(t,n)}}else this._pushOrReplaceState(t)}}},{key:"_isValidPage",value:function(e){return Number.isInteger(e)&&e>0&&e<=this.linkService.pagesCount}},{key:"_isValidState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return!1;if(e.fingerprint!==this._fingerprint){if(!t)return!1;if("string"!=typeof e.fingerprint||e.fingerprint.length!==this._fingerprint.length)return!1;var n=performance.getEntriesByType("navigation"),i=ma(n,1),a=i[0];if("reload"!==(null==a?void 0:a.type))return!1}return!(!Number.isInteger(e.uid)||e.uid<0)&&null!==e.destination&&"object"===ga(e.destination)}},{key:"_updateInternalState",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),n&&null!=e&&e.temporary&&delete e.temporary,this._destination=e,this._uid=t,this._maxUid=Math.max(this._maxUid,t),this._numPositionUpdates=0}},{key:"_parseCurrentHash",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=unescape(va()).substring(1),n=O(t),i=n.get("nameddest")||"",a=0|n.get("page");return(!this._isValidPage(a)||e&&i.length>0)&&(a=null),{hash:t,page:a,rotation:this.linkService.rotation}}},{key:"_updateViewarea",value:function(e){var t=this,n=e.location;this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),this._position={hash:this._isViewerInPresentationMode?"page=".concat(n.pageNumber):n.pdfOpenParams.substring(1),page:this.linkService.page,first:n.pageNumber,rotation:n.rotation},this._popStateInProgress||(this._isPagesLoaded&&this._destination&&!this._destination.page&&this._numPositionUpdates++,this._updateViewareaTimeout=setTimeout((function(){t._popStateInProgress||t._tryPushCurrentPosition(!0),t._updateViewareaTimeout=null}),1e3))}},{key:"_popState",value:function(e){var t=this,n=e.state,i=va(),a=this._currentHash!==i;if(this._currentHash=i,"undefined"!=typeof PDFJSDev&&PDFJSDev.test("CHROME")&&null!=n&&n.chromecomState&&!this._isValidState(n)||!n){this._uid++;var o=this._parseCurrentHash(),s=o.hash,r=o.page,l=o.rotation;this._pushOrReplaceState({hash:s,page:r,rotation:l},!0)}else if(this._isValidState(n)){var c,u,d,p,h;this._popStateInProgress=!0,a&&(this._blockHashChange++,(c={target:window,name:"hashchange",delay:1e3},u=c.target,d=c.name,p=c.delay,h=void 0===p?0:p,new Promise((function(e,t){if("object"!==fe(u)||!d||"string"!=typeof d||!(Number.isInteger(h)&&h>=0))throw new Error("waitOnEventOrTimeout - invalid parameters.");function n(t){u instanceof ye?u._off(d,i):u.removeEventListener(d,i),o&&clearTimeout(o),e(t)}var i=n.bind(null,ge);u instanceof ye?u._on(d,i):u.addEventListener(d,i);var a=n.bind(null,me),o=setTimeout(a,h)}))).then((function(){t._blockHashChange--})));var f=n.destination;this._updateInternalState(f,n.uid,!0),Y(f.rotation)&&(this.linkService.rotation=f.rotation),f.dest?this.linkService.goToDestination(f.dest):f.hash?this.linkService.setHash(f.hash):f.page&&(this.linkService.page=f.page),Promise.resolve().then((function(){t._popStateInProgress=!1}))}}},{key:"_pageHide",value:function(){this._destination&&!this._destination.temporary||this._tryPushCurrentPosition()}},{key:"_bindEvents",value:function(){this._boundEvents||(this._boundEvents={updateViewarea:this._updateViewarea.bind(this),popState:this._popState.bind(this),pageHide:this._pageHide.bind(this)},this.eventBus._on("updateviewarea",this._boundEvents.updateViewarea),window.addEventListener("popstate",this._boundEvents.popState),window.addEventListener("pagehide",this._boundEvents.pageHide))}},{key:"_unbindEvents",value:function(){this._boundEvents&&(this.eventBus._off("updateviewarea",this._boundEvents.updateViewarea),window.removeEventListener("popstate",this._boundEvents.popState),window.removeEventListener("pagehide",this._boundEvents.pageHide),this._boundEvents=null)}}],n&&ba(t.prototype,n),i&&ba(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _a(e){return _a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_a(e)}function Ea(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ka(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ka(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function ka(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Ca(){Ca=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_a(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Da(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function xa(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){Da(o,i,a,s,r,"next",e)}function r(e){Da(o,i,a,s,r,"throw",e)}s(void 0)}))}}function Sa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Aa(){return Aa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=La(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},Aa.apply(this,arguments)}function La(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ma(e)););return e}function Ta(e,t){return Ta=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ta(e,t)}function Ba(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Ma(e);if(t){var a=Ma(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Pa(this,n)}}function Pa(e,t){if(t&&("object"===_a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ia(e)}function Ia(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ma(e){return Ma=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ma(e)}var Fa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ta(e,t)}(r,e);var t,n,i,a,o,s=Ba(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=s.call(this,e)).l10n=e.l10n,t.eventBus._on("resetlayers",t._resetLayers.bind(Ia(t))),t.eventBus._on("togglelayerstree",t._toggleAllTreeItems.bind(Ia(t))),t}return t=r,n=[{key:"reset",value:function(){Aa(Ma(r.prototype),"reset",this).call(this),this._optionalContentConfig=null}},{key:"_dispatchEvent",value:function(e){this.eventBus.dispatch("layersloaded",{source:this,layersCount:e})}},{key:"_bindLink",value:function(e,t){var n=this,i=t.groupId,a=t.input,o=function(){n._optionalContentConfig.setVisibility(i,a.checked),n.eventBus.dispatch("optionalcontentconfig",{source:n,promise:Promise.resolve(n._optionalContentConfig)})};e.onclick=function(t){return t.target===a?(o(),!0):t.target!==e||(a.checked=!a.checked,o(),!1)}}},{key:"_setNestedName",value:(o=xa(Ca().mark((function e(t,n){var i,a;return Ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.name,"string"!=typeof(a=void 0===i?null:i)){e.next=4;break}return t.textContent=this._normalizeTextContent(a),e.abrupt("return");case 4:t.textContent=window.siyuan.languages.additionalLayers,t.style.fontStyle="italic";case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"_addToggleButton",value:function(e,t){var n=t.name,i=void 0===n?null:n;Aa(Ma(r.prototype),"_addToggleButton",this).call(this,e,null===i)}},{key:"_toggleAllTreeItems",value:function(){this._optionalContentConfig&&Aa(Ma(r.prototype),"_toggleAllTreeItems",this).call(this)}},{key:"render",value:function(e){var t=e.optionalContentConfig,n=e.pdfDocument;this._optionalContentConfig&&this.reset(),this._optionalContentConfig=t||null,this._pdfDocument=n||null;var i=null==t?void 0:t.getOrder();if(i){for(var a=document.createDocumentFragment(),o=[{parent:a,groups:i}],s=0,r=!1;o.length>0;){var l,c=o.shift(),u=Ea(c.groups);try{for(u.s();!(l=u.n()).done;){var d=l.value,p=document.createElement("div");p.className="treeItem";var h=document.createElement("a");if(p.appendChild(h),"object"===_a(d)){r=!0,this._addToggleButton(p,d),this._setNestedName(h,d);var f=document.createElement("div");f.className="treeItems",p.appendChild(f),o.push({parent:f,groups:d.order})}else{var g=t.getGroup(d),m=document.createElement("input");this._bindLink(h,{groupId:d,input:m}),m.type="checkbox",m.id=d,m.checked=g.visible;var y=document.createElement("label");y.setAttribute("for",d),y.textContent=this._normalizeTextContent(g.name),h.appendChild(m),h.appendChild(y),s++}c.parent.appendChild(p)}}catch(e){u.e(e)}finally{u.f()}}this._finishRendering(a,s,r)}else this._dispatchEvent(0)}},{key:"_resetLayers",value:(a=xa(Ca().mark((function e(){var t;return Ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._optionalContentConfig){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._pdfDocument.getOptionalContentConfig();case 4:t=e.sent,this.eventBus.dispatch("optionalcontentconfig",{source:this,promise:Promise.resolve(t)}),this.render({optionalContentConfig:t,pdfDocument:this._pdfDocument});case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})}],n&&Sa(t.prototype,n),i&&Sa(t,i),Object.defineProperty(t,"prototype",{writable:!1}),r}(Zt);function Na(e){return Na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Na(e)}function $a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,a,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return o}(e,t)||Ua(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oa(){Oa=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==Na(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ha(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function Ra(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){Ha(o,i,a,s,r,"next",e)}function r(e){Ha(o,i,a,s,r,"throw",e)}s(void 0)}))}}function qa(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Ua(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function ja(e){return function(e){if(Array.isArray(e))return za(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ua(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ua(e,t){if(e){if("string"==typeof e)return za(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?za(e,t):void 0}}function za(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Wa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ga(){return Ga="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Va(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},Ga.apply(this,arguments)}function Va(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Xa(e)););return e}function Ya(e,t){return Ya=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ya(e,t)}function Ka(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Xa(e);if(t){var a=Xa(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Za(this,n)}}function Za(e,t){if(t&&("object"===Na(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ja(e)}function Ja(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xa(e){return Xa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Xa(e)}var Qa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ya(e,t)}(r,e);var t,n,i,a,o,s=Ka(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=s.call(this,e)).linkService=e.linkService,t.eventBus._on("toggleoutlinetree",t._toggleAllTreeItems.bind(Ja(t))),t.eventBus._on("currentoutlineitem",t._currentOutlineItem.bind(Ja(t))),t.eventBus._on("pagechanging",(function(e){t._currentPageNumber=e.pageNumber})),t.eventBus._on("pagesloaded",(function(e){t._isPagesLoaded=!!e.pagesCount,t._currentOutlineItemCapability&&!t._currentOutlineItemCapability.settled&&t._currentOutlineItemCapability.resolve(t._isPagesLoaded)})),t.eventBus._on("sidebarviewchanged",(function(e){t._sidebarView=e.view})),t}return t=r,n=[{key:"reset",value:function(){Ga(Xa(r.prototype),"reset",this).call(this),this._outline=null,this._pageNumberToDestHashCapability=null,this._currentPageNumber=1,this._isPagesLoaded=null,this._currentOutlineItemCapability&&!this._currentOutlineItemCapability.settled&&this._currentOutlineItemCapability.resolve(!1),this._currentOutlineItemCapability=null}},{key:"_dispatchEvent",value:function(e){var t;this._currentOutlineItemCapability=(0,ve.createPromiseCapability)(),0===e||null!==(t=this._pdfDocument)&&void 0!==t&&t.loadingParams.disableAutoFetch?this._currentOutlineItemCapability.resolve(!1):null!==this._isPagesLoaded&&this._currentOutlineItemCapability.resolve(this._isPagesLoaded),this.eventBus.dispatch("outlineloaded",{source:this,outlineCount:e,currentOutlineItemPromise:this._currentOutlineItemCapability.promise})}},{key:"_bindLink",value:function(e,t){var n=this,i=t.url,a=t.newWindow,o=t.dest,s=this.linkService;i?s.addLinkAttributes(e,i,a):(e.href=s.getDestinationHash(o),e.onclick=function(e){return n._updateCurrentTreeItem(e.target.parentNode),o&&s.goToDestination(o),!1})}},{key:"_setStyles",value:function(e,t){var n=t.bold,i=t.italic;n&&(e.style.fontWeight="bold"),i&&(e.style.fontStyle="italic")}},{key:"_addToggleButton",value:function(e,t){var n=t.count,i=t.items,a=!1;if(n<0){var o=i.length;if(o>0)for(var s=ja(i);s.length>0;){var l=s.shift(),c=l.count,u=l.items;c>0&&u.length>0&&(o+=u.length,s.push.apply(s,ja(u)))}Math.abs(n)===o&&(a=!0)}Ga(Xa(r.prototype),"_addToggleButton",this).call(this,e,a)}},{key:"_toggleAllTreeItems",value:function(){this._outline&&Ga(Xa(r.prototype),"_toggleAllTreeItems",this).call(this)}},{key:"render",value:function(e){var t=e.outline,n=e.pdfDocument;if(this._outline&&this.reset(),this._outline=t||null,this._pdfDocument=n||null,t){for(var i=document.createDocumentFragment(),a=[{parent:i,items:t}],o=0,s=!1;a.length>0;){var r,l=a.shift(),c=qa(l.items);try{for(c.s();!(r=c.n()).done;){var u=r.value,d=document.createElement("div");d.className="treeItem";var p=document.createElement("a");if(this._bindLink(p,u),this._setStyles(p,u),p.textContent=this._normalizeTextContent(u.title),d.appendChild(p),u.items.length>0){s=!0,this._addToggleButton(d,u);var h=document.createElement("div");h.className="treeItems",d.appendChild(h),a.push({parent:h,items:u.items})}l.parent.appendChild(d),o++}}catch(e){c.e(e)}finally{c.f()}}this._finishRendering(i,o,s)}else this._dispatchEvent(0)}},{key:"_currentOutlineItem",value:(o=Ra(Oa().mark((function e(){var t,n,i,a;return Oa().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isPagesLoaded){e.next=2;break}throw new Error("_currentOutlineItem: All pages have not been loaded.");case 2:if(this._outline&&this._pdfDocument){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this._getPageNumberToDestHash(this._pdfDocument);case 6:if(t=e.sent){e.next=9;break}return e.abrupt("return");case 9:if(this._updateCurrentTreeItem(null),this._sidebarView===C){e.next=12;break}return e.abrupt("return");case 12:n=this._currentPageNumber;case 13:if(!(n>0)){e.next=25;break}if(i=t.get(n)){e.next=17;break}return e.abrupt("continue",22);case 17:if(a=this.container.querySelector('a[href="'.concat(i,'"]'))){e.next=20;break}return e.abrupt("continue",22);case 20:return this._scrollToCurrentTreeItem(a.parentNode),e.abrupt("break",25);case 22:n--,e.next=13;break;case 25:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_getPageNumberToDestHash",value:(a=Ra(Oa().mark((function e(t){var n,i,a,o,s,r,l,c,u,d,p,h,f,g,m;return Oa().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._pageNumberToDestHashCapability){e.next=2;break}return e.abrupt("return",this._pageNumberToDestHashCapability.promise);case 2:this._pageNumberToDestHashCapability=(0,ve.createPromiseCapability)(),n=new Map,i=new Map,a=[{nesting:0,items:this._outline}];case 5:if(!(a.length>0)){e.next=56;break}o=a.shift(),s=o.nesting,r=qa(o.items),e.prev=8,r.s();case 10:if((l=r.n()).done){e.next=46;break}if(c=l.value,u=c.dest,d=c.items,p=void 0,h=void 0,"string"!=typeof u){e.next=21;break}return e.next=16,t.getDestination(u);case 16:if(p=e.sent,t===this._pdfDocument){e.next=19;break}return e.abrupt("return",null);case 19:e.next=22;break;case 21:p=u;case 22:if(!Array.isArray(p)){e.next=43;break}if(f=$a(p,1),"object"!==Na(g=f[0])||null===g){e.next=41;break}if(h=this.linkService._cachedPageNumber(g)){e.next=39;break}return e.prev=27,e.next=30,t.getPageIndex(g);case 30:if(e.t0=e.sent,h=e.t0+1,t===this._pdfDocument){e.next=34;break}return e.abrupt("return",null);case 34:this.linkService.cachePageRef(h,g),e.next=39;break;case 37:e.prev=37,e.t1=e.catch(27);case 39:e.next=42;break;case 41:Number.isInteger(g)&&(h=g+1);case 42:Number.isInteger(h)&&(!n.has(h)||s>i.get(h))&&(m=this.linkService.getDestinationHash(u),n.set(h,m),i.set(h,s));case 43:d.length>0&&a.push({nesting:s+1,items:d});case 44:e.next=10;break;case 46:e.next=51;break;case 48:e.prev=48,e.t2=e.catch(8),r.e(e.t2);case 51:return e.prev=51,r.f(),e.finish(51);case 54:e.next=5;break;case 56:return this._pageNumberToDestHashCapability.resolve(n.size>0?n:null),e.abrupt("return",this._pageNumberToDestHashCapability.promise);case 58:case"end":return e.stop()}}),e,this,[[8,48,51,54],[27,37]])}))),function(e){return a.apply(this,arguments)})}],n&&Wa(t.prototype,n),i&&Wa(t,i),Object.defineProperty(t,"prototype",{writable:!1}),r}(Zt);function eo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function to(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function no(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var io="pdfPresentationMode",ao="pdfPresentationModeControls",oo=Math.PI/6,so=new WeakSet,ro=new WeakSet,lo=new WeakSet,co=new WeakSet,uo=new WeakSet,po=new WeakSet,ho=new WeakSet,fo=new WeakSet,go=new WeakSet,mo=new WeakSet,yo=new WeakSet,bo=new WeakSet,vo=new WeakSet,wo=new WeakSet,_o=new WeakSet,Eo=new WeakSet,ko=new WeakSet,Co=function(){function e(t){var n=t.container,i=t.pdfViewer,a=t.eventBus;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),to(this,ko),to(this,Eo),to(this,_o),to(this,wo),to(this,vo),to(this,bo),to(this,yo),to(this,mo),to(this,go),to(this,fo),to(this,ho),to(this,po),to(this,uo),to(this,co),to(this,lo),to(this,ro),to(this,so),this.container=n,this.pdfViewer=i,this.eventBus=a,this.active=!1,this.args=null,this.contextMenuOpen=!1,this.mouseScrollTimeStamp=0,this.mouseScrollDelta=0,this.touchSwipeState=null}var t,n,i;return t=e,(n=[{key:"request",value:function(){return!(this.switchInProgress||this.active||!this.pdfViewer.pagesCount||!this.container.requestFullscreen||(no(this,Eo,Ro).call(this),no(this,lo,So).call(this),no(this,ro,xo).call(this),this.container.requestFullscreen(),this.args={pageNumber:this.pdfViewer.currentPageNumber,scaleValue:this.pdfViewer.currentScaleValue,scrollMode:this.pdfViewer.scrollMode,spreadMode:this.pdfViewer.spreadMode},0))}}])&&eo(t.prototype,n),i&&eo(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Do(e){if(this.active){e.preventDefault();var t=function(e){var t=V(e);return 0===e.deltaMode?t/=900:1===e.deltaMode&&(t/=30),t}(e),n=Date.now(),i=this.mouseScrollTimeStamp;if(!(n>i&&n-i<50)&&((this.mouseScrollDelta>0&&t<0||this.mouseScrollDelta<0&&t>0)&&no(this,yo,Fo).call(this),this.mouseScrollDelta+=t,Math.abs(this.mouseScrollDelta)>=.1)){var a=this.mouseScrollDelta;no(this,yo,Fo).call(this),(a>0?this.pdfViewer.previousPage():this.pdfViewer.nextPage())&&(this.mouseScrollTimeStamp=n)}}}function xo(){var e=b;this.switchInProgress?e=v:this.active&&(e=w),this.eventBus.dispatch("presentationmodechanged",{source:this,state:e})}function So(){var e=this;this.switchInProgress&&clearTimeout(this.switchInProgress),this.switchInProgress=setTimeout((function(){no(e,ko,qo).call(e),delete e.switchInProgress,no(e,ro,xo).call(e)}),1500)}function Ao(){this.switchInProgress&&(clearTimeout(this.switchInProgress),delete this.switchInProgress)}function Lo(){var e=this;this.active=!0,no(this,co,Ao).call(this),no(this,ro,xo).call(this),this.container.classList.add(io),setTimeout((function(){e.pdfViewer.scrollMode=P.PAGE,e.pdfViewer.spreadMode=I.NONE,e.pdfViewer.currentPageNumber=e.args.pageNumber,e.pdfViewer.currentScaleValue="page-fit"}),0),no(this,vo,$o).call(this),no(this,go,Io).call(this),this.contextMenuOpen=!1,window.getSelection().removeAllRanges()}function To(){var e=this,t=this.pdfViewer.currentPageNumber;this.container.classList.remove(io),setTimeout((function(){e.active=!1,no(e,ko,qo).call(e),no(e,ro,xo).call(e),e.pdfViewer.scrollMode=e.args.scrollMode,e.pdfViewer.spreadMode=e.args.spreadMode,e.pdfViewer.currentScaleValue=e.args.scaleValue,e.pdfViewer.currentPageNumber=t,e.args=null}),0),no(this,wo,Oo).call(this),no(this,mo,Mo).call(this),no(this,yo,Fo).call(this),this.contextMenuOpen=!1}function Bo(e){if(this.contextMenuOpen)return this.contextMenuOpen=!1,void e.preventDefault();0===e.button&&(e.target.href&&e.target.classList.contains("internalLink")||(e.preventDefault(),e.shiftKey?this.pdfViewer.previousPage():this.pdfViewer.nextPage()))}function Po(){this.contextMenuOpen=!0}function Io(){var e=this;this.controlsTimeout?clearTimeout(this.controlsTimeout):this.container.classList.add(ao),this.controlsTimeout=setTimeout((function(){e.container.classList.remove(ao),delete e.controlsTimeout}),3e3)}function Mo(){this.controlsTimeout&&(clearTimeout(this.controlsTimeout),this.container.classList.remove(ao),delete this.controlsTimeout)}function Fo(){this.mouseScrollTimeStamp=0,this.mouseScrollDelta=0}function No(e){if(this.active)if(e.touches.length>1)this.touchSwipeState=null;else switch(e.type){case"touchstart":this.touchSwipeState={startX:e.touches[0].pageX,startY:e.touches[0].pageY,endX:e.touches[0].pageX,endY:e.touches[0].pageY};break;case"touchmove":if(null===this.touchSwipeState)return;this.touchSwipeState.endX=e.touches[0].pageX,this.touchSwipeState.endY=e.touches[0].pageY,e.preventDefault();break;case"touchend":if(null===this.touchSwipeState)return;var t=0,n=this.touchSwipeState.endX-this.touchSwipeState.startX,i=this.touchSwipeState.endY-this.touchSwipeState.startY,a=Math.abs(Math.atan2(i,n));Math.abs(n)>50&&(a<=oo||a>=Math.PI-oo)?t=n:Math.abs(i)>50&&Math.abs(a-Math.PI/2)<=oo&&(t=i),t>0?this.pdfViewer.previousPage():t<0&&this.pdfViewer.nextPage()}}function $o(){this.showControlsBind=no(this,go,Io).bind(this),this.mouseDownBind=no(this,ho,Bo).bind(this),this.mouseWheelBind=no(this,so,Do).bind(this),this.resetMouseScrollStateBind=no(this,yo,Fo).bind(this),this.contextMenuBind=no(this,fo,Po).bind(this),this.touchSwipeBind=no(this,bo,No).bind(this),window.addEventListener("mousemove",this.showControlsBind),window.addEventListener("mousedown",this.mouseDownBind),window.addEventListener("wheel",this.mouseWheelBind,{passive:!1}),window.addEventListener("keydown",this.resetMouseScrollStateBind),window.addEventListener("contextmenu",this.contextMenuBind),window.addEventListener("touchstart",this.touchSwipeBind),window.addEventListener("touchmove",this.touchSwipeBind),window.addEventListener("touchend",this.touchSwipeBind)}function Oo(){window.removeEventListener("mousemove",this.showControlsBind),window.removeEventListener("mousedown",this.mouseDownBind),window.removeEventListener("wheel",this.mouseWheelBind,{passive:!1}),window.removeEventListener("keydown",this.resetMouseScrollStateBind),window.removeEventListener("contextmenu",this.contextMenuBind),window.removeEventListener("touchstart",this.touchSwipeBind),window.removeEventListener("touchmove",this.touchSwipeBind),window.removeEventListener("touchend",this.touchSwipeBind),delete this.showControlsBind,delete this.mouseDownBind,delete this.mouseWheelBind,delete this.resetMouseScrollStateBind,delete this.contextMenuBind,delete this.touchSwipeBind}function Ho(){document.fullscreenElement?no(this,uo,Lo).call(this):no(this,po,To).call(this)}function Ro(){this.fullscreenChangeBind=no(this,_o,Ho).bind(this),window.addEventListener("fullscreenchange",this.fullscreenChangeBind)}function qo(){window.removeEventListener("fullscreenchange",this.fullscreenChangeBind),delete this.fullscreenChangeBind}function jo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Uo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pdfViewer=null,this.pdfThumbnailViewer=null,this.onIdle=null,this.highestPriorityPage=null,this.idleTimeout=null,this.printing=!1,this.isThumbnailViewEnabled=!1}var t,n,i;return t=e,n=[{key:"setViewer",value:function(e){this.pdfViewer=e}},{key:"setThumbnailViewer",value:function(e){this.pdfThumbnailViewer=e}},{key:"isHighestPriority",value:function(e){return this.highestPriorityPage===e.renderingId}},{key:"hasViewer",value:function(){return!!this.pdfViewer}},{key:"renderHighestPriority",value:function(e){var t;this.idleTimeout&&(clearTimeout(this.idleTimeout),this.idleTimeout=null),this.pdfViewer.forceRendering(e)||this.isThumbnailViewEnabled&&null!==(t=this.pdfThumbnailViewer)&&void 0!==t&&t.forceRendering()||this.printing||this.onIdle&&(this.idleTimeout=setTimeout(this.onIdle.bind(this),3e4))}},{key:"getHighestPriority",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.views,o=a.length;if(0===o)return null;for(var s=0;s<o;s++){var r=a[s].view;if(!this.isViewFinished(r))return r}var l=e.first.id,c=e.last.id;if(c-l+1>o)for(var u=e.ids,d=1,p=c-l;d<p;d++){var h=n?l+d:c-d;if(!u.has(h)){var f=t[h-1];if(!this.isViewFinished(f))return f}}var g=n?c:l-2,m=t[g];return m&&!this.isViewFinished(m)||i&&(m=t[g+=n?1:-1])&&!this.isViewFinished(m)?m:null}},{key:"isViewFinished",value:function(e){return e.renderingState===m}},{key:"renderView",value:function(e){var t=this;switch(e.renderingState){case m:return!1;case g:this.highestPriorityPage=e.renderingId,e.resume();break;case f:this.highestPriorityPage=e.renderingId;break;case h:this.highestPriorityPage=e.renderingId,e.draw().finally((function(){t.renderHighestPriority()})).catch((function(e){e instanceof ve.RenderingCancelledException||console.error('renderView: "'.concat(e,'"'))}))}return!0}}],n&&jo(t.prototype,n),i&&jo(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function zo(e){return zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zo(e)}function Wo(e){return function(e){if(Array.isArray(e))return Qo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Xo(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Go(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Vo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Go(Object(n),!0).forEach((function(t){Yo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Go(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Yo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ko(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Xo(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function Zo(){Zo=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==zo(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Jo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,a,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return o}(e,t)||Xo(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xo(e,t){if(e){if("string"==typeof e)return Qo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qo(e,t):void 0}}function Qo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function es(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function ts(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){es(o,i,a,s,r,"next",e)}function r(e){es(o,i,a,s,r,"throw",e)}s(void 0)}))}}function ns(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var is=function(){function e(t){var n=this,i=t.eventBus,a=t.sandboxBundleSrc,o=void 0===a?null:a,s=t.scriptingFactory,r=void 0===s?null:s,l=t.docPropertiesLookup,c=void 0===l?null:l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._pdfDocument=null,this._pdfViewer=null,this._closeCapability=null,this._destroyCapability=null,this._scripting=null,this._mouseState=Object.create(null),this._ready=!1,this._eventBus=i,this._sandboxBundleSrc=o,this._scriptingFactory=r,this._docPropertiesLookup=c,"undefined"!=typeof PDFJSDev&&PDFJSDev.test("COMPONENTS")&&!this._scriptingFactory&&window.addEventListener("updatefromsandbox",(function(e){n._eventBus.dispatch("updatefromsandbox",{source:window,detail:e.detail})}))}var t,i,a,o,s,r,l,c,u,d,p,h,f;return t=e,i=[{key:"setViewer",value:function(e){this._pdfViewer=e}},{key:"setDocument",value:(f=ts(Zo().mark((function e(t){var n,i,a,o,s,r,l,c,u,d,p,h,f,g,m,y,b,v=this;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._pdfDocument){e.next=3;break}return e.next=3,this._destroyScripting();case 3:if(this._pdfDocument=t,t){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,Promise.all([t.getFieldObjects(),t.getCalculationOrderIds(),t.getJSActions()]);case 8:if(i=e.sent,a=Jo(i,3),o=a[0],s=a[1],r=a[2],o||r){e.next=17;break}return e.next=16,this._destroyScripting();case 16:return e.abrupt("return");case 17:if(t===this._pdfDocument){e.next=19;break}return e.abrupt("return");case 19:e.prev=19,this._scripting=this._createScripting(),e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(19),console.error('PDFScriptingManager.setDocument: "'.concat(null===e.t0||void 0===e.t0?void 0:e.t0.message,'".')),e.next=28,this._destroyScripting();case 28:return e.abrupt("return");case 29:this._internalEvents.set("updatefromsandbox",(function(e){(null==e?void 0:e.source)===window&&v._updateFromSandbox(e.detail)})),this._internalEvents.set("dispatcheventinsandbox",(function(e){var t;null===(t=v._scripting)||void 0===t||t.dispatchEventInSandbox(e.detail)})),this._internalEvents.set("pagechanging",(function(e){var t=e.pageNumber,n=e.previous;t!==n&&(v._dispatchPageClose(n),v._dispatchPageOpen(t))})),this._internalEvents.set("pagerendered",(function(e){var t=e.pageNumber;v._pageOpenPending.has(t)&&t===v._pdfViewer.currentPageNumber&&v._dispatchPageOpen(t)})),this._internalEvents.set("pagesdestroy",function(){var e=ts(Zo().mark((function e(t){var n,i;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v._dispatchPageClose(v._pdfViewer.currentPageNumber);case 2:return e.next=4,null===(n=v._scripting)||void 0===n?void 0:n.dispatchEventInSandbox({id:"doc",name:"WillClose"});case 4:null===(i=v._closeCapability)||void 0===i||i.resolve();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this._domEvents.set("mousedown",(function(e){v._mouseState.isDown=!0})),this._domEvents.set("mouseup",(function(e){v._mouseState.isDown=!1})),l=Ko(this._internalEvents);try{for(l.s();!(c=l.n()).done;)u=Jo(c.value,2),d=u[0],p=u[1],this._eventBus._on(d,p)}catch(e){l.e(e)}finally{l.f()}h=Ko(this._domEvents);try{for(h.s();!(f=h.n()).done;)g=Jo(f.value,2),m=g[0],y=g[1],window.addEventListener(m,y)}catch(e){h.e(e)}finally{h.f()}return e.prev=40,e.next=43,this._getDocProperties();case 43:if(b=e.sent,t===this._pdfDocument){e.next=46;break}return e.abrupt("return");case 46:return e.next=48,this._scripting.createSandbox({objects:o,calculationOrder:s,appInfo:{platform:navigator.platform,language:navigator.language},docInfo:Vo(Vo({},b),{},{actions:r})});case 48:this._eventBus.dispatch("sandboxcreated",{source:this}),e.next=57;break;case 51:return e.prev=51,e.t1=e.catch(40),console.error('PDFScriptingManager.setDocument: "'.concat(null===e.t1||void 0===e.t1?void 0:e.t1.message,'".')),e.next=56,this._destroyScripting();case 56:return e.abrupt("return");case 57:return e.next=59,null===(n=this._scripting)||void 0===n?void 0:n.dispatchEventInSandbox({id:"doc",name:"Open"});case 59:return e.next=61,this._dispatchPageOpen(this._pdfViewer.currentPageNumber,!0);case 61:Promise.resolve().then((function(){t===v._pdfDocument&&(v._ready=!0)}));case 62:case"end":return e.stop()}}),e,this,[[19,23],[40,51]])}))),function(e){return f.apply(this,arguments)})},{key:"dispatchWillSave",value:(h=ts(Zo().mark((function e(t){var n;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===(n=this._scripting)||void 0===n?void 0:n.dispatchEventInSandbox({id:"doc",name:"WillSave"}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"dispatchDidSave",value:(p=ts(Zo().mark((function e(t){var n;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===(n=this._scripting)||void 0===n?void 0:n.dispatchEventInSandbox({id:"doc",name:"DidSave"}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"dispatchWillPrint",value:(d=ts(Zo().mark((function e(t){var n;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===(n=this._scripting)||void 0===n?void 0:n.dispatchEventInSandbox({id:"doc",name:"WillPrint"}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"dispatchDidPrint",value:(u=ts(Zo().mark((function e(t){var n;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===(n=this._scripting)||void 0===n?void 0:n.dispatchEventInSandbox({id:"doc",name:"DidPrint"}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"mouseState",get:function(){return this._mouseState}},{key:"destroyPromise",get:function(){var e;return(null===(e=this._destroyCapability)||void 0===e?void 0:e.promise)||null}},{key:"ready",get:function(){return this._ready}},{key:"_internalEvents",get:function(){return(0,ve.shadow)(this,"_internalEvents",new Map)}},{key:"_domEvents",get:function(){return(0,ve.shadow)(this,"_domEvents",new Map)}},{key:"_pageOpenPending",get:function(){return(0,ve.shadow)(this,"_pageOpenPending",new Set)}},{key:"_visitedPages",get:function(){return(0,ve.shadow)(this,"_visitedPages",new Map)}},{key:"_updateFromSandbox",value:(c=ts(Zo().mark((function e(t){var n,i,a,o,s,r,l,c,u,d,p,h;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._pdfViewer.isInPresentationMode||this._pdfViewer.isChangingPresentationMode,i=t.id,a=t.siblings,o=t.command,s=t.value,i){e.next=46;break}e.t0=o,e.next="clear"===e.t0?6:"error"===e.t0?8:"layout"===e.t0?10:"page-num"===e.t0?15:"print"===e.t0?17:"println"===e.t0?21:"zoom"===e.t0?23:"SaveAs"===e.t0?27:"FirstPage"===e.t0?29:"LastPage"===e.t0?31:"NextPage"===e.t0?33:"PrevPage"===e.t0?35:"ZoomViewIn"===e.t0?37:"ZoomViewOut"===e.t0?41:45;break;case 6:return console.clear(),e.abrupt("break",45);case 8:return console.error(s),e.abrupt("break",45);case 10:if(!n){e.next=12;break}return e.abrupt("return");case 12:return r=ee(s),this._pdfViewer.spreadMode=r.spreadMode,e.abrupt("break",45);case 15:return this._pdfViewer.currentPageNumber=s+1,e.abrupt("break",45);case 17:return e.next=19,this._pdfViewer.pagesPromise;case 19:return this._eventBus.dispatch("print",{source:this}),e.abrupt("break",45);case 21:return console.log(s),e.abrupt("break",45);case 23:if(!n){e.next=25;break}return e.abrupt("return");case 25:return this._pdfViewer.currentScaleValue=s,e.abrupt("break",45);case 27:return this._eventBus.dispatch("save",{source:this}),e.abrupt("break",45);case 29:return this._pdfViewer.currentPageNumber=1,e.abrupt("break",45);case 31:return this._pdfViewer.currentPageNumber=this._pdfViewer.pagesCount,e.abrupt("break",45);case 33:return this._pdfViewer.nextPage(),e.abrupt("break",45);case 35:return this._pdfViewer.previousPage(),e.abrupt("break",45);case 37:if(!n){e.next=39;break}return e.abrupt("return");case 39:return this._pdfViewer.increaseScale(),e.abrupt("break",45);case 41:if(!n){e.next=43;break}return e.abrupt("return");case 43:return this._pdfViewer.decreaseScale(),e.abrupt("break",45);case 45:return e.abrupt("return");case 46:if(!n){e.next=49;break}if(!t.focus){e.next=49;break}return e.abrupt("return");case 49:delete t.id,delete t.siblings,l=a?[i].concat(Wo(a)):[i],c=Ko(l);try{for(c.s();!(u=c.n()).done;)d=u.value,(p=document.getElementById(d))?p.dispatchEvent(new CustomEvent("updatefromsandbox",{detail:t})):null===(h=this._pdfDocument)||void 0===h||h.annotationStorage.setValue(d,t)}catch(e){c.e(e)}finally{c.f()}case 54:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"_dispatchPageOpen",value:(l=ts(Zo().mark((function e(t){var n,i,a,o,s,r=this,l=arguments;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]&&l[1],i=this._pdfDocument,a=this._visitedPages,n&&(this._closeCapability=(0,ve.createPromiseCapability)()),this._closeCapability){e.next=5;break}return e.abrupt("return");case 5:if((null==(o=this._pdfViewer.getPageView(t-1))?void 0:o.renderingState)===m){e.next=9;break}return this._pageOpenPending.add(t),e.abrupt("return");case 9:this._pageOpenPending.delete(t),s=ts(Zo().mark((function e(){var n,s,l;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.has(t)?null:null===(n=o.pdfPage)||void 0===n?void 0:n.getJSActions();case 2:if(l=e.sent,i===r._pdfDocument){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,null===(s=r._scripting)||void 0===s?void 0:s.dispatchEventInSandbox({id:"page",name:"PageOpen",pageNumber:t,actions:l});case 7:case"end":return e.stop()}}),e)})))(),a.set(t,s);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"_dispatchPageClose",value:(r=ts(Zo().mark((function e(t){var n,i,a,o;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._pdfDocument,a=this._visitedPages,this._closeCapability){e.next=3;break}return e.abrupt("return");case 3:if(!this._pageOpenPending.has(t)){e.next=5;break}return e.abrupt("return");case 5:if(o=a.get(t)){e.next=8;break}return e.abrupt("return");case 8:return a.set(t,null),e.next=11,o;case 11:if(i===this._pdfDocument){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,null===(n=this._scripting)||void 0===n?void 0:n.dispatchEventInSandbox({id:"page",name:"PageClose",pageNumber:t});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_getDocProperties",value:(s=ts(Zo().mark((function e(){var t,i;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._docPropertiesLookup){e.next=2;break}return e.abrupt("return",this._docPropertiesLookup(this._pdfDocument));case 2:if("undefined"==typeof PDFJSDev||!PDFJSDev.test("COMPONENTS")){e.next=5;break}return t=n(2752),i=t.docPropertiesLookup,e.abrupt("return",i(this._pdfDocument));case 5:throw new Error("_getDocProperties: Unable to lookup properties.");case 6:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"_createScripting",value:function(){if(this._destroyCapability=(0,ve.createPromiseCapability)(),this._scripting)throw new Error("_createScripting: Scripting already exists.");if(this._scriptingFactory)return this._scriptingFactory.createScripting({sandboxBundleSrc:this._sandboxBundleSrc});if("undefined"!=typeof PDFJSDev&&PDFJSDev.test("COMPONENTS"))return new(0,n(2752).GenericScripting)(this._sandboxBundleSrc);throw new Error("_createScripting: Cannot create scripting.")}},{key:"_destroyScripting",value:(o=ts(Zo().mark((function e(){var t,n,i,a,o,s,r,l,c,u,d,p;return Zo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._scripting){e.next=4;break}return this._pdfDocument=null,null===(n=this._destroyCapability)||void 0===n||n.resolve(),e.abrupt("return");case 4:if(!this._closeCapability){e.next=8;break}return e.next=7,Promise.race([this._closeCapability.promise,new Promise((function(e){setTimeout(e,1e3)}))]).catch((function(e){}));case 7:this._closeCapability=null;case 8:return this._pdfDocument=null,e.prev=9,e.next=12,this._scripting.destroySandbox();case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(9);case 16:i=Ko(this._internalEvents);try{for(i.s();!(a=i.n()).done;)o=Jo(a.value,2),s=o[0],r=o[1],this._eventBus._off(s,r)}catch(e){i.e(e)}finally{i.f()}this._internalEvents.clear(),l=Ko(this._domEvents);try{for(l.s();!(c=l.n()).done;)u=Jo(c.value,2),d=u[0],p=u[1],window.removeEventListener(d,p)}catch(e){l.e(e)}finally{l.f()}this._domEvents.clear(),this._pageOpenPending.clear(),this._visitedPages.clear(),this._scripting=null,delete this._mouseState.isDown,this._ready=!1,null===(t=this._destroyCapability)||void 0===t||t.resolve();case 28:case"end":return e.stop()}}),e,this,[[9,14]])}))),function(){return o.apply(this,arguments)})}],i&&ns(t.prototype,i),a&&ns(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();function as(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var os="pdfSidebarNotification",ss=function(){function e(t){var n=t.elements,i=t.pdfViewer,a=t.pdfThumbnailViewer,o=t.eventBus,s=t.l10n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isOpen=!1,this.active=k,this.isInitialViewSet=!1,this.onToggled=null,this.pdfViewer=i,this.pdfThumbnailViewer=a,this.outerContainer=n.outerContainer,this.viewerContainer=n.viewerContainer,this.toggleButton=n.toggleButton,this.thumbnailButton=n.thumbnailButton,this.outlineButton=n.outlineButton,this.attachmentsButton=n.attachmentsButton,this.layersButton=n.layersButton,this.thumbnailView=n.thumbnailView,this.outlineView=n.outlineView,this.attachmentsView=n.attachmentsView,this.layersView=n.layersView,this._outlineOptionsContainer=n.outlineOptionsContainer,this._currentOutlineItemButton=n.currentOutlineItemButton,this.eventBus=o,this.l10n=s,this._addEventListeners()}var t,n,i;return t=e,n=[{key:"reset",value:function(){this.isInitialViewSet=!1,this._hideUINotification(!0),this.switchView(k),this.outlineButton.disabled=!1,this.attachmentsButton.disabled=!1,this.layersButton.disabled=!1,this._currentOutlineItemButton.disabled=!0}},{key:"visibleView",get:function(){return this.isOpen?this.active:E}},{key:"isThumbnailViewVisible",get:function(){return this.isOpen&&this.active===k}},{key:"isOutlineViewVisible",get:function(){return this.isOpen&&this.active===C}},{key:"isAttachmentsViewVisible",get:function(){return this.isOpen&&this.active===D}},{key:"isLayersViewVisible",get:function(){return this.isOpen&&this.active===x}},{key:"setInitialView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;this.isInitialViewSet||(this.isInitialViewSet=!0,e!==E&&e!==_&&this._switchView(e,!0)||this._dispatchEvent())}},{key:"switchView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._switchView(e,t)}},{key:"_switchView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e!==this.active,i=!1;switch(e){case E:return!!this.isOpen&&(this.close(),!0);case k:this.isOpen&&n&&(i=!0);break;case C:if(this.outlineButton.disabled)return!1;break;case D:if(this.attachmentsButton.disabled)return!1;break;case x:if(this.layersButton.disabled)return!1;break;default:return console.error('PDFSidebar._switchView: "'.concat(e,'" is not a valid view.')),!1}this.active=e;var a=e===k,o=e===C,s=e===D,r=e===x;return this.thumbnailButton.classList.toggle("toggled",a),this.outlineButton.classList.toggle("toggled",o),this.attachmentsButton.classList.toggle("toggled",s),this.layersButton.classList.toggle("toggled",r),this.thumbnailButton.setAttribute("aria-checked","".concat(a)),this.outlineButton.setAttribute("aria-checked","".concat(o)),this.attachmentsButton.setAttribute("aria-checked","".concat(s)),this.layersButton.setAttribute("aria-checked","".concat(r)),this.thumbnailView.classList.toggle("fn__hidden",!a),this.outlineView.classList.toggle("fn__hidden",!o),this.attachmentsView.classList.toggle("fn__hidden",!s),this.layersView.classList.toggle("fn__hidden",!r),this._outlineOptionsContainer.classList.toggle("fn__hidden",!o),t&&!this.isOpen?(this.open(),!0):(i&&(this._updateThumbnailViewer(),this._forceRendering()),n&&this._dispatchEvent(),n)}},{key:"open",value:function(){this.isOpen||(this.isOpen=!0,this.toggleButton.classList.add("toggled"),this.toggleButton.setAttribute("aria-expanded","true"),this.outerContainer.classList.add("sidebarMoving","sidebarOpen"),this.active===k&&this._updateThumbnailViewer(),this._forceRendering(),this._dispatchEvent(),this._hideUINotification())}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.toggleButton.classList.remove("toggled"),this.toggleButton.setAttribute("aria-expanded","false"),this.outerContainer.classList.add("sidebarMoving"),this.outerContainer.classList.remove("sidebarOpen"),this._forceRendering(),this._dispatchEvent())}},{key:"toggle",value:function(){this.isOpen?this.close():this.open()}},{key:"_dispatchEvent",value:function(){this.eventBus.dispatch("sidebarviewchanged",{source:this,view:this.visibleView})}},{key:"_forceRendering",value:function(){this.onToggled?this.onToggled():(this.pdfViewer.forceRendering(),this.pdfThumbnailViewer.forceRendering())}},{key:"_updateThumbnailViewer",value:function(){for(var e=this.pdfViewer,t=this.pdfThumbnailViewer,n=e.pagesCount,i=0;i<n;i++){var a=e.getPageView(i);(null==a?void 0:a.renderingState)===m&&t.getThumbnail(i).setImage(a)}t.scrollThumbnailIntoView(e.currentPageNumber)}},{key:"_showUINotification",value:function(){this.toggleButton.title=window.siyuan.languages.toggleSidebarNotification2Title,this.isOpen||this.toggleButton.classList.add(os)}},{key:"_hideUINotification",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.isOpen||e)&&this.toggleButton.classList.remove(os),e&&(this.toggleButton.title=window.siyuan.languages.toggleSidebarTitle)}},{key:"_addEventListeners",value:function(){var e=this;this.viewerContainer.addEventListener("transitionend",(function(t){t.target===e.viewerContainer&&e.outerContainer.classList.remove("sidebarMoving")})),this.toggleButton.addEventListener("click",(function(){e.toggle()})),this.thumbnailButton.addEventListener("click",(function(){e.switchView(k)})),this.outlineButton.addEventListener("click",(function(){e.switchView(C)})),this.outlineButton.addEventListener("dblclick",(function(){e.eventBus.dispatch("toggleoutlinetree",{source:e})})),this.attachmentsButton.addEventListener("click",(function(){e.switchView(D)})),this.layersButton.addEventListener("click",(function(){e.switchView(x)})),this.layersButton.addEventListener("dblclick",(function(){e.eventBus.dispatch("resetlayers",{source:e})})),this._currentOutlineItemButton.addEventListener("click",(function(){e.eventBus.dispatch("currentoutlineitem",{source:e})}));var t=function(t,n,i){n.disabled=!t,t?e._showUINotification():e.active===i&&e.switchView(k)};this.eventBus._on("outlineloaded",(function(n){t(n.outlineCount,e.outlineButton,C),n.currentOutlineItemPromise.then((function(t){e.isInitialViewSet&&(e._currentOutlineItemButton.disabled=!t)}))})),this.eventBus._on("attachmentsloaded",(function(n){t(n.attachmentsCount,e.attachmentsButton,D)})),this.eventBus._on("layersloaded",(function(n){t(n.layersCount,e.layersButton,x)})),this.eventBus._on("presentationmodechanged",(function(t){t.state===b&&e.isThumbnailViewVisible&&e._updateThumbnailViewer()}))}}],n&&as(t.prototype,n),i&&as(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function rs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ls="--b3-pdf-sidebar-width",cs=200,us="sidebarResizing",ds=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isRTL=!1,this.sidebarOpen=!1,this.doc=document.documentElement,this._width=null,this._outerContainerWidth=null,this._boundEvents=Object.create(null),this.outerContainer=t.outerContainer,this.resizer=t.resizer,this.eventBus=n,this.isRTL=!1,this._addEventListeners()}var t,n,i;return t=e,n=[{key:"outerContainerWidth",get:function(){return this._outerContainerWidth||(this._outerContainerWidth=this.outerContainer.clientWidth)}},{key:"_updateWidth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=Math.floor(this.outerContainerWidth/2);return e>t&&(e=t),e<cs&&(e=cs),e!==this._width&&(this._width=e,this.doc.style.setProperty(ls,"".concat(e,"px")),!0)}},{key:"_mouseMove",value:function(e){var t=e.clientX;this.isRTL&&(t=this.outerContainerWidth-t),this._updateWidth(t)}},{key:"_mouseUp",value:function(e){this.outerContainer.classList.remove(us),this.eventBus.dispatch("resize",{source:this});var t=this._boundEvents;window.removeEventListener("mousemove",t.mouseMove),window.removeEventListener("mouseup",t.mouseUp)}},{key:"_addEventListeners",value:function(){var e=this,t=this._boundEvents;t.mouseMove=this._mouseMove.bind(this),t.mouseUp=this._mouseUp.bind(this),this.resizer.addEventListener("mousedown",(function(n){0===n.button&&(e.outerContainer.classList.add(us),window.addEventListener("mousemove",t.mouseMove),window.addEventListener("mouseup",t.mouseUp))})),this.eventBus._on("sidebarviewchanged",(function(t){e.sidebarOpen=!(null==t||!t.view)})),this.eventBus._on("resize",(function(t){if((null==t?void 0:t.source)===window&&(e._outerContainerWidth=null,e._width))if(e.sidebarOpen){e.outerContainer.classList.add(us);var n=e._updateWidth(e._width);Promise.resolve().then((function(){e.outerContainer.classList.remove(us),n&&e.eventBus.dispatch("resize",{source:e})}))}else e._updateWidth(e._width)}))}}],n&&rs(t.prototype,n),i&&rs(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ps(e){return ps="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ps(e)}function hs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,a,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fs(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function gs(){gs=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==ps(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function ms(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function ys(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function vs(e,t,n){return t&&bs(e.prototype,t),n&&bs(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ws(e,t,n,i){return ks(e,t),Es(n,"set"),function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,n,i),i}function _s(e,t,n){return ks(e,t),Es(n,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,n)}function Es(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function ks(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var Cs=function(){function e(){ys(this,e)}return vs(e,null,[{key:"getCanvas",value:function(t,n){var i=_s(this,e,Ds)||ws(this,e,Ds,document.createElement("canvas"));i.width=t,i.height=n,("undefined"==typeof PDFJSDev||PDFJSDev.test("MOZCENTRAL || GENERIC"))&&(i.mozOpaque=!0);var a=i.getContext("2d",{alpha:!1});return a.save(),a.fillStyle="rgb(255, 255, 255)",a.fillRect(0,0,t,n),a.restore(),[i,i.getContext("2d")]}},{key:"destroyCanvas",value:function(){var t=_s(this,e,Ds);t&&(t.width=0,t.height=0),ws(this,e,Ds,null)}}]),e}(),Ds={writable:!0,value:null},xs=function(){function e(t){var n=t.container,i=t.id,a=t.defaultViewport,o=t.optionalContentConfigPromise,s=t.linkService,r=t.renderingQueue,l=t.checkSetImageDisabled,c=t.l10n;ys(this,e),this.id=i,this.renderingId="thumbnail"+i,this.pageLabel=null,this.pdfPage=null,this.rotation=0,this.viewport=a,this.pdfPageRotate=a.rotation,this._optionalContentConfigPromise=o||null,this.linkService=s,this.renderingQueue=r,this.renderTask=null,this.renderingState=h,this.resume=null,this._checkSetImageDisabled=l||function(){return!1};var u=this.viewport.width,d=u/this.viewport.height;this.canvasWidth=98,this.canvasHeight=this.canvasWidth/d|0,this.scale=this.canvasWidth/u,this.l10n=c;var p=document.createElement("a");p.href=s.getAnchorUrl("#page="+i),p.title=this._thumbPageTitle,p.onclick=function(){return s.goToPage(i),!1},this.anchor=p;var f=document.createElement("div");f.className="thumbnail",f.setAttribute("data-page-number",this.id),this.div=f;var g=document.createElement("div");g.className="thumbnailSelectionRing";g.style.width=this.canvasWidth+2+"px",g.style.height=this.canvasHeight+2+"px",this.ring=g,f.appendChild(g),p.appendChild(f),n.appendChild(p)}return vs(e,[{key:"setPdfPage",value:function(e){this.pdfPage=e,this.pdfPageRotate=e.rotate;var t=(this.rotation+this.pdfPageRotate)%360;this.viewport=e.getViewport({scale:1,rotation:t}),this.reset()}},{key:"reset",value:function(){this.cancelRendering(),this.renderingState=h;var e=this.viewport.width,t=e/this.viewport.height;this.canvasHeight=this.canvasWidth/t|0,this.scale=this.canvasWidth/e,this.div.removeAttribute("data-loaded");var n=this.ring;n.textContent="";n.style.width=this.canvasWidth+2+"px",n.style.height=this.canvasHeight+2+"px",this.canvas&&(this.canvas.width=0,this.canvas.height=0,delete this.canvas),this.image&&(this.image.removeAttribute("src"),delete this.image)}},{key:"update",value:function(e){var t=e.rotation,n=void 0===t?null:t;"number"==typeof n&&(this.rotation=n);var i=(this.rotation+this.pdfPageRotate)%360;this.viewport=this.viewport.clone({scale:1,rotation:i}),this.reset()}},{key:"cancelRendering",value:function(){this.renderTask&&(this.renderTask.cancel(),this.renderTask=null),this.resume=null}},{key:"_getPageDrawContext",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=document.createElement("canvas");("undefined"==typeof PDFJSDev||PDFJSDev.test("MOZCENTRAL || GENERIC"))&&(t.mozOpaque=!0);var n=t.getContext("2d",{alpha:!1}),i=new F;t.width=e*this.canvasWidth*i.sx|0,t.height=e*this.canvasHeight*i.sy|0;var a=i.scaled?[i.sx,0,0,i.sy,0,0]:null;return{ctx:n,canvas:t,transform:a}}},{key:"_convertCanvasToImage",value:function(e){if(this.renderingState!==m)throw new Error("_convertCanvasToImage: Rendering has not finished.");var t=this._reduceImage(e),n=document.createElement("img");n.className="thumbnailImage",n.setAttribute("aria-label",this._thumbPageCanvas),n.style.width=this.canvasWidth+"px",n.style.height=this.canvasHeight+"px",n.src=t.toDataURL(),this.image=n,this.div.setAttribute("data-loaded",!0),this.ring.appendChild(n),t.width=0,t.height=0}},{key:"draw",value:function(){var e=this;if(this.renderingState!==h)return console.error("Must be in new state before drawing"),Promise.resolve();var t=this.pdfPage;if(!t)return this.renderingState=m,Promise.reject(new Error("pdfPage is not loaded"));this.renderingState=f;var n=function(){var t,n=(t=gs().mark((function t(){var n,i=arguments;return gs().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=i.length>0&&void 0!==i[0]?i[0]:null,r===e.renderTask&&(e.renderTask=null),!(n instanceof ve.RenderingCancelledException)){t.next=4;break}return t.abrupt("return");case 4:if(e.renderingState=m,e._convertCanvasToImage(o),!n){t.next=8;break}throw n;case 8:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(i,a){var o=t.apply(e,n);function s(e){ms(o,i,a,s,r,"next",e)}function r(e){ms(o,i,a,s,r,"throw",e)}s(void 0)}))});return function(){return n.apply(this,arguments)}}(),i=this._getPageDrawContext(2),a=i.ctx,o=i.canvas,s={canvasContext:a,transform:i.transform,viewport:this.viewport.clone({scale:2*this.scale}),optionalContentConfigPromise:this._optionalContentConfigPromise},r=this.renderTask=t.render(s);r.onContinue=function(t){if(!e.renderingQueue.isHighestPriority(e))return e.renderingState=g,void(e.resume=function(){e.renderingState=f,t()});t()};var l=r.promise.then((function(){return n(null)}),(function(e){return n(e)}));return l.finally((function(){var t;(o.width=0,o.height=0,e.linkService.isPageCached(e.id))||(null===(t=e.pdfPage)||void 0===t||t.cleanup())})),l}},{key:"setImage",value:function(e){if(!this._checkSetImageDisabled()&&this.renderingState===h){var t=e.canvas,n=e.pdfPage;t&&(this.pdfPage||this.setPdfPage(n),this.renderingState=m,this._convertCanvasToImage(t))}}},{key:"_reduceImage",value:function(e){var t=this._getPageDrawContext(),n=t.ctx,i=t.canvas;if(e.width<=2*i.width)return n.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),i;for(var a=i.width<<3,o=i.height<<3,s=hs(Cs.getCanvas(a,o),2),r=s[0],l=s[1];a>e.width||o>e.height;)a>>=1,o>>=1;for(l.drawImage(e,0,0,e.width,e.height,0,0,a,o);a>2*i.width;)l.drawImage(r,0,0,a,o,0,0,a>>1,o>>1),a>>=1,o>>=1;return n.drawImage(r,0,0,a,o,0,0,i.width,i.height),i}},{key:"_thumbPageTitle",get:function(){var e;return window.siyuan.languages.thumbPageTitle.replace("{{page}}",null!==(e=this.pageLabel)&&void 0!==e?e:this.id)}},{key:"_thumbPageCanvas",get:function(){var e;return window.siyuan.languages.thumbPage.replace("{{page}}",null!==(e=this.pageLabel)&&void 0!==e?e:this.id)}},{key:"setPageLabel",value:function(e){var t;this.pageLabel="string"==typeof e?e:null,this.anchor.title=this._thumbPageTitle,this.renderingState===m&&(null===(t=this.image)||void 0===t||t.setAttribute("aria-label",this._thumbPageCanvas))}}]),e}();function Ss(e){return Ss="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ss(e)}function As(){As=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==Ss(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ls(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function Ts(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){Ls(o,i,a,s,r,"next",e)}function r(e){Ls(o,i,a,s,r,"throw",e)}s(void 0)}))}}function Bs(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ps(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ps(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function Ps(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Is(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ms(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function Fs(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var Ns="selected",$s=new WeakSet,Os=new WeakSet,Hs=function(){function e(t){var n=this,i=t.container,a=t.eventBus,o=t.linkService,s=t.renderingQueue,r=t.l10n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ms(this,Os),Ms(this,$s),this.container=i,this.linkService=o,this.renderingQueue=s,this.l10n=r,this.scroll=$(this.container,this._scrollUpdated.bind(this)),this._resetView(),a._on("optionalcontentconfigchanged",(function(){n._setImageDisabled=!0}))}var t,n,i;return t=e,(n=[{key:"_scrollUpdated",value:function(){this.renderingQueue.renderHighestPriority()}},{key:"getThumbnail",value:function(e){return this._thumbnails[e]}},{key:"_getVisibleThumbs",value:function(){return W({scrollEl:this.container,views:this._thumbnails})}},{key:"scrollThumbnailIntoView",value:function(e){if(this.pdfDocument){var t=this._thumbnails[e-1];if(t){e!==this._currentPageNumber&&(this._thumbnails[this._currentPageNumber-1].div.classList.remove(Ns),t.div.classList.add(Ns));var n=this._getVisibleThumbs(),i=n.first,a=n.last,o=n.views;if(o.length>0){var s=!1;if(e<=i.id||e>=a.id)s=!0;else{var r,l=Bs(o);try{for(l.s();!(r=l.n()).done;){var c=r.value,u=c.id,d=c.percent;if(u===e){s=d<100;break}}}catch(e){l.e(e)}finally{l.f()}}s&&N(t.div,{top:-19})}this._currentPageNumber=e}else console.error('scrollThumbnailIntoView: Invalid "pageNumber" parameter.')}}},{key:"pagesRotation",get:function(){return this._pagesRotation},set:function(e){if(!Y(e))throw new Error("Invalid thumbnails rotation angle.");if(this.pdfDocument&&this._pagesRotation!==e){this._pagesRotation=e;var t,n={rotation:e},i=Bs(this._thumbnails);try{for(i.s();!(t=i.n()).done;)t.value.update(n)}catch(e){i.e(e)}finally{i.f()}}}},{key:"cleanup",value:function(){for(var e=0,t=this._thumbnails.length;e<t;e++)this._thumbnails[e]&&this._thumbnails[e].renderingState!==m&&this._thumbnails[e].reset();Cs.destroyCanvas()}},{key:"_resetView",value:function(){this._thumbnails=[],this._currentPageNumber=1,this._pageLabels=null,this._pagesRotation=0,this._optionalContentConfigPromise=null,this._setImageDisabled=!1,this.container.textContent=""}},{key:"setDocument",value:function(e){var t=this;if(this.pdfDocument&&(this._cancelRendering(),this._resetView()),this.pdfDocument=e,e){var n=e.getPage(1),i=e.getOptionalContentConfig();n.then((function(n){t._optionalContentConfigPromise=i;for(var a=e.numPages,o=n.getViewport({scale:1}),s=function(){return t._setImageDisabled},r=1;r<=a;++r){var l=new xs({container:t.container,id:r,defaultViewport:o.clone(),optionalContentConfigPromise:i,linkService:t.linkService,renderingQueue:t.renderingQueue,checkSetImageDisabled:s,l10n:t.l10n});t._thumbnails.push(l)}var c=t._thumbnails[0];c&&c.setPdfPage(n),t._thumbnails[t._currentPageNumber-1].div.classList.add(Ns)})).catch((function(e){console.error("Unable to initialize thumbnail viewer",e)}))}}},{key:"_cancelRendering",value:function(){for(var e=0,t=this._thumbnails.length;e<t;e++)this._thumbnails[e]&&this._thumbnails[e].cancelRendering()}},{key:"setPageLabels",value:function(e){if(this.pdfDocument){e?Array.isArray(e)&&this.pdfDocument.numPages===e.length?this._pageLabels=e:(this._pageLabels=null,console.error("PDFThumbnailViewer_setPageLabels: Invalid page labels.")):this._pageLabels=null;for(var t=0,n=this._thumbnails.length;t<n;t++){var i,a;this._thumbnails[t].setPageLabel(null!==(i=null===(a=this._pageLabels)||void 0===a?void 0:a[t])&&void 0!==i?i:null)}}}},{key:"forceRendering",value:function(){var e=this,t=this._getVisibleThumbs(),n=Fs(this,Os,js).call(this,t),i=this.renderingQueue.getHighestPriority(t,this._thumbnails,n);return!!i&&(Fs(this,$s,Rs).call(this,i).then((function(){e.renderingQueue.renderView(i)})),!0)}}])&&Is(t.prototype,n),i&&Is(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Rs(e){return qs.apply(this,arguments)}function qs(){return(qs=Ts(As().mark((function e(t){var n;return As().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.pdfPage){e.next=2;break}return e.abrupt("return",t.pdfPage);case 2:return e.prev=2,e.next=5,this.pdfDocument.getPage(t.id);case 5:return n=e.sent,t.pdfPage||t.setPdfPage(n),e.abrupt("return",n);case 10:return e.prev=10,e.t0=e.catch(2),console.error("Unable to get page for thumb view",e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,this,[[2,10]])})))).apply(this,arguments)}function js(e){var t,n;return 1===(null===(t=e.first)||void 0===t?void 0:t.id)||(null===(n=e.last)||void 0===n?void 0:n.id)!==this._thumbnails.length&&this.scroll.down}function Us(e){return Us="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Us(e)}function zs(){zs=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==Us(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ws(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function Gs(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){Ws(o,i,a,s,r,"next",e)}function r(e){Ws(o,i,a,s,r,"throw",e)}s(void 0)}))}}var Vs={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",print_progress_percent:"{{progress}}%","toggle_sidebar.title":"Toggle Sidebar","toggle_sidebar_notification2.title":"Toggle Sidebar (document contains outline/attachments/layers)",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",error_version_info:"PDF.js v{{version}} (build: {{build}})",error_message:"Message: {{message}}",error_stack:"Stack: {{stack}}",error_file:"File: {{file}}",error_line:"Line: {{line}}",rendering_error:"An error occurred while rendering the page.",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading:"Loading…",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts."};function Ys(e,t){switch(e){case"find_match_count":e="find_match_count[".concat(1===t.total?"one":"other","]");break;case"find_match_count_limit":e="find_match_count_limit[".concat(1===t.limit?"one":"other","]")}return Vs[e]||""}function Ks(e,t){return t?e.replace(/\{\{\s*(\w+)\s*\}\}/g,(function(e,n){return n in t?t[n]:"{{"+n+"}}"})):e}var Zs={getLanguage:function(){return Gs(zs().mark((function e(){return zs().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","en-us");case 1:case"end":return e.stop()}}),e)})))()},getDirection:function(){return Gs(zs().mark((function e(){return zs().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","ltr");case 1:case"end":return e.stop()}}),e)})))()},get:function(e){var t=arguments;return Gs(zs().mark((function n(){var i,a;return zs().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=t.length>1&&void 0!==t[1]?t[1]:null,a=t.length>2&&void 0!==t[2]?t[2]:Ys(e,i),n.abrupt("return",Ks(a,i));case 3:case"end":return n.stop()}}),n)})))()},translate:function(e){return Gs(zs().mark((function e(){return zs().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}};function Js(e){return Js="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Js(e)}function Xs(){Xs=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==Js(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Qs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,a,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return er(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return er(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function er(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function tr(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function nr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ir=function(){function e(t){var n=t.pageDiv,i=t.pdfPage,a=t.linkService,o=t.downloadManager,s=t.annotationStorage,r=void 0===s?null:s,l=t.imageResourcesPath,c=void 0===l?"":l,u=t.renderForms,d=void 0===u||u,p=t.l10n,h=void 0===p?Zs:p,f=t.enableScripting,g=void 0!==f&&f,m=t.hasJSActionsPromise,y=void 0===m?null:m,b=t.fieldObjectsPromise,v=void 0===b?null:b,w=t.mouseState,_=void 0===w?null:w,E=t.annotationCanvasMap,k=void 0===E?null:E;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pageDiv=n,this.pdfPage=i,this.linkService=a,this.downloadManager=o,this.imageResourcesPath=c,this.renderForms=d,this.l10n=h,this.annotationStorage=r,this.enableScripting=g,this._hasJSActionsPromise=y,this._fieldObjectsPromise=v,this._mouseState=_,this._annotationCanvasMap=k,this.div=null,this._cancelled=!1}var t,n,i,a,o;return t=e,n=[{key:"render",value:(a=Xs().mark((function e(t){var n,i,a,o,s,r,l,c,u,d=arguments;return Xs().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:"display",e.next=3,Promise.all([this.pdfPage.getAnnotations({intent:n}),this._hasJSActionsPromise,this._fieldObjectsPromise]);case 3:if(i=e.sent,a=Qs(i,3),o=a[0],s=a[1],r=void 0!==s&&s,l=a[2],c=void 0===l?null:l,!this._cancelled&&0!==o.length){e.next=12;break}return e.abrupt("return");case 12:u={viewport:t.clone({dontFlip:!0}),div:this.div,annotations:o,page:this.pdfPage,imageResourcesPath:this.imageResourcesPath,renderForms:this.renderForms,linkService:this.linkService,downloadManager:this.downloadManager,annotationStorage:this.annotationStorage,enableScripting:this.enableScripting,hasJSActions:r,fieldObjects:c,mouseState:this._mouseState,annotationCanvasMap:this._annotationCanvasMap},this.div?ve.AnnotationLayer.update(u):(this.div=document.createElement("div"),this.div.className="annotationLayer",this.pageDiv.appendChild(this.div),u.div=this.div,ve.AnnotationLayer.render(u),this.l10n.translate(this.div));case 14:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,i){var o=a.apply(e,t);function s(e){tr(o,n,i,s,r,"next",e)}function r(e){tr(o,n,i,s,r,"throw",e)}s(void 0)}))},function(e){return o.apply(this,arguments)})},{key:"cancel",value:function(){this._cancelled=!0}},{key:"hide",value:function(){this.div&&(this.div.hidden=!0)}}],n&&nr(t.prototype,n),i&&nr(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ar(e){return ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ar(e)}function or(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return sr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function sr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function rr(){rr=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==ar(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function lr(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function cr(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){lr(o,i,a,s,r,"next",e)}function r(e){lr(o,i,a,s,r,"throw",e)}s(void 0)}))}}function ur(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function dr(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function pr(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,fr(e,t,"get"))}function hr(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,fr(e,t,"set"),n),n}function fr(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var gr=ne.bA.maxCanvasPixels||16777216,mr=new WeakMap,yr=function(){function e(t){var n,i,a,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),dr(this,mr,{writable:!0,value:ve.AnnotationMode.ENABLE_FORMS});var s=t.container,r=t.defaultViewport;this.id=t.id,this.renderingId="page"+this.id,this.pdfPage=null,this.pageLabel=null,this.rotation=0,this.scale=t.scale||1,this.viewport=r,this.pdfPageRotate=r.rotation,this._optionalContentConfigPromise=t.optionalContentConfigPromise||null,this.hasRestrictedScaling=!1,this.textLayerMode=null!==(n=t.textLayerMode)&&void 0!==n?n:T,hr(this,mr,null!==(i=t.annotationMode)&&void 0!==i?i:ve.AnnotationMode.ENABLE_FORMS),this.imageResourcesPath=t.imageResourcesPath||"",this.useOnlyCssZoom=t.useOnlyCssZoom||!1,this.maxCanvasPixels=t.maxCanvasPixels||gr,this.eventBus=t.eventBus,this.renderingQueue=t.renderingQueue,this.textLayerFactory=t.textLayerFactory,this.annotationLayerFactory=t.annotationLayerFactory,this.xfaLayerFactory=t.xfaLayerFactory,this.textHighlighter=null===(a=t.textHighlighterFactory)||void 0===a?void 0:a.createTextHighlighter(this.id-1,this.eventBus),this.structTreeLayerFactory=t.structTreeLayerFactory,this.renderer=t.renderer||S,this.l10n=t.l10n||Zs,this.paintTask=null,this.paintedViewportMap=new WeakMap,this.renderingState=h,this.resume=null,this._renderError=null,this._isStandalone=!(null!==(o=this.renderingQueue)&&void 0!==o&&o.hasViewer()),this._annotationCanvasMap=null,this.annotationLayer=null,this.textLayer=null,this.zoomLayer=null,this.xfaLayer=null,this.structTreeLayer=null;var l=document.createElement("div");l.className="page",l.style.width=Math.floor(this.viewport.width)+"px",l.style.height=Math.floor(this.viewport.height)+"px",l.setAttribute("data-page-number",this.id),l.setAttribute("role","region"),l.setAttribute("aria-label",window.siyuan.languages.thumbPageTitle.replace("{{page}}",this.id)),this.div=l,null==s||s.appendChild(l)}var t,n,i,a,o,s;return t=e,n=[{key:"setPdfPage",value:function(e){this.pdfPage=e,this.pdfPageRotate=e.rotate;var t=(this.rotation+this.pdfPageRotate)%360;this.viewport=e.getViewport({scale:this.scale*ve.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:t}),this.reset()}},{key:"destroy",value:function(){this.reset(),this.pdfPage&&this.pdfPage.cleanup()}},{key:"_renderAnnotationLayer",value:(s=cr(rr().mark((function e(){var t;return rr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,e.prev=1,e.next=4,this.annotationLayer.render(this.viewport,"display");case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),t=e.t0;case 9:return e.prev=9,this.eventBus.dispatch("annotationlayerrendered",{source:this,pageNumber:this.id,error:t}),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[1,6,9,12]])}))),function(){return s.apply(this,arguments)})},{key:"_renderXfaLayer",value:(o=cr(rr().mark((function e(){var t,n;return rr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,e.prev=1,e.next=4,this.xfaLayer.render(this.viewport,"display");case 4:n=e.sent,this.textHighlighter&&this._buildXfaTextContentItems(n.textDivs),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t=e.t0;case 11:return e.prev=11,this.eventBus.dispatch("xfalayerrendered",{source:this,pageNumber:this.id,error:t}),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[1,8,11,14]])}))),function(){return o.apply(this,arguments)})},{key:"_buildXfaTextContentItems",value:(a=cr(rr().mark((function e(t){var n,i,a,o,s;return rr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pdfPage.getTextContent();case 2:n=e.sent,i=[],a=or(n.items);try{for(a.s();!(o=a.n()).done;)s=o.value,i.push(s.str)}catch(e){a.e(e)}finally{a.f()}this.textHighlighter.setTextMapping(t,i),this.textHighlighter.enable();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_resetZoomLayer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.zoomLayer){var t=this.zoomLayer.firstChild;this.paintedViewportMap.delete(t),t.width=0,t.height=0,e&&this.zoomLayer.remove(),this.zoomLayer=null}}},{key:"reset",value:function(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=i.keepZoomLayer,o=void 0!==a&&a,s=i.keepAnnotationLayer,r=void 0!==s&&s,l=i.keepXfaLayer,c=void 0!==l&&l;this.cancelRendering({keepAnnotationLayer:r,keepXfaLayer:c}),this.renderingState=h;var u=this.div;u.style.width=Math.floor(this.viewport.width)+"px",u.style.height=Math.floor(this.viewport.height)+"px";for(var d=u.childNodes,p=o&&this.zoomLayer||null,f=r&&(null===(e=this.annotationLayer)||void 0===e?void 0:e.div)||null,g=c&&(null===(t=this.xfaLayer)||void 0===t?void 0:t.div)||null,m=d.length-1;m>=0;m--){var y=d[m];switch(y){case p:case f:case g:continue}y.remove()}u.removeAttribute("data-loaded"),f&&this.annotationLayer.hide(),g&&this.xfaLayer.hide(),p||(this.canvas&&(this.paintedViewportMap.delete(this.canvas),this.canvas.width=0,this.canvas.height=0,delete this.canvas),this._resetZoomLayer()),this.svg&&(this.paintedViewportMap.delete(this.svg),delete this.svg),this.loadingIconDiv=document.createElement("div"),this.loadingIconDiv.className="loadingIcon notVisible",this._isStandalone&&this.toggleLoadingIconSpinner(!0),this.loadingIconDiv.setAttribute("role","img"),null===(n=this.loadingIconDiv)||void 0===n||n.setAttribute("aria-label",window.siyuan.languages.loading),u.appendChild(this.loadingIconDiv)}},{key:"update",value:function(e){var t=e.scale,n=void 0===t?0:t,i=e.rotation,a=void 0===i?null:i,o=e.optionalContentConfigPromise,s=void 0===o?null:o;this.scale=n||this.scale,"number"==typeof a&&(this.rotation=a),s instanceof Promise&&(this._optionalContentConfigPromise=s);var r=(this.rotation+this.pdfPageRotate)%360,l=this.scale*ve.PixelsPerInch.PDF_TO_CSS_UNITS;if(this.viewport=this.viewport.clone({scale:l,rotation:r}),this._isStandalone){var c=document.documentElement.style;c.setProperty("--zoom-factor",this.scale),c.setProperty("--viewport-scale-factor",l)}if(this.svg)return this.cssTransform({target:this.svg,redrawAnnotationLayer:!0,redrawXfaLayer:!0}),void this.eventBus.dispatch("pagerendered",{source:this,pageNumber:this.id,cssTransform:!0,timestamp:performance.now(),error:this._renderError});var u=!1;if(this.canvas&&this.maxCanvasPixels>0){var d=this.outputScale;(Math.floor(this.viewport.width)*d.sx|0)*(Math.floor(this.viewport.height)*d.sy|0)>this.maxCanvasPixels&&(u=!0)}if(this.canvas){if(this.useOnlyCssZoom||this.hasRestrictedScaling&&u)return this.cssTransform({target:this.canvas,redrawAnnotationLayer:!0,redrawXfaLayer:!0}),void this.eventBus.dispatch("pagerendered",{source:this,pageNumber:this.id,cssTransform:!0,timestamp:performance.now(),error:this._renderError});this.zoomLayer||this.canvas.hidden||(this.zoomLayer=this.canvas.parentNode,this.zoomLayer.style.position="absolute")}this.zoomLayer&&this.cssTransform({target:this.zoomLayer.firstChild}),this.reset({keepZoomLayer:!0,keepAnnotationLayer:!0,keepXfaLayer:!0})}},{key:"cancelRendering",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.keepAnnotationLayer,i=void 0!==n&&n,a=t.keepXfaLayer,o=void 0!==a&&a;this.paintTask&&(this.paintTask.cancel(),this.paintTask=null),this.resume=null,this.textLayer&&(this.textLayer.cancel(),this.textLayer=null),!this.annotationLayer||i&&this.annotationLayer.div||(this.annotationLayer.cancel(),this.annotationLayer=null,this._annotationCanvasMap=null),!this.xfaLayer||o&&this.xfaLayer.div||(this.xfaLayer.cancel(),this.xfaLayer=null,null===(e=this.textHighlighter)||void 0===e||e.disable()),this._onTextLayerRendered&&(this.eventBus._off("textlayerrendered",this._onTextLayerRendered),this._onTextLayerRendered=null)}},{key:"cssTransform",value:function(e){var t=e.target,n=e.redrawAnnotationLayer,i=void 0!==n&&n,a=e.redrawXfaLayer,o=void 0!==a&&a,s=this.viewport.width,r=this.viewport.height,l=this.div;t.style.width=t.parentNode.style.width=l.style.width=Math.floor(s)+"px",t.style.height=t.parentNode.style.height=l.style.height=Math.floor(r)+"px";var c=this.viewport.rotation-this.paintedViewportMap.get(t).rotation,u=Math.abs(c),d=1,p=1;if(90!==u&&270!==u||(d=r/s,p=s/r),t.style.transform="rotate(".concat(c,"deg) scale(").concat(d,", ").concat(p,")"),this.textLayer){var h=this.textLayer.viewport,f=this.viewport.rotation-h.rotation,g=Math.abs(f),m=s/h.width;90!==g&&270!==g||(m=s/h.height);var y,b,v=this.textLayer.textLayerDiv;switch(g){case 0:y=b=0;break;case 90:y=0,b="-"+v.style.height;break;case 180:y="-"+v.style.width,b="-"+v.style.height;break;case 270:y="-"+v.style.width,b=0;break;default:console.error("Bad rotation value.")}v.style.transform="rotate(".concat(g,"deg) ")+"scale(".concat(m,") ")+"translate(".concat(y,", ").concat(b,")"),v.style.transformOrigin="0% 0%"}i&&this.annotationLayer&&this._renderAnnotationLayer(),o&&this.xfaLayer&&this._renderXfaLayer()}},{key:"width",get:function(){return this.viewport.width}},{key:"height",get:function(){return this.viewport.height}},{key:"getPagePoint",value:function(e,t){return this.viewport.convertToPdfPoint(e,t)}},{key:"toggleLoadingIconSpinner",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===(e=this.loadingIconDiv)||void 0===e||e.classList.toggle("notVisible",!t)}},{key:"draw",value:function(){var e,t,n=this;this.renderingState!==h&&(console.error("Must be in new state before drawing"),this.reset());var i=this.div,a=this.pdfPage;if(!a)return this.renderingState=m,this.loadingIconDiv&&(this.loadingIconDiv.remove(),delete this.loadingIconDiv),Promise.reject(new Error("pdfPage is not loaded"));this.renderingState=f;var o=document.createElement("div");o.style.width=i.style.width,o.style.height=i.style.height,o.classList.add("canvasWrapper"),null!==(e=this.annotationLayer)&&void 0!==e&&e.div?i.insertBefore(o,this.annotationLayer.div):i.appendChild(o);var s=null;if(this.textLayerMode!==L&&this.textLayerFactory){var r,l=document.createElement("div");l.className="textLayer",l.style.width=o.style.width,l.style.height=o.style.height,null!==(r=this.annotationLayer)&&void 0!==r&&r.div?i.insertBefore(l,this.annotationLayer.div):i.appendChild(l),s=this.textLayerFactory.createTextLayerBuilder(l,this.id-1,this.viewport,this.textLayerMode===B,this.eventBus,this.textHighlighter)}this.textLayer=s,pr(this,mr)!==ve.AnnotationMode.DISABLE&&this.annotationLayerFactory&&(this._annotationCanvasMap||(this._annotationCanvasMap=new Map),this.annotationLayer||(this.annotationLayer=this.annotationLayerFactory.createAnnotationLayerBuilder(i,a,null,this.imageResourcesPath,pr(this,mr)===ve.AnnotationMode.ENABLE_FORMS,this.l10n,null,null,null,null,this._annotationCanvasMap))),null!==(t=this.xfaLayer)&&void 0!==t&&t.div&&i.appendChild(this.xfaLayer.div);var c=null;this.renderingQueue&&(c=function(e){if(!n.renderingQueue.isHighestPriority(n))return n.renderingState=g,void(n.resume=function(){n.renderingState=f,e()});e()});var u=function(){var e=cr(rr().mark((function e(){var t,i=arguments;return rr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:null,d===n.paintTask&&(n.paintTask=null),!(t instanceof ve.RenderingCancelledException)){e.next=5;break}return n._renderError=null,e.abrupt("return");case 5:if(n._renderError=t,n.renderingState=m,n.loadingIconDiv&&(n.loadingIconDiv.remove(),delete n.loadingIconDiv),n._resetZoomLayer(!0),n.eventBus.dispatch("pagerendered",{source:n,pageNumber:n.id,cssTransform:!1,timestamp:performance.now(),error:n._renderError}),!t){e.next=12;break}throw t;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),d=this.renderer===A?this.paintOnSvg(o):this.paintOnCanvas(o);d.onRenderContinue=c,this.paintTask=d;var p=d.promise.then((function(){return u(null).then((function(){if(s){var e=a.streamTextContent({includeMarkedContent:!0});s.setTextContentStream(e),s.render()}n.annotationLayer&&n._renderAnnotationLayer()}))}),(function(e){return u(e)}));return this.xfaLayerFactory&&(this.xfaLayer||(this.xfaLayer=this.xfaLayerFactory.createXfaLayerBuilder(i,a,null)),this._renderXfaLayer()),this.structTreeLayerFactory&&this.textLayer&&this.canvas&&(this._onTextLayerRendered=function(e){e.pageNumber===n.id&&(n.eventBus._off("textlayerrendered",n._onTextLayerRendered),n._onTextLayerRendered=null,n.canvas&&n.pdfPage.getStructTree().then((function(e){if(e&&n.canvas){var t=n.structTreeLayer.render(e);t.classList.add("structTree"),n.canvas.appendChild(t)}})))},this.eventBus._on("textlayerrendered",this._onTextLayerRendered),this.structTreeLayer=this.structTreeLayerFactory.createStructTreeLayerBuilder(a)),i.setAttribute("data-loaded",!0),this.eventBus.dispatch("pagerender",{source:this,pageNumber:this.id}),p}},{key:"paintOnCanvas",value:function(e){var t=(0,ve.createPromiseCapability)(),n={promise:t.promise,onRenderContinue:function(e){e()},cancel:function(){g.cancel()}},i=this.viewport,a=document.createElement("canvas");a.hidden=!0;var o=!0,s=function(){o&&(a.hidden=!1,o=!1)};e.appendChild(a),this.canvas=a,("undefined"==typeof PDFJSDev||PDFJSDev.test("MOZCENTRAL || GENERIC"))&&(a.mozOpaque=!0);var r=a.getContext("2d",{alpha:!1}),l=this.outputScale=new F;if(this.useOnlyCssZoom){var c=i.clone({scale:ve.PixelsPerInch.PDF_TO_CSS_UNITS});l.sx*=c.width/i.width,l.sy*=c.height/i.height}if(this.maxCanvasPixels>0){var u=i.width*i.height,d=Math.sqrt(this.maxCanvasPixels/u);l.sx>d||l.sy>d?(l.sx=d,l.sy=d,this.hasRestrictedScaling=!0):this.hasRestrictedScaling=!1}var p=U(l.sx),h=U(l.sy);a.width=z(i.width*l.sx,p[0]),a.height=z(i.height*l.sy,h[0]),a.style.width=z(i.width,p[1])+"px",a.style.height=z(i.height,h[1])+"px",this.paintedViewportMap.set(a,i);var f={canvasContext:r,transform:l.scaled?[l.sx,0,0,l.sy,0,0]:null,viewport:this.viewport,annotationMode:pr(this,mr),optionalContentConfigPromise:this._optionalContentConfigPromise,annotationCanvasMap:this._annotationCanvasMap},g=this.pdfPage.render(f);return g.onContinue=function(e){s(),n.onRenderContinue?n.onRenderContinue(e):e()},g.promise.then((function(){s(),t.resolve()}),(function(e){s(),t.reject(e)})),n}},{key:"paintOnSvg",value:function(e){var t=this;if("undefined"!=typeof PDFJSDev&&PDFJSDev.test("MOZCENTRAL || CHROME"))return{promise:Promise.reject(new Error("SVG rendering is not supported.")),onRenderContinue:function(e){},cancel:function(){}};var n=!1,i=function(){if(n)throw new ve.RenderingCancelledException("Rendering cancelled, page ".concat(t.id),"svg")},a=this.pdfPage,o=this.viewport.clone({scale:ve.PixelsPerInch.PDF_TO_CSS_UNITS});return{promise:a.getOperatorList({annotationMode:pr(this,mr)}).then((function(n){return i(),new ve.SVGGraphics(a.commonObjs,a.objs).getSVG(n,o).then((function(n){i(),t.svg=n,t.paintedViewportMap.set(n,o),n.style.width=e.style.width,n.style.height=e.style.height,t.renderingState=m,e.appendChild(n)}))})),onRenderContinue:function(e){e()},cancel:function(){n=!0}}}},{key:"setPageLabel",value:function(e){this.pageLabel="string"==typeof e?e:null,null!==this.pageLabel?this.div.setAttribute("data-page-label",this.pageLabel):this.div.removeAttribute("data-page-label")}}],n&&ur(t.prototype,n),i&&ur(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function br(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return vr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function vr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function wr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _r={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},Er=/^H(\d+)$/,kr=function(){function e(t){var n=t.pdfPage;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pdfPage=n}var t,n,i;return t=e,(n=[{key:"render",value:function(e){return this._walk(e)}},{key:"_setAttributes",value:function(e,t){void 0!==e.alt&&t.setAttribute("aria-label",e.alt),void 0!==e.id&&t.setAttribute("aria-owns",e.id),void 0!==e.lang&&t.setAttribute("lang",e.lang)}},{key:"_walk",value:function(e){if(!e)return null;var t=document.createElement("span");if("role"in e){var n=e.role,i=n.match(Er);i?(t.setAttribute("role","heading"),t.setAttribute("aria-level",i[1])):_r[n]&&t.setAttribute("role",_r[n])}if(this._setAttributes(e,t),e.children)if(1===e.children.length&&"id"in e.children[0])this._setAttributes(e.children[0],t);else{var a,o=br(e.children);try{for(o.s();!(a=o.n()).done;){var s=a.value;t.appendChild(this._walk(s))}}catch(e){o.e(e)}finally{o.f()}}return t}}])&&wr(t.prototype,n),i&&wr(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Cr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Dr=function(){function e(t){var n=t.findController,i=t.eventBus,a=t.pageIndex;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.findController=n,this.matches=[],this.eventBus=i,this.pageIdx=a,this._onUpdateTextLayerMatches=null,this.textDivs=null,this.textContentItemsStr=null,this.enabled=!1}var t,n,i;return t=e,(n=[{key:"setTextMapping",value:function(e,t){this.textDivs=e,this.textContentItemsStr=t}},{key:"enable",value:function(){var e=this;if(!this.textDivs||!this.textContentItemsStr)throw new Error("Text divs and strings have not been set.");if(this.enabled)throw new Error("TextHighlighter is already enabled.");this.enabled=!0,this._onUpdateTextLayerMatches||(this._onUpdateTextLayerMatches=function(t){t.pageIndex!==e.pageIdx&&-1!==t.pageIndex||e._updateMatches()},this.eventBus._on("updatetextlayermatches",this._onUpdateTextLayerMatches)),this._updateMatches()}},{key:"disable",value:function(){this.enabled&&(this.enabled=!1,this._onUpdateTextLayerMatches&&(this.eventBus._off("updatetextlayermatches",this._onUpdateTextLayerMatches),this._onUpdateTextLayerMatches=null))}},{key:"_convertMatches",value:function(e,t){if(!e)return[];for(var n=this.textContentItemsStr,i=0,a=0,o=n.length-1,s=[],r=0,l=e.length;r<l;r++){for(var c=e[r];i!==o&&c>=a+n[i].length;)a+=n[i].length,i++;i===n.length&&console.error("Could not find a matching mapping");var u={begin:{divIdx:i,offset:c-a}};for(c+=t[r];i!==o&&c>a+n[i].length;)a+=n[i].length,i++;u.end={divIdx:i,offset:c-a},s.push(u)}return s}},{key:"_renderMatches",value:function(e){if(0!==e.length){var t=this.findController,n=this.pageIdx,i=this.textContentItemsStr,a=this.textDivs,o=n===t.selected.pageIdx,s=t.selected.matchIdx,r=null,l={divIdx:-1,offset:void 0},c=s,u=c+1;if(t.state.highlightAll)c=0,u=e.length;else if(!o)return;for(var d=c;d<u;d++){var p=e[d],h=p.begin,f=p.end,g=o&&d===s,m=g?" selected":"",y=0;if(r&&h.divIdx===r.divIdx?_(r.divIdx,r.offset,h.offset):(null!==r&&_(r.divIdx,r.offset,l.offset),w(h)),h.divIdx===f.divIdx)y=_(h.divIdx,h.offset,f.offset,"highlight"+m);else{y=_(h.divIdx,h.offset,l.offset,"highlight begin"+m);for(var b=h.divIdx+1,v=f.divIdx;b<v;b++)a[b].className="highlight middle"+m;w(f,"highlight end"+m)}r=f,g&&t.scrollMatchIntoView({element:a[h.divIdx],selectedLeft:y,pageIndex:n,matchIndex:s})}r&&_(r.divIdx,r.offset,l.offset)}function w(e,t){var n=e.divIdx;return a[n].textContent="",_(n,0,e.offset,t)}function _(e,t,n,o){var s=a[e];if(s.nodeType===Node.TEXT_NODE){var r=document.createElement("span");s.parentNode.insertBefore(r,s),r.appendChild(s),a[e]=r,s=r}var l=i[e].substring(t,n),c=document.createTextNode(l);if(o){var u=document.createElement("span");return u.className="".concat(o," appended"),u.appendChild(c),s.appendChild(u),o.includes("selected")?u.offsetLeft:0}return s.appendChild(c),0}}},{key:"_updateMatches",value:function(){if(this.enabled){for(var e=this.findController,t=this.matches,n=this.pageIdx,i=this.textContentItemsStr,a=this.textDivs,o=-1,s=0,r=t.length;s<r;s++){for(var l=t[s],c=Math.max(o,l.begin.divIdx),u=l.end.divIdx;c<=u;c++){var d=a[c];d.textContent=i[c],d.className=""}o=l.end.divIdx+1}if(null!=e&&e.highlightMatches){var p=e.pageMatches[n]||null,h=e.pageMatchesLength[n]||null;this.matches=this._convertMatches(p,h),this._renderMatches(this.matches)}}}}])&&Cr(t.prototype,n),i&&Cr(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}(),xr=n(1631);function Sr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ar=function(){function e(t){var n=t.textLayerDiv,i=t.eventBus,a=t.pageIndex,o=t.viewport,s=t.highlighter,r=void 0===s?null:s,l=t.enhanceTextSelection,c=void 0!==l&&l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textLayerDiv=n,this.eventBus=i,this.textContent=null,this.textContentItemsStr=[],this.textContentStream=null,this.renderingDone=!1,this.pageNumber=a+1,this.viewport=o,this.textDivs=[],this.textLayerRenderTask=null,this.highlighter=r,this.enhanceTextSelection=c,this._bindMouse()}var t,n,i;return t=e,n=[{key:"_finishRendering",value:function(){if(this.renderingDone=!0,!this.enhanceTextSelection){var e=document.createElement("div");e.className="endOfContent",this.textLayerDiv.appendChild(e)}this.eventBus.dispatch("textlayerrendered",{source:this,pageNumber:this.pageNumber,numTextDivs:this.textDivs.length}),(0,xr.L_)(this.textLayerDiv)}},{key:"render",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if((this.textContent||this.textContentStream)&&!this.renderingDone){this.cancel(),this.textDivs.length=0,null===(e=this.highlighter)||void 0===e||e.setTextMapping(this.textDivs,this.textContentItemsStr);var i=document.createDocumentFragment();this.textLayerRenderTask=(0,ve.renderTextLayer)({textContent:this.textContent,textContentStream:this.textContentStream,container:i,viewport:this.viewport,textDivs:this.textDivs,textContentItemsStr:this.textContentItemsStr,timeout:n,enhanceTextSelection:this.enhanceTextSelection}),this.textLayerRenderTask.promise.then((function(){var e;t.textLayerDiv.appendChild(i),t._finishRendering(),null===(e=t.highlighter)||void 0===e||e.enable()}),(function(e){}))}}},{key:"cancel",value:function(){var e;this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),null===(e=this.highlighter)||void 0===e||e.disable()}},{key:"setTextContentStream",value:function(e){this.cancel(),this.textContentStream=e}},{key:"setTextContent",value:function(e){this.cancel(),this.textContent=e}},{key:"_bindMouse",value:function(){var e=this,t=this.textLayerDiv,n=null;t.addEventListener("mousedown",(function(i){if(e.enhanceTextSelection&&e.textLayerRenderTask)return e.textLayerRenderTask.expandTextDivs(!0),void("undefined"!=typeof PDFJSDev&&PDFJSDev.test("MOZCENTRAL")||!n||(clearTimeout(n),n=null));var a=t.querySelector(".endOfContent");if(a){if("undefined"==typeof PDFJSDev||!PDFJSDev.test("MOZCENTRAL")){var o=i.target!==t;if(("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC"))&&(o=o&&"none"!==window.getComputedStyle(a).getPropertyValue("-moz-user-select")),o){var s=t.getBoundingClientRect(),r=Math.max(0,(i.pageY-s.top)/s.height);a.style.top=(100*r).toFixed(2)+"%"}}a.classList.add("active")}})),t.addEventListener("mouseup",(function(){if(e.enhanceTextSelection&&e.textLayerRenderTask)"undefined"!=typeof PDFJSDev&&PDFJSDev.test("MOZCENTRAL")?e.textLayerRenderTask.expandTextDivs(!1):n=setTimeout((function(){e.textLayerRenderTask&&e.textLayerRenderTask.expandTextDivs(!1),n=null}),300);else{var i=t.querySelector(".endOfContent");i&&("undefined"!=typeof PDFJSDev&&PDFJSDev.test("MOZCENTRAL")||(i.style.top=""),i.classList.remove("active"))}}))}}],n&&Sr(t.prototype,n),i&&Sr(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Lr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Tr,Br=function(){function e(t){var n=t.pageDiv,i=t.pdfPage,a=t.annotationStorage,o=void 0===a?null:a,s=t.linkService,r=t.xfaHtml,l=void 0===r?null:r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pageDiv=n,this.pdfPage=i,this.annotationStorage=o,this.linkService=s,this.xfaHtml=l,this.div=null,this._cancelled=!1}var t,n,i;return t=e,n=[{key:"render",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"display";if("print"===n){var i={viewport:e.clone({dontFlip:!0}),div:this.div,xfaHtml:this.xfaHtml,annotationStorage:this.annotationStorage,linkService:this.linkService,intent:n},a=document.createElement("div");this.pageDiv.appendChild(a),i.div=a;var o=ve.XfaLayer.render(i);return Promise.resolve(o)}return this.pdfPage.getXfa().then((function(i){if(t._cancelled||!i)return{textDivs:[]};var a={viewport:e.clone({dontFlip:!0}),div:t.div,xfaHtml:i,annotationStorage:t.annotationStorage,linkService:t.linkService,intent:n};return t.div?ve.XfaLayer.update(a):(t.div=document.createElement("div"),t.pageDiv.appendChild(t.div),a.div=t.div,ve.XfaLayer.render(a))})).catch((function(e){console.error(e)}))}},{key:"cancel",value:function(){this._cancelled=!0}},{key:"hide",value:function(){this.div&&(this.div.hidden=!0)}}],n&&Lr(t.prototype,n),i&&Lr(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Pr(e){return Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pr(e)}function Ir(){Ir=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==Pr(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Mr(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function Fr(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){Mr(o,i,a,s,r,"next",e)}function r(e){Mr(o,i,a,s,r,"throw",e)}s(void 0)}))}}function Nr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,a,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return o}(e,t)||Or(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Or(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function Or(e,t){if(e){if("string"==typeof e)return Hr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Hr(e,t):void 0}}function Hr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Rr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function jr(e,t,n){return t&&qr(e.prototype,t),n&&qr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ur(e,t){Wr(e,t),t.add(e)}function zr(e,t,n){Wr(e,t),t.set(e,n)}function Wr(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Gr(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function Vr(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Kr(e,t,"get"))}function Yr(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Kr(e,t,"set"),n),n}function Kr(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var Zr="enablePermissions",Jr=15e3,Xr=7500,Qr=250,el=new WeakMap,tl=new WeakMap,nl=new WeakSet;Tr=Symbol.iterator;var il=function(){function e(t){Rr(this,e),Ur(this,nl),zr(this,el,{writable:!0,value:new Set}),zr(this,tl,{writable:!0,value:0}),Yr(this,tl,t)}return jr(e,[{key:"push",value:function(e){var t=Vr(this,el);t.has(e)&&t.delete(e),t.add(e),t.size>Vr(this,tl)&&Gr(this,nl,al).call(this)}},{key:"resize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Yr(this,tl,e);var n=Vr(this,el);if(t){var i,a=n.size,o=1,s=$r(n);try{for(s.s();!(i=s.n()).done;){var r=i.value;if(t.has(r.id)&&(n.delete(r),n.add(r)),++o>a)break}}catch(e){s.e(e)}finally{s.f()}}for(;n.size>Vr(this,tl);)Gr(this,nl,al).call(this)}},{key:"has",value:function(e){return Vr(this,el).has(e)}},{key:Tr,value:function(){return Vr(this,el).keys()}}]),e}();function al(){var e=Vr(this,el).keys().next().value;null==e||e.destroy(),Vr(this,el).delete(e)}var ol=new WeakMap,sl=new WeakMap,rl=new WeakMap,ll=new WeakMap,cl=new WeakMap,ul=new WeakMap,dl=new WeakMap,pl=new WeakSet,hl=new WeakSet,fl=new WeakSet,gl=new WeakSet,ml=new WeakSet,yl=new WeakSet,bl=new WeakSet,vl=function(){function e(t){var n,i,a=this;if(Rr(this,e),Ur(this,bl),Ur(this,yl),Ur(this,ml),Ur(this,gl),Ur(this,fl),Ur(this,hl),Ur(this,pl),zr(this,ol,{writable:!0,value:null}),zr(this,sl,{writable:!0,value:ve.AnnotationMode.ENABLE_FORMS}),zr(this,rl,{writable:!0,value:null}),zr(this,ll,{writable:!0,value:!1}),zr(this,cl,{writable:!0,value:0}),zr(this,ul,{writable:!0,value:null}),zr(this,dl,{writable:!0,value:null}),this.constructor===e)throw new Error("Cannot initialize BaseViewer.");if(this.container=t.container,this.viewer=t.viewer||t.container.firstElementChild,"undefined"==typeof PDFJSDev||PDFJSDev.test("!PRODUCTION || GENERIC")){var o,s;if("DIV"!==(null===(o=this.container)||void 0===o?void 0:o.tagName.toUpperCase())||"DIV"!==(null===(s=this.viewer)||void 0===s?void 0:s.tagName.toUpperCase()))throw new Error("Invalid `container` and/or `viewer` option.");if(this.container.offsetParent&&"absolute"!==getComputedStyle(this.container).position)throw new Error("The `container` must be absolutely positioned.")}this.eventBus=t.eventBus,this.linkService=t.linkService||new pt,this.downloadManager=t.downloadManager||null,this.findController=t.findController||null,this._scriptingManager=t.scriptingManager||null,this.removePageBorders=t.removePageBorders||!1,this.textLayerMode=null!==(n=t.textLayerMode)&&void 0!==n?n:T,Yr(this,sl,null!==(i=t.annotationMode)&&void 0!==i?i:ve.AnnotationMode.ENABLE_FORMS),this.imageResourcesPath=t.imageResourcesPath||"",this.enablePrintAutoRotate=t.enablePrintAutoRotate||!1,this.renderer=t.renderer||S,this.useOnlyCssZoom=t.useOnlyCssZoom||!1,this.maxCanvasPixels=t.maxCanvasPixels,this.l10n=t.l10n||Zs,Yr(this,ll,t.enablePermissions||!1),this.defaultRenderingQueue=!t.renderingQueue,this.defaultRenderingQueue?(this.renderingQueue=new Uo,this.renderingQueue.setViewer(this)):this.renderingQueue=t.renderingQueue,this._doc=document.documentElement,this.scroll=$(this.container,this._scrollUpdate.bind(this)),this.presentationModeState=y,this._onBeforeDraw=this._onAfterDraw=null,this._resetView(),this.removePageBorders&&this.viewer.classList.add("removePageBorders"),Promise.resolve().then((function(){a.eventBus.dispatch("baseviewerinit",{source:a})}))}return jr(e,[{key:"pagesCount",get:function(){return this._pages.length}},{key:"getPageView",value:function(e){return this._pages[e]}},{key:"pageViewsReady",get:function(){return!!this._pagesCapability.settled&&this._pages.every((function(e){return null==e?void 0:e.pdfPage}))}},{key:"renderForms",get:function(){return Vr(this,sl)===ve.AnnotationMode.ENABLE_FORMS}},{key:"enableScripting",get:function(){return!!this._scriptingManager}},{key:"currentPageNumber",get:function(){return this._currentPageNumber},set:function(e){if(!Number.isInteger(e))throw new Error("Invalid page number.");this.pdfDocument&&(this._setCurrentPageNumber(e,!0)||console.error('currentPageNumber: "'.concat(e,'" is not a valid page.')))}},{key:"_setCurrentPageNumber",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._currentPageNumber===e)return i&&this._resetCurrentPageView(),!0;if(!(0<e&&e<=this.pagesCount))return!1;var a=this._currentPageNumber;return this._currentPageNumber=e,this.eventBus.dispatch("pagechanging",{source:this,pageNumber:e,pageLabel:null!==(t=null===(n=this._pageLabels)||void 0===n?void 0:n[e-1])&&void 0!==t?t:null,previous:a}),i&&this._resetCurrentPageView(),!0}},{key:"currentPageLabel",get:function(){var e,t;return null!==(e=null===(t=this._pageLabels)||void 0===t?void 0:t[this._currentPageNumber-1])&&void 0!==e?e:null},set:function(e){if(this.pdfDocument){var t=0|e;if(this._pageLabels){var n=this._pageLabels.indexOf(e);n>=0&&(t=n+1)}this._setCurrentPageNumber(t,!0)||console.error('currentPageLabel: "'.concat(e,'" is not a valid page.'))}}},{key:"currentScale",get:function(){return 0!==this._currentScale?this._currentScale:1},set:function(e){if(isNaN(e))throw new Error("Invalid numeric scale.");this.pdfDocument&&this._setScale(e,!1)}},{key:"currentScaleValue",get:function(){return this._currentScaleValue},set:function(e){this.pdfDocument&&this._setScale(e,!1)}},{key:"pagesRotation",get:function(){return this._pagesRotation},set:function(e){if(!Y(e))throw new Error("Invalid pages rotation angle.");if(this.pdfDocument&&((e%=360)<0&&(e+=360),this._pagesRotation!==e)){this._pagesRotation=e;var t,n=this._currentPageNumber,i={rotation:e},a=$r(this._pages);try{for(a.s();!(t=a.n()).done;){t.value.update(i)}}catch(e){a.e(e)}finally{a.f()}this._currentScaleValue&&this._setScale(this._currentScaleValue,!0),this.eventBus.dispatch("rotationchanging",{source:this,pagesRotation:e,pageNumber:n}),this.defaultRenderingQueue&&this.update()}}},{key:"firstPagePromise",get:function(){return this.pdfDocument?this._firstPageCapability.promise:null}},{key:"onePageRendered",get:function(){return this.pdfDocument?this._onePageRenderedCapability.promise:null}},{key:"pagesPromise",get:function(){return this.pdfDocument?this._pagesCapability.promise:null}},{key:"setDocument",value:function(e){var t=this;if(this.pdfDocument&&(this.eventBus.dispatch("pagesdestroy",{source:this}),this._cancelRendering(),this._resetView(),this.findController&&this.findController.setDocument(null),this._scriptingManager&&this._scriptingManager.setDocument(null)),this.pdfDocument=e,e){var n=e.isPureXfa,i=e.numPages,a=e.getPage(1),o=e.getOptionalContentConfig(),s=Vr(this,ll)?e.getPermissions():Promise.resolve();if(i>Jr){console.warn("Forcing PAGE-scrolling for performance reasons, given the length of the document.");var r=this._scrollMode=P.PAGE;this.eventBus.dispatch("scrollmodechanged",{source:this,mode:r})}this._pagesCapability.promise.then((function(){t.eventBus.dispatch("pagesloaded",{source:t,pagesCount:i})}),(function(){})),this._onBeforeDraw=function(e){var n=t._pages[e.pageNumber-1];n&&Vr(t,ol).push(n)},this.eventBus._on("pagerender",this._onBeforeDraw),this._onAfterDraw=function(e){e.cssTransform||t._onePageRenderedCapability.settled||(t._onePageRenderedCapability.resolve({timestamp:e.timestamp}),t.eventBus._off("pagerendered",t._onAfterDraw),t._onAfterDraw=null,Vr(t,dl)&&(document.removeEventListener("visibilitychange",Vr(t,dl)),Yr(t,dl,null)))},this.eventBus._on("pagerendered",this._onAfterDraw),Promise.all([a,s]).then((function(a){var s=Nr(a,2),r=s[0],l=s[1];if(e===t.pdfDocument){t._firstPageCapability.resolve(r),t._optionalContentConfigPromise=o,Gr(t,pl,wl).call(t,l);for(var c=t._scrollMode===P.PAGE?null:t.viewer,u=t.currentScale,d=r.getViewport({scale:u*ve.PixelsPerInch.PDF_TO_CSS_UNITS}),p=t.textLayerMode===L||n?null:t,h=Vr(t,sl)!==ve.AnnotationMode.DISABLE?t:null,f=n?t:null,g=1;g<=i;++g){var m=new yr({container:c,eventBus:t.eventBus,id:g,scale:u,defaultViewport:d.clone(),optionalContentConfigPromise:o,renderingQueue:t.renderingQueue,textLayerFactory:p,textLayerMode:t.textLayerMode,annotationLayerFactory:h,annotationMode:Vr(t,sl),xfaLayerFactory:f,textHighlighterFactory:t,structTreeLayerFactory:t,imageResourcesPath:t.imageResourcesPath,renderer:t.renderer,useOnlyCssZoom:t.useOnlyCssZoom,maxCanvasPixels:t.maxCanvasPixels,l10n:t.l10n});t._pages.push(m)}var y=t._pages[0];y&&(y.setPdfPage(r),t.linkService.cachePageRef(1,r.ref)),t._scrollMode===P.PAGE?Gr(t,fl,El).call(t):t._spreadMode!==I.NONE&&t._updateSpreadMode(),Gr(t,hl,_l).call(t).then(Fr(Ir().mark((function n(){var a,o,s;return Ir().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.findController&&t.findController.setDocument(e),t._scriptingManager&&t._scriptingManager.setDocument(e),!(e.loadingParams.disableAutoFetch||i>Xr)){n.next=5;break}return t._pagesCapability.resolve(),n.abrupt("return");case 5:if(!((a=i-1)<=0)){n.next=9;break}return t._pagesCapability.resolve(),n.abrupt("return");case 9:o=Ir().mark((function n(i){var o;return Ir().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.getPage(i).then((function(e){var n=t._pages[i-1];n.pdfPage||n.setPdfPage(e),t.linkService.cachePageRef(i,e.ref),0==--a&&t._pagesCapability.resolve()}),(function(e){console.error("Unable to get page ".concat(i," to initialize viewer"),e),0==--a&&t._pagesCapability.resolve()})),i%Qr!=0){n.next=4;break}return n.next=4,o;case 4:case"end":return n.stop()}}),n)})),s=2;case 11:if(!(s<=i)){n.next=16;break}return n.delegateYield(o(s),"t0",13);case 13:++s,n.next=11;break;case 16:case"end":return n.stop()}}),n)})))),t.eventBus.dispatch("pagesinit",{source:t}),e.getMetadata().then((function(n){var i=n.info;e===t.pdfDocument&&i.Language&&(t.viewer.lang=i.Language)})),t.defaultRenderingQueue&&t.update()}})).catch((function(e){console.error("Unable to initialize viewer",e),t._pagesCapability.reject(e)}))}}},{key:"setPageLabels",value:function(e){if(this.pdfDocument){e?Array.isArray(e)&&this.pdfDocument.numPages===e.length?this._pageLabels=e:(this._pageLabels=null,console.error("setPageLabels: Invalid page labels.")):this._pageLabels=null;for(var t=0,n=this._pages.length;t<n;t++){var i,a;this._pages[t].setPageLabel(null!==(i=null===(a=this._pageLabels)||void 0===a?void 0:a[t])&&void 0!==i?i:null)}}}},{key:"_resetView",value:function(){this._pages=[],this._currentPageNumber=1,this._currentScale=0,this._currentScaleValue=null,this._pageLabels=null,Yr(this,ol,new il(10)),this._location=null,this._pagesRotation=0,this._optionalContentConfigPromise=null,this._firstPageCapability=(0,ve.createPromiseCapability)(),this._onePageRenderedCapability=(0,ve.createPromiseCapability)(),this._pagesCapability=(0,ve.createPromiseCapability)(),this._scrollMode=P.VERTICAL,this._previousScrollMode=P.UNKNOWN,this._spreadMode=I.NONE,Yr(this,ul,{previousPageNumber:1,scrollDown:!0,pages:[]}),this._onBeforeDraw&&(this.eventBus._off("pagerender",this._onBeforeDraw),this._onBeforeDraw=null),this._onAfterDraw&&(this.eventBus._off("pagerendered",this._onAfterDraw),this._onAfterDraw=null),Vr(this,dl)&&(document.removeEventListener("visibilitychange",Vr(this,dl)),Yr(this,dl,null)),this.viewer.textContent="",this._updateScrollMode(),this.viewer.removeAttribute("lang"),this.viewer.classList.remove(Zr),null!==Vr(this,rl)&&(Yr(this,sl,Vr(this,rl)),Yr(this,rl,null))}},{key:"_scrollUpdate",value:function(){0!==this.pagesCount&&this.update()}},{key:"_scrollIntoView",value:function(e){var t=e.pageDiv,n=e.pageSpot,i=void 0===n?null:n,a=e.pageNumber,o=void 0===a?null:a;if(this._scrollMode===P.PAGE&&(o&&this._setCurrentPageNumber(o),Gr(this,fl,El).call(this),this.update()),!i&&!this.isInPresentationMode){var s=t.offsetLeft+t.clientLeft,r=s+t.clientWidth,l=this.container,c=l.scrollLeft,u=l.clientWidth;(this._scrollMode===P.HORIZONTAL||s<c||r>c+u)&&(i={left:0,top:0})}N(t,i)}},{key:"_setScaleUpdatePages",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._currentScaleValue=t.toString(),Gr(this,gl,kl).call(this,e))i&&this.eventBus.dispatch("scalechanging",{source:this,scale:e,presetValue:t});else{this._doc.style.setProperty("--zoom-factor",e),this._doc.style.setProperty("--viewport-scale-factor",e*ve.PixelsPerInch.PDF_TO_CSS_UNITS);var a,o={scale:e},s=$r(this._pages);try{for(s.s();!(a=s.n()).done;){var r=a.value;r.update(o)}}catch(e){s.e(e)}finally{s.f()}if(this._currentScale=e,!n){var l,c=this._currentPageNumber;!this._location||this.isInPresentationMode||this.isChangingPresentationMode||(c=this._location.pageNumber,l=[null,{name:"XYZ"},this._location.left,this._location.top,null]),this.scrollPageIntoView({pageNumber:c,destArray:l,allowNegativeOffset:!0})}this.eventBus.dispatch("scalechanging",{source:this,scale:e,presetValue:i?t:void 0}),this.defaultRenderingQueue&&this.update(),Yr(this,cl,this.container.clientHeight)}}},{key:"_pageWidthScaleFactor",get:function(){return this._spreadMode!==I.NONE&&this._scrollMode!==P.HORIZONTAL?2:1}},{key:"_setScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=parseFloat(e);if(n>0)this._setScaleUpdatePages(n,e,t,!1);else{var i=this._pages[this._currentPageNumber-1];if(!i)return;var a=40,o=5;if(this.isInPresentationMode?a=o=4:this.removePageBorders&&(a=o=0),this._scrollMode===P.HORIZONTAL){var s=[o,a];a=s[0],o=s[1]}var r=(this.container.clientWidth-a)/i.width*i.scale/this._pageWidthScaleFactor,l=(this.container.clientHeight-o)/i.height*i.scale;switch(e){case"page-actual":n=1;break;case"page-width":n=r;break;case"page-height":n=l;break;case"page-fit":n=Math.min(r,l);break;case"auto":var c=J(i)?r:Math.min(l,r);n=Math.min(1.25,c);break;default:return void console.error('_setScale: "'.concat(e,'" is an unknown zoom value.'))}this._setScaleUpdatePages(n,e,t,!0)}}},{key:"_resetCurrentPageView",value:function(){this.isInPresentationMode&&this._setScale(this._currentScaleValue,!0);var e=this._pages[this._currentPageNumber-1];this._scrollIntoView({pageDiv:e.div})}},{key:"pageLabelToPageNumber",value:function(e){if(!this._pageLabels)return null;var t=this._pageLabels.indexOf(e);return t<0?null:t+1}},{key:"scrollPageIntoView",value:function(e){var t=e.pageNumber,n=e.destArray,i=void 0===n?null:n,a=e.allowNegativeOffset,o=void 0!==a&&a,s=e.ignoreDestinationZoom,r=void 0!==s&&s;if(this.pdfDocument){var l=Number.isInteger(t)&&this._pages[t-1];if(l)if(!this.isInPresentationMode&&i){var u,d,p=0,h=0,f=0,g=0,m=l.rotation%180!=0,y=(m?l.height:l.width)/l.scale/ve.PixelsPerInch.PDF_TO_CSS_UNITS,b=(m?l.width:l.height)/l.scale/ve.PixelsPerInch.PDF_TO_CSS_UNITS,v=0;switch(i[1].name){case"XYZ":p=i[2],h=i[3],v=i[4],p=null!==p?p:0,h=null!==h?h:b;break;case"Fit":case"FitB":v="page-fit";break;case"FitH":case"FitBH":v="page-width",null===(h=i[2])&&this._location?(p=this._location.left,h=this._location.top):("number"!=typeof h||h<0)&&(h=b);break;case"FitV":case"FitBV":p=i[2],f=y,g=b,v="page-height";break;case"FitR":p=i[2],h=i[3],f=i[4]-p,g=i[5]-h;var w=this.removePageBorders?0:40,_=this.removePageBorders?0:5;u=(this.container.clientWidth-w)/f/ve.PixelsPerInch.PDF_TO_CSS_UNITS,d=(this.container.clientHeight-_)/g/ve.PixelsPerInch.PDF_TO_CSS_UNITS,v=Math.min(Math.abs(u),Math.abs(d));break;default:return void console.error('scrollPageIntoView: "'.concat(i[1].name,'" is not a valid destination type.'))}if(r||(v&&v!==this._currentScale?this.currentScaleValue=v:0===this._currentScale&&(this.currentScaleValue=c)),"page-fit"!==v||i[4]){var E=[l.viewport.convertToViewportPoint(p,h),l.viewport.convertToViewportPoint(p+f,h+g)],k=Math.min(E[0][0],E[1][0]),C=Math.min(E[0][1],E[1][1]);o||(k=Math.max(k,0),C=Math.max(C,0)),this._scrollIntoView({pageDiv:l.div,pageSpot:{left:k,top:C},pageNumber:t})}else this._scrollIntoView({pageDiv:l.div,pageNumber:t})}else this._setCurrentPageNumber(t,!0);else console.error('scrollPageIntoView: "'.concat(t,'" is not a valid pageNumber parameter.'))}}},{key:"_updateLocation",value:function(e){var t=this._currentScale,n=this._currentScaleValue,i=parseFloat(n)===t?Math.round(1e4*t)/100:n,a=e.id,o="#page="+a;o+="&zoom="+i;var s=this._pages[a-1],r=this.container,l=s.getPagePoint(r.scrollLeft-e.x,r.scrollTop-e.y),c=Math.round(l[0]),u=Math.round(l[1]);o+=","+c+","+u,this._location={pageNumber:a,scale:i,top:u,left:c,rotation:this._pagesRotation,pdfOpenParams:o}}},{key:"update",value:function(){var e=this._getVisiblePages(),t=e.views,n=t.length;if(0!==n){var i=Math.max(10,2*n+1);if(Vr(this,ol).resize(i,e.ids),this.renderingQueue.renderHighestPriority(e),!this.isInPresentationMode){var a,o=this._spreadMode===I.NONE&&(this._scrollMode===P.PAGE||this._scrollMode===P.VERTICAL),s=this._currentPageNumber,r=!1,l=$r(t);try{for(l.s();!(a=l.n()).done;){var c=a.value;if(c.percent<100)break;if(c.id===s&&o){r=!0;break}}}catch(e){l.e(e)}finally{l.f()}r||(s=t[0].id),this._setCurrentPageNumber(s)}this._updateLocation(e.first),this.eventBus.dispatch("updateviewarea",{source:this,location:this._location})}}},{key:"containsElement",value:function(e){return this.container.contains(e)}},{key:"focus",value:function(){this.container.focus()}},{key:"_isContainerRtl",get:function(){return"rtl"===getComputedStyle(this.container).direction}},{key:"isInPresentationMode",get:function(){return this.presentationModeState===w}},{key:"isChangingPresentationMode",get:function(){return this.presentationModeState===v}},{key:"isHorizontalScrollbarEnabled",get:function(){return!this.isInPresentationMode&&this.container.scrollWidth>this.container.clientWidth}},{key:"isVerticalScrollbarEnabled",get:function(){return!this.isInPresentationMode&&this.container.scrollHeight>this.container.clientHeight}},{key:"_getCurrentVisiblePage",value:function(){if(!this.pagesCount)return{views:[]};var e=this._pages[this._currentPageNumber-1],t=e.div,n={id:e.id,x:t.offsetLeft+t.clientLeft,y:t.offsetTop+t.clientTop,view:e};return{first:n,last:n,views:[n],ids:new Set([e.id])}}},{key:"_getVisiblePages",value:function(){if(this.isInPresentationMode)return this._getCurrentVisiblePage();var e=this._scrollMode===P.PAGE?Vr(this,ul).pages:this._pages,t=this._scrollMode===P.HORIZONTAL,n=t&&this._isContainerRtl;return W({scrollEl:this.container,views:e,sortByVisibility:!0,horizontal:t,rtl:n})}},{key:"isPageVisible",value:function(e){return!!this.pdfDocument&&(Number.isInteger(e)&&e>0&&e<=this.pagesCount?this._getVisiblePages().ids.has(e):(console.error('isPageVisible: "'.concat(e,'" is not a valid page.')),!1))}},{key:"isPageCached",value:function(e){if(!this.pdfDocument)return!1;if(!(Number.isInteger(e)&&e>0&&e<=this.pagesCount))return console.error('isPageCached: "'.concat(e,'" is not a valid page.')),!1;var t=this._pages[e-1];return Vr(this,ol).has(t)}},{key:"cleanup",value:function(){for(var e=0,t=this._pages.length;e<t;e++)this._pages[e]&&this._pages[e].renderingState!==m&&this._pages[e].reset()}},{key:"_cancelRendering",value:function(){for(var e=0,t=this._pages.length;e<t;e++)this._pages[e]&&this._pages[e].cancelRendering()}},{key:"forceRendering",value:function(e){var t=this,n=e||this._getVisiblePages(),i=Gr(this,yl,xl).call(this,n),a=this._spreadMode!==I.NONE&&this._scrollMode!==P.HORIZONTAL,o=this.renderingQueue.getHighestPriority(n,this._pages,i,a);return Gr(this,bl,Sl).call(this,n.ids),!!o&&(Gr(this,ml,Cl).call(this,o).then((function(){t.renderingQueue.renderView(o)})),!0)}},{key:"createTextLayerBuilder",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;return new Ar({textLayerDiv:e,eventBus:a,pageIndex:t,viewport:n,enhanceTextSelection:!this.isInPresentationMode&&i,highlighter:o})}},{key:"createTextHighlighter",value:function(e,t){return new Dr({eventBus:t,pageIndex:e,findController:this.isInPresentationMode?null:this.findController})}},{key:"createAnnotationLayerBuilder",value:function(e,t){var n,i,a,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Zs,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null;return new ir({pageDiv:e,pdfPage:t,annotationStorage:s||(null===(n=this.pdfDocument)||void 0===n?void 0:n.annotationStorage),imageResourcesPath:r,renderForms:l,linkService:this.linkService,downloadManager:this.downloadManager,l10n:c,enableScripting:null!=u?u:this.enableScripting,hasJSActionsPromise:d||(null===(i=this.pdfDocument)||void 0===i?void 0:i.hasJSActions()),fieldObjectsPromise:h||(null===(a=this.pdfDocument)||void 0===a?void 0:a.getFieldObjects()),mouseState:p||(null===(o=this._scriptingManager)||void 0===o?void 0:o.mouseState),annotationCanvasMap:f})}},{key:"createXfaLayerBuilder",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Br({pageDiv:e,pdfPage:t,annotationStorage:i||(null===(n=this.pdfDocument)||void 0===n?void 0:n.annotationStorage),linkService:this.linkService})}},{key:"createStructTreeLayerBuilder",value:function(e){return new kr({pdfPage:e})}},{key:"hasEqualPageSizes",get:function(){for(var e=this._pages[0],t=1,n=this._pages.length;t<n;++t){var i=this._pages[t];if(i.width!==e.width||i.height!==e.height)return!1}return!0}},{key:"getPagesOverview",value:function(){var e=this;return this._pages.map((function(t){var n=t.pdfPage.getViewport({scale:1});return!e.enablePrintAutoRotate||J(n)?{width:n.width,height:n.height,rotation:n.rotation}:{width:n.height,height:n.width,rotation:(n.rotation-90)%360}}))}},{key:"optionalContentConfigPromise",get:function(){return this.pdfDocument?this._optionalContentConfigPromise?this._optionalContentConfigPromise:this.pdfDocument.getOptionalContentConfig():Promise.resolve(null)},set:function(e){if(!(e instanceof Promise))throw new Error("Invalid optionalContentConfigPromise: ".concat(e));if(this.pdfDocument&&this._optionalContentConfigPromise){this._optionalContentConfigPromise=e;var t,n={optionalContentConfigPromise:e},i=$r(this._pages);try{for(i.s();!(t=i.n()).done;){t.value.update(n)}}catch(e){i.e(e)}finally{i.f()}this.update(),this.eventBus.dispatch("optionalcontentconfigchanged",{source:this,promise:e})}}},{key:"scrollMode",get:function(){return this._scrollMode},set:function(e){if(this._scrollMode!==e){if(!K(e))throw new Error("Invalid scroll mode: ".concat(e));this.pagesCount>Jr||(this._previousScrollMode=this._scrollMode,this._scrollMode=e,this.eventBus.dispatch("scrollmodechanged",{source:this,mode:e}),this._updateScrollMode(this._currentPageNumber))}}},{key:"_updateScrollMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this._scrollMode,n=this.viewer;n.classList.toggle("scrollHorizontal",t===P.HORIZONTAL),n.classList.toggle("scrollWrapped",t===P.WRAPPED),this.pdfDocument&&e&&(t===P.PAGE?Gr(this,fl,El).call(this):this._previousScrollMode===P.PAGE&&this._updateSpreadMode(),this._currentScaleValue&&isNaN(this._currentScaleValue)&&this._setScale(this._currentScaleValue,!0),this._setCurrentPageNumber(e,!0),this.update())}},{key:"spreadMode",get:function(){return this._spreadMode},set:function(e){if(this._spreadMode!==e){if(!Z(e))throw new Error("Invalid spread mode: ".concat(e));this._spreadMode=e,this.eventBus.dispatch("spreadmodechanged",{source:this,mode:e}),this._updateSpreadMode(this._currentPageNumber)}}},{key:"_updateSpreadMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.pdfDocument){var t=this.viewer,n=this._pages;if(this._scrollMode===P.PAGE)Gr(this,fl,El).call(this);else if(t.textContent="",this._spreadMode===I.NONE)for(var i=0,a=n.length;i<a;++i)t.appendChild(n[i].div);else for(var o=this._spreadMode-1,s=null,r=0,l=n.length;r<l;++r)null===s?((s=document.createElement("div")).className="spread",t.appendChild(s)):r%2===o&&(s=s.cloneNode(!1),t.appendChild(s)),s.appendChild(n[r].div);e&&(this._currentScaleValue&&isNaN(this._currentScaleValue)&&this._setScale(this._currentScaleValue,!0),this._setCurrentPageNumber(e,!0),this.update())}}},{key:"_getPageAdvance",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(this._scrollMode){case P.WRAPPED:var n,i=this._getVisiblePages(),a=i.views,o=new Map,s=$r(a);try{for(s.s();!(n=s.n()).done;){var r=n.value,l=r.id,c=r.y,u=r.percent,d=r.widthPercent;if(!(0===u||d<100)){var p=o.get(c);p||o.set(c,p||(p=[])),p.push(l)}}}catch(e){s.e(e)}finally{s.f()}var h,f=$r(o.values());try{for(f.s();!(h=f.n()).done;){var g=h.value,m=g.indexOf(e);if(-1!==m){var y=g.length;if(1===y)break;if(t)for(var b=m-1,v=0;b>=v;b--){var w=g[b],_=g[b+1]-1;if(w<_)return e-_}else for(var E=m+1,k=y;E<k;E++){var C=g[E],D=g[E-1]+1;if(C>D)return D-e}if(t){var x=g[0];if(x<e)return e-x+1}else{var S=g[y-1];if(S>e)return S-e+1}break}}}catch(e){f.e(e)}finally{f.f()}break;case P.HORIZONTAL:break;case P.PAGE:case P.VERTICAL:if(this._spreadMode===I.NONE)break;var A=this._spreadMode-1;if(t&&e%2!==A)break;if(!t&&e%2===A)break;var L,T=this._getVisiblePages(),B=T.views,M=t?e-1:e+1,F=$r(B);try{for(F.s();!(L=F.n()).done;){var N=L.value,$=N.id,O=N.percent,H=N.widthPercent;if($===M){if(O>0&&100===H)return 2;break}}}catch(e){F.e(e)}finally{F.f()}}return 1}},{key:"nextPage",value:function(){var e=this._currentPageNumber,t=this.pagesCount;if(e>=t)return!1;var n=this._getPageAdvance(e,!1)||1;return this.currentPageNumber=Math.min(e+n,t),!0}},{key:"previousPage",value:function(){var e=this._currentPageNumber;if(e<=1)return!1;var t=this._getPageAdvance(e,!0)||1;return this.currentPageNumber=Math.max(e-t,1),!0}},{key:"increaseScale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this._currentScale;do{t=(t*u).toFixed(2),t=Math.ceil(10*t)/10,t=Math.min(p,t)}while(--e>0&&t<p);this.currentScaleValue=t}},{key:"decreaseScale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this._currentScale;do{t=(t/u).toFixed(2),t=Math.floor(10*t)/10,t=Math.max(d,t)}while(--e>0&&t>d);this.currentScaleValue=t}}]),e}();function wl(e){e&&(e.includes(ve.PermissionFlag.COPY)||this.viewer.classList.add(Zr),e.includes(ve.PermissionFlag.MODIFY_ANNOTATIONS)||e.includes(ve.PermissionFlag.FILL_INTERACTIVE_FORMS)||Vr(this,sl)===ve.AnnotationMode.ENABLE_FORMS&&(Yr(this,rl,Vr(this,sl)),Yr(this,sl,ve.AnnotationMode.ENABLE)))}function _l(){var e=this;if("hidden"===document.visibilityState||!this.container.offsetParent||0===this._getVisiblePages().views.length)return Promise.resolve();var t=new Promise((function(t){Yr(e,dl,(function(){"hidden"===document.visibilityState&&(t(),document.removeEventListener("visibilitychange",Vr(e,dl)),Yr(e,dl,null))})),document.addEventListener("visibilitychange",Vr(e,dl))}));return Promise.race([this._onePageRenderedCapability.promise,t])}function El(){if(this._scrollMode!==P.PAGE)throw new Error("#ensurePageViewVisible: Invalid scrollMode value.");var e=this._currentPageNumber,t=Vr(this,ul),n=this.viewer;if(n.textContent="",t.pages.length=0,this._spreadMode===I.NONE){var i=this._pages[e-1];if(this.isInPresentationMode){var a=document.createElement("div");a.className="spread";var o=document.createElement("div");o.className="dummyPage",o.style.height="".concat(this.container.clientHeight,"px"),a.appendChild(o),a.appendChild(i.div),n.appendChild(a)}else n.appendChild(i.div);t.pages.push(i)}else{var s=new Set,r=this._spreadMode-1;e%2!==r?(s.add(e-1),s.add(e)):(s.add(e-2),s.add(e-1));var l,c=null,u=$r(s);try{for(u.s();!(l=u.n()).done;){var d=l.value,p=this._pages[d];p&&(null===c?((c=document.createElement("div")).className="spread",n.appendChild(c)):d%2===r&&(c=c.cloneNode(!1),n.appendChild(c)),c.appendChild(p.div),t.pages.push(p))}}catch(e){u.e(e)}finally{u.f()}}t.scrollDown=e>=t.previousPageNumber,t.previousPageNumber=e}function kl(e){return(!this.isInPresentationMode||this.container.clientHeight===Vr(this,cl))&&(e===this._currentScale||Math.abs(e-this._currentScale)<1e-15)}function Cl(e){return Dl.apply(this,arguments)}function Dl(){return(Dl=Fr(Ir().mark((function e(t){var n,i,a;return Ir().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.pdfPage){e.next=2;break}return e.abrupt("return",t.pdfPage);case 2:return e.prev=2,e.next=5,this.pdfDocument.getPage(t.id);case 5:return a=e.sent,t.pdfPage||t.setPdfPage(a),null!==(n=(i=this.linkService)._cachedPageNumber)&&void 0!==n&&n.call(i,a.ref)||this.linkService.cachePageRef(t.id,a.ref),e.abrupt("return",a);case 11:return e.prev=11,e.t0=e.catch(2),console.error("Unable to get page for page view",e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,this,[[2,11]])})))).apply(this,arguments)}function xl(e){var t,n;if(1===(null===(t=e.first)||void 0===t?void 0:t.id))return!0;if((null===(n=e.last)||void 0===n?void 0:n.id)===this.pagesCount)return!1;switch(this._scrollMode){case P.PAGE:return Vr(this,ul).scrollDown;case P.HORIZONTAL:return this.scroll.right}return this.scroll.down}function Sl(e){var t,n=$r(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=this._pages[i-1];null==a||a.toggleLoadingIconSpinner(!0)}}catch(e){n.e(e)}finally{n.f()}var o,s=$r(Vr(this,ol));try{for(s.s();!(o=s.n()).done;){var r=o.value;e.has(r.id)||r.toggleLoadingIconSpinner(!1)}}catch(e){s.e(e)}finally{s.f()}}function Al(e){return Al="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Al(e)}function Ll(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Tl(e,t,n){return t&&Ll(e.prototype,t),n&&Ll(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Bl(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pl(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Il(e,t)}function Il(e,t){return Il=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Il(e,t)}function Ml(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Nl(e);if(t){var a=Nl(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Fl(this,n)}}function Fl(e,t){if(t&&("object"===Al(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Nl(e){return Nl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nl(e)}var $l=function(e){Pl(n,e);var t=Ml(n);function n(){return Bl(this,n),t.apply(this,arguments)}return Tl(n)}(vl);function Ol(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Hl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hl(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function Hl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Rl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ql(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function jl(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var Ul=new WeakSet,zl=new WeakSet,Wl=new WeakSet,Gl=new WeakSet,Vl=new WeakSet,Yl=new WeakSet,Kl=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ql(this,Yl),ql(this,Vl),ql(this,Gl),ql(this,Wl),ql(this,zl),ql(this,Ul),this.toolbar=t.toolbar,this.toggleButton=t.toggleButton,this.toolbarButtonContainer=t.toolbarButtonContainer,this.buttons=[{element:t.firstPageButton,eventName:"firstpage",close:!0},{element:t.lastPageButton,eventName:"lastpage",close:!0},{element:t.pageRotateCwButton,eventName:"rotatecw",close:!1},{element:t.pageRotateCcwButton,eventName:"rotateccw",close:!1},{element:t.cursorSelectToolButton,eventName:"switchcursortool",eventDetails:{tool:Me},close:!0},{element:t.cursorHandToolButton,eventName:"switchcursortool",eventDetails:{tool:Fe},close:!0},{element:t.scrollPageButton,eventName:"switchscrollmode",eventDetails:{mode:P.PAGE},close:!0},{element:t.scrollVerticalButton,eventName:"switchscrollmode",eventDetails:{mode:P.VERTICAL},close:!0},{element:t.scrollHorizontalButton,eventName:"switchscrollmode",eventDetails:{mode:P.HORIZONTAL},close:!0},{element:t.scrollWrappedButton,eventName:"switchscrollmode",eventDetails:{mode:P.WRAPPED},close:!0},{element:t.spreadNoneButton,eventName:"switchspreadmode",eventDetails:{mode:I.NONE},close:!0},{element:t.spreadOddButton,eventName:"switchspreadmode",eventDetails:{mode:I.ODD},close:!0},{element:t.spreadEvenButton,eventName:"switchspreadmode",eventDetails:{mode:I.EVEN},close:!0},{element:t.documentPropertiesButton,eventName:"documentproperties",close:!0}],this.items={firstPage:t.firstPageButton,lastPage:t.lastPageButton,pageRotateCw:t.pageRotateCwButton,pageRotateCcw:t.pageRotateCcwButton},this.mainContainer=n,this.eventBus=i,this.opened=!1,this.containerHeight=null,this.previousContainerHeight=null,this.reset(),jl(this,zl,Jl).call(this),jl(this,Wl,Xl).call(this,t),jl(this,Gl,Ql).call(this,t),jl(this,Vl,ec).call(this,t),this.eventBus._on("resize",jl(this,Yl,tc).bind(this))}var t,n,i;return t=e,(n=[{key:"isOpen",get:function(){return this.opened}},{key:"setPageNumber",value:function(e){this.pageNumber=e,jl(this,Ul,Zl).call(this)}},{key:"setPagesCount",value:function(e){this.pagesCount=e,jl(this,Ul,Zl).call(this)}},{key:"reset",value:function(){this.pageNumber=0,this.pagesCount=0,jl(this,Ul,Zl).call(this),this.eventBus.dispatch("secondarytoolbarreset",{source:this})}},{key:"open",value:function(){this.opened||(this.opened=!0,jl(this,Yl,tc).call(this),this.toggleButton.classList.add("toggled"),this.toggleButton.setAttribute("aria-expanded","true"),this.toolbar.classList.remove("fn__hidden"))}},{key:"close",value:function(){this.opened&&(this.opened=!1,this.toolbar.classList.add("fn__hidden"),this.toggleButton.classList.remove("toggled"),this.toggleButton.setAttribute("aria-expanded","false"))}},{key:"toggle",value:function(){this.opened?this.close():this.open()}}])&&Rl(t.prototype,n),i&&Rl(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Zl(){this.items.firstPage.disabled=this.pageNumber<=1,this.items.lastPage.disabled=this.pageNumber>=this.pagesCount,this.items.pageRotateCw.disabled=0===this.pagesCount,this.items.pageRotateCcw.disabled=0===this.pagesCount}function Jl(){var e=this;this.toggleButton.addEventListener("click",this.toggle.bind(this));var t,n=Ol(this.buttons);try{var i=function(){var n=t.value,i=n.element,a=n.eventName,o=n.close,s=n.eventDetails;i.addEventListener("click",(function(t){if(null!==a){var n={source:e};for(var i in s)n[i]=s[i];e.eventBus.dispatch(a,n)}o&&e.close()}))};for(n.s();!(t=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}}function Xl(e){var t=e.cursorSelectToolButton,n=e.cursorHandToolButton;this.eventBus._on("cursortoolchanged",(function(e){var i=e.tool,a=i===Me,o=i===Fe;t.classList.toggle("toggled",a),n.classList.toggle("toggled",o),t.setAttribute("aria-checked","".concat(a)),n.setAttribute("aria-checked","".concat(o))}))}function Ql(e){var t=this,n=e.scrollPageButton,i=e.scrollVerticalButton,a=e.scrollHorizontalButton,o=e.scrollWrappedButton,s=e.spreadNoneButton,r=e.spreadOddButton,l=e.spreadEvenButton,c=function(e){var c=e.mode,u=c===P.PAGE,d=c===P.VERTICAL,p=c===P.HORIZONTAL,h=c===P.WRAPPED;n.classList.toggle("toggled",u),i.classList.toggle("toggled",d),a.classList.toggle("toggled",p),o.classList.toggle("toggled",h),n.setAttribute("aria-checked","".concat(u)),i.setAttribute("aria-checked","".concat(d)),a.setAttribute("aria-checked","".concat(p)),o.setAttribute("aria-checked","".concat(h));var f=t.pagesCount>Jr;n.disabled=f,i.disabled=f,a.disabled=f,o.disabled=f,s.disabled=p,r.disabled=p,l.disabled=p};this.eventBus._on("scrollmodechanged",c),this.eventBus._on("secondarytoolbarreset",(function(e){e.source===t&&c({mode:P.VERTICAL})}))}function ec(e){var t=this,n=e.spreadNoneButton,i=e.spreadOddButton,a=e.spreadEvenButton;function o(e){var t=e.mode,o=t===I.NONE,s=t===I.ODD,r=t===I.EVEN;n.classList.toggle("toggled",o),i.classList.toggle("toggled",s),a.classList.toggle("toggled",r),n.setAttribute("aria-checked","".concat(o)),i.setAttribute("aria-checked","".concat(s)),a.setAttribute("aria-checked","".concat(r))}this.eventBus._on("spreadmodechanged",o),this.eventBus._on("secondarytoolbarreset",(function(e){e.source===t&&o({mode:I.NONE})}))}function tc(){this.opened&&(this.containerHeight=this.mainContainer.clientHeight,this.containerHeight!==this.previousContainerHeight&&(this.toolbarButtonContainer.style.maxHeight="".concat(this.containerHeight-40,"px"),this.previousContainerHeight=this.containerHeight))}function nc(e){return nc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nc(e)}function ic(){ic=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==nc(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function ac(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function oc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return sc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sc(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function sc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function rc(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var lc="visiblePageIsLoading",cc=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.toolbar=t.container,this.eventBus=n,this.l10n=i,this.buttons=[{element:t.previous,eventName:"previouspage"},{element:t.next,eventName:"nextpage"},{element:t.zoomIn,eventName:"zoomin"},{element:t.zoomOut,eventName:"zoomout"},{element:t.presentationModeButton,eventName:"presentationmode"},{element:t.viewBookmark,eventName:null}],this.items={numPages:t.numPages,pageNumber:t.pageNumber,scaleSelect:t.scaleSelect,customScaleOption:t.customScaleOption,previous:t.previous,next:t.next,zoomIn:t.zoomIn,zoomOut:t.zoomOut},this._wasLocalized=!1,this.reset(),this._bindListeners()}var t,n,i,a,o;return t=e,n=[{key:"setPageNumber",value:function(e,t){this.pageNumber=e,this.pageLabel=t,this._updateUIState(!1)}},{key:"setPagesCount",value:function(e,t){this.pagesCount=e,this.hasPageLabels=t,this._updateUIState(!0)}},{key:"setPageScale",value:function(e,t){this.pageScaleValue=(e||t).toString(),this.pageScale=t,this._updateUIState(!1)}},{key:"reset",value:function(){this.pageNumber=0,this.pageLabel=null,this.hasPageLabels=!1,this.pagesCount=0,this.pageScaleValue=c,this.pageScale=1,this._updateUIState(!0),this.updateLoadingIndicatorState()}},{key:"_bindListeners",value:function(){var e,t=this,n=this.items,i=n.pageNumber,a=n.scaleSelect,o=this,s=oc(this.buttons);try{var r=function(){var n=e.value,i=n.element,a=n.eventName;i.addEventListener("click",(function(e){null!==a&&t.eventBus.dispatch(a,{source:t})}))};for(s.s();!(e=s.n()).done;)r()}catch(e){s.e(e)}finally{s.f()}i.addEventListener("click",(function(){this.select()})),i.addEventListener("change",(function(){o.eventBus.dispatch("pagenumberchanged",{source:o,value:this.value})})),a.addEventListener("change",(function(){"custom"!==this.value&&o.eventBus.dispatch("scalechanged",{source:o,value:this.value})})),a.addEventListener("click",(function(e){var t=e.target;this.value===o.pageScaleValue&&"OPTION"===t.tagName.toUpperCase()&&this.blur()})),a.oncontextmenu=G,this.eventBus._on("localized",(function(){t._wasLocalized=!0,t._adjustScaleWidth(),t._updateUIState(!0)}))}},{key:"_updateUIState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._wasLocalized){var t=this.pageNumber,n=this.pagesCount,i=this.pageScaleValue,a=this.pageScale,o=this.items;e&&(this.hasPageLabels?o.pageNumber.type="text":(o.pageNumber.type="number",o.numPages.textContent="/ "+n),o.pageNumber.max=n),this.hasPageLabels?(o.pageNumber.value=this.pageLabel,o.numPages.textContent="(".concat(t," / ").concat(n,")")):o.pageNumber.value=t,o.previous.disabled=t<=1,o.next.disabled=t>=n,o.zoomOut.disabled=a<=d,o.zoomIn.disabled=a>=p;var s,r=!1,l=oc(o.scaleSelect.options);try{for(l.s();!(s=l.n()).done;){var c=s.value;c.value===i?(c.selected=!0,r=!0):c.selected=!1}}catch(e){l.e(e)}finally{l.f()}r||(o.customScaleOption.textContent="".concat(Math.round(1e4*a)/100,"%"),o.customScaleOption.selected=!0)}}},{key:"updateLoadingIndicatorState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.items.pageNumber;t.classList.toggle(lc,e)}},{key:"_adjustScaleWidth",value:(a=ic().mark((function e(){var t,n,i,a,o,s,r,l,c,u,d,p;return ic().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.items,this.l10n,n=getComputedStyle(t.scaleSelect),i=parseInt(n.getPropertyValue("--scale-select-container-width"),10),a=parseInt(n.getPropertyValue("--scale-select-overflow"),10),o=document.createElement("canvas"),("undefined"==typeof PDFJSDev||PDFJSDev.test("MOZCENTRAL || GENERIC"))&&(o.mozOpaque=!0),s=o.getContext("2d",{alpha:!1}),e.next=7,X;case 7:for(s.font="".concat(n.fontSize," ").concat(n.fontFamily),r=0,l=0,c=[window.siyuan.languages.pageScaleAuto,window.siyuan.languages.pageScaleActual,window.siyuan.languages.pageScaleFit,window.siyuan.languages.pageScaleWidth];l<c.length;l++)u=c[l],d=s.measureText(u),(p=d.width)>r&&(r=p);(r+=2*a)>i&&document.documentElement.style.setProperty("--scale-select-container-width","".concat(r,"px")),o.width=0,o.height=0,o=s=null;case 15:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,i){var o=a.apply(e,t);function s(e){ac(o,n,i,s,r,"next",e)}function r(e){ac(o,n,i,s,r,"throw",e)}s(void 0)}))},function(){return o.apply(this,arguments)})}],n&&rc(t.prototype,n),i&&rc(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function uc(e){return uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uc(e)}function dc(){dc=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==uc(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function pc(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function hc(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){pc(o,i,a,s,r,"next",e)}function r(e){pc(o,i,a,s,r,"throw",e)}s(void 0)}))}}function fc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gc(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var mc=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;fc(this,e),this.fingerprint=t,this.cacheSize=i,this._initializedPromise=this._readFromStorage().then((function(e){var t=JSON.parse(e||"{}"),i=-1;if(Array.isArray(t.files)){for(;t.files.length>=n.cacheSize;)t.files.shift();for(var a=0,o=t.files.length;a<o;a++){if(t.files[a].fingerprint===n.fingerprint){i=a;break}}}else t.files=[];-1===i&&(i=t.files.push({fingerprint:n.fingerprint})-1),n.file=t.files[i],n.database=t}))}var t,n,i,a,o,s,r,l;return t=e,n=[{key:"_writeToStorage",value:(l=hc(dc().mark((function e(){var t;return dc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=JSON.stringify(this.database),"undefined"==typeof PDFJSDev||!PDFJSDev.test("MOZCENTRAL")){e.next=4;break}return sessionStorage.setItem("pdfjs.history",t),e.abrupt("return");case 4:localStorage.setItem("pdfjs.history",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"_readFromStorage",value:(r=hc(dc().mark((function e(){return dc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"==typeof PDFJSDev||!PDFJSDev.test("MOZCENTRAL")){e.next=2;break}return e.abrupt("return",sessionStorage.getItem("pdfjs.history"));case 2:return e.abrupt("return",localStorage.getItem("pdfjs.history"));case 3:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"set",value:(s=hc(dc().mark((function e(t,n){return dc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:return this.file[t]=n,e.abrupt("return",this._writeToStorage());case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"setMultiple",value:(o=hc(dc().mark((function e(t){var n;return dc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:for(n in t)this.file[n]=t[n];return e.abrupt("return",this._writeToStorage());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"get",value:function(){var e=hc(dc().mark((function e(t,n){var i;return dc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:return i=this.file[t],e.abrupt("return",void 0!==i?i:n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMultiple",value:(a=hc(dc().mark((function e(t){var n,i,a;return dc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:for(i in n=Object.create(null),t)a=this.file[i],n[i]=void 0!==a?a:t[i];return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})}],n&&gc(t.prototype,n),i&&gc(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}(),yc=n(8792);function bc(){bc=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_c(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function vc(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function wc(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){vc(o,i,a,s,r,"next",e)}function r(e){vc(o,i,a,s,r,"throw",e)}s(void 0)}))}}function _c(e){return _c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_c(e)}function Ec(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function kc(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function Cc(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,xc(e,t,"set"),n),n}function Dc(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,xc(e,t,"get"))}function xc(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var Sc=new WeakMap,Ac=new WeakMap,Lc=new WeakMap,Tc=function(){function e(){var t=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),kc(this,Sc,{writable:!0,value:Object.freeze("undefined"!=typeof PDFJSDev&&PDFJSDev.test("PRODUCTION")?PDFJSDev.eval("DEFAULT_PREFERENCES"):ne.UZ.getAll(ne.mp.PREFERENCE))}),kc(this,Ac,{writable:!0,value:Object.create(null)}),kc(this,Lc,{writable:!0,value:null}),this.constructor===e)throw new Error("Cannot initialize BasePreferences.");"undefined"!=typeof PDFJSDev&&PDFJSDev.test("CHROME")&&Object.defineProperty(this,"defaults",{get:function(){return Dc(this,Sc)}}),Cc(this,Lc,this._readFromStorage(Dc(this,Sc)).then((function(e){for(var n in Dc(t,Sc)){var i=null==e?void 0:e[n];_c(i)===_c(Dc(t,Sc)[n])&&(Dc(t,Ac)[n]=i)}})))}var t,n,i,a,o,s,r;return t=e,n=[{key:"_writeToStorage",value:(r=wc(bc().mark((function e(t){return bc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not implemented: _writeToStorage");case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"_readFromStorage",value:(s=wc(bc().mark((function e(t){return bc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not implemented: _readFromStorage");case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"reset",value:function(){var e=wc(bc().mark((function e(){var t,n=this;return bc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dc(this,Lc);case 2:return t=Dc(this,Ac),Cc(this,Ac,Object.create(null)),e.abrupt("return",this._writeToStorage(Dc(this,Sc)).catch((function(e){throw Cc(n,Ac,t),e})));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"set",value:(o=wc(bc().mark((function e(t,n){var i,a,o,s,r=this;return bc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dc(this,Lc);case 2:if(i=Dc(this,Sc)[t],a=Dc(this,Ac),void 0!==i){e.next=7;break}throw new Error('Set preference: "'.concat(t,'" is undefined.'));case 7:if(void 0!==n){e.next=9;break}throw new Error("Set preference: no value is specified.");case 9:if(o=_c(n),s=_c(i),o===s){e.next=18;break}if("number"!==o||"string"!==s){e.next=15;break}n=n.toString(),e.next=16;break;case 15:throw new Error('Set preference: "'.concat(n,'" is a ').concat(o,", expected a ").concat(s,"."));case 16:e.next=20;break;case 18:if("number"!==o||Number.isInteger(n)){e.next=20;break}throw new Error('Set preference: "'.concat(n,'" must be an integer.'));case 20:return Dc(this,Ac)[t]=n,e.abrupt("return",this._writeToStorage(Dc(this,Ac)).catch((function(e){throw Cc(r,Ac,a),e})));case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"get",value:function(){var e=wc(bc().mark((function e(t){var n,i;return bc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dc(this,Lc);case 2:if(void 0!==(i=Dc(this,Sc)[t])){e.next=5;break}throw new Error('Get preference: "'.concat(t,'" is undefined.'));case 5:return e.abrupt("return",null!==(n=Dc(this,Ac)[t])&&void 0!==n?n:i);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAll",value:(a=wc(bc().mark((function e(){var t,n,i;return bc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dc(this,Lc);case 2:for(n in t=Object.create(null),Dc(this,Sc))t[n]=null!==(i=Dc(this,Ac)[n])&&void 0!==i?i:Dc(this,Sc)[n];return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})}],n&&Ec(t.prototype,n),i&&Ec(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Bc(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}if("undefined"!=typeof PDFJSDev&&!PDFJSDev.test("CHROME || GENERIC"))throw new Error('Module "pdfjs-web/download_manager" shall not be used outside CHROME and GENERIC builds.');function Pc(e,t){var n=document.createElement("a");if(!n.click)throw new Error('DownloadManager: "a.click()" is not supported.');n.href=e,n.target="_parent","download"in n&&(n.download=t),(document.body||document.documentElement).appendChild(n),n.click(),n.remove()}var Ic=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._openBlobUrls=new WeakMap}var t,n,i;return t=e,(n=[{key:"downloadUrl",value:function(e,t){(0,ve.createValidAbsoluteUrl)(e,"http://example.com")?Pc(e+"#pdfjs.action=download",t):console.error("downloadUrl - not a valid URL: ".concat(e))}},{key:"downloadData",value:function(e,t,n){Pc(URL.createObjectURL(new Blob([e],{type:n})),t)}},{key:"openOrDownloadData",value:function(e,t,n){var i=(0,ve.isPdfFile)(n),a=i?"application/pdf":"";if(i){var o,s=this._openBlobUrls.get(e);s||(s=URL.createObjectURL(new Blob([t],{type:a})),this._openBlobUrls.set(e,s)),"undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC")?o="?file="+encodeURIComponent(s+"#"+n):PDFJSDev.test("CHROME")&&(o=chrome.runtime.getURL("/content/web/viewer.html")+"?file="+encodeURIComponent(s+"#"+n));try{return window.open(o),!0}catch(t){console.error("openOrDownloadData: ".concat(t)),URL.revokeObjectURL(s),this._openBlobUrls.delete(e)}}return this.downloadData(t,n,a),!1}},{key:"download",value:function(e,t,n){var i=URL.createObjectURL(e);Pc(i,n)}}])&&Bc(t.prototype,n),i&&Bc(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Mc=n(2752);function Fc(e){return Fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fc(e)}function Nc(){Nc=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==Fc(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function $c(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function Oc(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){$c(o,i,a,s,r,"next",e)}function r(e){$c(o,i,a,s,r,"throw",e)}s(void 0)}))}}function Hc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Rc(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function qc(e,t,n){return t&&Rc(e.prototype,t),n&&Rc(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function jc(e,t){return jc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},jc(e,t)}function Uc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Wc(e);if(t){var a=Wc(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return zc(this,n)}}function zc(e,t){if(t&&("object"===Fc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Wc(e){return Wc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Wc(e)}if("undefined"!=typeof PDFJSDev&&!PDFJSDev.test("GENERIC"))throw new Error('Module "pdfjs-web/genericcom" shall not be used outside GENERIC build.');var Gc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jc(e,t)}(a,e);var t,n,i=Uc(a);function a(){return Hc(this,a),i.apply(this,arguments)}return qc(a,[{key:"_writeToStorage",value:(n=Oc(Nc().mark((function e(t){return Nc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.setItem("pdfjs.preferences",JSON.stringify(t));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"_readFromStorage",value:(t=Oc(Nc().mark((function e(t){return Nc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",JSON.parse(localStorage.getItem("pdfjs.preferences")));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),a}(Tc),Vc=function(){function e(){throw Hc(this,e),new Error("Cannot initialize DefaultExternalServices.")}var t;return qc(e,null,[{key:"updateFindControlState",value:function(e){}},{key:"updateFindMatchesCount",value:function(e){}},{key:"initPassiveLoading",value:function(e){}},{key:"fallback",value:(t=Oc(Nc().mark((function e(t){return Nc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"reportTelemetry",value:function(e){}},{key:"supportsIntegratedFind",get:function(){return(0,ve.shadow)(this,"supportsIntegratedFind",!1)}},{key:"supportsDocumentFonts",get:function(){return(0,ve.shadow)(this,"supportsDocumentFonts",!0)}},{key:"supportedMouseWheelZoomModifierKeys",get:function(){return(0,ve.shadow)(this,"supportedMouseWheelZoomModifierKeys",{ctrlKey:!0,metaKey:!0})}},{key:"isInAutomation",get:function(){return(0,ve.shadow)(this,"isInAutomation",!1)}},{key:"createDownloadManager",value:function(e){return new Ic}},{key:"createPreferences",value:function(){return new Gc}},{key:"createScripting",value:function(e){var t=e.sandboxBundleSrc;return new Mc.GenericScripting(t)}}]),e}();function Yc(e){return Yc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yc(e)}function Kc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Zc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kc(Object(n),!0).forEach((function(t){Jc(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Jc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,a,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return o}(e,t)||eu(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=eu(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function eu(e,t){if(e){if("string"==typeof e)return tu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tu(e,t):void 0}}function tu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function nu(){nu=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function r(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new k(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return D()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=w(s,n);if(r){if(r===u)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function h(){}var f={};r(f,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(f=m);var y=h.prototype=d.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function i(a,o,s,r){var l=c(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==Yc(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,r)}),(function(e){i("throw",e,s,r)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,r)}))}r(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){i(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=h,r(y,"constructor",h),r(h,"constructor",p),p.displayName=r(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),r(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new v(l(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),r(y,s,"Generator"),r(y,a,(function(){return this})),r(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function iu(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function au(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){iu(o,i,a,s,r,"next",e)}function r(e){iu(o,i,a,s,r,"throw",e)}s(void 0)}))}}function ou(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var su,ru,lu,cu=-1,uu=1,du={AUTOMATIC:0,LIGHT:1,DARK:2},pu=["1.0","1.1","1.2","1.3","1.4","1.5","1.6","1.7","1.8","1.9","2.0","2.1","2.2","2.3"],hu=["acrobat distiller","acrobat pdfwriter","adobe livecycle","adobe pdf library","adobe photoshop","ghostscript","tcpdf","cairo","dvipdfm","dvips","pdftex","pdfkit","itext","prince","quarkxpress","mac os x","microsoft","openoffice","oracle","luradocument","pdf-xchange","antenna house","aspose.cells","fpdf"],fu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pdfId=t,this.initialBookmark=document.location.hash.substring(1),this._initializedCapability=(0,ve.createPromiseCapability)(),this.appConfig=null,this.pdfDocument=null,this.pdfLoadingTask=null,this.printService=null,this.pdfViewer=null,this.pdfThumbnailViewer=null,this.pdfRenderingQueue=null,this.pdfPresentationMode=null,this.pdfDocumentProperties=null,this.pdfLinkService=null,this.pdfHistory=null,this.pdfSidebar=null,this.pdfSidebarResizer=null,this.pdfOutlineViewer=null,this.pdfAttachmentViewer=null,this.pdfLayerViewer=null,this.pdfCursorTools=null,this.pdfScriptingManager=null,this.store=null,this.downloadManager=null,this.overlayManager=null,this.preferences=null,this.toolbar=null,this.secondaryToolbar=null,this.eventBus=null,this.l10n=null,this.isInitialViewSet=!1,this.downloadComplete=!1,this.isViewerEmbedded=window.parent!==window,this.url="",this.baseUrl="",this._downloadUrl="",this.externalServices=Vc,this._boundEvents=Object.create(null),this.documentInfo=null,this.metadata=null,this._contentDispositionFilename=null,this._contentLength=null,this._saveInProgress=!1,this._docStats=null,this._wheelUnusedTicks=0,this._idleCallbacks=new Set}var t,n,i,a,o,s,r,l,u,d,p,h,f,g,m;return t=e,n=[{key:"initialize",value:(m=au(nu().mark((function e(t){return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.preferences=this.externalServices.createPreferences(),this.appConfig=t,e.next=4,this._readPreferences();case 4:return e.next=6,this._parseHashParameters();case 6:return this._forceCssTheme(),this.isViewerEmbedded&&ne.UZ.get("externalLinkTarget")===tt&&ne.UZ.set("externalLinkTarget",ot),e.next=10,this._initializeViewerComponents();case 10:this.bindEvents(),this.bindWindowEvents(),this.eventBus.dispatch("localized",{source:this}),this._initializedCapability.resolve();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"_readPreferences",value:(g=au(nu().mark((function e(){return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof PDFJSDev&&!PDFJSDev.test("!PRODUCTION || GENERIC")){e.next=4;break}if(!ne.UZ.get("disablePreferences")){e.next=3;break}return e.abrupt("return");case 3:ne.UZ._hasUserOptions()&&console.warn('_readPreferences: The Preferences may override manually set AppOptions; please use the "disablePreferences"-option in order to prevent that.');case 4:return e.prev=4,e.t0=ne.UZ,e.next=8,this.preferences.getAll();case 8:e.t1=e.sent,e.t0.setAll.call(e.t0,e.t1),e.next=15;break;case 12:e.prev=12,e.t2=e.catch(4),console.error('_readPreferences: "'.concat(null===e.t2||void 0===e.t2?void 0:e.t2.message,'".'));case 15:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(){return g.apply(this,arguments)})},{key:"_parseHashParameters",value:(f=au(nu().mark((function e(){var t,n,i,a;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ne.UZ.get("pdfBugEnabled")){e.next=2;break}return e.abrupt("return");case 2:if(t=document.location.hash.substring(1)){e.next=5;break}return e.abrupt("return");case 5:if(n=O(t),i=[],"true"===n.get("disableworker")&&i.push(mu()),n.has("disablerange")&&ne.UZ.set("disableRange","true"===n.get("disablerange")),n.has("disablestream")&&ne.UZ.set("disableStream","true"===n.get("disablestream")),n.has("disableautofetch")&&ne.UZ.set("disableAutoFetch","true"===n.get("disableautofetch")),n.has("disablefontface")&&ne.UZ.set("disableFontFace","true"===n.get("disablefontface")),n.has("disablehistory")&&ne.UZ.set("disableHistory","true"===n.get("disablehistory")),n.has("verbosity")&&ne.UZ.set("verbosity",0|n.get("verbosity")),!n.has("textlayer")){e.next=22;break}e.t0=n.get("textlayer"),e.next="off"===e.t0?17:"visible"===e.t0||"shadow"===e.t0||"hover"===e.t0?19:22;break;case 17:return ne.UZ.set("textLayerMode",L),e.abrupt("break",22);case 19:return this.appConfig.viewerContainer.classList.add("textLayer-".concat(n.get("textlayer"))),e.abrupt("break",22);case 22:if(n.has("pdfbug")&&(ne.UZ.set("pdfBug",!0),ne.UZ.set("fontExtraProperties",!0),a=n.get("pdfbug").split(","),i.push(bu(a,this))),("undefined"==typeof PDFJSDev||PDFJSDev.test("!PRODUCTION || GENERIC"))&&n.has("locale")&&ne.UZ.set("locale",n.get("locale")),0!==i.length){e.next=26;break}return e.abrupt("return");case 26:return e.prev=26,e.next=29,Promise.all(i);case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(26),console.error('_parseHashParameters: "'.concat(e.t1.message,'".'));case 34:case"end":return e.stop()}}),e,this,[[26,31]])}))),function(){return f.apply(this,arguments)})},{key:"_forceCssTheme",value:function(){var e=ne.UZ.get("viewerCssTheme");if(e!==du.AUTOMATIC&&Object.values(du).includes(e))try{for(var t=document.styleSheets[0],n=(null==t?void 0:t.cssRules)||[],i=0,a=n.length;i<a;i++){var o,s=n[i];if(s instanceof CSSMediaRule&&"(prefers-color-scheme: dark)"===(null===(o=s.media)||void 0===o?void 0:o[0])){if(e===du.LIGHT)return void t.deleteRule(i);var r=/^@media \(prefers-color-scheme: dark\) {\n\s*([\w\s-.,:;/\\{}()]+)\n}$/.exec(s.cssText);return void(null!=r&&r[1]&&(t.deleteRule(i),t.insertRule(r[1],i)))}}}catch(e){console.error('_forceCssTheme: "'.concat(null==e?void 0:e.message,'".'))}}},{key:"_initializeViewerComponents",value:(h=au(nu().mark((function e(){var t,n,i,a,o,s,r,l,c,u;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.appConfig,n=this.externalServices,i=n.isInAutomation?new be:new ye,this.eventBus=i,this.overlayManager=new Tt,(a=new Uo).onIdle=this._cleanup.bind(this),this.pdfRenderingQueue=a,o=new ct({eventBus:i,externalLinkTarget:ne.UZ.get("externalLinkTarget"),externalLinkRel:ne.UZ.get("externalLinkRel"),ignoreDestinationZoom:ne.UZ.get("ignoreDestinationZoom")}),this.pdfLinkService=o,s=n.createDownloadManager(),this.downloadManager=s,r=new ji({linkService:o,eventBus:i}),this.findController=r,l=new is({eventBus:i,sandboxBundleSrc:"undefined"==typeof PDFJSDev||PDFJSDev.test("!PRODUCTION || GENERIC || CHROME")?ne.UZ.get("sandboxBundleSrc"):null,scriptingFactory:n,docPropertiesLookup:this._scriptingDocProperties.bind(this)}),this.pdfScriptingManager=l,c=t.mainContainer,u=t.viewerContainer,this.pdfViewer=new $l({container:c,viewer:u,eventBus:i,renderingQueue:a,linkService:o,downloadManager:s,findController:r,scriptingManager:ne.UZ.get("enableScripting")&&l,renderer:ne.UZ.get("renderer"),l10n:this.l10n,textLayerMode:ne.UZ.get("textLayerMode"),annotationMode:ne.UZ.get("annotationMode"),imageResourcesPath:ne.UZ.get("imageResourcesPath"),enablePrintAutoRotate:ne.UZ.get("enablePrintAutoRotate"),useOnlyCssZoom:ne.UZ.get("useOnlyCssZoom"),maxCanvasPixels:ne.UZ.get("maxCanvasPixels"),enablePermissions:ne.UZ.get("enablePermissions")}),a.setViewer(this.pdfViewer),o.setViewer(this.pdfViewer),l.setViewer(this.pdfViewer),this.pdfThumbnailViewer=new Hs({container:t.sidebar.thumbnailView,eventBus:i,renderingQueue:a,linkService:o,l10n:this.l10n}),a.setThumbnailViewer(this.pdfThumbnailViewer),this.isViewerEmbedded||ne.UZ.get("disableHistory")||(this.pdfHistory=new wa({linkService:o,eventBus:i}),o.setHistory(this.pdfHistory)),this.supportsIntegratedFind||(this.findBar=new ha(t.findBar,i,this.l10n)),this.pdfDocumentProperties=new Mn(t.documentProperties,this.overlayManager,i,this.l10n),this.pdfCursorTools=new Oe({container:c,eventBus:i,cursorToolOnLoad:ne.UZ.get("cursorToolOnLoad")}),this.toolbar=new cc(t.toolbar,i,this.l10n),this.secondaryToolbar=new Kl(t.secondaryToolbar,c,i),this.supportsFullscreen&&(this.pdfPresentationMode=new Co({container:c,pdfViewer:this.pdfViewer,eventBus:i})),this.passwordPrompt=new Ut(t.passwordOverlay,this.overlayManager,this.l10n,this.isViewerEmbedded),this.pdfOutlineViewer=new Qa({container:t.sidebar.outlineView,eventBus:i,linkService:o}),this.pdfAttachmentViewer=new cn({container:t.sidebar.attachmentsView,eventBus:i,downloadManager:s}),this.pdfLayerViewer=new Fa({container:t.sidebar.layersView,eventBus:i,l10n:this.l10n}),this.pdfSidebar=new ss({elements:t.sidebar,pdfViewer:this.pdfViewer,pdfThumbnailViewer:this.pdfThumbnailViewer,eventBus:i,l10n:this.l10n}),this.pdfSidebar.onToggled=this.forceRendering.bind(this),this.pdfSidebarResizer=new ds(t.sidebarResizer,i,this.l10n);case 37:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"run",value:function(e){var t=this;this.initialize(e).then((function(){!function(e){var t,n,i,a=e.appConfig;if("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC")?su(a.file):PDFJSDev.test("MOZCENTRAL")?window.location.href:PDFJSDev.test("CHROME")&&ne.UZ.get("defaultUrl"),"undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC")){var o=document.createElement("input");o.id=a.openFileInputName,o.className="fileInput",o.setAttribute("type","file"),o.oncontextmenu=G,document.body.appendChild(o),window.File&&window.FileReader&&window.FileList&&window.Blob?o.value=null:(a.toolbar.openFile.hidden=!0,a.secondaryToolbar.openFileButton.hidden=!0),o.addEventListener("change",(function(t){var n=t.target.files;n&&0!==n.length&&e.eventBus.dispatch("fileinputchange",{source:this,fileInput:t.target})})),a.mainContainer.addEventListener("dragover",(function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"})),a.mainContainer.addEventListener("drop",(function(t){t.preventDefault();var n=t.dataTransfer.files;n&&0!==n.length&&e.eventBus.dispatch("fileinputchange",{source:this,fileInput:t.dataTransfer})}))}else a.toolbar.openFile.hidden=!0,a.secondaryToolbar.openFileButton.hidden=!0;e.supportsPrinting||(null===(t=a.toolbar.print)||void 0===t||t.classList.add("fn__hidden"),null===(n=a.secondaryToolbar.printButton)||void 0===n||n.classList.add("fn__hidden"));e.supportsFullscreen||(a.toolbar.presentationModeButton.classList.add("fn__hidden"),null===(i=a.secondaryToolbar.presentationModeButton)||void 0===i||i.classList.add("fn__hidden"));e.supportsIntegratedFind&&a.toolbar.viewFind.classList.add("fn__hidden"),a.mainContainer.addEventListener("transitionend",(function(t){t.target===this&&e.eventBus.dispatch("resize",{source:this})}),!0);try{!function(e){var t=e.appConfig.file;if("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC"))t?e.open(t):e._hideViewBookmark();else if(PDFJSDev.test("MOZCENTRAL || CHROME"))e.setTitleUsingUrl(t,t),e.initPassiveLoading();else{if(t)throw new Error("Not implemented: webViewerOpenFileViaURL");e._hideViewBookmark()}}(e)}catch(t){e._documentError(window.siyuan.languages.loadingError,t)}}(t)}))}},{key:"initialized",get:function(){return this._initializedCapability.settled}},{key:"initializedPromise",get:function(){return this._initializedCapability.promise}},{key:"zoomIn",value:function(e){this.pdfViewer.isInPresentationMode||this.pdfViewer.increaseScale(e)}},{key:"zoomOut",value:function(e){this.pdfViewer.isInPresentationMode||this.pdfViewer.decreaseScale(e)}},{key:"zoomReset",value:function(){this.pdfViewer.isInPresentationMode||(this.pdfViewer.currentScaleValue=c)}},{key:"pagesCount",get:function(){return this.pdfDocument?this.pdfDocument.numPages:0}},{key:"page",get:function(){return this.pdfViewer.currentPageNumber},set:function(e){this.pdfViewer.currentPageNumber=e}},{key:"supportsPrinting",get:function(){return ld.instance.supportsPrinting}},{key:"supportsFullscreen",get:function(){return(0,ve.shadow)(this,"supportsFullscreen",document.fullscreenEnabled)}},{key:"supportsIntegratedFind",get:function(){return this.externalServices.supportsIntegratedFind}},{key:"supportsDocumentFonts",get:function(){return this.externalServices.supportsDocumentFonts}},{key:"loadingBar",get:function(){var e=new Q(this.appConfig.appContainer);return(0,ve.shadow)(this,"loadingBar",e)}},{key:"supportedMouseWheelZoomModifierKeys",get:function(){return this.externalServices.supportedMouseWheelZoomModifierKeys}},{key:"initPassiveLoading",value:function(){var e=this;if("undefined"==typeof PDFJSDev||!PDFJSDev.test("MOZCENTRAL || CHROME"))throw new Error("Not implemented: initPassiveLoading");this.externalServices.initPassiveLoading({onOpenWithTransport:function(t,n,i){e.open(t,{length:n,range:i})},onOpenWithData:function(t,n){(0,ve.isPdfFile)(n)&&(e._contentDispositionFilename=n),e.open(t)},onOpenWithURL:function(t,n,i){var a=void 0!==i?{url:t,originalUrl:i}:t,o=void 0!==n?{length:n}:null;e.open(a,o)},onError:function(t){e._documentError(window.siyuan.languages.loadingError,t)},onProgress:function(t,n){e.progress(t/n)}})}},{key:"setTitleUsingUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.url=e,this.baseUrl=e.split("#")[0],t&&(this._downloadUrl=t===e?this.baseUrl:t.split("#")[0]);var n=(0,ve.getPdfFilenameFromUrl)(e,"");if(!n)try{n=decodeURIComponent((0,ve.getFilenameFromUrl)(e))||e}catch(t){n=e}this.setTitle(n)}},{key:"setTitle",value:function(e){this.isViewerEmbedded}},{key:"_docFilename",get:function(){return this._contentDispositionFilename||(0,ve.getPdfFilenameFromUrl)(this.url)}},{key:"_hideViewBookmark",value:function(){var e=this.appConfig,t=e.toolbar,n=e.secondaryToolbar;t.viewBookmark.hidden=!0,n.viewBookmarkButton.hidden=!0}},{key:"_cancelIdleCallbacks",value:function(){if(this._idleCallbacks.size){var e,t=Qc(this._idleCallbacks);try{for(t.s();!(e=t.n()).done;){var n=e.value;window.cancelIdleCallback(n)}}catch(e){t.e(e)}finally{t.f()}this._idleCallbacks.clear()}}},{key:"close",value:(p=au(nu().mark((function e(){var t,n,i,a;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._unblockDocumentLoadEvent(),this._hideViewBookmark(),"undefined"!=typeof PDFJSDev&&PDFJSDev.test("MOZCENTRAL")||(this.appConfig.errorWrapper.container.hidden=!0),this.pdfLoadingTask){e.next=5;break}return e.abrupt("return");case 5:if(!(("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC"))&&(null===(t=this.pdfDocument)||void 0===t?void 0:t.annotationStorage.size)>0&&this._annotationStorageModified)){e.next=13;break}return e.prev=6,e.next=9,this.save({sourceEventType:"save"});case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(6);case 13:return(a=[]).push(this.pdfLoadingTask.destroy()),this.pdfLoadingTask=null,this.pdfDocument&&(this.pdfDocument=null,this.pdfThumbnailViewer.setDocument(null),this.pdfViewer.setDocument(null),this.pdfLinkService.setDocument(null),this.pdfDocumentProperties.setDocument(null)),this.pdfLinkService.externalLinkEnabled=!0,this.store=null,this.isInitialViewSet=!1,this.downloadComplete=!1,this.url="",this.baseUrl="",this._downloadUrl="",this.documentInfo=null,this.metadata=null,this._contentDispositionFilename=null,this._contentLength=null,this._saveInProgress=!1,this._docStats=null,this._cancelIdleCallbacks(),a.push(this.pdfScriptingManager.destroyPromise),this.pdfSidebar.reset(),this.pdfOutlineViewer.reset(),this.pdfAttachmentViewer.reset(),this.pdfLayerViewer.reset(),null===(n=this.pdfHistory)||void 0===n||n.reset(),null===(i=this.findBar)||void 0===i||i.reset(),this.toolbar.reset(),this.secondaryToolbar.reset(),"undefined"!=typeof PDFBug&&PDFBug.cleanup(),e.next=43,Promise.all(a);case 43:case"end":return e.stop()}}),e,this,[[6,11]])}))),function(){return p.apply(this,arguments)})},{key:"open",value:(d=au(nu().mark((function e(t,n){var i,a,o,s,r,l,c,u,d=this;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pdfLoadingTask){e.next=3;break}return e.next=3,this.close();case 3:for(a in i=ne.UZ.getAll(ne.mp.WORKER))ve.GlobalWorkerOptions[a]=i[a];for(r in o=Object.create(null),"string"==typeof t?(this.setTitleUsingUrl(t,t),o.url=t):t&&"byteLength"in t?o.data=t:t.url&&t.originalUrl&&(this.setTitleUsingUrl(t.originalUrl,t.url),o.url=t.url),s=ne.UZ.getAll(ne.mp.API))l=s[r],"docBaseUrl"!==r||l||("undefined"!=typeof PDFJSDev&&PDFJSDev.test("PRODUCTION")?PDFJSDev.test("MOZCENTRAL || CHROME")&&(l=this.baseUrl):l=document.URL.split("#")[0]),o[r]=l;if(n)for(c in n)o[c]=n[c];return u=(0,ve.getDocument)(o),this.pdfLoadingTask=u,u.onPassword=function(e,t){d.pdfLinkService.externalLinkEnabled=!1,d.passwordPrompt.setUpdateCallback(e,t),d.passwordPrompt.open()},u.onProgress=function(e){var t=e.loaded,n=e.total;d.progress(t/n)},u.onUnsupportedFeature=this.fallback.bind(this),e.abrupt("return",u.promise.then((function(e){d.load(e)}),(function(e){if(u===d.pdfLoadingTask){var t="loadingError";throw e instanceof ve.InvalidPDFException?t="invalidFileError":e instanceof ve.MissingPDFException?t="missingFileError":e instanceof ve.UnexpectedResponseException&&(t="unexpectedResponseError"),d._documentError(window.siyuan.languages[t],{message:null==e?void 0:e.message}),e}})));case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"_ensureDownloadComplete",value:function(){if(!this.pdfDocument||!this.downloadComplete)throw new Error("PDF document not downloaded.")}},{key:"download",value:function(){var e=au(nu().mark((function e(){var t,n,i,a,o,s,r,l=arguments;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:{},n=t.sourceEventType,i=void 0===n?"download":n,a=this._downloadUrl,o=this._docFilename,e.prev=2,this._ensureDownloadComplete(),e.next=6,this.pdfDocument.getData();case 6:return s=e.sent,r=new Blob([s],{type:"application/pdf"}),e.next=10,this.downloadManager.download(r,a,o,i);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(2),e.next=16,this.downloadManager.downloadUrl(a,o);case 16:case"end":return e.stop()}}),e,this,[[2,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"save",value:(u=au(nu().mark((function e(){var t,n,i,a,o,s,r,l=arguments;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:{},n=t.sourceEventType,i=void 0===n?"download":n,!this._saveInProgress){e.next=3;break}return e.abrupt("return");case 3:return this._saveInProgress=!0,e.next=6,this.pdfScriptingManager.dispatchWillSave();case 6:return a=this._downloadUrl,o=this._docFilename,e.prev=7,this._ensureDownloadComplete(),e.next=11,this.pdfDocument.saveDocument();case 11:return s=e.sent,r=new Blob([s],{type:"application/pdf"}),e.next=15,this.downloadManager.download(r,a,o,i);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(7),console.error("Error when saving the document: ".concat(e.t0.message)),e.next=22,this.download({sourceEventType:i});case 22:return e.prev=22,e.next=25,this.pdfScriptingManager.dispatchDidSave();case 25:return this._saveInProgress=!1,e.finish(22);case 27:case"end":return e.stop()}}),e,this,[[7,17,22,27]])}))),function(){return u.apply(this,arguments)})},{key:"downloadOrSave",value:function(e){var t;(null===(t=this.pdfDocument)||void 0===t?void 0:t.annotationStorage.size)>0?this.save(e):this.download(e)}},{key:"fallback",value:function(e){this.externalServices.reportTelemetry({type:"unsupportedFeature",featureId:e})}},{key:"_documentError",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._unblockDocumentLoadEvent(),this._otherError(e,n),this.eventBus.dispatch("documenterror",{source:this,message:e,reason:null!==(t=null==n?void 0:n.message)&&void 0!==t?t:null})}},{key:"_otherError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=["PDF.js v".concat(ve.version||"?"," (build: ").concat(ve.build||"?",")")];if(t&&(n.push("Message: ".concat(t.message)),t.stack?n.push("Stack: ".concat(t.stack)):(t.filename&&n.push("File: ".concat(t.filename)),t.lineNumber&&n.push("Line: ".concat(t.lineNumber)))),"undefined"!=typeof PDFJSDev&&PDFJSDev.test("MOZCENTRAL"))Promise.all(n).then((function(t){console.error(e+"\n"+t.join("\n"))})),this.fallback();else{var i=this.appConfig.errorWrapper,a=i.container;a.hidden=!1;var o=i.errorMessage;o.textContent=e;var s=i.closeButton;s.onclick=function(){a.hidden=!0};var r=i.errorMoreInfo,l=i.moreInfoButton,c=i.lessInfoButton;l.onclick=function(){r.hidden=!1,l.hidden=!0,c.hidden=!1,r.style.height=r.scrollHeight+"px"},c.onclick=function(){r.hidden=!0,l.hidden=!1,c.hidden=!0},l.oncontextmenu=G,c.oncontextmenu=G,s.oncontextmenu=G,l.hidden=!1,c.hidden=!0,Promise.all(n).then((function(e){r.value=e.join("\n")}))}}},{key:"progress",value:function(e){var t=this;if(!this.downloadComplete){var n=Math.round(100*e);(n>this.loadingBar.percent||isNaN(n))&&(this.loadingBar.percent=n,(this.pdfDocument?this.pdfDocument.loadingParams.disableAutoFetch:ne.UZ.get("disableAutoFetch"))&&n&&(this.disableAutoFetchLoadingBarTimeout&&(clearTimeout(this.disableAutoFetchLoadingBarTimeout),this.disableAutoFetchLoadingBarTimeout=null),this.loadingBar.show(),this.disableAutoFetchLoadingBarTimeout=setTimeout((function(){t.loadingBar.hide(),t.disableAutoFetchLoadingBarTimeout=null}),5e3)))}}},{key:"load",value:function(e){var t=this;this.pdfDocument=e,e.getDownloadInfo().then((function(e){var n=e.length;t._contentLength=n,t.downloadComplete=!0,t.loadingBar.hide(),r.then((function(){t.eventBus.dispatch("documentloaded",{source:t})}))}));var n,i=e.getPageLayout().catch((function(){})),a=e.getPageMode().catch((function(){})),o=e.getOpenAction().catch((function(){}));this.toolbar.setPagesCount(e.numPages,!1),this.secondaryToolbar.setPagesCount(e.numPages),"undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC")?n=null:PDFJSDev.test("MOZCENTRAL")?n=this.baseUrl:PDFJSDev.test("CHROME")&&(n=location.href.split("#")[0]),this.pdfLinkService.setDocument(e,n),this.pdfDocumentProperties.setDocument(e,this.url);var s=this.pdfViewer;s.setDocument(e);var r=s.firstPagePromise,l=s.onePageRendered,u=s.pagesPromise;this.pdfThumbnailViewer.setDocument(e);var d=(this.store=new mc(e.fingerprints[0])).getMultiple({page:null,zoom:c,scrollLeft:"0",scrollTop:"0",rotation:null,sidebarView:_,scrollMode:P.UNKNOWN,spreadMode:I.UNKNOWN}).catch((function(){return Object.create(null)}));r.then((function(n){t.loadingBar.setWidth(t.appConfig.viewerContainer),t._initializeAnnotationStorageCallbacks(e),Promise.all([X,d,i,a,o]).then(function(){var n=au(nu().mark((function n(i){var a,o,r,l,c,d,p,h,f,g,m,y,b,v;return nu().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(a=Xc(i,5))[0],o=a[1],r=a[2],l=a[3],c=a[4],d=ne.UZ.get("viewOnLoad"),t._initializePdfHistory({fingerprint:e.fingerprints[0],viewOnLoad:d,initialDest:null==c?void 0:c.dest}),p=t.initialBookmark,h=ne.UZ.get("defaultZoomValue"),f=h?"zoom=".concat(h):null,g=null,m=ne.UZ.get("sidebarViewOnLoad"),y=ne.UZ.get("scrollModeOnLoad"),b=ne.UZ.get("spreadModeOnLoad"),o.page&&d!==uu&&(f="page=".concat(o.page,"&zoom=").concat(h||o.zoom,",")+"".concat(o.scrollLeft,",").concat(o.scrollTop),g=parseInt(o.rotation,10),m===_&&(m=0|o.sidebarView),y===P.UNKNOWN&&(y=0|o.scrollMode),b===I.UNKNOWN&&(b=0|o.spreadMode)),l&&m===_&&(m=te(l)),r&&y===P.UNKNOWN&&b===I.UNKNOWN&&(v=ee(r),b=v.spreadMode),t.setInitialView(f,{rotation:g,sidebarView:m,scrollMode:y,spreadMode:b}),t.eventBus.dispatch("documentinit",{source:t}),t.isViewerEmbedded||s.focus(),n.next=18,Promise.race([u,new Promise((function(e){setTimeout(e,1e4)}))]);case 18:if(p||f){n.next=20;break}return n.abrupt("return");case 20:if(!s.hasEqualPageSizes){n.next=22;break}return n.abrupt("return");case 22:t.initialBookmark=p,s.currentScaleValue=s.currentScaleValue,t.setInitialView(f),t.annoId&&t.pdfId&&qu({value:t.pdfId,pdfInstance:t,id:t.annoId});case 26:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(){t.setInitialView()})).then((function(){s.update()}))})),u.then((function(){t._unblockDocumentLoadEvent(),t._initializeAutoPrint(e,o)}),(function(e){t._documentError(window.siyuan.languages.loadingError,{message:null==e?void 0:e.message})})),l.then((function(n){if(t.externalServices.reportTelemetry({type:"pageInfo",timestamp:n.timestamp}),e.getOutline().then((function(n){e===t.pdfDocument&&t.pdfOutlineViewer.render({outline:n,pdfDocument:e})})),e.getAttachments().then((function(n){e===t.pdfDocument&&t.pdfAttachmentViewer.render({attachments:n})})),s.optionalContentConfigPromise.then((function(n){e===t.pdfDocument&&t.pdfLayerViewer.render({optionalContentConfig:n,pdfDocument:e})})),"undefined"!=typeof PDFJSDev&&PDFJSDev.test("MOZCENTRAL")||"requestIdleCallback"in window){var i=window.requestIdleCallback((function(){t._collectTelemetry(e),t._idleCallbacks.delete(i)}),{timeout:1e3});t._idleCallbacks.add(i)}})),this._initializePageLabels(e),this._initializeMetadata(e)}},{key:"_scriptingDocProperties",value:(l=au(nu().mark((function e(t){var n,i,a=this;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.documentInfo){e.next=5;break}return e.next=3,new Promise((function(e){a.eventBus._on("metadataloaded",e,{once:!0})}));case 3:if(t===this.pdfDocument){e.next=5;break}return e.abrupt("return",null);case 5:if(this._contentLength){e.next=10;break}return e.next=8,new Promise((function(e){a.eventBus._on("documentloaded",e,{once:!0})}));case 8:if(t===this.pdfDocument){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",Zc(Zc({},this.documentInfo),{},{baseURL:this.baseUrl,filesize:this._contentLength,filename:this._docFilename,metadata:null===(n=this.metadata)||void 0===n?void 0:n.getRaw(),authors:null===(i=this.metadata)||void 0===i?void 0:i.get("dc:creator"),numPages:this.pagesCount,URL:this.url}));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"_collectTelemetry",value:(r=au(nu().mark((function e(t){var n,i;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pdfDocument.getMarkInfo();case 2:if(n=e.sent,t===this.pdfDocument){e.next=5;break}return e.abrupt("return");case 5:i=(null==n?void 0:n.Marked)||!1,this.externalServices.reportTelemetry({type:"tagged",tagged:i});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_initializeAutoPrint",value:(s=au(nu().mark((function e(t,n){var i,a,o,s,r,l,c,u,d=this;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n,this.pdfViewer.enableScripting?null:t.getJavaScript()]);case 2:if(i=e.sent,a=Xc(i,2),o=a[0],s=a[1],t===this.pdfDocument){e.next=8;break}return e.abrupt("return");case 8:if(r=!1,"Print"===(null==o?void 0:o.action)&&(r=!0),!s){e.next=31;break}if(s.some((function(e){return!!e&&(console.warn("Warning: JavaScript support is not enabled"),d.fallback(ve.UNSUPPORTED_FEATURES.javaScript),!0)})),r){e.next=31;break}l=Qc(s),e.prev=14,l.s();case 16:if((c=l.n()).done){e.next=23;break}if(!(u=c.value)||!M.test(u)){e.next=21;break}return r=!0,e.abrupt("break",23);case 21:e.next=16;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(14),l.e(e.t0);case 28:return e.prev=28,l.f(),e.finish(28);case 31:r&&this.triggerPrinting();case 32:case"end":return e.stop()}}),e,this,[[14,25,28,31]])}))),function(e,t){return s.apply(this,arguments)})},{key:"_initializeMetadata",value:(o=au(nu().mark((function e(t){var n,i,a,o,s,r,l,c,u,d,p,h,f;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getMetadata();case 2:if(a=e.sent,o=a.info,s=a.metadata,r=a.contentDispositionFilename,l=a.contentLength,t===this.pdfDocument){e.next=9;break}return e.abrupt("return");case 9:this.documentInfo=o,this.metadata=s,null!==(n=this._contentDispositionFilename)&&void 0!==n||(this._contentDispositionFilename=r),null!==(i=this._contentLength)&&void 0!==i||(this._contentLength=l),c=null==o?void 0:o.Title,(u=null==s?void 0:s.get("dc:title"))&&("Untitled"===u||/[\uFFF0-\uFFFF]/g.test(u)||(c=u)),c?this.setTitle("".concat(c," - ").concat(r||document.title)):r&&this.setTitle(r),!o.IsXFAPresent||o.IsAcroFormPresent||t.isPureXfa?!o.IsAcroFormPresent&&!o.IsXFAPresent||this.pdfViewer.renderForms||(console.warn("Warning: Interactive form support is not enabled"),this.fallback(ve.UNSUPPORTED_FEATURES.forms)):(t.loadingParams.enableXfa?console.warn("Warning: XFA Foreground documents are not supported"):console.warn("Warning: XFA support is not enabled"),this.fallback(ve.UNSUPPORTED_FEATURES.forms)),o.IsSignaturesPresent&&(console.warn("Warning: Digital signatures validation is not supported"),this.fallback(ve.UNSUPPORTED_FEATURES.signatures)),d="other",pu.includes(o.PDFFormatVersion)&&(d="v".concat(o.PDFFormatVersion.replace(".","_"))),p="other",o.Producer&&(h=o.Producer.toLowerCase(),hu.some((function(e){return!!h.includes(e)&&(p=e.replace(/[ .-]/g,"_"),!0)}))),f=null,o.IsXFAPresent?f="xfa":o.IsAcroFormPresent&&(f="acroform"),this.externalServices.reportTelemetry({type:"documentInfo",version:d,generator:p,formType:f}),this.eventBus.dispatch("metadataloaded",{source:this});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_initializePageLabels",value:(a=au(nu().mark((function e(t){var n,i,a,o,s,r,l,c,u;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getPageLabels();case 2:if(n=e.sent,t===this.pdfDocument){e.next=5;break}return e.abrupt("return");case 5:if(n&&!ne.UZ.get("disablePageLabels")){e.next=7;break}return e.abrupt("return");case 7:i=n.length,a=0,o=0,s=0;case 10:if(!(s<i)){e.next=24;break}if((r=n[s])!==(s+1).toString()){e.next=16;break}a++,e.next=21;break;case 16:if(""!==r){e.next=20;break}o++,e.next=21;break;case 20:return e.abrupt("break",24);case 21:s++,e.next=10;break;case 24:if(!(a>=i||o>=i)){e.next=26;break}return e.abrupt("return");case 26:l=this.pdfViewer,c=this.pdfThumbnailViewer,u=this.toolbar,l.setPageLabels(n),c.setPageLabels(n),u.setPagesCount(i,!0),u.setPageNumber(l.currentPageNumber,l.currentPageLabel);case 31:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_initializePdfHistory",value:function(e){var t=e.fingerprint,n=e.viewOnLoad,i=e.initialDest,a=void 0===i?null:i;this.pdfHistory&&(this.pdfHistory.initialize({fingerprint:t,resetHistory:n===uu,updateUrl:ne.UZ.get("historyUpdateUrl")}),this.pdfHistory.initialBookmark&&(this.initialBookmark=this.pdfHistory.initialBookmark,this.initialRotation=this.pdfHistory.initialRotation),a&&!this.initialBookmark&&n===cu&&(this.initialBookmark=JSON.stringify(a),this.pdfHistory.push({explicitDest:a,pageNumber:null})))}},{key:"_initializeAnnotationStorageCallbacks",value:function(e){var t=this;if(e===this.pdfDocument){var n=e.annotationStorage;n.onSetModified=function(){("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC"))&&(t._annotationStorageModified=!0)},n.onResetModified=function(){("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC"))&&delete t._annotationStorageModified}}}},{key:"setInitialView",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.rotation,a=n.sidebarView,o=n.scrollMode,s=n.spreadMode,r=function(e){Y(e)&&(t.pdfViewer.pagesRotation=e)},l=function(e,n){K(e)&&(t.pdfViewer.scrollMode=e),Z(n)&&(t.pdfViewer.spreadMode=n)};this.isInitialViewSet=!0,this.pdfSidebar.setInitialView(a),l(o,s),this.initialBookmark?(r(this.initialRotation),delete this.initialRotation,this.pdfLinkService.setHash(this.initialBookmark),this.initialBookmark=null):e&&(r(i),this.pdfLinkService.setHash(e)),this.toolbar.setPageNumber(this.pdfViewer.currentPageNumber,this.pdfViewer.currentPageLabel),this.secondaryToolbar.setPageNumber(this.pdfViewer.currentPageNumber),this.pdfViewer.currentScaleValue||(this.pdfViewer.currentScaleValue=c)}},{key:"_cleanup",value:function(){this.pdfDocument&&(this.pdfViewer.cleanup(),this.pdfThumbnailViewer.cleanup(),this.pdfDocument.cleanup(this.pdfViewer.renderer===A))}},{key:"forceRendering",value:function(){this.pdfRenderingQueue.printing=!!this.printService,this.pdfRenderingQueue.isThumbnailViewEnabled=this.pdfSidebar.isThumbnailViewVisible,this.pdfRenderingQueue.renderHighestPriority()}},{key:"beforePrint",value:function(){if(this.pdfScriptingManager.dispatchWillPrint(),!this.printService)if(this.supportsPrinting)if(this.pdfViewer.pageViewsReady){var e=this.pdfViewer.getPagesOverview(),t=this.appConfig.printContainer,n=ne.UZ.get("printResolution"),i=this.pdfViewer.optionalContentConfigPromise,a=ld.instance.createPrintService(this.pdfDocument,e,t,n,i,this.l10n);this.printService=a,this.forceRendering(),a.layout(),this.externalServices.reportTelemetry({type:"print"})}else window.alert(window.siyuan.languages.printingNotReady);else this._otherError(window.siyuan.languages.printingNotSupported)}},{key:"afterPrint",value:function(){var e;this.pdfScriptingManager.dispatchDidPrint(),this.printService&&(this.printService.destroy(),this.printService=null,null===(e=this.pdfDocument)||void 0===e||e.annotationStorage.resetModified()),this.forceRendering()}},{key:"rotatePages",value:function(e){this.pdfViewer.pagesRotation+=e}},{key:"requestPresentationMode",value:function(){var e;null===(e=this.pdfPresentationMode)||void 0===e||e.request()}},{key:"triggerPrinting",value:function(){this.supportsPrinting&&window.print()}},{key:"bindEvents",value:function(){var e=this.eventBus,t=this._boundEvents;t.beforePrint=this.beforePrint.bind(this),t.afterPrint=this.afterPrint.bind(this),e._on("hashchange",Lu),e._on("beforeprint",t.beforePrint),e._on("afterprint",t.afterPrint),e._on("pagerendered",_u),e._on("updateviewarea",xu),e._on("pagechanging",ed),e._on("scalechanging",Xu),e._on("rotationchanging",Qu),e._on("sidebarviewchanged",Du),e._on("pagemode",Eu),e._on("namedaction",ku),e._on("presentationmodechanged",Cu),e._on("presentationmode",Tu),e._on("print",Bu),e._on("download",Pu),e._on("save",Iu),e._on("firstpage",Mu),e._on("lastpage",Fu),e._on("nextpage",Nu),e._on("previouspage",$u),e._on("zoomin",Ou),e._on("zoomout",Hu),e._on("zoomreset",Ru),e._on("pagenumberchanged",qu),e._on("scalechanged",ju),e._on("rotatecw",Uu),e._on("rotateccw",zu),e._on("optionalcontentconfig",Wu),e._on("switchscrollmode",Gu),e._on("scrollmodechanged",Su),e._on("switchspreadmode",Vu),e._on("spreadmodechanged",Au),e._on("documentproperties",Yu),e._on("findfromurlhash",Ku),e._on("updatefindmatchescount",Zu),e._on("updatefindcontrolstate",Ju),ne.UZ.get("pdfBug")&&(t.reportPageStatsPDFBug=wu,e._on("pagerendered",t.reportPageStatsPDFBug),e._on("pagechanging",t.reportPageStatsPDFBug)),("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC"))&&(e._on("fileinputchange",ru),e._on("openfile",lu))}},{key:"bindWindowEvents",value:function(){this.unbindWindowEvents();var e=this.eventBus,t=this._boundEvents;t.windowResize=function(){e.dispatch("resize",{source:window})},t.windowHashChange=function(){e.dispatch("hashchange",{source:window,hash:document.location.hash.substring(1)})},t.windowBeforePrint=function(){e.dispatch("beforeprint",{source:window})},t.windowAfterPrint=function(){e.dispatch("afterprint",{source:window})},t.windowUpdateFromSandbox=function(t){e.dispatch("updatefromsandbox",{source:window,detail:t.detail})},window.addEventListener("visibilitychange",td),window.addEventListener("wheel",ad,{passive:!1}),window.addEventListener("touchstart",od,{passive:!1}),window.addEventListener("click",sd),window.addEventListener("keydown",rd),window.addEventListener("resize",t.windowResize),window.addEventListener("hashchange",t.windowHashChange),window.addEventListener("beforeprint",t.windowBeforePrint),window.addEventListener("afterprint",t.windowAfterPrint),window.addEventListener("updatefromsandbox",t.windowUpdateFromSandbox)}},{key:"unbindEvents",value:function(){var e=this.eventBus,t=this._boundEvents;e._off("hashchange",Lu),e._off("beforeprint",t.beforePrint),e._off("afterprint",t.afterPrint),e._off("pagerendered",_u),e._off("updateviewarea",xu),e._off("pagechanging",ed),e._off("scalechanging",Xu),e._off("rotationchanging",Qu),e._off("sidebarviewchanged",Du),e._off("pagemode",Eu),e._off("namedaction",ku),e._off("presentationmodechanged",Cu),e._off("presentationmode",Tu),e._off("print",Bu),e._off("download",Pu),e._off("save",Iu),e._off("firstpage",Mu),e._off("lastpage",Fu),e._off("nextpage",Nu),e._off("previouspage",$u),e._off("zoomin",Ou),e._off("zoomout",Hu),e._off("zoomreset",Ru),e._off("pagenumberchanged",qu),e._off("scalechanged",ju),e._off("rotatecw",Uu),e._off("rotateccw",zu),e._off("optionalcontentconfig",Wu),e._off("switchscrollmode",Gu),e._off("scrollmodechanged",Su),e._off("switchspreadmode",Vu),e._off("spreadmodechanged",Au),e._off("documentproperties",Yu),e._off("findfromurlhash",Ku),e._off("updatefindmatchescount",Zu),e._off("updatefindcontrolstate",Ju),t.reportPageStatsPDFBug&&(e._off("pagerendered",t.reportPageStatsPDFBug),e._off("pagechanging",t.reportPageStatsPDFBug),t.reportPageStatsPDFBug=null),("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC"))&&(e._off("fileinputchange",ru),e._off("openfile",lu)),t.beforePrint=null,t.afterPrint=null}},{key:"unbindWindowEvents",value:function(){var e=this._boundEvents;window.removeEventListener("visibilitychange",td),window.removeEventListener("wheel",ad,{passive:!1}),window.removeEventListener("touchstart",od,{passive:!1}),window.removeEventListener("click",sd),window.removeEventListener("keydown",rd),window.removeEventListener("resize",e.windowResize),window.removeEventListener("hashchange",e.windowHashChange),window.removeEventListener("beforeprint",e.windowBeforePrint),window.removeEventListener("afterprint",e.windowAfterPrint),window.removeEventListener("updatefromsandbox",e.windowUpdateFromSandbox),e.windowResize=null,e.windowHashChange=null,e.windowBeforePrint=null,e.windowAfterPrint=null,e.windowUpdateFromSandbox=null}},{key:"accumulateWheelTicks",value:function(e){(this._wheelUnusedTicks>0&&e<0||this._wheelUnusedTicks<0&&e>0)&&(this._wheelUnusedTicks=0),this._wheelUnusedTicks+=e;var t=Math.sign(this._wheelUnusedTicks)*Math.floor(Math.abs(this._wheelUnusedTicks));return this._wheelUnusedTicks-=t,t}},{key:"_unblockDocumentLoadEvent",value:function(){document.blockUnblockOnload&&document.blockUnblockOnload(!1),this._unblockDocumentLoadEvent=function(){}}},{key:"_reportDocumentStatsTelemetry",value:function(){var e=this.pdfDocument.stats;e!==this._docStats&&(this._docStats=e,this.externalServices.reportTelemetry({type:"documentStats",stats:e}))}},{key:"scriptingReady",get:function(){return this.pdfScriptingManager.ready}}],n&&ou(t.prototype,n),i&&ou(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();if("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC")){var gu=["null","http://mozilla.github.io","https://mozilla.github.io"];su=function(e){if(void 0!==e)try{var t=new URL(window.location.href).origin||"null";if(gu.includes(t))return;if(new URL(e,window.location.href).origin!==t)throw new Error("file origin does not match viewer's")}catch(e){throw console.log(window.siyuan.languages.loadingError,e.message),e}}}function mu(){return yu.apply(this,arguments)}function yu(){return(yu=au(nu().mark((function e(){return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ve.GlobalWorkerOptions.workerSrc||(ve.GlobalWorkerOptions.workerSrc=ne.UZ.get("workerSrc")),"undefined"!=typeof PDFJSDev&&PDFJSDev.test("PRODUCTION")){e.next=6;break}return e.next=4,n(4981)("".concat(yc.Constants.PROTYLE_CDN,"/js/pdf/pdf.worker.js"));case 4:return window.pdfjsWorker=e.sent,e.abrupt("return");case 6:return e.next=8,(0,ve.loadScript)(ve.PDFWorker.workerSrc);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bu(e,t){return vu.apply(this,arguments)}function vu(){return(vu=au(nu().mark((function e(t,n){var i,a,o;return nu().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.appConfig,a=i.debuggerScriptPath,o=i.mainContainer,e.next=3,(0,ve.loadScript)(a);case 3:PDFBug.init({OPS:ve.OPS},o,t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wu(e){var t,n=e.pageNumber,i=e.source;if((0,xr.Tk)(i.div)&&"undefined"!=typeof Stats&&Stats.enabled){var a=fu.pdfViewer.getPageView(n-1),o=null==a||null===(t=a.pdfPage)||void 0===t?void 0:t.stats;o&&Stats.add(n,o)}}function _u(e){var t=e.pageNumber,n=e.error,i=e.source,a=(0,xr.Tk)(i.div);if(a){if(t===a.page&&a.toolbar.updateLoadingIndicatorState(!1),a.pdfSidebar.isThumbnailViewVisible){var o=a.pdfViewer.getPageView(t-1),s=a.pdfThumbnailViewer.getThumbnail(t-1);o&&s&&s.setImage(o)}n&&a._otherError("An error occurred while rendering the page.",n),a._reportDocumentStatsTelemetry()}}function Eu(e){var t=e.mode,n=e.source,i=(0,xr.Tk)(n.externalLinkTarget);if(i){var a;switch(t){case"thumbs":a=k;break;case"bookmarks":case"outline":a=C;break;case"attachments":a=D;break;case"layers":a=x;break;case"none":a=E;break;default:return void console.error('Invalid "pagemode" hash parameter: '+t)}i.pdfSidebar.switchView(a,!0)}}function ku(e){var t=(0,xr.Tk)(e.source.externalLinkTarget);if(t)switch(e.action){case"GoToPage":t.appConfig.toolbar.pageNumber.select();break;case"Find":t.supportsIntegratedFind||t.findBar.toggle();break;case"Print":t.triggerPrinting();break;case"SaveAs":Iu()}}function Cu(e){var t=(0,xr.Tk)(e.source.toolbar);t&&(t.pdfViewer.presentationModeState=e.state)}function Du(e){var t,n=(0,xr.Tk)(e.source.outerContainer);n&&(n.pdfRenderingQueue.isThumbnailViewEnabled=n.pdfSidebar.isThumbnailViewVisible,n.isInitialViewSet&&(null===(t=n.store)||void 0===t||t.set("sidebarView",e.view).catch((function(){}))))}function xu(e){var t=(0,xr.Tk)(e.source.container);if(t){var n,i=e.location;if(t.isInitialViewSet)null===(n=t.store)||void 0===n||n.setMultiple({page:i.pageNumber,zoom:i.scale,scrollLeft:i.left,scrollTop:i.top,rotation:i.rotation}).catch((function(){}));var a=t.pdfLinkService.getAnchorUrl(i.pdfOpenParams);t.appConfig.toolbar.viewBookmark.href=a,t.appConfig.secondaryToolbar.viewBookmarkButton.href=a;var o=t.pdfViewer.getPageView(t.page-1),s=(null==o?void 0:o.renderingState)!==m;t.toolbar.updateLoadingIndicatorState(s)}}function Su(e){var t,n=(0,xr.Tk)(e.source.container);n&&(n.isInitialViewSet&&(null===(t=n.store)||void 0===t||t.set("scrollMode",e.mode).catch((function(){}))))}function Au(e){var t,n=(0,xr.Tk)(e.source.container);n&&(n.isInitialViewSet&&(null===(t=n.store)||void 0===t||t.set("spreadMode",e.mode).catch((function(){}))))}function Lu(e){var t,n=e.hash;if(n){var i=(0,xr.Tk)(e.source);i&&(i.isInitialViewSet?null!==(t=i.pdfHistory)&&void 0!==t&&t.popStateInProgress||i.pdfLinkService.setHash(n):i.initialBookmark=n)}}function Tu(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.requestPresentationMode()}function Bu(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.triggerPrinting()}function Pu(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.downloadOrSave({sourceEventType:"download"})}function Iu(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.downloadOrSave({sourceEventType:"save"})}function Mu(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.pdfDocument&&(n.page=1)}function Fu(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.pdfDocument&&(n.page=n.pagesCount)}function Nu(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.pdfViewer.nextPage()}function $u(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.pdfViewer.previousPage()}function Ou(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.zoomIn()}function Hu(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.zoomOut()}function Ru(e){var t=e.source,n=(0,xr.Tk)(t.toolbar);n&&n.zoomReset()}function qu(e){var t;if((t=e.pdfInstance?e.pdfInstance:(0,xr.Tk)(e.source.toolbar))&&void 0!==e.value){var n=t.pdfViewer;""!==e.value&&t.pdfLinkService.goToPage(e.value),e.id&&(0,xr.Py)(t.pdfViewer.container,e.id),e.value!==n.currentPageNumber.toString()&&e.value!==n.currentPageLabel&&t.toolbar.setPageNumber(n.currentPageNumber,n.currentPageLabel)}}function ju(e){var t=(0,xr.Tk)(e.source.toolbar);t&&(t.pdfViewer.currentScaleValue=e.value)}function Uu(e){var t=(0,xr.Tk)(e.source.toolbar);t&&t.rotatePages(90)}function zu(e){var t=(0,xr.Tk)(e.source.toolbar);t&&t.rotatePages(-90)}function Wu(e){var t=(0,xr.Tk)(e.source.toolbar);t&&(t.pdfViewer.optionalContentConfigPromise=e.promise)}function Gu(e){var t=(0,xr.Tk)(e.source.toolbar);t&&(t.pdfViewer.scrollMode=e.mode)}function Vu(e){var t=(0,xr.Tk)(e.source.toolbar);t&&(t.pdfViewer.spreadMode=e.mode)}function Yu(e){var t=(0,xr.Tk)(e.source.toolbar);t&&t.pdfDocumentProperties.open()}function Ku(e){var t=(0,xr.Tk)(e.source.bar);t&&t.eventBus.dispatch("find",{source:e.source,type:"",query:e.query,phraseSearch:e.phraseSearch,caseSensitive:!1,entireWord:!1,highlightAll:!0,findPrevious:!1,matchDiacritics:!0})}function Zu(e){var t=e.matchesCount,n=e.source,i=(0,xr.Tk)(n._linkService.pdfViewer.container);i&&(i.supportsIntegratedFind?i.externalServices.updateFindMatchesCount(t):i.findBar.updateResultsCount(t))}function Ju(e){var t=e.state,n=e.previous,i=e.matchesCount,a=e.rawQuery,o=e.source;if(o.state){var s=(0,xr.Tk)(o.state.source.bar);s&&(s.supportsIntegratedFind?s.externalServices.updateFindControlState({result:t,findPrevious:n,matchesCount:i,rawQuery:a}):s.findBar.updateUIState(t,n,i))}}function Xu(e){var t=(0,xr.Tk)(e.source.container);t&&(t.toolbar.setPageScale(e.presetValue,e.scale),t.pdfViewer.update())}function Qu(e){var t=(0,xr.Tk)(e.source.container);t&&(t.pdfThumbnailViewer.pagesRotation=e.pagesRotation,t.forceRendering(),t.pdfViewer.currentPageNumber=e.pageNumber)}function ed(e){var t=e.pageNumber,n=e.pageLabel,i=e.source,a=(0,xr.Tk)(i.container);a&&(a.toolbar.setPageNumber(t,n),a.secondaryToolbar.setPageNumber(t),a.pdfSidebar.isThumbnailViewVisible&&a.pdfThumbnailViewer.scrollThumbnailIntoView(t))}function td(e){"visible"===document.visibilityState&&id()}("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC"))&&(ru=function(e){var t;if(null===(t=e.source.pdfViewer)||void 0===t||!t.isInPresentationMode){var n=e.fileInput.files[0],i=URL.createObjectURL(n);n.name&&(i={url:i,originalUrl:n.name})}},lu=function(e){var t=e.pdfInstance.appConfig.openFileInputName;document.getElementById(t).click()});var nd=null;function id(){nd&&clearTimeout(nd),nd=setTimeout((function(){nd=null}),1e3)}function ad(e){var t=(0,xr.Tk)(e.target);if(t){var n=t.pdfViewer,i=t.supportedMouseWheelZoomModifierKeys;if(!n.isInPresentationMode)if(e.ctrlKey&&i.ctrlKey||e.metaKey&&i.metaKey){if(e.preventDefault(),nd||"hidden"===document.visibilityState)return;var a=e.deltaMode,o=V(e),s=n.currentScale,r=0;if(a===WheelEvent.DOM_DELTA_LINE||a===WheelEvent.DOM_DELTA_PAGE)r=Math.abs(o)>=1?Math.sign(o):t.accumulateWheelTicks(o);else{r=t.accumulateWheelTicks(o/30)}r<0?t.zoomOut(-r):r>0&&t.zoomIn(r);var l=n.currentScale;if(s!==l){var c=l/s-1,u=n.container.getBoundingClientRect(),d=e.clientX-u.left,p=e.clientY-u.top;n.container.scrollLeft+=d*c,n.container.scrollTop+=p*c}}else id()}}function od(e){e.touches.length>1&&e.preventDefault()}function sd(e){var t=(0,xr.Tk)(e.target);if(t&&t.secondaryToolbar.isOpen){var n=t.appConfig;(t.pdfViewer.containsElement(e.target)||n.toolbar.container.contains(e.target)&&!n.secondaryToolbar.toggleButton.contains(e.target))&&t.secondaryToolbar.close()}}function rd(e){var t=(0,xr.Tk)(e.target);if(t&&!t.overlayManager.active){var n=t.eventBus,i=t.pdfViewer,a=i.isInPresentationMode,o=!1,s=!1,r=(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.metaKey?8:0);if(1===r||8===r||5===r||12===r)switch(e.keyCode){case 70:t.supportsIntegratedFind||e.shiftKey||(t.findBar.open(),o=!0);break;case 71:if(!t.supportsIntegratedFind){var l=t.findController.state;if(l){var c=Object.assign(Object.create(null),l,{source:window,type:"again",findPrevious:5===r||12===r});n.dispatch("find",c)}o=!0}break;case 61:case 107:case 187:case 171:a||t.zoomIn(),o=!0;break;case 173:case 109:case 189:a||t.zoomOut(),o=!0;break;case 48:case 96:a||(setTimeout((function(){t.zoomReset()})),o=!1);break;case 38:(a||t.page>1)&&(t.page=1,o=!0,s=!0);break;case 40:(a||t.page<t.pagesCount)&&(t.page=t.pagesCount,o=!0,s=!0)}if(("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC || CHROME"))&&(1===r||8===r))switch(e.keyCode){case 83:n.dispatch("download",{source:window}),o=!0;break;case 79:("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC"))&&(n.dispatch("openfile",{source:window,pdfInstance:this}),o=!0)}if(3===r||10===r)switch(e.keyCode){case 80:t.requestPresentationMode(),o=!0;break;case 71:t.appConfig.toolbar.pageNumber.select(),o=!0}if(o)return s&&!a&&i.focus(),void e.preventDefault();var u=function(){for(var e=document,t=e.activeElement||e.querySelector(":focus");null!==(n=t)&&void 0!==n&&n.shadowRoot;){var n;t=(e=t.shadowRoot).activeElement||e.querySelector(":focus")}return t}(),d=null==u?void 0:u.tagName.toUpperCase();if(!("INPUT"===d||"TEXTAREA"===d||"SELECT"===d||null!=u&&u.isContentEditable)||27===e.keyCode){if(0===r){var p=0,h=!1;switch(e.keyCode){case 38:case 33:i.isVerticalScrollbarEnabled&&(h=!0),p=-1;break;case 8:a||(h=!0),p=-1;break;case 37:i.isHorizontalScrollbarEnabled&&(h=!0);case 75:case 80:p=-1;break;case 27:t.secondaryToolbar.isOpen&&(t.secondaryToolbar.close(),o=!0),!t.supportsIntegratedFind&&t.findBar.opened&&(t.findBar.close(),o=!0);break;case 40:case 34:i.isVerticalScrollbarEnabled&&(h=!0),p=1;break;case 13:case 32:a||(h=!0),p=1;break;case 39:i.isHorizontalScrollbarEnabled&&(h=!0);case 74:case 78:p=1;break;case 36:(a||t.page>1)&&(t.page=1,o=!0,s=!0);break;case 35:(a||t.page<t.pagesCount)&&(t.page=t.pagesCount,o=!0,s=!0);break;case 83:t.pdfCursorTools.switchTool(Me);break;case 72:t.pdfCursorTools.switchTool(Fe);break;case 82:t.rotatePages(90);break;case 115:t.pdfSidebar.toggle()}0===p||h&&"page-fit"!==i.currentScaleValue||(p>0?i.nextPage():i.previousPage(),o=!0)}if(4===r)switch(e.keyCode){case 13:case 32:if(!a&&"page-fit"!==i.currentScaleValue)break;i.previousPage(),o=!0;break;case 82:t.rotatePages(-90)}o||a||(e.keyCode>=33&&e.keyCode<=40||32===e.keyCode&&"BUTTON"!==d)&&(s=!0),s&&!i.containsElement(u)&&i.focus(),o&&e.preventDefault()}}}var ld={instance:{supportsPrinting:!1,createPrintService:function(){throw new Error("Not implemented: createPrintService")}}}},5e3:(e,t,n)=>{"use strict";n.d(t,{UZ:()=>g,bA:()=>s,mp:()=>p});var i=n(8792);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=Object.create(null);if("undefined"==typeof PDFJSDev||PDFJSDev.test("GENERIC")){var r="undefined"!=typeof navigator&&navigator.userAgent||"",l="undefined"!=typeof navigator&&navigator.platform||"",c="undefined"!=typeof navigator&&navigator.maxTouchPoints||1,u=/Android/.test(r),d=/\b(iPad|iPhone|iPod)(?=;)/.test(r)||"MacIntel"===l&&c>1;/CriOS/.test(r)&&(s.disableCreateObjectURL=!0),(d||u)&&(s.maxCanvasPixels=5242880)}var p={VIEWER:2,API:4,WORKER:8,PREFERENCE:128},h={annotationMode:{value:2,kind:p.VIEWER+p.PREFERENCE},cursorToolOnLoad:{value:0,kind:p.VIEWER+p.PREFERENCE},defaultUrl:{value:"compressed.tracemonkey-pldi-09.pdf",kind:p.VIEWER},defaultZoomValue:{value:"",kind:p.VIEWER+p.PREFERENCE},disableHistory:{value:!1,kind:p.VIEWER},disablePageLabels:{value:!1,kind:p.VIEWER+p.PREFERENCE},enablePermissions:{value:!1,kind:p.VIEWER+p.PREFERENCE},enablePrintAutoRotate:{value:!0,kind:p.VIEWER+p.PREFERENCE},enableScripting:{value:"undefined"==typeof PDFJSDev||!PDFJSDev.test("CHROME"),kind:p.VIEWER+p.PREFERENCE},externalLinkRel:{value:"noopener noreferrer nofollow",kind:p.VIEWER},externalLinkTarget:{value:0,kind:p.VIEWER+p.PREFERENCE},historyUpdateUrl:{value:!1,kind:p.VIEWER+p.PREFERENCE},ignoreDestinationZoom:{value:!1,kind:p.VIEWER+p.PREFERENCE},imageResourcesPath:{value:"./images/",kind:p.VIEWER},maxCanvasPixels:{value:16777216,compatibility:s.maxCanvasPixels,kind:p.VIEWER},pdfBugEnabled:{value:"undefined"==typeof PDFJSDev||!PDFJSDev.test("PRODUCTION"),kind:p.VIEWER+p.PREFERENCE},printResolution:{value:150,kind:p.VIEWER},renderer:{value:"canvas",kind:p.VIEWER},sidebarViewOnLoad:{value:-1,kind:p.VIEWER+p.PREFERENCE},scrollModeOnLoad:{value:-1,kind:p.VIEWER+p.PREFERENCE},spreadModeOnLoad:{value:-1,kind:p.VIEWER+p.PREFERENCE},textLayerMode:{value:1,kind:p.VIEWER+p.PREFERENCE},useOnlyCssZoom:{value:!1,kind:p.VIEWER+p.PREFERENCE},viewerCssTheme:{value:"undefined"!=typeof PDFJSDev&&PDFJSDev.test("CHROME")?2:0,kind:p.VIEWER+p.PREFERENCE},viewOnLoad:{value:0,kind:p.VIEWER+p.PREFERENCE},cMapPacked:{value:!0,kind:p.API},cMapUrl:{value:"cmaps/",kind:p.API},disableAutoFetch:{value:!1,kind:p.API+p.PREFERENCE},disableFontFace:{value:!1,kind:p.API+p.PREFERENCE},disableRange:{value:!1,kind:p.API+p.PREFERENCE},disableStream:{value:!1,kind:p.API+p.PREFERENCE},docBaseUrl:{value:"",kind:p.API},enableXfa:{value:!0,kind:p.API+p.PREFERENCE},fontExtraProperties:{value:!1,kind:p.API},isEvalSupported:{value:!0,kind:p.API},maxImageSize:{value:-1,kind:p.API},pdfBug:{value:!1,kind:p.API},standardFontDataUrl:{value:"undefined"!=typeof PDFJSDev&&PDFJSDev.test("PRODUCTION")?"../web/standard_fonts/":"../external/standard_fonts/",kind:p.API},verbosity:{value:1,kind:p.API},workerPort:{value:null,kind:p.WORKER},workerSrc:{value:"".concat(i.Constants.PROTYLE_CDN,"/js/pdf/pdf.worker.js?v=2.14.102"),kind:p.WORKER}};"undefined"==typeof PDFJSDev||PDFJSDev.test("!PRODUCTION || GENERIC")?(h.disablePreferences={value:"undefined"!=typeof PDFJSDev&&PDFJSDev.test("TESTING"),kind:p.VIEWER},h.locale={value:"undefined"!=typeof navigator?navigator.language:"en-US",kind:p.VIEWER},h.sandboxBundleSrc={value:"undefined"!=typeof PDFJSDev&&PDFJSDev.test("PRODUCTION")?"../build/pdf.sandbox.js":"../build/dev-sandbox/pdf.sandbox.js",kind:p.VIEWER},h.renderer.kind+=p.PREFERENCE):PDFJSDev.test("CHROME")&&(h.disableTelemetry={value:!1,kind:p.VIEWER+p.PREFERENCE},h.sandboxBundleSrc={value:"../build/pdf.sandbox.js",kind:p.VIEWER});var f=Object.create(null),g=function(){function e(){throw function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),new Error("Cannot initialize AppOptions.")}var t,n,i;return t=e,i=[{key:"get",value:function(e){var t=f[e];if(void 0!==t)return t;var n,i=h[e];return void 0!==i?null!==(n=i.compatibility)&&void 0!==n?n:i.value:void 0}},{key:"getAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Object.create(null);for(var n in h){var i,o=h[n];if(e){if(0==(e&o.kind))continue;if(e===p.PREFERENCE){var s=o.value,r=a(s);if("boolean"===r||"string"===r||"number"===r&&Number.isInteger(s)){t[n]=s;continue}throw new Error("Invalid type for preference: ".concat(n))}}var l=f[n];t[n]=void 0!==l?l:null!==(i=o.compatibility)&&void 0!==i?i:o.value}return t}},{key:"set",value:function(e,t){f[e]=t}},{key:"setAll",value:function(e){for(var t in e)f[t]=e[t]}},{key:"remove",value:function(e){delete f[e]}},{key:"_hasUserOptions",value:function(){return Object.keys(f).length>0}}],(n=null)&&o(t.prototype,n),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}()},2752:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GenericScripting:()=>f,docPropertiesLookup:()=>p});var i=n(2843);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(){l=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",r=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new D(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(a,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return S()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var r=E(s,n);if(r){if(r===p)continue;return r}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=d(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,s),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function h(){}function f(){}function g(){}var m={};c(m,o,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(x([])));b&&b!==t&&n.call(b,o)&&(m=b);var v=g.prototype=h.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(o,s,r,l){var c=d(e[o],e,s);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==a(p)&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){i("next",e,r,l)}),(function(e){i("throw",e,r,l)})):t.resolve(p).then((function(e){u.value=e,r(u)}),(function(e){return i("throw",e,r,l)}))}l(c.arg)}var o;this._invoke=function(e,n){function a(){return new t((function(t,a){i(e,n,t,a)}))}return o=o?o.then(a,a):a()}}function E(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=d(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function x(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=g,c(v,"constructor",g),c(g,"constructor",f),f.displayName=c(g,r,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,r,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},w(_.prototype),c(_.prototype,s,(function(){return this})),e.AsyncIterator=_,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new _(u(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},w(v),c(v,r,"Generator"),c(v,o,(function(){return this})),c(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=x,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var r=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(r&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;C(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:x(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},e}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){u(o,i,a,s,r,"next",e)}function r(e){u(o,i,a,s,r,"throw",e)}s(void 0)}))}}function p(e){return h.apply(this,arguments)}function h(){return(h=d(l().mark((function e(t){var n,a,o,r,c,u,d,p,h;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(n="").split("#")[0],e.next=3,t.getMetadata();case 3:if(o=e.sent,r=o.info,c=o.metadata,u=o.contentDispositionFilename,d=o.contentLength){e.next=14;break}return e.next=11,t.getDownloadInfo();case 11:p=e.sent,h=p.length,d=h;case 14:return e.abrupt("return",s(s({},r),{},{baseURL:a,filesize:d,filename:u||(0,i.getPdfFilenameFromUrl)(n),metadata:null==c?void 0:c.getRaw(),authors:null==c?void 0:c.get("dc:creator"),numPages:t.numPages,URL:n}));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ready=(0,i.loadScript)(t,!0).then((function(){return window.pdfjsSandbox.QuickJSSandbox()}))}var t,n,a,o,s,r;return t=e,n=[{key:"createSandbox",value:(r=d(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ready;case 2:e.sent.create(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"dispatchEventInSandbox",value:(s=d(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ready;case 2:n=e.sent,setTimeout((function(){return n.dispatchEvent(t)}),0);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"destroySandbox",value:(o=d(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ready;case 2:e.sent.nukeSandbox();case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})}],n&&c(t.prototype,n),a&&c(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}()},2843:(e,t,n)=>{"use strict";var i=n(6555).addScriptSync,a=n(8792).Constants;i("".concat(a.PROTYLE_CDN,"/js/pdf/pdf.js?v=2.14.102"),"pdfjsScript"),e.exports=window["pdfjs-dist/build/pdf"]},9842:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PDFViewerApplication:()=>l.PDFViewerApplication,webViewerLoad:()=>u});var i,a,o,s,r=n(5e3),l=n(9444),c=n(1631);"undefined"!=typeof PDFJSDev&&PDFJSDev.eval("BUNDLE_VERSION"),"undefined"!=typeof PDFJSDev&&PDFJSDev.eval("BUNDLE_BUILD");(window.PDFViewerApplication=l.PDFViewerApplication,window.PDFViewerApplicationOptions=r.UZ,"undefined"!=typeof PDFJSDev&&PDFJSDev.test("CHROME"))&&(a=document.location.search.slice(1),o=/(^|&)file=([^&]*)/.exec(a),s="/"+(i=o?decodeURIComponent(o[2]):"")+location.hash,history.replaceState(history.state,"",s),top===window&&chrome.runtime.sendMessage("showPageAction"));function u(e,t,n,a){var o=new l.PDFViewerApplication(n);o.annoId=a;var s=function(e){var t=null;return"undefined"!=typeof PDFJSDev&&PDFJSDev.test("MOZCENTRAL")||(t={container:e.querySelector("#errorWrapper"),errorMessage:e.querySelector("#errorMessage"),closeButton:e.querySelector("#errorClose"),errorMoreInfo:e.querySelector("#errorMoreInfo"),moreInfoButton:e.querySelector("#errorShowMore"),lessInfoButton:e.querySelector("#errorShowLess")}),{appContainer:e,mainContainer:e.querySelector("#viewerContainer"),viewerContainer:e.querySelector("#viewer"),toolbar:{rectAnno:e.querySelector("#rectAnno"),container:e.querySelector("#toolbarViewer"),numPages:e.querySelector("#numPages"),pageNumber:e.querySelector("#pageNumber"),scaleSelect:e.querySelector("#scaleSelect"),customScaleOption:e.querySelector("#customScaleOption"),previous:e.querySelector("#previous"),next:e.querySelector("#next"),zoomIn:e.querySelector("#zoomIn"),zoomOut:e.querySelector("#zoomOut"),viewFind:e.querySelector("#viewFind"),openFile:e.querySelector("#openFile"),print:e.querySelector("#print"),presentationModeButton:e.querySelector("#presentationMode"),download:e.querySelector("#download"),viewBookmark:e.querySelector("#viewBookmark")},secondaryToolbar:{toolbar:e.querySelector("#secondaryToolbar"),toggleButton:e.querySelector("#secondaryToolbarToggle"),toolbarButtonContainer:e.querySelector("#secondaryToolbarButtonContainer"),presentationModeButton:e.querySelector("#secondaryPresentationMode"),openFileButton:e.querySelector("#secondaryOpenFile"),printButton:e.querySelector("#secondaryPrint"),downloadButton:e.querySelector("#secondaryDownload"),viewBookmarkButton:e.querySelector("#secondaryViewBookmark"),firstPageButton:e.querySelector("#firstPage"),lastPageButton:e.querySelector("#lastPage"),pageRotateCwButton:e.querySelector("#pageRotateCw"),pageRotateCcwButton:e.querySelector("#pageRotateCcw"),cursorSelectToolButton:e.querySelector("#cursorSelectTool"),cursorHandToolButton:e.querySelector("#cursorHandTool"),scrollPageButton:e.querySelector("#scrollPage"),scrollVerticalButton:e.querySelector("#scrollVertical"),scrollHorizontalButton:e.querySelector("#scrollHorizontal"),scrollWrappedButton:e.querySelector("#scrollWrapped"),spreadNoneButton:e.querySelector("#spreadNone"),spreadOddButton:e.querySelector("#spreadOdd"),spreadEvenButton:e.querySelector("#spreadEven"),documentPropertiesButton:e.querySelector("#documentProperties")},sidebar:{outerContainer:e.querySelector("#outerContainer"),viewerContainer:e.querySelector("#viewerContainer"),toggleButton:e.querySelector("#sidebarToggle"),thumbnailButton:e.querySelector("#viewThumbnail"),outlineButton:e.querySelector("#viewOutline"),attachmentsButton:e.querySelector("#viewAttachments"),layersButton:e.querySelector("#viewLayers"),thumbnailView:e.querySelector("#thumbnailView"),outlineView:e.querySelector("#outlineView"),attachmentsView:e.querySelector("#attachmentsView"),layersView:e.querySelector("#layersView"),outlineOptionsContainer:e.querySelector("#outlineOptionsContainer"),currentOutlineItemButton:e.querySelector("#currentOutlineItem")},sidebarResizer:{outerContainer:e.querySelector("#outerContainer"),resizer:e.querySelector("#sidebarResizer")},findBar:{bar:e.querySelector("#findbar"),toggleButton:e.querySelector("#viewFind"),findField:e.querySelector("#findInput"),highlightAllCheckbox:e.querySelector("#findHighlightAll"),caseSensitiveCheckbox:e.querySelector("#findMatchCase"),matchDiacriticsCheckbox:e.querySelector("#findMatchDiacritics"),entireWordCheckbox:e.querySelector("#findEntireWord"),findMsg:e.querySelector("#findMsg"),findResultsCount:e.querySelector("#findResultsCount"),findPreviousButton:e.querySelector("#findPrevious"),findNextButton:e.querySelector("#findNext")},passwordOverlay:{overlayName:"passwordOverlay",container:e.querySelector("#passwordOverlay"),label:e.querySelector("#passwordText"),input:e.querySelector("#password"),submitButton:e.querySelector("#passwordSubmit"),cancelButton:e.querySelector("#passwordCancel")},documentProperties:{overlayName:"documentPropertiesOverlay",container:e.querySelector("#documentPropertiesOverlay"),closeButton:e.querySelector("#documentPropertiesClose"),fields:{fileName:e.querySelector("#fileNameField"),fileSize:e.querySelector("#fileSizeField"),title:e.querySelector("#titleField"),author:e.querySelector("#authorField"),subject:e.querySelector("#subjectField"),keywords:e.querySelector("#keywordsField"),creationDate:e.querySelector("#creationDateField"),modificationDate:e.querySelector("#modificationDateField"),creator:e.querySelector("#creatorField"),producer:e.querySelector("#producerField"),version:e.querySelector("#versionField"),pageCount:e.querySelector("#pageCountField"),pageSize:e.querySelector("#pageSizeField"),linearized:e.querySelector("#linearizedField")}},errorWrapper:t,printContainer:e.querySelector("#printContainer"),openFileInputName:"fileInput",debuggerScriptPath:"./debugger.js"}}(t);if("undefined"!=typeof PDFJSDev&&PDFJSDev.test("PRODUCTION")){if("undefined"!=typeof PDFJSDev&&PDFJSDev.test("CHROME")&&r.UZ.set("defaultUrl",i),"undefined"!=typeof PDFJSDev&&PDFJSDev.test("GENERIC")){var u=document.createEvent("CustomEvent");u.initCustomEvent("webviewerloaded",!0,!0,{source:window});try{parent.document.dispatchEvent(u)}catch(e){console.error("webviewerloaded: ".concat(e)),document.dispatchEvent(u)}}}else s.file=e;return o.run(s),(0,c.xW)(e,t,a,o,s),o}document.blockUnblockOnload&&document.blockUnblockOnload(!0)},8970:function(e,t,n){var i;!function(a){"use strict";function o(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function s(e,t,n,i,a,s){return o((r=o(o(t,e),o(i,s)))<<(l=a)|r>>>32-l,n);var r,l}function r(e,t,n,i,a,o,r){return s(t&n|~t&i,e,t,a,o,r)}function l(e,t,n,i,a,o,r){return s(t&i|n&~i,e,t,a,o,r)}function c(e,t,n,i,a,o,r){return s(t^n^i,e,t,a,o,r)}function u(e,t,n,i,a,o,r){return s(n^(t|~i),e,t,a,o,r)}function d(e,t){var n,i,a,s,d;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var p=1732584193,h=-271733879,f=-1732584194,g=271733878;for(n=0;n<e.length;n+=16)i=p,a=h,s=f,d=g,p=r(p,h,f,g,e[n],7,-680876936),g=r(g,p,h,f,e[n+1],12,-389564586),f=r(f,g,p,h,e[n+2],17,606105819),h=r(h,f,g,p,e[n+3],22,-1044525330),p=r(p,h,f,g,e[n+4],7,-176418897),g=r(g,p,h,f,e[n+5],12,1200080426),f=r(f,g,p,h,e[n+6],17,-1473231341),h=r(h,f,g,p,e[n+7],22,-45705983),p=r(p,h,f,g,e[n+8],7,1770035416),g=r(g,p,h,f,e[n+9],12,-1958414417),f=r(f,g,p,h,e[n+10],17,-42063),h=r(h,f,g,p,e[n+11],22,-1990404162),p=r(p,h,f,g,e[n+12],7,1804603682),g=r(g,p,h,f,e[n+13],12,-40341101),f=r(f,g,p,h,e[n+14],17,-1502002290),p=l(p,h=r(h,f,g,p,e[n+15],22,1236535329),f,g,e[n+1],5,-165796510),g=l(g,p,h,f,e[n+6],9,-1069501632),f=l(f,g,p,h,e[n+11],14,643717713),h=l(h,f,g,p,e[n],20,-373897302),p=l(p,h,f,g,e[n+5],5,-701558691),g=l(g,p,h,f,e[n+10],9,38016083),f=l(f,g,p,h,e[n+15],14,-660478335),h=l(h,f,g,p,e[n+4],20,-405537848),p=l(p,h,f,g,e[n+9],5,568446438),g=l(g,p,h,f,e[n+14],9,-1019803690),f=l(f,g,p,h,e[n+3],14,-187363961),h=l(h,f,g,p,e[n+8],20,1163531501),p=l(p,h,f,g,e[n+13],5,-1444681467),g=l(g,p,h,f,e[n+2],9,-51403784),f=l(f,g,p,h,e[n+7],14,1735328473),p=c(p,h=l(h,f,g,p,e[n+12],20,-1926607734),f,g,e[n+5],4,-378558),g=c(g,p,h,f,e[n+8],11,-2022574463),f=c(f,g,p,h,e[n+11],16,1839030562),h=c(h,f,g,p,e[n+14],23,-35309556),p=c(p,h,f,g,e[n+1],4,-1530992060),g=c(g,p,h,f,e[n+4],11,1272893353),f=c(f,g,p,h,e[n+7],16,-155497632),h=c(h,f,g,p,e[n+10],23,-1094730640),p=c(p,h,f,g,e[n+13],4,681279174),g=c(g,p,h,f,e[n],11,-358537222),f=c(f,g,p,h,e[n+3],16,-722521979),h=c(h,f,g,p,e[n+6],23,76029189),p=c(p,h,f,g,e[n+9],4,-640364487),g=c(g,p,h,f,e[n+12],11,-421815835),f=c(f,g,p,h,e[n+15],16,530742520),p=u(p,h=c(h,f,g,p,e[n+2],23,-995338651),f,g,e[n],6,-198630844),g=u(g,p,h,f,e[n+7],10,1126891415),f=u(f,g,p,h,e[n+14],15,-1416354905),h=u(h,f,g,p,e[n+5],21,-57434055),p=u(p,h,f,g,e[n+12],6,1700485571),g=u(g,p,h,f,e[n+3],10,-1894986606),f=u(f,g,p,h,e[n+10],15,-1051523),h=u(h,f,g,p,e[n+1],21,-2054922799),p=u(p,h,f,g,e[n+8],6,1873313359),g=u(g,p,h,f,e[n+15],10,-30611744),f=u(f,g,p,h,e[n+6],15,-1560198380),h=u(h,f,g,p,e[n+13],21,1309151649),p=u(p,h,f,g,e[n+4],6,-145523070),g=u(g,p,h,f,e[n+11],10,-1120210379),f=u(f,g,p,h,e[n+2],15,718787259),h=u(h,f,g,p,e[n+9],21,-343485551),p=o(p,i),h=o(h,a),f=o(f,s),g=o(g,d);return[p,h,f,g]}function p(e){var t,n="",i=32*e.length;for(t=0;t<i;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function h(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function f(e){var t,n,i="0123456789abcdef",a="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),a+=i.charAt(t>>>4&15)+i.charAt(15&t);return a}function g(e){return unescape(encodeURIComponent(e))}function m(e){return function(e){return p(d(h(e),8*e.length))}(g(e))}function y(e,t){return function(e,t){var n,i,a=h(e),o=[],s=[];for(o[15]=s[15]=void 0,a.length>16&&(a=d(a,8*e.length)),n=0;n<16;n+=1)o[n]=909522486^a[n],s[n]=1549556828^a[n];return i=d(o.concat(h(t)),512+8*t.length),p(d(s.concat(i),640))}(g(e),g(t))}function b(e,t,n){return t?n?y(t,e):f(y(t,e)):n?m(e):f(m(e))}void 0===(i=function(){return b}.call(t,n,t,e))||(e.exports=i)}()},5680:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,i="millisecond",a="second",o="minute",s="hour",r="day",l="week",c="month",u="quarter",d="year",p="date",h="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},y=function(e,t,n){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(n)+e},b={s:y,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),i=Math.floor(n/60),a=n%60;return(t<=0?"+":"-")+y(i,2,"0")+":"+y(a,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var i=12*(n.year()-t.year())+(n.month()-t.month()),a=t.clone().add(i,c),o=n-a<0,s=t.clone().add(i+(o?-1:1),c);return+(-(i+(n-a)/(o?a-s:s-a))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:d,w:l,d:r,D:p,h:s,m:o,s:a,ms:i,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},v="en",w={};w[v]=m;var _=function(e){return e instanceof D},E=function e(t,n,i){var a;if(!t)return v;if("string"==typeof t){var o=t.toLowerCase();w[o]&&(a=o),n&&(w[o]=n,a=o);var s=t.split("-");if(!a&&s.length>1)return e(s[0])}else{var r=t.name;w[r]=t,a=r}return!i&&a&&(v=a),a||!i&&v},k=function(e,t){if(_(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new D(n)},C=b;C.l=E,C.i=_,C.w=function(e,t){return k(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var D=function(){function m(e){this.$L=E(e.locale,null,!0),this.parse(e)}var y=m.prototype;return y.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(C.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(f);if(i){var a=i[2]-1||0,o=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],a,i[3]||1,i[4]||0,i[5]||0,i[6]||0,o)):new Date(i[1],a,i[3]||1,i[4]||0,i[5]||0,i[6]||0,o)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},y.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},y.$utils=function(){return C},y.isValid=function(){return!(this.$d.toString()===h)},y.isSame=function(e,t){var n=k(e);return this.startOf(t)<=n&&n<=this.endOf(t)},y.isAfter=function(e,t){return k(e)<this.startOf(t)},y.isBefore=function(e,t){return this.endOf(t)<k(e)},y.$g=function(e,t,n){return C.u(e)?this[t]:this.set(n,e)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(e,t){var n=this,i=!!C.u(t)||t,u=C.p(e),h=function(e,t){var a=C.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return i?a:a.endOf(r)},f=function(e,t){return C.w(n.toDate()[e].apply(n.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},g=this.$W,m=this.$M,y=this.$D,b="set"+(this.$u?"UTC":"");switch(u){case d:return i?h(1,0):h(31,11);case c:return i?h(1,m):h(0,m+1);case l:var v=this.$locale().weekStart||0,w=(g<v?g+7:g)-v;return h(i?y-w:y+(6-w),m);case r:case p:return f(b+"Hours",0);case s:return f(b+"Minutes",1);case o:return f(b+"Seconds",2);case a:return f(b+"Milliseconds",3);default:return this.clone()}},y.endOf=function(e){return this.startOf(e,!1)},y.$set=function(e,t){var n,l=C.p(e),u="set"+(this.$u?"UTC":""),h=(n={},n[r]=u+"Date",n[p]=u+"Date",n[c]=u+"Month",n[d]=u+"FullYear",n[s]=u+"Hours",n[o]=u+"Minutes",n[a]=u+"Seconds",n[i]=u+"Milliseconds",n)[l],f=l===r?this.$D+(t-this.$W):t;if(l===c||l===d){var g=this.clone().set(p,1);g.$d[h](f),g.init(),this.$d=g.set(p,Math.min(this.$D,g.daysInMonth())).$d}else h&&this.$d[h](f);return this.init(),this},y.set=function(e,t){return this.clone().$set(e,t)},y.get=function(e){return this[C.p(e)]()},y.add=function(i,u){var p,h=this;i=Number(i);var f=C.p(u),g=function(e){var t=k(h);return C.w(t.date(t.date()+Math.round(e*i)),h)};if(f===c)return this.set(c,this.$M+i);if(f===d)return this.set(d,this.$y+i);if(f===r)return g(1);if(f===l)return g(7);var m=(p={},p[o]=t,p[s]=n,p[a]=e,p)[f]||1,y=this.$d.getTime()+i*m;return C.w(y,this)},y.subtract=function(e,t){return this.add(-1*e,t)},y.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var i=e||"YYYY-MM-DDTHH:mm:ssZ",a=C.z(this),o=this.$H,s=this.$m,r=this.$M,l=n.weekdays,c=n.months,u=function(e,n,a,o){return e&&(e[n]||e(t,i))||a[n].slice(0,o)},d=function(e){return C.s(o%12||12,e,"0")},p=n.meridiem||function(e,t,n){var i=e<12?"AM":"PM";return n?i.toLowerCase():i},f={YY:String(this.$y).slice(-2),YYYY:this.$y,M:r+1,MM:C.s(r+1,2,"0"),MMM:u(n.monthsShort,r,c,3),MMMM:u(c,r),D:this.$D,DD:C.s(this.$D,2,"0"),d:String(this.$W),dd:u(n.weekdaysMin,this.$W,l,2),ddd:u(n.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(o),HH:C.s(o,2,"0"),h:d(1),hh:d(2),a:p(o,s,!0),A:p(o,s,!1),m:String(s),mm:C.s(s,2,"0"),s:String(this.$s),ss:C.s(this.$s,2,"0"),SSS:C.s(this.$ms,3,"0"),Z:a};return i.replace(g,(function(e,t){return t||f[e]||a.replace(":","")}))},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(i,p,h){var f,g=C.p(p),m=k(i),y=(m.utcOffset()-this.utcOffset())*t,b=this-m,v=C.m(this,m);return v=(f={},f[d]=v/12,f[c]=v,f[u]=v/3,f[l]=(b-y)/6048e5,f[r]=(b-y)/864e5,f[s]=b/n,f[o]=b/t,f[a]=b/e,f)[g]||b,h?v:C.a(v)},y.daysInMonth=function(){return this.endOf(c).$D},y.$locale=function(){return w[this.$L]},y.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),i=E(e,t,!0);return i&&(n.$L=i),n},y.clone=function(){return C.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},m}(),x=D.prototype;return k.prototype=x,[["$ms",i],["$s",a],["$m",o],["$H",s],["$W",r],["$M",c],["$y",d],["$D",p]].forEach((function(e){x[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),k.extend=function(e,t){return e.$i||(e(t,D,k),e.$i=!0),k},k.locale=E,k.isDayjs=_,k.unix=function(e){return k(1e3*e)},k.en=w[v],k.Ls=w,k.p={},k}()},8456:(e,t,n)=>{"use strict";n.r(t)},2005:e=>{"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var n,i="",a=0,o=-1,s=0,r=0;r<=e.length;++r){if(r<e.length)n=e.charCodeAt(r);else{if(47===n)break;n=47}if(47===n){if(o===r-1||1===s);else if(o!==r-1&&2===s){if(i.length<2||2!==a||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){var l=i.lastIndexOf("/");if(l!==i.length-1){-1===l?(i="",a=0):a=(i=i.slice(0,l)).length-1-i.lastIndexOf("/"),o=r,s=0;continue}}else if(2===i.length||1===i.length){i="",a=0,o=r,s=0;continue}t&&(i.length>0?i+="/..":i="..",a=2)}else i.length>0?i+="/"+e.slice(o+1,r):i=e.slice(o+1,r),a=r-o-1;o=r,s=0}else 46===n&&-1!==s?++s:s=-1}return i}var i={resolve:function(){for(var e,i="",a=!1,o=arguments.length-1;o>=-1&&!a;o--){var s;o>=0?s=arguments[o]:(void 0===e&&(e=process.cwd()),s=e),t(s),0!==s.length&&(i=s+"/"+i,a=47===s.charCodeAt(0))}return i=n(i,!a),a?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(e){if(t(e),0===e.length)return".";var i=47===e.charCodeAt(0),a=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!i)).length||i||(e="."),e.length>0&&a&&(e+="/"),i?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var a=arguments[n];t(a),a.length>0&&(void 0===e?e=a:e+="/"+a)}return void 0===e?".":i.normalize(e)},relative:function(e,n){if(t(e),t(n),e===n)return"";if((e=i.resolve(e))===(n=i.resolve(n)))return"";for(var a=1;a<e.length&&47===e.charCodeAt(a);++a);for(var o=e.length,s=o-a,r=1;r<n.length&&47===n.charCodeAt(r);++r);for(var l=n.length-r,c=s<l?s:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(47===n.charCodeAt(r+d))return n.slice(r+d+1);if(0===d)return n.slice(r+d)}else s>c&&(47===e.charCodeAt(a+d)?u=d:0===d&&(u=0));break}var p=e.charCodeAt(a+d);if(p!==n.charCodeAt(r+d))break;47===p&&(u=d)}var h="";for(d=a+u+1;d<=o;++d)d!==o&&47!==e.charCodeAt(d)||(0===h.length?h+="..":h+="/..");return h.length>0?h+n.slice(r+u):(r+=u,47===n.charCodeAt(r)&&++r,n.slice(r))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var n=e.charCodeAt(0),i=47===n,a=-1,o=!0,s=e.length-1;s>=1;--s)if(47===(n=e.charCodeAt(s))){if(!o){a=s;break}}else o=!1;return-1===a?i?"/":".":i&&1===a?"//":e.slice(0,a)},basename:function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');t(e);var i,a=0,o=-1,s=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var r=n.length-1,l=-1;for(i=e.length-1;i>=0;--i){var c=e.charCodeAt(i);if(47===c){if(!s){a=i+1;break}}else-1===l&&(s=!1,l=i+1),r>=0&&(c===n.charCodeAt(r)?-1==--r&&(o=i):(r=-1,o=l))}return a===o?o=l:-1===o&&(o=e.length),e.slice(a,o)}for(i=e.length-1;i>=0;--i)if(47===e.charCodeAt(i)){if(!s){a=i+1;break}}else-1===o&&(s=!1,o=i+1);return-1===o?"":e.slice(a,o)},extname:function(e){t(e);for(var n=-1,i=0,a=-1,o=!0,s=0,r=e.length-1;r>=0;--r){var l=e.charCodeAt(r);if(47!==l)-1===a&&(o=!1,a=r+1),46===l?-1===n?n=r:1!==s&&(s=1):-1!==n&&(s=-1);else if(!o){i=r+1;break}}return-1===n||-1===a||0===s||1===s&&n===a-1&&n===i+1?"":e.slice(n,a)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,i=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+i:n+e+i:i}("/",e)},parse:function(e){t(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var i,a=e.charCodeAt(0),o=47===a;o?(n.root="/",i=1):i=0;for(var s=-1,r=0,l=-1,c=!0,u=e.length-1,d=0;u>=i;--u)if(47!==(a=e.charCodeAt(u)))-1===l&&(c=!1,l=u+1),46===a?-1===s?s=u:1!==d&&(d=1):-1!==s&&(d=-1);else if(!c){r=u+1;break}return-1===s||-1===l||0===d||1===d&&s===l-1&&s===r+1?-1!==l&&(n.base=n.name=0===r&&o?e.slice(1,l):e.slice(r,l)):(0===r&&o?(n.name=e.slice(1,s),n.base=e.slice(1,l)):(n.name=e.slice(r,s),n.base=e.slice(r,l)),n.ext=e.slice(s,l)),r>0?n.dir=e.slice(0,r-1):o&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};i.posix=i,e.exports=i},1631:(e,t,n)=>{"use strict";t.Py=t.L_=t.Tk=t.xW=void 0;const i=n(734),a=n(6224),o=n(3607),s=n(5680),r=n(7954),l=n(2892),c=n(4640);t.xW=(e,t,n,i,s)=>(_(i),((e,t,n)=>{const i=e.toolbar.rectAnno;i.addEventListener("click",(()=>{i.classList.contains("toggled")?(i.classList.remove("toggled"),e.mainContainer.classList.remove("rect-to-annotation")):(t.pdfCursorTools.switchTool(0),i.classList.add("toggled"),e.mainContainer.classList.add("rect-to-annotation"),getSelection().rangeCount>0&&getSelection().getRangeAt(0).collapse(!0),p(n))}));const o=e.mainContainer.lastElementChild;e.mainContainer.addEventListener("mousedown",(s=>{if(2===s.button||!i.classList.contains("toggled"))return;const r=t.pdfViewer._getCurrentVisiblePage().first.view.canvas.getBoundingClientRect(),l=e.mainContainer.getBoundingClientRect(),c=r.left,u=r.right,d=l.bottom;let p=s.clientX;s.clientX>u?p=u:s.clientX<c&&(p=c);const f=l.top,g=s.clientY,m=document;m.onmousemove=e=>{o.classList.remove("fn__none");let t=0,n=0,i=0,a=0;e.clientX<p?(n=e.clientX<c?c:e.clientX,i=p-n):e.clientX>u?(n=p,i=u-n):(n=p,i=e.clientX-p),e.clientY>g?e.clientY>d?(t=g,a=d-g):(t=g,a=e.clientY-g):(t=e.clientY<f?f:e.clientY,a=g-t),o.setAttribute("style",`top:${t}px;height:${a}px;left:${n}px;width:${i}px;`)},m.onmouseup=()=>{m.onmousemove=null,m.onmouseup=null,m.ondragstart=null,m.onselectstart=null,m.onselect=null,i.classList.remove("toggled"),e.mainContainer.classList.remove("rect-to-annotation"),o.setAttribute("data-render","true");const t=n.querySelector(".pdf__util");t.classList.remove("pdf__util--hide","fn__none");const s=o.getBoundingClientRect();(0,a.setPosition)(t,s.left,s.top+s.height+4),h=null,n.querySelector(".pdf__util").classList.add("pdf__util--hide")}}))})(s,i,t),t.addEventListener("click",(e=>{let n=!1,a=e.target;for(;a&&!a.classList.contains("pdf__outer");){const o=a.getAttribute("data-type");if(a.classList.contains("b3-color__square")){const o=a.style.backgroundColor;if(h)d(i,o);else{let e;s.mainContainer.lastElementChild.classList.contains("fn__none")?e=y(i,o):(e=g(i,o,s.mainContainer.lastElementChild),s.mainContainer.lastElementChild.classList.add("fn__none")),e&&e.forEach((e=>{b(e,i)}))}p(t),n=!0,e.preventDefault(),e.stopPropagation();break}if(a.classList.contains("pdf__rect")){f(t,void 0,a),s.mainContainer.lastElementChild.classList.add("fn__none"),e.preventDefault(),e.stopPropagation(),n=!0;break}if("remove"===o){w(i,h.getAttribute("data-node-id")),p(t),e.preventDefault(),e.stopPropagation(),n=!0;break}if("copy"===o){(0,r.writeText)(`<<${i.appConfig.file.replace(location.origin,"").substr(1)}/${h.getAttribute("data-node-id")} "${h.getAttribute("data-content")}">>`),p(t),e.preventDefault(),e.stopPropagation(),n=!0;break}if("toggle"===o){u(i),e.preventDefault(),e.stopPropagation(),n=!0,p(t);break}a=a.parentElement}n||setTimeout((()=>{const n=!s.mainContainer.lastElementChild.classList.contains("fn__none");let i=!1;const a=window.getSelection();if(a.rangeCount>0){const e=a.getRangeAt(0);""!==e.toString()&&(0,o.hasClosestByClassName)(e.commonAncestorContainer,"pdfViewer")&&(n?e.collapse(!0):(f(t,e),i=!0))}i||(n?((0,o.hasClosestByClassName)(e.target,"pdf__util")||(0,o.hasClosestByClassName)(e.target,"pdf__resize")||"true"===s.mainContainer.lastElementChild.getAttribute("data-render")||(p(t),s.mainContainer.lastElementChild.classList.add("fn__none")),s.mainContainer.lastElementChild.removeAttribute("data-render")):p(t))}))})),i);const u=e=>{const t=_(e),n=t[h.getAttribute("data-node-id")];"border"===n.type?n.type="text":n.type="border",Array.from(h.children).forEach((e=>{"text"===n.type?e.style.backgroundColor=e.style.border.replace("2px solid ",""):e.style.backgroundColor=""})),(0,i.fetchPost)("/api/asset/setFileAnnotation",{path:e.appConfig.file.replace(location.origin,"").substr(1)+".sya",data:JSON.stringify(t)})},d=(e,t)=>{const n=_(e),a=n[h.getAttribute("data-node-id")];a.color=t,Array.from(h.children).forEach((e=>{e.style.border="2px solid "+t,"text"===a.type?e.style.backgroundColor=t:e.style.backgroundColor="transparent"})),(0,i.fetchPost)("/api/asset/setFileAnnotation",{path:e.appConfig.file.replace(location.origin,"").substr(1)+".sya",data:JSON.stringify(n)})},p=e=>{e.querySelector(".pdf__util").classList.add("fn__none")};let h;const f=(e,t,n)=>{n&&(n.setAttribute("prevent-popover","true"),setTimeout((()=>{n.removeAttribute("prevent-popover")}),620));const i=e.querySelector(".pdf__util");if(i.classList.remove("fn__none"),t){i.classList.add("pdf__util--hide");const e=t.getClientRects(),n=e[e.length-1];return(0,a.setPosition)(i,n.left,n.bottom),void(h=null)}h=n,i.classList.remove("pdf__util--hide");const o=n.firstElementChild.getBoundingClientRect();(0,a.setPosition)(i,o.left,o.top+o.height+4)},g=(e,t,n)=>{const i=n.getBoundingClientRect(),a=(0,o.hasClosestByClassName)(document.elementFromPoint(i.left,i.top-1),"page");if(!a)return;const r=parseInt(a.getAttribute("data-page-number"))-1,l=e.pdfViewer.getPageView(r),c=l.canvas.getClientRects()[0],u=l.viewport,d=u.convertToPdfPoint(i.left-c.x,i.top-c.y).concat(u.convertToPdfPoint(i.right-c.x,i.bottom-c.y)),p=[{index:l.id-1,positions:[d]}],h=Lute.NewNodeID(),f=e.appConfig.file.replace(location.origin,"").substr(8).replace(/-\d{14}-\w{7}.pdf$/,"")+`-P${l.id}-${s().format("YYYYMMDDHHmmss")}`,g=[{index:l.id-1,coords:[d],id:h,color:t,content:f,type:"border"}];let m=document.elementFromPoint(i.right,i.bottom+1);if(m=(0,o.hasClosestByClassName)(m,"page"),m){const n=parseInt(m.getAttribute("data-page-number"))-1;if(n!==r){const a=e.pdfViewer.getPageView(n),o=a.canvas.getClientRects()[0],s=a.viewport,r=s.convertToPdfPoint(i.left-o.x,i.top-o.y).concat(s.convertToPdfPoint(i.right-o.x,i.bottom-o.y));p.push({index:a.id-1,positions:[r]}),g.push({index:a.id-1,coords:[r],id:h,color:t,content:f,type:"border"})}}return v(e,h,{pages:p,content:f,color:t,type:"border"}),g},m=e=>{const t=e.getClientRects(),n=[];let i;return Array.from(t).forEach((e=>{0!==e.height&&0!==e.width&&(void 0===i||Math.abs(i-e.top)>4?(n.push({left:e.left,top:e.top,right:e.right,bottom:e.bottom}),i=e.top):n[n.length-1].right=e.right)})),n},y=(e,t)=>{const n=window.getSelection().getRangeAt(0),i=(0,o.hasClosestByClassName)(n.startContainer,"page");if(!i)return;const a=parseInt(i.getAttribute("data-page-number"))-1,s=(0,o.hasClosestByClassName)(n.endContainer,"page");if(!s)return;const r=parseInt(s.getAttribute("data-page-number"))-1,l=n.cloneContents();Array.from(l.children).forEach((e=>{if("BR"===e.tagName){const t=e.previousElementSibling.textContent,n=e.nextElementSibling.textContent;t.endsWith("-")&&/^[A-Za-z]$/.test(t.substring(t.length-2,t.length-1))&&/^[A-Za-z]$/.test(n.substring(0,1))?e.previousElementSibling.textContent=t.substring(0,t.length-1):e.insertAdjacentText("afterend"," ")}}));const u=Lute.EscapeHTMLStr(l.textContent),d=e.pdfViewer.getPageView(a),p=d.canvas.getClientRects()[0],h=d.viewport,f=n.cloneRange();if(a!==r){const e=d.textLayer.textDivs;n.setEndAfter(e[e.length-1])}const g=[];m(n).forEach((function(e){g.push(h.convertToPdfPoint(e.left-p.x,e.top-p.y).concat(h.convertToPdfPoint(e.right-p.x,e.bottom-p.y)))}));const y=[];if(a!==r){(0,c.focusByRange)(f);const t=e.pdfViewer.getPageView(r),n=t.canvas.getClientRects()[0],i=t.viewport,a=t.textLayer.textDivs;f.setStart(a[0],0),m(f).forEach((function(e){y.push(i.convertToPdfPoint(e.left-n.x,e.top-n.y).concat(i.convertToPdfPoint(e.right-n.x,e.bottom-n.y)))}))}const b=Lute.NewNodeID(),w=[],_=[];return g.length>0&&(w.push({index:a,positions:g}),_.push({index:a,coords:g,id:b,color:t,content:u,type:"text"})),y.length>0&&(w.push({index:r,positions:y}),_.push({index:r,coords:y,id:b,color:t,content:u,type:"text"})),0!==w.length?(v(e,b,{pages:w,content:u,color:t,type:"text"}),_):void 0};t.Tk=e=>{let t;return(0,l.getAllModels)().asset.find((n=>{if(n.pdfObject&&e&&n.element&&void 0!==n.element.contains&&n.element.contains(e))return t=n.pdfObject,!0})),t};t.L_=e=>{const n=(0,t.Tk)(e);if(!n)return;const i=parseInt(e.parentElement.getAttribute("data-page-number"))-1,a=_(n);Object.keys(a).find((e=>{const t=a[e],o=t.pages.find((e=>{if(e.index===i)return!0}));o&&b({index:i,coords:o.positions,id:e,color:t.color,content:t.content,type:t.type},n,n.annoId===e)}))};const b=(e,n,i)=>{const a=e.index,o=n.pdfViewer.getPageView(a);let s=o.textLayer.textLayerDiv;if(!s.lastElementChild)return;const r=o.viewport;s.lastElementChild.classList.contains("endOfContent")&&s.insertAdjacentHTML("beforeend","<div></div>"),s=s.lastElementChild;let l=`<div class="pdf__rect popover__block" data-node-id="${e.id}">`;e.coords.forEach((t=>{const n=r.convertToViewportRectangle(t),i=Math.abs(n[0]-n[2]);if(i<=0)return;let a=`border: 2px solid ${e.color};background-color: ${e.color};`;"border"===e.type&&(a=`border: 2px solid ${e.color};`),l+=`<div style="${a}\n        left:${Math.min(n[0],n[2])}px;\n        top:${Math.min(n[1],n[3])}px;\n        width:${i}px;\n        height: ${Math.abs(n[1]-n[3])}px"></div>`})),s.insertAdjacentHTML("beforeend",l+"</div>"),s.lastElementChild.setAttribute("data-content",e.content),i&&(0,t.Py)(s,e.id)};t.Py=(e,t)=>{const n=e.querySelector(`.pdf__rect[data-node-id="${t}"]`);if(n&&n.firstElementChild){const e=(0,o.hasClosestByAttribute)(n,"id","viewerContainer");if(e){const t=n.firstElementChild.getBoundingClientRect(),i=e.getBoundingClientRect();t.top<i.top?e.scrollTop=e.scrollTop-(i.top-t.top)-(i.height-t.height)/2:t.bottom>i.bottom&&(e.scrollTop=e.scrollTop+(t.bottom-i.bottom)+(i.height-t.height)/2)}n.classList.add("pdf__rect--hl"),setTimeout((()=>{n.classList.remove("pdf__rect--hl")}),1500)}};const v=(e,t,n)=>{const a=e.appConfig.file.replace(location.origin,"").substr(1),o=_(e);o[t]=n,(0,i.fetchPost)("/api/asset/setFileAnnotation",{path:a+".sya",data:JSON.stringify(o)},(()=>{(0,r.writeText)(`<<${a}/${t} "${n.content}">>`)}))},w=(e,t)=>{const n=e.appConfig.file.replace(location.origin,"").substr(1),a=_(e);delete a[t],h.remove(),(0,i.fetchPost)("/api/asset/setFileAnnotation",{path:n+".sya",data:JSON.stringify(a)})},_=e=>{if(e.appConfig.config)return e.appConfig.config;const t=e.appConfig.file.replace(location.origin,"").substr(1)+".sya";(0,i.fetchPost)("/api/asset/getFileAnnotation",{path:t},(t=>{let n={};1!==t.code&&(n=JSON.parse(t.data.data)),e.appConfig.config=n}))}},3319:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Asset=void 0;const i=n(7924),a=n(8792),o=n(3371),s=n(9842),r=n(9444),l=n(734);class c extends i.Model{constructor(e){super({id:e.tab.id,msgCallback(e){if(e&&"remove"===e.cmd)e.data.path===this.path&&this.parent.parent.removeTab(this.parent.id)}}),window.siyuan.config.fileTree.openFilesUseCurrentTab&&e.tab.headElement.classList.add("item--unupdate"),this.element=e.tab.panelElement,this.path=e.path,this.pdfId=e.page,this.element.addEventListener("click",(()=>{(0,o.setPanelFocus)(this.element.parentElement.parentElement)})),"string"!=typeof this.pdfId?("number"==typeof this.pdfId&&(this.pdfPage=this.pdfId),this.render()):this.getPdfId((()=>{this.render()}))}getPdfId(e){(0,l.fetchPost)("/api/asset/getFileAnnotation",{path:this.path+".sya"},(t=>{if(1!==t.code){const e=JSON.parse(t.data.data);e[this.pdfId]?this.pdfPage=e[this.pdfId].page?e[this.pdfId].page+1:e[this.pdfId].pages[0].index+1:this.pdfPage=void 0}e()}))}goToPage(e){void 0!==e&&(this.pdfId=e,"string"!=typeof e?(0,r.webViewerPageNumberChanged)({value:this.pdfId,pdfInstance:this.pdfObject}):this.getPdfId((()=>{(0,r.webViewerPageNumberChanged)({value:this.pdfPage,pdfInstance:this.pdfObject,id:this.pdfId})})))}render(){const e=this.path.substr(this.path.lastIndexOf(".")).toLowerCase();a.Constants.SIYUAN_ASSETS_IMAGE.includes(e)?this.element.innerHTML=`<div class="asset"><img src="${this.path.startsWith("file")?this.path:document.getElementById("baseURL").getAttribute("href")+"/"+this.path}"></div>`:a.Constants.SIYUAN_ASSETS_AUDIO.includes(e)?this.element.innerHTML=`<div class="asset"><audio controls="controls" src="${this.path.startsWith("file")?this.path:document.getElementById("baseURL").getAttribute("href")+"/"+this.path}"></audio></div>`:a.Constants.SIYUAN_ASSETS_VIDEO.includes(e)?this.element.innerHTML=`<div class="asset"><video controls="controls" src="${this.path.startsWith("file")?this.path:document.getElementById("baseURL").getAttribute("href")+"/"+this.path}"></video></div>`:".pdf"===e&&(this.element.innerHTML=`<div class="pdf__outer" id="outerContainer">\n      <div id="sidebarContainer">\n        <div id="toolbarSidebar">\n          <div id="toolbarSidebarLeft">\n              <button id="viewThumbnail" class="toolbarButton toggled b3-tooltips b3-tooltips__ne" tabindex="2" aria-label="${window.siyuan.languages.thumbsTitle}">\n                <svg><use xlink:href="#iconImage"></use></svg>\n              </button>\n              <button id="viewOutline" class="toolbarButton b3-tooltips b3-tooltips__ne" tabindex="3" aria-label="${window.siyuan.languages.outline}">\n                 <svg><use xlink:href="#iconAlignCenter"></use></svg>\n              </button>\n              <button id="viewAttachments" class="toolbarButton fn__none" tabindex="4" data-l10n-id="attachments">\n                 <span data-l10n-id="attachments_label">Attachments</span>\n              </button>\n              <button id="viewLayers" class="toolbarButton fn__none" tabindex="5" data-l10n-id="layers">\n                 <span data-l10n-id="layers_label">Layers</span>\n              </button>\n          </div>\n          <div class="fn__flex-1"></div>\n          <div id="toolbarSidebarRight">\n            <div id="outlineOptionsContainer" class="fn__hidden">\n              <button id="currentOutlineItem" class="toolbarButton b3-tooltips b3-tooltips__nw" disabled="disabled" tabindex="6" aria-label="${window.siyuan.languages.focusOutline}">\n                <svg><use xlink:href="#iconFocus"></use></svg>\n              </button>\n            </div>\n          </div>\n        </div>\n        <div id="sidebarContent">\n          <div id="thumbnailView">\n          </div>\n          <div id="outlineView" class="fn__hidden">\n          </div>\n          <div id="attachmentsView" class="fn__hidden">\n          </div>\n          <div id="layersView" class="fn__hidden">\n          </div>\n        </div>\n        <div id="sidebarResizer"></div>\n      </div>  \x3c!-- sidebarContainer --\x3e\n      <div id="mainContainer">\n        <div class="findbar b3-menu fn__hidden doorHanger" id="findbar">\n            <input id="findInput" class="toolbarField b3-text-field" placeholder="${window.siyuan.languages.search}" tabindex="91">\n            <div class="fn__space"></div>\n            <button id="findPrevious" class="toolbarButton findPrevious b3-tooltips b3-tooltips__n" tabindex="92" aria-label="${window.siyuan.languages.previous}">\n                <svg><use xlink:href="#iconUp"></use></svg>\n            </button>\n            <button id="findNext" class="toolbarButton findNext b3-tooltips b3-tooltips__n" tabindex="93" aria-label="${window.siyuan.languages.next}">\n                <svg><use xlink:href="#iconDown"></use></svg>\n            </button>\n            <label class="b3-button b3-button--outline b3-button--small">\n                <input type="checkbox" id="findHighlightAll" class="toolbarField" tabindex="94">\n                ${window.siyuan.languages.findHighlight}\n            </label>\n            <div class="fn__space"></div>\n            <label class="b3-button b3-button--outline b3-button--small">\n                <input type="checkbox" id="findMatchCase" class="toolbarField" tabindex="95">\n                ${window.siyuan.languages.searchCaseSensitive}\n            </label>\n            <div class="fn__space"></div>\n            <label class="b3-button b3-button--outline b3-button--small">\n                <input type="checkbox" id="findMatchDiacritics" class="toolbarField" tabindex="96">\n                ${window.siyuan.languages.matchDiacritics}\n            </label>\n            <div class="fn__space"></div>\n            <label class="b3-button b3-button--outline b3-button--small">\n                <input type="checkbox" id="findEntireWord" class="toolbarField" tabindex="97">\n                ${window.siyuan.languages.findEntireWord}\n            </label>\n            <div class="fn__space"></div>\n            <span id="findResultsCount" class="b3-button b3-button--small b3-button--cancel"></span>\n            <span id="findMsg" class="b3-button b3-button--small b3-button--cancel"></span>\n        </div>  \x3c!-- findbar --\x3e\n        <div id="secondaryToolbar" class="secondaryToolbar fn__hidden doorHangerRight b3-menu">\n          <div id="secondaryToolbarButtonContainer">\n            <button id="firstPage" class="secondaryToolbarButton b3-menu__item firstPage" tabindex="56">\n              <svg class="b3-menu__icon"><use xlink:href="#iconUp"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.firstPage}</span>\n            </button>\n            <button id="lastPage" class="secondaryToolbarButton b3-menu__item lastPage" tabindex="57">\n              <svg class="b3-menu__icon"><use xlink:href="#iconDown"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.lastPage}</span>\n            </button>\n\n            <div class="horizontalToolbarSeparator b3-menu__separator"></div>\n\n            <button id="pageRotateCw" class="secondaryToolbarButton b3-menu__item rotateCw" tabindex="58">\n               <svg class="b3-menu__icon"><use xlink:href="#iconRedo"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.rotateCw}</span>\n            </button>\n            <button id="pageRotateCcw" class="secondaryToolbarButton b3-menu__item rotateCcw" tabindex="59">\n               <svg class="b3-menu__icon"><use xlink:href="#iconUndo"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.rotateCcw}</span>\n            </button>\n\n            <div class="horizontalToolbarSeparator b3-menu__separator"></div>\n\n            <button id="cursorSelectTool" class="secondaryToolbarButton b3-menu__item selectTool toggled" tabindex="60">\n               <svg class="b3-menu__icon"><use xlink:href="#iconSelectText"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.cursorText}</span>\n            </button>\n            <button id="cursorHandTool" class="secondaryToolbarButton b3-menu__item handTool" tabindex="61">\n              <svg class="b3-menu__icon"><use xlink:href="#iconHand"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.cursorHand}</span>\n            </button>\n\n            <div class="horizontalToolbarSeparator b3-menu__separator"></div>\n\n            <button id="scrollVertical" class="secondaryToolbarButton b3-menu__item scrollModeButtons scrollVertical toggled" tabindex="62">\n             <svg class="b3-menu__icon"><use xlink:href="#iconSplitTB"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.scrollVertical}</span>\n            </button>\n            <button id="scrollHorizontal" class="secondaryToolbarButton b3-menu__item scrollModeButtons scrollHorizontal" tabindex="63">\n              <svg class="b3-menu__icon"><use xlink:href="#iconSplitLR"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.scrollHorizontal}</span>\n            </button>\n            <button id="scrollWrapped" class="secondaryToolbarButton b3-menu__item scrollModeButtons scrollWrapped" tabindex="64">\n             <svg class="b3-menu__icon"><use xlink:href="#iconScrollWrapped"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.scrollWrapped}</span>\n            </button>\n\n            <div class="horizontalToolbarSeparator b3-menu__separator scrollModeButtons"></div>\n\n            <button id="spreadNone" class="secondaryToolbarButton b3-menu__item spreadModeButtons spreadNone toggled" tabindex="65">\n              <svg class="b3-menu__icon"><use xlink:href="#iconFile"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.spreadNone}</span>\n            </button>\n            <button id="spreadOdd" class="secondaryToolbarButton b3-menu__item spreadModeButtons spreadOdd" tabindex="66">\n              <svg class="b3-menu__icon"><use xlink:href="#iconSpreadOdd"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.spreadOdd}</span>\n            </button>\n            <button id="spreadEven" class="secondaryToolbarButton b3-menu__item spreadModeButtons spreadEven" tabindex="67">\n              <svg class="b3-menu__icon"><use xlink:href="#iconSpreadEven"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.spreadEven}</span>\n            </button>\n            <div class="horizontalToolbarSeparator b3-menu__separator spreadModeButtons"></div>\n            <button id="documentProperties" class="secondaryToolbarButton b3-menu__item documentProperties" tabindex="68">\n              <svg class="b3-menu__icon"><use xlink:href="#iconInfo"></use></svg> \n              <span class="b3-menu__label">${window.siyuan.languages.attr}</span>\n            </button>\n          </div>\n        </div>  \x3c!-- secondaryToolbar --\x3e\n\n        <div class="pdf__toolbar">\n          <div id="toolbarContainer">\n            <div id="toolbarViewer">\n                <button id="sidebarToggle" class="toolbarButton b3-tooltips b3-tooltips__se" tabindex="11" aria-expanded="false" aria-controls="sidebarContainer" aria-label="${window.siyuan.languages.toggleSidebarNotification2Title}">\n                    <svg><use xlink:href="#iconBoth"></use></svg>\n                </button>\n                <button id="viewFind" class="toolbarButton b3-tooltips b3-tooltips__s" tabindex="12" aria-expanded="false" aria-controls="findbar" aria-label="${window.siyuan.languages.search}">\n                  <svg><use xlink:href="#iconSearch"></use></svg>\n                </button>\n                <button id="rectAnno" class="toolbarButton b3-tooltips b3-tooltips__s" tabindex="12" aria-expanded="false" aria-controls="findbar" aria-label="${window.siyuan.languages.rectAnnotation}">\n                  <svg><use xlink:href="#iconTopLeft"></use></svg>\n                </button>\n                <button class="toolbarButton pageUp b3-tooltips b3-tooltips__s" aria-label="${window.siyuan.languages.previousLabel}" id="previous" tabindex="13">\n                  <svg><use xlink:href="#iconUp"></use></svg>\n                </button>\n                <button class="toolbarButton pageDown b3-tooltips b3-tooltips__s" id="next" tabindex="14" aria-label="${window.siyuan.languages.nextLabel}">\n                  <svg><use xlink:href="#iconDown"></use></svg>\n                </button>\n                <input type="number" id="pageNumber" class="toolbarField pageNumber b3-text-field" value="1" size="4" min="1" tabindex="15" autocomplete="off">\n                <span id="numPages"></span>\n                <div class="fn__flex-1"></div>\n                <button id="zoomOut" class="toolbarButton zoomOut b3-tooltips b3-tooltips__sw" tabindex="21" aria-label="${window.siyuan.languages.zoomOut}">\n                  <svg><use xlink:href="#iconLine"></use></svg>\n                </button>\n                <button id="zoomIn" class="toolbarButton zoomIn b3-tooltips b3-tooltips__sw" tabindex="22" aria-label="${window.siyuan.languages.zoomIn}">\n                  <svg><use xlink:href="#iconAdd"></use></svg>\n                </button>\n                <span id="scaleSelectContainer" class="dropdownToolbarButton">\n                  <select id="scaleSelect" tabindex="23" class="b3-select">\n                    <option id="pageAutoOption" value="auto" selected="selected">${window.siyuan.languages.pageScaleAuto}</option>\n                    <option id="pageActualOption" value="page-actual">${window.siyuan.languages.pageScaleActual}</option>\n                    <option id="pageFitOption" value="page-fit">${window.siyuan.languages.pageScaleFit}</option>\n                    <option id="pageWidthOption" value="page-width">${window.siyuan.languages.pageScaleWidth}</option>\n                    <option id="customScaleOption" value="custom" disabled="disabled" hidden="true"></option>\n                    <option value="0.5">50%</option>\n                    <option value="0.75">75%</option>\n                    <option value="1">100%</option>\n                    <option value="1.25">125%</option>\n                    <option value="1.5">150%</option>\n                    <option value="2">200%</option>\n                    <option value="3">300%</option>\n                    <option value="4">400%</option>\n                  </select>\n                </span>\n                <button id="presentationMode" class="toolbarButton presentationMode b3-tooltips b3-tooltips__sw hiddenLargeView" tabindex="31" aria-label="${window.siyuan.languages.presentationMode}">\n                  <svg><use xlink:href="#iconPlay"></use></svg>\n                </button>\n                <span id="scrollPage" class="fn__none"></span>\n                <span id="viewBookmark" class="fn__none"></span>\n                <span id="secondaryViewBookmark" class="fn__none"></span>\n                <button id="secondaryToolbarToggle" class="toolbarButton b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.more}" tabindex="36" aria-expanded="false" aria-controls="secondaryToolbar">\n                  <svg><use xlink:href="#iconMore"></use></svg>\n                </button>\n            </div>\n            <div id="loadingBar">\n              <div class="progress">\n                <div class="glimmer">\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div id="viewerContainer" tabindex="0">\n          <div id="viewer" class="pdfViewer"></div>\n          <div class="pdf__resize fn__none"></div>\n        </div>\n        <div id="errorWrapper" hidden='true'>\n          <div id="errorMessageLeft">\n            <span id="errorMessage"></span>\n            <button id="errorShowMore" data-l10n-id="error_more_info">\n              More Information\n            </button>\n            <button id="errorShowLess" data-l10n-id="error_less_info" hidden='true'>\n              Less Information\n            </button>\n          </div>\n          <div id="errorMessageRight">\n            <button id="errorClose" data-l10n-id="error_close">\n              Close\n            </button>\n          </div>\n          <div class="clearBoth"></div>\n          <textarea id="errorMoreInfo" hidden='true' readonly="readonly"></textarea>\n        </div>\n      </div>\n      <div id="overlayContainer" class="fn__hidden">\n        <div id="passwordOverlay" class="container fn__hidden">\n          <div class="dialog">\n            <div class="row">\n              <p id="passwordText" data-l10n-id="password_label">Enter the password to open this PDF file:</p>\n            </div>\n            <div class="row">\n              <input type="password" id="password" class="toolbarField">\n            </div>\n            <div class="buttonRow">\n              <button id="passwordCancel" class="overlayButton"><span data-l10n-id="password_cancel">Cancel</span></button>\n              <button id="passwordSubmit" class="overlayButton"><span data-l10n-id="password_ok">OK</span></button>\n            </div>\n          </div>\n        </div>\n        <div id="documentPropertiesOverlay" class="container fn__hidden">\n          <div class="dialog b3-menu">\n            <div class="row">\n              <span>${window.siyuan.languages.fileName}</span> <p id="fileNameField">-</p>\n            </div>\n            <div class="row">\n              <span>${window.siyuan.languages.fileSize}</span> <p id="fileSizeField">-</p>\n            </div>\n            <div class="separator"></div>\n            <div class="row">\n              <span>${window.siyuan.languages.title1}</span> <p id="titleField">-</p>\n            </div>\n            <div class="row">\n              <span>${window.siyuan.languages.author}</span> <p id="authorField">-</p>\n            </div>\n            <div class="row">\n              <span>${window.siyuan.languages.subject}</span> <p id="subjectField">-</p>\n            </div>\n            <div class="row">\n              <span>${window.siyuan.languages.keywords}</span> <p id="keywordsField">-</p>\n            </div>\n            <div class="row">\n              <span>${window.siyuan.languages.creationDate}</span> <p id="creationDateField">-</p>\n            </div>\n            <div class="row">\n              <span>${window.siyuan.languages.modificationDate}</span> <p id="modificationDateField">-</p>\n            </div>\n            <div class="row">\n              <span>${window.siyuan.languages.creator}</span> <p id="creatorField">-</p>\n            </div>\n            <div class="separator"></div>\n            <div class="row">\n              <span>PDF ${window.siyuan.languages.producer}</span> <p id="producerField">-</p>\n            </div>\n            <div class="row">\n              <span>PDF ${window.siyuan.languages.version}</span> <p id="versionField">-</p>\n            </div>\n            <div class="row">\n              <span>${window.siyuan.languages.pageCount}</span> <p id="pageCountField">-</p>\n            </div>\n            <div class="row">\n              <span>${window.siyuan.languages.pageSize}</span> <p id="pageSizeField">-</p>\n            </div>\n            <div class="separator"></div>\n            <div class="row">\n              <span>${window.siyuan.languages.linearized}</span> <p id="linearizedField">-</p>\n            </div>\n            <div class="buttonRow">\n              <button id="documentPropertiesClose" class="b3-button"><span>${window.siyuan.languages.close}</span></button>\n            </div>\n          </div>\n        </div>\n        <div id="printServiceOverlay" class="container fn__hidden">\n          <div class="dialog">\n            <div class="row">\n              <span data-l10n-id="print_progress_message">Preparing document for printing…</span>\n            </div>\n            <div class="row">\n              <progress value="0" max="100"></progress>\n              <span data-l10n-id="print_progress_percent" data-l10n-args='{ "progress": 0 }' class="relative-progress">0%</span>\n            </div>\n            <div class="buttonRow">\n              <button id="printCancel" class="overlayButton"><span data-l10n-id="print_progress_close">Cancel</span></button>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="pdf__util b3-menu fn__none pdf__util--hide">\n        <div class="fn__flex" style="padding: 0 4px">\n            <button class="b3-color__square" style="background-color:var(--b3-pdf-background1)"></button>\n            <button class="b3-color__square" style="background-color:var(--b3-pdf-background2)"></button>\n            <button class="b3-color__square" style="background-color:var(--b3-pdf-background3)"></button>\n            <button class="b3-color__square" style="background-color:var(--b3-pdf-background4)"></button>\n            <button class="b3-color__square" style="background-color:var(--b3-pdf-background5)"></button>\n            <button class="b3-color__square" style="background-color:var(--b3-pdf-background6)"></button>\n            <button class="b3-color__square" style="background-color:var(--b3-pdf-background7)"></button>\n        </div>\n        <div class="b3-menu__separator pdf__util__hide" style="margin-top: 8px"></div>\n        <button class="b3-menu__item pdf__util__hide" data-type="toggle">\n            <svg class="b3-menu__icon"><use xlink:href="#iconFilesRoot"></use></svg>\n            <span class="b3-menu__label">${window.siyuan.languages.showHideBg}</span>\n        </button>\n        <button class="b3-menu__item pdf__util__hide" data-type="copy">\n            <svg class="b3-menu__icon"><use xlink:href="#iconGraph"></use></svg>\n            <span class="b3-menu__label">${window.siyuan.languages.copyAnnotation}</span>\n        </button>\n        <button class="b3-menu__item pdf__util__hide" data-type="remove">\n            <svg class="b3-menu__icon"><use xlink:href="#iconTrashcan"></use></svg>\n            <span class="b3-menu__label">${window.siyuan.languages.remove}</span>\n        </button>\n      </div>\n    </div> \x3c!-- outerContainer --\x3e\n    <div id="printContainer"></div>`,setTimeout((()=>{if(0===this.element.clientWidth){const e=new MutationObserver((()=>{this.pdfObject=(0,s.webViewerLoad)(this.path.startsWith("file")?this.path:document.getElementById("baseURL").getAttribute("href")+"/"+this.path,this.element,this.pdfPage,this.pdfId),e.disconnect()}));e.observe(this.element,{attributeFilter:["class"]})}else this.pdfObject=(0,s.webViewerLoad)(this.path.startsWith("file")?this.path:document.getElementById("baseURL").getAttribute("href")+"/"+this.path,this.element,this.pdfPage,this.pdfId)})))}}t.Asset=c},4382:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pdfResize=t.renderAssetsPreview=void 0;const i=n(8792),a=n(2892),o=n(8813);t.renderAssetsPreview=e=>{if(!e)return"";const t=(0,o.pathPosix)().extname(e).toLowerCase();return i.Constants.SIYUAN_ASSETS_IMAGE.includes(t)?`<img style="max-height: 100%" src="${e}">`:i.Constants.SIYUAN_ASSETS_AUDIO.includes(t)?`<audio style="max-width: 100%" controls="controls" src="${e}"></audio>`:i.Constants.SIYUAN_ASSETS_VIDEO.includes(t)?`<video style="max-width: 100%" controls="controls" src="${e}"></video>`:e};t.pdfResize=()=>{(0,a.getAllModels)().asset.forEach((e=>{const t=e.pdfObject;if(!t)return;const{pdfDocument:n,pdfViewer:i}=t;if(!n)return;const a=i.currentScaleValue;"auto"!==a&&"page-fit"!==a&&"page-width"!==a||(i.currentScaleValue=a),i.update()}))}},3110:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlockPanel=void 0;const i=n(3607),a=n(2009),o=n(8303),s=n(1384),r=n(6224),l=n(5378),c=n(8792),u=n(7010);t.BlockPanel=class{constructor(e){this.defIds=[],this.editors=[],this.id=(0,o.genUUID)(),this.stmt=e.stmt,this.targetElement=e.targetElement,this.nodeIds=e.nodeIds,this.defIds=e.defIds||[],this.esc=e.esc,this.element=document.createElement("div"),this.element.classList.add("block__popover","block__popover--move","block__popover--top");const t=(0,i.hasClosestByClassName)(this.targetElement,"block__popover",!0);let n=1;t?(this.element.setAttribute("data-oid",t.getAttribute("data-oid")),n=parseInt(t.getAttribute("data-level"))+1):this.element.setAttribute("data-oid",this.nodeIds[0]),this.element.setAttribute("data-level",n.toString());for(let e=0;e<window.siyuan.blockPanels.length;e++){const t=window.siyuan.blockPanels[e];"false"===t.element.getAttribute("data-pin")&&t.targetElement&&parseInt(t.element.getAttribute("data-level"))>=n&&(t.destroy(),e--)}document.body.insertAdjacentElement("beforeend",this.element),this.element.addEventListener("mousedown",(e=>{document.querySelectorAll(".block__popover--top").forEach((e=>{e.classList.remove("block__popover--top")})),this.element&&window.siyuan.blockPanels.length>1&&this.element.classList.add("block__popover--top");let t=(0,i.hasClosestByClassName)(e.target,"block__icons"),n="move",a=e.clientX-parseInt(this.element.style.left),o=e.clientY-parseInt(this.element.style.top);if(!(t||(a=e.clientX-this.element.clientWidth,o=e.clientY-this.element.clientHeight,t=(0,i.hasClosestByClassName)(e.target,"block__nwse"),n="nwse-resize",t||(t=(0,i.hasClosestByClassName)(e.target,"block__ns"),n="ns-resize",t||(t=(0,i.hasClosestByClassName)(e.target,"block__ew"),n="ew-resize",t)))))return;const r=document;this.element.style.userSelect="none",r.ondragstart=()=>!1,r.onmousemove=e=>{if(!this.element)return;let t=e.clientX-a,i=e.clientY-o;"move"===n?(t>window.innerWidth-this.element.clientWidth&&(t=window.innerWidth-this.element.clientWidth),i>window.innerHeight-this.element.clientHeight&&(i=window.innerHeight-this.element.clientHeight),this.element.style.left=Math.max(t,0)+"px",this.element.style.top=Math.max(i,c.Constants.SIZE_TOOLBAR_HEIGHT)+"px"):(t>200&&t<window.innerWidth&&("nwse-resize"===n||"ew-resize"===n)&&(this.element.style.width=t+"px"),i>65&&i<window.innerHeight-c.Constants.SIZE_TOOLBAR_HEIGHT&&("nwse-resize"===n||"ns-resize"===n)&&(this.element.style.height=i+"px",this.element.style.maxHeight=""))},r.onmouseup=()=>{this.element&&(window.siyuan.dragElement&&(window.siyuan.dragElement.style.opacity="",window.siyuan.dragElement=void 0),this.element.style.userSelect="auto",r.onmousemove=null,r.onmouseup=null,r.ondragstart=null,r.onselectstart=null,r.onselect=null,"move"!==n&&this.editors.forEach((e=>{(0,s.setPadding)(e.protyle)})))}})),this.targetElement.style.cursor="wait",this.element.setAttribute("data-pin","false"),this.element.addEventListener("dblclick",(e=>{const t=e.target,n=(0,i.hasClosestByClassName)(t,"block__icons");if(n){const t=n.querySelector('[data-type="pin"]');t.classList.contains("block__icon--active")?(t.classList.remove("block__icon--active"),t.setAttribute("aria-label",window.siyuan.languages.pin),this.element.setAttribute("data-pin","false")):(t.classList.add("block__icon--active"),t.setAttribute("aria-label",window.siyuan.languages.unpin),this.element.setAttribute("data-pin","true")),e.preventDefault(),e.stopPropagation()}})),this.element.addEventListener("click",(e=>{let t=e.target;for(;t&&!t.isEqualNode(this.element);){if(t.classList.contains("block__icon")||t.classList.contains("block__logo")){const n=t.getAttribute("data-type");"close"===n&&this.targetElement?this.destroy():"pin"===n&&(t.classList.contains("block__icon--active")?(t.classList.remove("block__icon--active"),t.setAttribute("aria-label",window.siyuan.languages.pin),this.element.setAttribute("data-pin","false")):(t.classList.add("block__icon--active"),t.setAttribute("aria-label",window.siyuan.languages.unpin),this.element.setAttribute("data-pin","true"))),e.preventDefault(),e.stopPropagation();break}t=t.parentElement}})),this.render()}initProtyle(e){const t=parseInt(e.getAttribute("data-index")),n=new a.default(e,{blockId:this.nodeIds[t],defId:this.defIds[t]||this.defIds[0]||"",action:[c.Constants.CB_GET_ALL],render:{gutter:!0,breadcrumbDocName:!0,breadcrumbContext:!0},typewriterMode:!1,after:t=>{window.siyuan.config.readonly&&(0,u.disabledProtyle)(t.protyle),e.addEventListener("mouseleave",(()=>{(0,l.hideElements)(["gutter"],t.protyle)}))}});this.editors.push(n)}destroy(){window.siyuan.blockPanels.find(((e,t)=>{if(e.id===this.id)return window.siyuan.blockPanels.splice(t,1),!0})),this.editors.length>0&&(this.editors.forEach((e=>{e.destroy()})),this.editors=[]),this.element.remove(),this.element=void 0,this.targetElement=void 0,window.siyuan.menus.menu.remove()}render(){if(!this.element.parentElement.parentElement)return void this.destroy();let e=`<div class="block__icons block__icons--border">\n    <span class="fn__space fn__flex-1"></span>\n    <span data-type="pin" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.pin}"><svg><use xlink:href="#iconPin"></use></svg></span>\n    <span class="fn__space"></span>\n    <span data-type="close" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.close}"><svg style="width: 10px"><use xlink:href="#iconClose"></use></svg></span>\n</div>\n<div class="block__content">`;0===this.nodeIds.length?e+=`<div class="ft__smaller ft__smaller ft__secondary b3-form__space--small" contenteditable="false">${window.siyuan.languages.refExpired}</div>`:this.nodeIds.forEach(((t,n)=>{e+=`<div class="block__edit fn__flex-1 protyle" data-index="${n}"></div>`})),e&&(e+='</div><div class="block__nwse"></div><div class="block__ew"></div><div class="block__ns"></div>'),this.element.innerHTML=e;const t=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&""===e.target.innerHTML&&this.initProtyle(e.target)}))}),{threshold:0});let n;if(this.element.querySelectorAll(".block__edit").forEach(((e,n)=>{n<5?this.initProtyle(e):t.observe(e)})),this.targetElement.style.cursor="",this.element.classList.add("block__popover--open"),this.targetElement.classList.contains("protyle-wysiwyg__embed")){n=this.targetElement.getBoundingClientRect();let e=n.top;const t=(0,i.hasClosestByClassName)(this.targetElement,"protyle-content",!0);if(t){const i=t.getBoundingClientRect().top;n.top<i&&(e=i)}(0,r.setPosition)(this.element,n.left,Math.max(e-84,c.Constants.SIZE_TOOLBAR_HEIGHT),0,8)}else n=this.targetElement.classList.contains("pdf__rect")?this.targetElement.firstElementChild.getBoundingClientRect():this.targetElement.getBoundingClientRect(),(0,r.setPosition)(this.element,n.left,n.top+n.height+4,n.height+12,8);const a=window.innerHeight-this.element.getBoundingClientRect().top-8+"px";this.element.style.maxHeight=a,this.nodeIds.length>1&&(this.element.style.height=a)}}},5473:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initBlockPopover=void 0;const a=n(3110),o=n(3607),s=n(734),r=n(5099);t.initBlockPopover=()=>{let e,t;document.addEventListener("mouseover",(n=>{const l=(0,o.hasClosestByAttribute)(n.target,"data-type","a",!0)||(0,o.hasClosestByAttribute)(n.target,"data-type","tab-header")||(0,o.hasClosestByClassName)(n.target,"emojis__item")||(0,o.hasClosestByClassName)(n.target,"emojis__type")||(0,o.hasClosestByAttribute)(n.target,"data-type","inline-memo");if(l){let e=l.getAttribute("aria-label")||l.getAttribute("data-inline-memo-content");if((0,o.hasClosestByAttribute)(n.target,"data-type","fold",!0)&&(e=window.siyuan.languages.fold),!e){e=l.getAttribute("data-href");const t=l.getAttribute("data-title");t&&(e+=" "+t)}if(e&&!e.startsWith("siyuan://blocks")&&!l.classList.contains("b3-tooltips"))return(0,r.showTooltip)(e,l),void n.stopPropagation()}else l||(0,r.hideTooltip)();clearTimeout(e),clearTimeout(t),t=window.setTimeout((()=>{var t;if((0,o.hasClosestByClassName)(n.target,"b3-menu")||n.target.id&&"svg"!==n.target.tagName&&(n.target.id.startsWith("minder_node")||n.target.id.startsWith("kity_")||n.target.id.startsWith("node_"))||n.target.classList.contains("counter")||"circle"===n.target.tagName)return;let i=(0,o.hasClosestByAttribute)(n.target,"data-type","block-ref")||(0,o.hasClosestByAttribute)(n.target,"data-type","virtual-block-ref");i&&i.classList.contains("protyle-toolbar")&&(i=void 0),i||(i=(0,o.hasClosestByClassName)(n.target,"popover__block"));const a=(0,o.hasClosestByAttribute)(n.target,"data-type","a",!0);if(!i&&a&&(null===(t=a.getAttribute("data-href"))||void 0===t?void 0:t.startsWith("siyuan://blocks"))&&(i=a),!i){const e=(0,o.hasClosestByClassName)(n.target,"block__popover",!0),t={oid:0};if(window.siyuan.blockPanels.forEach((e=>{if(e.targetElement&&"true"===e.element.getAttribute("data-pin")){const n=parseInt(e.element.getAttribute("data-level")),i=e.element.getAttribute("data-oid");t[i]?n>t[i]&&(t[i]=n):t[i]=n}})),e)for(let n=0;n<window.siyuan.blockPanels.length;n++){const i=window.siyuan.blockPanels[n];i.targetElement&&parseInt(i.element.getAttribute("data-level"))>(t[i.element.getAttribute("data-oid")]||0)&&"false"===i.element.getAttribute("data-pin")&&parseInt(i.element.getAttribute("data-level"))>parseInt(e.getAttribute("data-level"))&&(i.destroy(),n--)}else for(let e=0;e<window.siyuan.blockPanels.length;e++){const n=window.siyuan.blockPanels[e];n.targetElement&&"false"===n.element.getAttribute("data-pin")&&parseInt(n.element.getAttribute("data-level"))>(t[n.element.getAttribute("data-oid")]||0)&&(n.destroy(),e--)}}i||l||clearTimeout(e)}),200),e=window.setTimeout((()=>i(void 0,void 0,void 0,(function*(){var e,i,r;if((0,o.hasClosestByClassName)(n.target,"history__repo",!0))return;let c,u,d=(0,o.hasClosestByAttribute)(n.target,"data-type","block-ref")||(0,o.hasClosestByAttribute)(n.target,"data-type","virtual-block-ref");if(d&&d.classList.contains("protyle-toolbar")&&(d=void 0),d||(d=(0,o.hasClosestByClassName)(n.target,"popover__block")),!d&&l&&(null===(e=l.getAttribute("data-href"))||void 0===e?void 0:e.startsWith("siyuan://blocks"))&&"true"!==l.getAttribute("prevent-popover")&&(d=l),!d||window.siyuan.altIsPressed||window.siyuan.shiftIsPressed||window.siyuan.ctrlIsPressed||d&&"true"===d.getAttribute("prevent-popover"))return;if(d&&getSelection().rangeCount>0){const e=getSelection().getRangeAt(0);if(""!==e.toString()&&d.contains(e.startContainer))return}clearTimeout(t);const p=d.getAttribute("data-id");if(p)c=p.startsWith("[")?JSON.parse(p):[p],u=JSON.parse(d.getAttribute("data-defids")||"[]");else if((null===(i=d.getAttribute("data-type"))||void 0===i?void 0:i.indexOf("virtual-block-ref"))>-1){const e=(0,o.hasClosestBlock)(d);if(e){const t=yield(0,s.fetchSyncPost)("/api/block/getBlockDefIDsByRefText",{anchor:d.textContent,excludeIDs:[e.getAttribute("data-node-id")]});c=t.data}}else if(null===(r=d.getAttribute("data-type"))||void 0===r?void 0:r.split(" ").includes("a"))c=[d.getAttribute("data-href").substr(16,22)];else{let e,t="/api/block/getRefIDs";d.classList.contains("protyle-attr--refcount")?e=d.parentElement.parentElement.getAttribute("data-node-id"):d.classList.contains("pdf__rect")?(e=d.getAttribute("data-node-id"),t="/api/block/getRefIDsByFileAnnotationID"):e||(e=d.parentElement.getAttribute("data-node-id"));const n=yield(0,s.fetchSyncPost)(t,{id:e});c=n.data.refIDs,u=n.data.defIDs}let h=!1;window.siyuan.blockPanels.find((e=>{if(e.targetElement&&"true"===e.element.getAttribute("data-pin")&&JSON.stringify(c)===JSON.stringify(e.nodeIds))return h=!0,!0})),h||"0.1"===d.parentElement.style.opacity||window.siyuan.blockPanels.push(new a.BlockPanel({targetElement:d,nodeIds:c,defIds:u}))}))),620)}))}},9173:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genEmptyElement=t.genEmptyBlock=t.insertEmptyBlock=t.jumpToParentNext=t.genSBElement=t.cancelSB=void 0;const i=n(4640),a=n(3607),o=n(6520),s=n(4921),r=n(6840),l=n(8592),c=n(8792);t.cancelSB=(e,n)=>{const i=[],a=[];let o=n.previousElementSibling?n.previousElementSibling.getAttribute("data-node-id"):void 0;n.classList.remove("protyle-wysiwyg--select");const s=n.getAttribute("data-node-id"),r=(0,t.genSBElement)(n.getAttribute("data-sb-layout"),s,n.lastElementChild.outerHTML);return a.push({action:"insert",id:s,data:r.outerHTML,previousID:n.previousElementSibling?n.previousElementSibling.getAttribute("data-node-id"):void 0,parentID:n.parentElement.getAttribute("data-node-id")||e.block.parentID}),Array.from(n.children).forEach(((t,r)=>{if(r===n.childElementCount-1)return i.push({action:"delete",id:s}),n.lastElementChild.remove(),void(n.outerHTML=n.innerHTML);i.push({action:"move",id:t.getAttribute("data-node-id"),previousID:o,parentID:n.parentElement.getAttribute("data-node-id")||e.block.parentID}),a.push({action:"move",id:t.getAttribute("data-node-id"),previousID:t.previousElementSibling?t.previousElementSibling.getAttribute("data-node-id"):void 0,parentID:s}),o=t.getAttribute("data-node-id")})),{doOperations:i,undoOperations:a,previousId:o}};t.genSBElement=(e,t,n)=>{const i=document.createElement("div");return i.setAttribute("data-node-id",t||Lute.NewNodeID()),i.setAttribute("data-type","NodeSuperBlock"),i.setAttribute("class","sb"),i.setAttribute("data-sb-layout",e),i.innerHTML=n||`<div class="protyle-attr" contenteditable="false">${c.Constants.ZWSP}</div>`,i};t.jumpToParentNext=(e,t)=>{const n=(0,o.getTopAloneElement)(t);if(n){const t=(0,a.hasClosestByClassName)(n,"list")||(0,a.hasClosestByClassName)(n,"bq")||(0,a.hasClosestByClassName)(n,"sb")||n,s=(0,o.getNextBlock)(t);s&&((0,i.focusBlock)(s),(0,l.scrollCenter)(e,s))}};t.insertEmptyBlock=(e,n,c)=>{const u=(0,i.getEditorRange)(e.wysiwyg.element);let d,p;if(c)d=e.wysiwyg.element.querySelector(`[data-node-id="${c}"]`);else{const t=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");t.length>0?(d="beforebegin"===n?t[0]:t[t.length-1],t.forEach((e=>{e.classList.remove("protyle-wysiwyg--select")}))):(d=(0,a.hasClosestBlock)(u.startContainer),d=(0,o.getTopAloneElement)(d))}if(!d)return;"beforebegin"===n?d.previousElementSibling&&(p=d.previousElementSibling.getAttribute("data-node-id")):p=d.getAttribute("data-node-id");let h=(0,t.genEmptyElement)(!1,!0),f=1;"NodeListItem"===d.getAttribute("data-type")&&(h=(0,s.genListItemElement)(d,0,!0),f=parseInt(d.parentElement.firstElementChild.getAttribute("data-marker")));const g=d.parentElement.outerHTML,m=h.getAttribute("data-node-id");d.insertAdjacentElement(n,h),"NodeListItem"!==d.getAttribute("data-type")||"o"!==d.getAttribute("data-subtype")||h.parentElement.classList.contains("protyle-wysiwyg")?(0,r.transaction)(e,[{action:"insert",data:h.outerHTML,id:m,previousID:p,parentID:d.parentElement.getAttribute("data-node-id")||e.block.parentID}],[{action:"delete",id:m}]):((0,s.updateListOrder)(h.parentElement,f),(0,r.updateTransaction)(e,h.parentElement.getAttribute("data-node-id"),h.parentElement.outerHTML,g)),(0,i.focusByWbr)(e.wysiwyg.element,u),(0,l.scrollCenter)(e)};t.genEmptyBlock=(e=!0,t=!0,n)=>{let i="";return e&&(i=c.Constants.ZWSP),t&&(i+="<wbr>"),n&&(i+=n),`<div data-node-id="${Lute.NewNodeID()}" data-type="NodeParagraph" class="p"><div contenteditable="true" spellcheck="false">${i}</div><div contenteditable="false" class="protyle-attr">${c.Constants.ZWSP}</div></div>`};t.genEmptyElement=(e=!0,t=!0,n)=>{const i=document.createElement("div");return i.setAttribute("data-node-id",n||Lute.NewNodeID()),i.setAttribute("data-type","NodeParagraph"),i.classList.add("p"),i.innerHTML=`<div contenteditable="true" spellcheck="false">${e?c.Constants.ZWSP:""}${t?"<wbr>":""}</div><div class="protyle-attr" contenteditable="false">${c.Constants.ZWSP}</div>`,i}},9685:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.about=void 0;const i=n(8792),a=n(3274),o=n(734),s=n(5299),r=n(3371),l=n(1754),c=n(7954),u=n(1890),d=n(9866),p=n(1377);t.about={element:void 0,genHTML:()=>`<div class="fn__flex b3-label${(0,a.isBrowser)()||window.siyuan.config.system.isMicrosoftStore?" fn__none":""}">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.autoDownloadUpdatePkg}\n        <div class="b3-label__text">${window.siyuan.languages.autoDownloadUpdatePkgTip}</div>\n    </div>\n    <div class="fn__space"></div>\n    <input class="b3-switch fn__flex-center" id="downloadInstallPkg" type="checkbox"${window.siyuan.config.system.downloadInstallPkg?" checked":""}>\n</div>\n<div class="b3-label fn__flex">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.about9}\n        <div class="b3-label__text">${window.siyuan.languages.about10}</div>\n    </div>\n    <div class="fn__space"></div>\n    <input class="b3-switch fn__flex-center" id="uploadErrLog" type="checkbox"${window.siyuan.config.system.uploadErrLog?" checked":""}>\n</div>\n<div class="b3-label fn__flex">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.about11}\n        <div class="b3-label__text">${window.siyuan.languages.about12}</div>\n    </div>\n    <div class="fn__space"></div>\n    <input class="b3-switch fn__flex-center" id="networkServe" type="checkbox"${window.siyuan.config.system.networkServe?" checked":""}>\n</div>\n<div class="fn__flex b3-label${(0,a.isBrowser)()?" fn__none":""}">\n    <div class="fn__flex-1">\n       ${window.siyuan.languages.about2}\n        <div class="b3-label__text">${window.siyuan.languages.about3}</div>\n        <span class="b3-label__text"><code class="fn__code">${window.siyuan.config.localIPs.join("</code> <code class='fn__code'>")}</code></span>\n    </div>\n    <div class="fn__space"></div>\n    <button data-type="open" data-url="http://${window.siyuan.config.system.networkServe?window.siyuan.config.localIPs[0]:"127.0.0.1"}:6806" class="b3-button b3-button--outline fn__size200 fn__flex-center">\n        <svg><use xlink:href="#iconLink"></use></svg>${window.siyuan.languages.about4}\n    </button>\n</div>\n<div class="b3-label fn__flex">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.about5}\n        <div class="b3-label__text">${window.siyuan.languages.about6}</div>\n    </div>\n    <div class="fn__space"></div>\n    <button class="fn__flex-center b3-button b3-button--outline fn__size200" id="authCode">\n        <svg><use xlink:href="#iconLock"></use></svg>${window.siyuan.languages.config}\n    </button>\n</div>\n<div class="b3-label fn__flex">\n    <div class="fn__flex-1 fn__flex-center">\n        ${window.siyuan.languages.dataRepoKey}\n        <div class="b3-label__text">${window.siyuan.languages.dataRepoKeyTip1}</div>\n        <div class="b3-label__text ft__error">${window.siyuan.languages.dataRepoKeyTip2}</div>\n    </div>\n    <div class="fn__space"></div>\n    <div class="fn__size200 fn__flex-center${window.siyuan.config.repo.key?" fn__none":""}">\n        <button class="b3-button b3-button--outline fn__size200" id="importKey">\n            <svg><use xlink:href="#iconDownload"></use></svg>${window.siyuan.languages.importKey}\n        </button>\n        <div class="fn__hr"></div>\n        <button class="b3-button b3-button--outline fn__size200" id="initKey">\n            <svg><use xlink:href="#iconLock"></use></svg>${window.siyuan.languages.genKey}\n        </button>\n        <div class="fn__hr"></div>\n        <button class="b3-button b3-button--outline fn__size200" id="initKeyByPW">\n            <svg><use xlink:href="#iconHand"></use></svg>${window.siyuan.languages.genKeyByPW}\n        </button>\n    </div>\n    <div class="fn__size200 fn__flex-center${window.siyuan.config.repo.key?"":" fn__none"}">\n        <button class="b3-button b3-button--outline fn__size200" id="copyKey">\n            <svg><use xlink:href="#iconCopy"></use></svg>${window.siyuan.languages.copyKey}\n        </button>\n        <div class="fn__hr"></div>\n        <button class="b3-button b3-button--outline fn__size200" id="resetRepo">\n            <svg><use xlink:href="#iconTrashcan"></use></svg>${window.siyuan.languages.resetRepo}\n        </button>\n    </div>\n</div>\n<div class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.systemLog}\n        <div class="b3-label__text">${window.siyuan.languages.systemLogTip}</div>\n    </div>\n    <div class="fn__space"></div>\n    <button id="exportLog" class="b3-button b3-button--outline fn__size200 fn__flex-center">\n        <svg><use xlink:href="#iconUpload"></use></svg>${window.siyuan.languages.export}\n    </button>\n</div>\n<div class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.currentVer} v${i.Constants.SIYUAN_VERSION}\n        <span id="isInsider"></span>\n        <div class="b3-label__text">${window.siyuan.languages.visitAnnouncements}</div>\n    </div>\n    <div class="fn__space"></div>\n    <div class="fn__flex-center fn__size200">\n        <button id="checkUpdateBtn" class="b3-button b3-button--outline fn__size200">\n            <svg><use xlink:href="#iconRefresh"></use></svg>${window.siyuan.languages.checkUpdate}\n        </button>\n        <div class="fn__hr${(0,a.isBrowser)()?"":" fn__none"}"></div>\n        <button id="menuSafeQuit" class="b3-button b3-button--outline fn__size200${(0,a.isBrowser)()?"":" fn__none"}">\n            <svg><use xlink:href="#iconQuit"></use></svg>${window.siyuan.languages.safeQuit}\n        </button>\n    </div>\n</div>\n<div class="fn__flex b3-label${(0,a.isBrowser)()?" fn__none":""}">\n    <div class="fn__flex-1">\n        <div class="fn__flex">\n            ${window.siyuan.languages.about7}\n            <span class="fn__space"></span>\n            <a href="javascript:void(0)" data-type="open" data-url="${window.siyuan.config.system.workspaceDir}">${window.siyuan.config.system.workspaceDir}</a>\n        </div>\n        <div class="b3-label__text">${window.siyuan.languages.about8}</div>\n    </div>\n    <div class="fn__space"></div>\n    <select id="workspaceDir" class="fn__flex-center b3-select fn__size200"></select>\n</div>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.about13}\n         <div class="b3-label__text">${window.siyuan.languages.about14}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="token" value="${window.siyuan.config.api.token}" readonly="readonly">\n</label>\n<div class="b3-label${"std"===window.siyuan.config.system.container||"docker"===window.siyuan.config.system.container?"":" fn__none"}">\n    ${window.siyuan.languages.networkProxy}\n    <div class="b3-label__text">\n        ${window.siyuan.languages.about17}\n    </div>\n    <div class="b3-label__text fn__flex" style="padding: 4px 0 4px 4px;">\n        <select id="aboutScheme" class="b3-select">\n            <option value="" ${""===window.siyuan.config.system.networkProxy.scheme?"selected":""}>${window.siyuan.languages.directConnection}</option>\n            <option value="socks5" ${"socks5"===window.siyuan.config.system.networkProxy.scheme?"selected":""}>SOCKS5</option>\n            <option value="https" ${"https"===window.siyuan.config.system.networkProxy.scheme?"selected":""}>HTTPS</option>\n        </select>\n        <span class="fn__space"></span>\n        <input id="aboutHost" placeholder="Host/IP" class="b3-text-field fn__flex-1 fn__block" value="${window.siyuan.config.system.networkProxy.host}"/>\n        <span class="fn__space"></span>\n        <input id="aboutPort" placeholder="Port" class="b3-text-field fn__flex-1 fn__block" value="${window.siyuan.config.system.networkProxy.port}" type="number"/>\n        <span class="fn__space"></span>\n        <button id="aboutConfim" class="b3-button b3-button--outline">${window.siyuan.languages.confirm}</button>\n    </div>\n</div>\n<div class="b3-label">\n    <div class="config-about__logo">\n        <img src="/stage/icon.png">\n        <span>${window.siyuan.languages.siyuanNote}</span>\n        <span class="fn__space"></span>\n        <span class="ft__on-surface">${window.siyuan.languages.slogan}</span>\n        <span class="fn__space"></span>\n        <span style="color:var(--b3-theme-background);font-family: cursive;">会泽百家&nbsp;至公天下</span>\n    </div>\n    <div class='fn__hr'></div>\n    ${window.siyuan.languages.about1}\n</div>`,bindEvent:()=>{window.siyuan.config.system.isInsider&&(t.about.element.querySelector("#isInsider").innerHTML="<span class='ft__secondary'>Insider Preview</span>");const e=t.about.element.querySelector("#token");e.addEventListener("click",(()=>{e.select()})),t.about.element.querySelector("#exportLog").addEventListener("click",(()=>{(0,o.fetchPost)("/api/system/exportLog",{},(e=>{(0,c.openByMobile)(e.data.zip)}))})),t.about.element.querySelector("#menuSafeQuit").addEventListener("click",(()=>{(0,l.exitSiYuan)()}));const n=t.about.element.querySelector("#checkUpdateBtn");n.addEventListener("click",(()=>{n.firstElementChild.classList.contains("fn__rotate")||(n.innerHTML=`<svg class="fn__rotate"><use xlink:href="#iconRefresh"></use></svg>${window.siyuan.languages.checkUpdate}`,(0,o.fetchPost)("/api/system/checkUpdate",{showMsg:!0},(()=>{n.innerHTML=`<svg><use xlink:href="#iconRefresh"></use></svg>${window.siyuan.languages.checkUpdate}`})))})),t.about.element.querySelector("#authCode").addEventListener("click",(()=>{(0,s.setAccessAuthCode)()}));const i=t.about.element.querySelector("#importKey");i.addEventListener("click",(()=>{const e=new d.Dialog({title:"🔑 "+window.siyuan.languages.key,content:`<div class="b3-dialog__content">\n    <textarea class="b3-text-field fn__block" placeholder="${window.siyuan.languages.keyPlaceholder}"></textarea>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:"520px"}),t=e.element.querySelector("textarea");t.focus();const n=e.element.querySelectorAll(".b3-button");n[0].addEventListener("click",(()=>{e.destroy()})),n[1].addEventListener("click",(()=>{(0,o.fetchPost)("/api/repo/importRepoKey",{key:t.value},(()=>{window.siyuan.config.repo.key=t.value,i.parentElement.classList.add("fn__none"),i.parentElement.nextElementSibling.classList.remove("fn__none"),e.destroy()}))}))})),t.about.element.querySelector("#initKey").addEventListener("click",(()=>{(0,p.confirmDialog)("🔑 "+window.siyuan.languages.genKey,window.siyuan.languages.initRepoKeyTip,(()=>{(0,o.fetchPost)("/api/repo/initRepoKey",{},(e=>{window.siyuan.config.repo.key=e.data.key,i.parentElement.classList.add("fn__none"),i.parentElement.nextElementSibling.classList.remove("fn__none")}))}))})),t.about.element.querySelector("#initKeyByPW").addEventListener("click",(()=>{const e=new d.Dialog({title:"🔑 "+window.siyuan.languages.genKeyByPW,content:`<div class="b3-dialog__content">\n    <input class="b3-text-field fn__block" placeholder="${window.siyuan.languages.password}">\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:"520px"}),t=e.element.querySelector(".b3-text-field");t.focus();const n=e.element.querySelectorAll(".b3-button");e.bindInput(t,(()=>{n[1].click()})),n[0].addEventListener("click",(()=>{e.destroy()})),n[1].addEventListener("click",(()=>{t.value?(0,p.confirmDialog)("🔑 "+window.siyuan.languages.genKeyByPW,window.siyuan.languages.initRepoKeyTip,(()=>{e.destroy(),(0,o.fetchPost)("/api/repo/InitRepoKeyFromPassphrase",{pass:t.value},(e=>{window.siyuan.config.repo.key=e.data.key,i.parentElement.classList.add("fn__none"),i.parentElement.nextElementSibling.classList.remove("fn__none")}))})):(0,u.showMessage)(window.siyuan.languages._kernel[142])}))})),t.about.element.querySelector("#copyKey").addEventListener("click",(()=>{(0,u.showMessage)(window.siyuan.languages.copied),(0,c.writeText)(window.siyuan.config.repo.key)})),t.about.element.querySelector("#resetRepo").addEventListener("click",(()=>{(0,p.confirmDialog)("⚠️ "+window.siyuan.languages.resetRepo,window.siyuan.languages.resetRepoTip,(()=>{(0,o.fetchPost)("/api/repo/resetRepo",{},(()=>{window.siyuan.config.repo.key="",window.siyuan.config.sync.enabled=!1,i.parentElement.classList.remove("fn__none"),i.parentElement.nextElementSibling.classList.add("fn__none")}))}))}));const a=t.about.element.querySelector("#networkServe");a.addEventListener("change",(()=>{(0,o.fetchPost)("/api/system/setNetworkServe",{networkServe:a.checked},(()=>{(0,r.exportLayout)(!1,(()=>{(0,l.exitSiYuan)()}))}))}));const h=t.about.element.querySelector("#uploadErrLog");h.addEventListener("change",(()=>{(0,o.fetchPost)("/api/system/setUploadErrLog",{uploadErrLog:h.checked},(()=>{(0,r.exportLayout)(!1,(()=>{(0,l.exitSiYuan)()}))}))}));const f=t.about.element.querySelector("#downloadInstallPkg");f.addEventListener("change",(()=>{(0,o.fetchPost)("/api/system/setDownloadInstallPkg",{downloadInstallPkg:f.checked},(()=>{window.siyuan.config.system.downloadInstallPkg=f.checked}))})),t.about.element.querySelector("#aboutConfim").addEventListener("click",(()=>{(0,o.fetchPost)("/api/system/setNetworkProxy",{scheme:t.about.element.querySelector("#aboutScheme").value,host:t.about.element.querySelector("#aboutHost").value,port:t.about.element.querySelector("#aboutPort").value},(()=>{(0,r.exportLayout)(!1,(()=>{(0,l.exitSiYuan)()}))}))}))}}},7956:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.account=void 0;const i=n(8970),a=n(1890),o=n(8792),s=n(734),r=n(7766),l=n(1377),c=n(8776),u=n(5370),d=n(3607);t.account={element:void 0,genHTML:()=>{const e=`<a href="https://ld246.com/sponsor" target="_blank" class="b3-chip b3-chip--secondary">\n    <svg version='1.1' xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><path fill='#ffe43c' d='M6.4 0h19.2c4.268 0 6.4 2.132 6.4 6.4v19.2c0 4.268-2.132 6.4-6.4 6.4h-19.2c-4.268 0-6.4-2.132-6.4-6.4v-19.2c0-4.268 2.135-6.4 6.4-6.4z'></path> <path fill='#00f5d4' d='M25.6 0h-8.903c-7.762 1.894-14.043 7.579-16.697 15.113v10.487c0 3.533 2.867 6.4 6.4 6.4h19.2c3.533 0 6.4-2.867 6.4-6.4v-19.2c0-3.537-2.863-6.4-6.4-6.4z'></path> <path fill='#01beff' d='M25.6 0h-0.119c-12.739 2.754-20.833 15.316-18.079 28.054 0.293 1.35 0.702 2.667 1.224 3.946h16.974c3.533 0 6.4-2.867 6.4-6.4v-19.2c0-3.537-2.863-6.4-6.4-6.4z'></path> <path fill='#9a5ce5' d='M31.005 2.966c-0.457-0.722-1.060-1.353-1.784-1.849-8.342 3.865-13.683 12.223-13.679 21.416-0.003 3.256 0.67 6.481 1.978 9.463h8.081c0.602 0 1.185-0.084 1.736-0.238-2.1-3.189-3.401-7.624-3.401-12.526 0-7.337 2.921-13.628 7.070-16.266z'></path> <path fill='#f15bb5' d='M32 25.6v-19.2c0-1.234-0.354-2.419-0.998-3.43-4.149 2.638-7.067 8.928-7.067 16.266 0 4.902 1.301 9.334 3.401 12.526 2.693-0.757 4.664-3.231 4.664-6.162z'></path> <path fill='#fff' opacity='0.2' d='M26.972 22.415c-2.889 0.815-4.297 2.21-6.281 3.182 1.552 0.348 3.105 0.461 4.902 0.461 2.644 0 5.363-1.449 6.406-2.519v-1.085c-1.598-0.399-2.664-0.705-5.028-0.039zM4.773 21.612c-0.003 0-0.006-0.003-0.006-0.003-1.726-0.863-3.382-1.205-4.767-1.301v2.487c0.779-0.341 2.396-0.921 4.773-1.182zM17.158 26.599c1.472-0.158 2.57-0.531 3.533-1.002-1.063-0.238-2.126-0.583-3.269-1.079-2.767-1.205-5.63-3.092-10.491-3.034-0.779 0.010-1.495 0.058-2.158 0.132 4.503 2.248 7.882 5.463 12.384 4.983z'></path> <path fill='#fff' opacity='0.2' d='M20.691 25.594c-0.963 0.47-2.061 0.844-3.533 1.002-4.503 0.483-7.882-2.731-12.381-4.983-2.38 0.261-3.994 0.841-4.773 1.179v2.809c0 4.268 2.132 6.4 6.4 6.4h19.197c4.268 0 6.4-2.132 6.4-6.4v-2.065c-1.044 1.069-3.762 2.519-6.406 2.519-1.797 0-3.35-0.113-4.902-0.461z'></path> <path fill='#fff' opacity='0.5' d='M3.479 19.123c0 0.334 0.271 0.606 0.606 0.606s0.606-0.271 0.606-0.606v0c0-0.334-0.271-0.606-0.606-0.606s-0.606 0.271-0.606 0.606v0z'></path> <path fill='#fff' opacity='0.5' d='M29.027 14.266c0 0.334 0.271 0.606 0.606 0.606s0.606-0.271 0.606-0.606v0c0-0.334-0.271-0.606-0.606-0.606s-0.606 0.271-0.606 0.606v0z'></path> <path fill='#fff' d='M9.904 1.688c0 0.167 0.136 0.303 0.303 0.303s0.303-0.136 0.303-0.303v0c0-0.167-0.136-0.303-0.303-0.303s-0.303 0.136-0.303 0.303v0z'></path> <path fill='#fff' d='M2.673 10.468c0 0.167 0.136 0.303 0.303 0.303s0.303-0.136 0.303-0.303v0c0-0.167-0.136-0.303-0.303-0.303s-0.303 0.136-0.303 0.303v0z'></path> <path fill='#fff' opacity='0.6' d='M30.702 9.376c0 0.167 0.136 0.303 0.303 0.303s0.303-0.136 0.303-0.303v0c0-0.167-0.136-0.303-0.303-0.303s-0.303 0.136-0.303 0.303v0z'></path> <path fill='#fff' opacity='0.8' d='M29.236 20.881c0 0.276 0.224 0.499 0.499 0.499s0.499-0.224 0.499-0.499v0c0-0.276-0.224-0.499-0.499-0.499s-0.499 0.224-0.499 0.499v0z'></path> <path fill='#fff' opacity='0.8' d='M15.38 1.591c0.047 0.016 0.101 0.026 0.158 0.026 0.276 0 0.499-0.224 0.499-0.499 0-0.219-0.141-0.406-0.338-0.473l-0.004-0.001c-0.047-0.016-0.101-0.026-0.158-0.026-0.276 0-0.499 0.224-0.499 0.499 0 0.219 0.141 0.406 0.338 0.473l0.004 0.001z'></path> <path fill='#ffdeeb' d='M25.732 8.268c-2.393-2.371-6.249-2.371-8.642 0l-1.089 1.085-1.079-1.089c-2.38-2.39-6.249-2.393-8.639-0.013s-2.393 6.249-0.013 8.639l2.158 2.158 6.474 6.464c0.596 0.593 1.562 0.593 2.158 0l6.474-6.464 2.193-2.158c2.384-2.383 2.384-6.242 0.003-8.622z'></path> <path fill='#fff' d='M17.081 8.268l-1.079 1.085-1.079-1.089c-2.38-2.39-6.249-2.393-8.639-0.013s-2.393 6.249-0.013 8.639l2.158 2.158 2.548 2.487c4.097-1.044 7.627-3.646 9.837-7.254 1.424-2.271 2.284-4.848 2.503-7.518-2.193-0.715-4.606-0.132-6.236 1.504z'></path> </svg>\n    ${window.siyuan.languages.sponsor}\n</a>\n<div class="fn__hr--b"></div>\n<a class="b3-button b3-button--outline" style="min-width: 214px" href="https://ld246.com/subscribe/siyuan" target="_blank">\n    <span>\n        <div class="fn__hr"></div>\n        <span class="ft__smaller">${window.siyuan.languages.account4}</span>\n        <div class="fn__hr--small"></div>\n        <big class="ft__secondary">${window.siyuan.languages.priceAnnual}</big>\n        <span class="ft__on-background">/${window.siyuan.languages.year}</span>\n        <div class="fn__hr--small"></div>\n        <span class="ft__smaller ft__on-surface">${window.siyuan.languages.account1}</span>\n        <div class="fn__hr"></div>\n    </span>\n</a>\n<div class="fn__hr--b"></div>\n${window.siyuan.languages.account8}\n<div class="fn__hr"></div>\n${window.siyuan.languages.account2}\n<div><a href="https://b3log.org/siyuan/pricing.html" target="_blank">${window.siyuan.languages.account7}</a></div>\n<div class="fn__hr--b"></div>\n<span class="b3-chip b3-chip--primary fn__pointer${window.siyuan.user&&2===window.siyuan.user.userSiYuanSubscriptionStatus?" fn__none":""}" id="trialSub">\n    <svg class="ft__secondary"><use xlink:href="#iconVIP"></use></svg>\n    ${window.siyuan.languages.freeSub}\n</span>\n<div class="fn__hr--b"></div>`;if(window.siyuan.user){let t="";window.siyuan.user.userTitles.length>0&&(t='<div class="fn__hr--b"></div><div class="fn__flex" style="position: absolute"><span class="fn__space"></span>',window.siyuan.user.userTitles.forEach((e=>{t+=`<div class="b3-chip">${e.icon} ${e.name}</div><span class="fn__space"></span>`})),t+="</div>");let n=e,i=`<div class="fn__hr"></div>\n<div class="b3-form__icon fn__block">\n   <svg class="ft__secondary b3-form__icon-icon"><use xlink:href="#iconVIP"></use></svg>\n   <input class="b3-text-field fn__block b3-form__icon-input" style="padding-right: 44px;" placeholder="${window.siyuan.languages.activationCodePlaceholder}">\n   <button id="activationCode" class="b3-button b3-button--white" style="position: absolute;right: 1px;top: 1px;height: 25px;">${window.siyuan.languages.confirm}</button>\n</div>`;return-1===window.siyuan.user.userSiYuanProExpireTime?(i="",n=`<div class="b3-chip b3-chip--secondary">${o.Constants.SIYUAN_IMAGE_VIP}${window.siyuan.languages.account12}</div>`):window.siyuan.user.userSiYuanProExpireTime>0&&(n=2===window.siyuan.user.userSiYuanSubscriptionPlan?`<div class="b3-chip b3-chip--primary"><svg><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.account3}</div>\n<div class="fn__hr"></div>\n<div class="ft__on-surface ft__smaller">${window.siyuan.languages.account6} ${Math.max(0,Math.floor((window.siyuan.user.userSiYuanProExpireTime-(new Date).getTime())/1e3/60/60/24))} ${window.siyuan.languages.day} ${window.siyuan.languages.clickMeToRenew}</div>\n<div class="fn__hr"></div>\n${window.siyuan.languages.account8}`:`<div class="b3-chip b3-chip--primary"><svg class="ft__secondary"><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.account10}</div><div class="fn__hr"></div>\n<div class="ft__on-surface ft__smaller">${window.siyuan.languages.account6} ${Math.max(0,Math.floor((window.siyuan.user.userSiYuanProExpireTime-(new Date).getTime())/1e3/60/60/24))} ${window.siyuan.languages.day} ${window.siyuan.languages.clickMeToRenew}</div>`),`<div class="fn__flex config-account">\n<div class="config-account__center">\n    <div class="config-account__bg">\n        <div class="config-account__cover" style="background-image: url(${window.siyuan.user.userHomeBImgURL})"></div>\n        <a href="https://ld246.com/settings/avatar" class="config-account__avatar" style="background-image: url(${window.siyuan.user.userAvatarURL})" target="_blank"></a>\n        <h1 class="config-account__name">\n            <a target="_blank" class="fn__a" href="https://ld246.com/member/${window.siyuan.user.userName}">${window.siyuan.user.userName}</a>\n        </h1>\n        ${t}\n    </div>\n    <div class="config-account__info">\n        <div class="fn__flex">\n            <a class="b3-button b3-button--text" href="https://ld246.com/settings" target="_blank">${window.siyuan.languages.accountManage}</a>\n            <span class="fn__space"></span>\n            <button class="b3-button b3-button--cancel" id="logout">\n                ${window.siyuan.languages.logout}\n            </button>\n            <span class="fn__flex-1"></span>\n            <button class="b3-button b3-button--cancel b3-tooltips b3-tooltips__n" id="refresh" aria-label="${window.siyuan.languages.refresh}">\n                <svg><use xlink:href="#iconRefresh"></use></svg>\n            </button>\n        </div>\n        <div class="fn__hr--b"></div>\n        <div class="fn__flex">\n            <label>\n                ${window.siyuan.languages.accountDisplayTitle}\n                <input class="b3-switch fn__flex-center" id="displayTitle" type="checkbox"${window.siyuan.config.account.displayTitle?" checked":""}/>\n            </label>\n            <div class="fn__flex-1"></div>\n            <label>\n                ${window.siyuan.languages.accountDisplayVIP}\n                <input class="b3-switch fn__flex-center" id="displayVIP" type="checkbox"${window.siyuan.config.account.displayVIP?" checked":""}/>\n            </label>\n        </div>\n    </div>\n</div>\n<div class="config-account__center config-account__center--text${"ios"===window.siyuan.config.system.container?" fn__none":""}">\n    <div class="fn__flex-1 fn__hr"></div>\n    <div class="ft__center">${n}</div>\n    <div class="fn__flex-1 fn__hr"></div>\n    <div class="fn__flex fn__block" style="line-height: 1.625">\n        <div class="fn__flex-1"></div>\n        <span class="ft__on-surface">${window.siyuan.languages.paymentSum}</span>\n        <span class="fn__space"></span>\n        <span>${window.siyuan.user.userPaymentSum} RMB</span>\n    </div>\n    ${i}\n</div></div>`}return`<div class="fn__flex config-account">\n<div class="b3-form__space config-account__center">\n    <div class="config-account__form" id="form1">\n        <div class="b3-form__icon">\n            <svg class="b3-form__icon-icon"><use xlink:href="#iconAccount"></use></svg>\n            <input id="userName" class="b3-text-field fn__block b3-form__icon-input" placeholder="${window.siyuan.languages.accountName}">\n        </div>\n        <div class="fn__hr--b"></div>\n        <div class="b3-form__icon">\n            <svg class="b3-form__icon-icon"><use xlink:href="#iconLock"></use></svg>\n            <input type="password" id="userPassword" class="b3-text-field b3-form__icon-input fn__block" placeholder="${window.siyuan.languages.password}">\n        </div>\n        <div class="b3-form__img fn__none">\n            <div class="fn__hr--b"></div>\n            <img id="captchaImg" class="fn__pointer" style="top: 17px">\n            <input id="captcha" class="b3-text-field fn__block" placeholder="${window.siyuan.languages.captcha}">\n        </div>\n        <div class="fn__hr--b"></div>\n        <label class="ft__smaller ft__on-surface fn__flex">\n            <span class="fn__space"></span>\n            <input type="checkbox" class="b3-switch fn__flex-center" id="agreeLogin">\n            <span class="fn__space"></span>\n            <span>${window.siyuan.languages.accountTip}</span>\n        </label>\n        <div class="fn__hr--b"></div>\n        <button id="login" disabled class="b3-button fn__block">${window.siyuan.languages.login}</button>\n        <div class="fn__hr--b"></div>\n        <div class="ft__center">\n            <a href="https://ld246.com/forget-pwd" class="b3-button b3-button--cancel" target="_blank">${window.siyuan.languages.forgetPassword}</a>\n            <span class="fn__space${"ios"===window.siyuan.config.system.container?" fn__none":""}"></span>\n            <a href="https://ld246.com/register" class="b3-button b3-button--cancel${"ios"===window.siyuan.config.system.container?" fn__none":""}" target="_blank">${window.siyuan.languages.register}</a>\n        </div>\n    </div>\n    <div class="fn__none config-account__form" id="form2">\n        <div class="b3-form__icon">\n            <svg class="b3-form__icon-icon"><use xlink:href="#iconLock"></use></svg>\n            <input id="twofactorAuthCode" class="b3-text-field fn__block b3-form__icon-input" placeholder="${window.siyuan.languages.twoFactorCaptcha}">\n        </div>\n        <div class="fn__hr--b"></div>\n        <button id="login2" class="b3-button fn__block">${window.siyuan.languages.login}</button>\n    </div>\n</div>\n<div class="config-account__center config-account__center--text${"ios"===window.siyuan.config.system.container?" fn__none":""}">\n    <div class="ft__center">\n        ${e}\n        <div class="fn__hr--b"></div><div class="fn__hr--b"></div>\n    </div>\n</div>\n</div>`},bindEvent:e=>{const n=e.querySelector("#trialSub");n&&n.addEventListener("click",(()=>{(0,s.fetchPost)("/api/account/startFreeTrial",{},(()=>{e.querySelector("#refresh").dispatchEvent(new Event("click"))}))}));const o=e.querySelector("#agreeLogin"),r=e.querySelector("#userName");if(!r){const n=e.querySelector("#refresh");n.addEventListener("click",(()=>{const i=n.firstElementChild;i.classList.contains("fn__rotate")||(i.classList.add("fn__rotate"),(0,s.fetchPost)("/api/setting/getCloudUser",{token:window.siyuan.user.userToken},(n=>{window.siyuan.user=n.data,e.innerHTML=t.account.genHTML(),t.account.bindEvent(e),(0,a.showMessage)(window.siyuan.languages.refreshUser,3e3),t.account.onSetaccount()})))})),e.querySelector("#logout").addEventListener("click",(()=>{(0,s.fetchPost)("/api/setting/logoutCloudUser",{},(()=>{(0,s.fetchPost)("/api/setting/getCloudUser",{},(n=>{window.siyuan.user=n.data,e.innerHTML=t.account.genHTML(),t.account.bindEvent(e),t.account.onSetaccount()}))}))})),e.querySelectorAll("input[type='checkbox']").forEach((n=>{n.addEventListener("change",(()=>{(0,s.fetchPost)("/api/setting/setAccount",{displayTitle:e.querySelector("#displayTitle").checked,displayVIP:e.querySelector("#displayVIP").checked},(e=>{window.siyuan.config.account.displayTitle=e.data.displayTitle,window.siyuan.config.account.displayVIP=e.data.displayVIP,t.account.onSetaccount()}))}))}));const i=e.querySelector("#activationCode");return void i.addEventListener("click",(()=>{const e=i.previousElementSibling;(0,s.fetchPost)("/api/account/checkActivationcode",{data:e.value},(t=>{0!==t.code&&(e.value=""),(0,l.confirmDialog)(window.siyuan.languages.activationCode,t.msg,(()=>{0===t.code&&(0,s.fetchPost)("/api/account/useActivationcode",{data:i.previousElementSibling.value},(()=>{n.dispatchEvent(new CustomEvent("click"))}))}))}))}))}const c=e.querySelector("#userPassword"),u=e.querySelector("#captchaImg"),d=e.querySelector("#captcha"),p=e.querySelector("#twofactorAuthCode"),h=e.querySelector("#login"),f=e.querySelector("#login2");let g,m;o.addEventListener("click",(()=>{o.checked?h.removeAttribute("disabled"):h.setAttribute("disabled","disabled")})),r.focus(),r.addEventListener("keydown",(e=>{e.isComposing?e.preventDefault():"Enter"===e.key&&(h.click(),e.preventDefault())})),p.addEventListener("keydown",(e=>{e.isComposing?e.preventDefault():"Enter"===e.key&&(f.click(),e.preventDefault())})),d.addEventListener("keydown",(e=>{e.isComposing?e.preventDefault():"Enter"===e.key&&(h.click(),e.preventDefault())})),c.addEventListener("keydown",(e=>{e.isComposing?e.preventDefault():"Enter"===e.key&&(h.click(),e.preventDefault())})),u.addEventListener("click",(()=>{u.setAttribute("src",`https://ld246.com/captcha/login?needCaptcha=${m}&t=${(new Date).getTime()}`)})),h.addEventListener("click",(()=>{(0,s.fetchPost)("/api/account/login",{userName:r.value.replace(/(^\s*)|(\s*$)/g,""),userPassword:i(c.value),captcha:d.value.replace(/(^\s*)|(\s*$)/g,"")},(n=>{let i;return 1===n.code?(i=(0,a.showMessage)(n.msg),n.data.needCaptcha?(m=n.data.needCaptcha,d.parentElement.classList.remove("fn__none"),d.previousElementSibling.setAttribute("src",`https://ld246.com/captcha/login?needCaptcha=${n.data.needCaptcha}`),void(d.value="")):void 0):10===n.code?(e.querySelector("#form1").classList.add("fn__none"),e.querySelector("#form2").classList.remove("fn__none"),p.focus(),void(g=n.data.token)):((0,a.hideMessage)(i),void(0,s.fetchPost)("/api/setting/getCloudUser",{token:n.data.token},(n=>{t.account._afterLogin(n,e)})))}))})),f.addEventListener("click",(()=>{(0,s.fetchPost)("/api/setting/login2faCloudUser",{code:p.value,token:g},(n=>{(0,s.fetchPost)("/api/setting/getCloudUser",{token:n.data.token},(n=>{t.account._afterLogin(n,e)}))}))}))},_afterLogin(e,n){if(window.siyuan.user=e.data,n.classList.contains("account")&&!(0,c.needSubscribe)("")){const e=(0,d.hasClosestByClassName)(n,"b3-dialog--open");if(e)return window.siyuan.dialogs.find((t=>{if(t.element.isSameNode(e))return t.destroy(),!0})),void(0,u.syncGuide)()}n.innerHTML=t.account.genHTML(),t.account.bindEvent(n),t.account.onSetaccount()},onSetaccount(){if(r.repos.element&&(r.repos.element.innerHTML=""),"ios"===window.siyuan.config.system.container)return;let e="";window.siyuan.config.account.displayVIP&&window.siyuan.user&&(-1===window.siyuan.user.userSiYuanProExpireTime?e=`<div class="toolbar__item b3-tooltips b3-tooltips__se" aria-label="${window.siyuan.languages.account12}">${o.Constants.SIYUAN_IMAGE_VIP}</div>`:window.siyuan.user.userSiYuanProExpireTime>0&&(e=2===window.siyuan.user.userSiYuanSubscriptionPlan?`<div class="toolbar__item b3-tooltips b3-tooltips__se" aria-label="${window.siyuan.languages.account3}"><svg><use xlink:href="#iconVIP"></use></svg></div>`:`<div class="toolbar__item b3-tooltips b3-tooltips__se" aria-label="${window.siyuan.languages.account10}"><svg class="ft__secondary"><use xlink:href="#iconVIP"></use></svg></div>`)),(!window.siyuan.user||window.siyuan.user&&-1===window.siyuan.user.userSiYuanSubscriptionStatus)&&(e=`<div class="toolbar__item b3-tooltips b3-tooltips__se" aria-label="${window.siyuan.languages.freeSub}"><svg class="ft__error"><use xlink:href="#iconVIP"></use></svg></div>`),window.siyuan.config.account.displayTitle&&window.siyuan.user&&window.siyuan.user.userTitles.forEach((t=>{e+=`<div class="toolbar__item fn__a b3-tooltips b3-tooltips__se" aria-label="${t.name}：${t.desc}">${t.icon}</div>`})),document.getElementById("toolbarVIP").innerHTML=e}}},2186:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appearance=void 0;const i=n(8792),a=n(3371),o=n(4920),s=n(3274),r=n(734),l=n(8785),c=n(7550);t.appearance={element:void 0,genHTML:()=>`<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.appearance4}\n        <div class="b3-label__text">${window.siyuan.languages.appearance5}</div>\n    </div>\n    <span class="fn__space"></span>\n    <select class="b3-select fn__flex-center fn__size200" id="mode">\n      <option value="0" ${0===window.siyuan.config.appearance.mode?"selected":""}>${window.siyuan.languages.themeLight}</option>\n      <option value="1" ${1===window.siyuan.config.appearance.mode?"selected":""}>${window.siyuan.languages.themeDark}</option>\n      \x3c!--option value="dark" ${2===window.siyuan.config.appearance.mode?"selected":""}>${window.siyuan.languages.appearance7}</option--\x3e\n    </select>\n</label>\n<div class="b3-label">\n    <div class="fn__flex">\n        <div class="fn__flex-center">${window.siyuan.languages.theme}</div>\n        <span class="fn__space"></span>\n        <a href="javascript:void(0)" ${(0,s.isBrowser)()?" class='fn__none'":""} id="appearanceOpenTheme" class="fn__flex-center">${window.siyuan.languages.appearance9}</a>\n    </div>\n    <div class="fn__hr"></div>\n    <div class="fn__flex">\n        <div class="fn__flex-center fn__flex-1 ft__on-surface">\n            ${window.siyuan.languages.theme11}\n        </div>\n        <span class="fn__space"></span>\n        <select class="b3-select fn__flex-center fn__size200" id="themeLight">\n          ${(0,c.genOptions)(window.siyuan.config.appearance.lightThemes,window.siyuan.config.appearance.themeLight)}\n        </select>\n    </div>\n    <div class="fn__hr"></div>\n    <div class="fn__flex">\n        <div class="fn__flex-center fn__flex-1 ft__on-surface">\n            ${window.siyuan.languages.theme12}\n        </div>\n        <span class="fn__space"></span>\n        <select class="b3-select fn__flex-center fn__size200" id="themeDark">\n           ${(0,c.genOptions)(window.siyuan.config.appearance.darkThemes,window.siyuan.config.appearance.themeDark)}\n        </select>\n    </div>\n</div>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        <div class="fn__flex">\n            ${window.siyuan.languages.icon}\n            <span class="fn__space"></span>\n            <a href="javascript:void(0)"${(0,s.isBrowser)()?" class='fn__none'":""} id="appearanceOpenIcon">${window.siyuan.languages.appearance8}</a>\n        </div>\n        <div class="b3-label__text">${window.siyuan.languages.theme2}</div>\n    </div>\n    <span class="fn__space"></span>\n    <select class="b3-select fn__flex-center fn__size200" id="icon">\n        ${(0,c.genOptions)(window.siyuan.config.appearance.icons,window.siyuan.config.appearance.icon)}\n    </select>\n</label>\n<label class="b3-label fn__flex"><div class="fn__block">\n    <div>\n        ${window.siyuan.languages.appearance1}\n    </div>\n    <div class="fn__hr"></div>\n    <div class="fn__flex">\n        <div class="fn__flex-center fn__flex-1 ft__on-surface">${window.siyuan.languages.appearance2}</div>\n        <span class="fn__space"></span>\n        <select id="codeBlockThemeLight" class="b3-select fn__size200">\n            ${(0,c.genOptions)(i.Constants.SIYUAN_CONFIG_APPEARANCE_LIGHT_CODE,window.siyuan.config.appearance.codeBlockThemeLight)}\n        </select>\n    </div>\n    <div class="fn__hr"></div>\n    <div class="fn__flex">\n        <div class="fn__flex-center fn__flex-1 ft__on-surface">${window.siyuan.languages.appearance3}</div>\n        <span class="fn__space"></span>\n        <select id="codeBlockThemeDark" class="b3-select fn__size200">\n            ${(0,c.genOptions)(i.Constants.SIYUAN_CONFIG_APPEARANCE_DARK_CODE,window.siyuan.config.appearance.codeBlockThemeDark)}\n        </select>\n    </div>\n</div></label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.language}\n        <div class="b3-label__text">${window.siyuan.languages.language1}</div>\n    </div>\n    <span class="fn__space"></span>\n    <select id="lang" class="b3-select fn__flex-center fn__size200">${(0,c.genOptions)(window.siyuan.config.langs,window.siyuan.config.appearance.lang)}</select>\n</label>\n<div class="b3-label${(0,s.isBrowser)()?" fn__none":""}">\n    <div class="fn__block fn__flex">\n        <div class="fn__flex-1">\n            ${window.siyuan.languages.customEmoji}\n            <div class="b3-label__text">${window.siyuan.languages.customEmojiTip}</div>\n        </div>\n        <span class="fn__space"></span>\n        <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="appearanceRefresh">\n            <svg><use xlink:href="#iconRefresh"></use></svg>\n            ${window.siyuan.languages.refresh}\n        </button>\n    </div>\n</div>\n<div class="b3-label">\n    <div class="fn__block fn__flex">\n        <div class="fn__flex-1">\n            ${window.siyuan.languages.theme13} <b id="appearanceCustomName">${0===window.siyuan.config.appearance.mode?window.siyuan.config.appearance.themeLight:window.siyuan.config.appearance.themeDark}</b>\n            <div class="b3-label__text">${window.siyuan.languages.theme14}</div>\n        </div>\n        <span class="fn__space"></span>\n        <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="appearanceCustom">${window.siyuan.config.appearance.customCSS?window.siyuan.languages.close:window.siyuan.languages.open}</button>\n    </div>\n    <div id="appearanceCustomPanel"></div>\n</div>\n<label class="b3-label fn__flex">\n   <div class="fn__flex-1">\n        ${window.siyuan.languages.resetLayout}\n        <div class="b3-label__text">${window.siyuan.languages.appearance6}</div>\n    </div>\n    <span class="fn__space"></span>\n    <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="resetLayout">\n        <svg><use xlink:href="#iconUndo"></use></svg>${window.siyuan.languages.reset}\n    </button>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.appearance14}\n        <div class="b3-label__text">${window.siyuan.languages.appearance15}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="nativeEmoji" type="checkbox"${window.siyuan.config.appearance.nativeEmoji?" checked":""}>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.appearance16}\n        <div class="b3-label__text">${window.siyuan.languages.appearance17}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="hideStatusBar" type="checkbox"${window.siyuan.config.appearance.hideStatusBar?" checked":""}>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.appearance10}\n        <div class="b3-label__text">${window.siyuan.languages.appearance11}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="closeButtonBehavior" type="checkbox"${0===window.siyuan.config.appearance.closeButtonBehavior?"":" checked"}>\n</label>`,onGetcustomcss:e=>{let n='<div class="fn__hr"></div>';Object.keys(e).forEach((t=>{n+=`<div class="fn__hr"></div><div>${window.siyuan.languages[t]}</div><div class="fn__hr"></div>`,Object.keys(e[t]).forEach((i=>{n+=`<div class="fn__flex">\n    <span class="colorPicker" data-key="${t}" data-subkey="${i}" data-value="${e[t][i]}"></span>\n    <span class="fn__space"></span>\n    <span class="ft__on-surface fn__flex-center">${window.siyuan.languages[i]}</span>\n</div><div class="fn__hr"></div>`}))})),t.appearance.element.querySelector("#appearanceCustomPanel").innerHTML=n;const i={};t.appearance.element.querySelectorAll("#appearanceCustomPanel .colorPicker").forEach((e=>{const n=o.create({container:"#appearanceCustomPanel",el:e,theme:"nano",default:e.getAttribute("data-value"),comparison:!1,components:{preview:!0,opacity:!0,hue:!0,interaction:{input:!0}}});n.on("hide",(()=>{t.appearance._sendCustomcss(i)})),n.on("changestop",(()=>{t.appearance._sendCustomcss(i)}));const a=e.getAttribute("data-key");i[a]||(i[a]={}),i[a][e.getAttribute("data-subkey")]=n}))},_sendCustomcss:e=>{const n={};Object.keys(e).forEach((t=>{n[t]={},Object.keys(e[t]).forEach((i=>{n[t][i]=e[t][i].getColor().toRGBA().toString(0)}))})),(0,r.fetchPost)("/api/setting/setCustomCSS",{theme:t.appearance.element.querySelector("#appearanceCustomName").textContent,css:n})},_send:e=>{const n=t.appearance.element.querySelector("#themeLight").value,i=t.appearance.element.querySelector("#themeDark").value,o="number"==typeof e?e:parseInt(t.appearance.element.querySelector("#mode").value);(0,r.fetchPost)("/api/setting/setAppearance",{icon:t.appearance.element.querySelector("#icon").value,mode:o,codeBlockThemeDark:t.appearance.element.querySelector("#codeBlockThemeDark").value,codeBlockThemeLight:t.appearance.element.querySelector("#codeBlockThemeLight").value,themeDark:i,themeLight:n,darkThemes:window.siyuan.config.appearance.darkThemes,lightThemes:window.siyuan.config.appearance.lightThemes,icons:window.siyuan.config.appearance.icons,lang:t.appearance.element.querySelector("#lang").value,customCSS:window.siyuan.config.appearance.customCSS,closeButtonBehavior:t.appearance.element.querySelector("#closeButtonBehavior").checked?1:0,nativeEmoji:t.appearance.element.querySelector("#nativeEmoji").checked,hideStatusBar:t.appearance.element.querySelector("#hideStatusBar").checked},(e=>{let s=!1;o===window.siyuan.config.appearance.mode&&n===window.siyuan.config.appearance.themeLight&&i===window.siyuan.config.appearance.themeDark||(s=!0),window.siyuan.config.appearance.themeJS&&s?(0,a.exportLayout)(!0):(t.appearance.onSetappearance(e.data),e.data.hideStatusBar?document.getElementById("status").classList.add("fn__none"):document.getElementById("status").classList.remove("fn__none"))}))},bindEvent:()=>{window.siyuan.config.appearance.customCSS&&(0,r.fetchPost)("/api/setting/getCustomCSS",{theme:t.appearance.element.querySelector("#appearanceCustomName").textContent},(e=>{t.appearance.onGetcustomcss(e.data)}));const e=t.appearance.element.querySelector("#appearanceCustom");e.addEventListener("click",(()=>{window.siyuan.config.appearance.customCSS?(window.siyuan.config.appearance.customCSS=!1,e.textContent=window.siyuan.languages.open,t.appearance.element.querySelector("#appearanceCustomPanel").innerHTML=""):(window.siyuan.config.appearance.customCSS=!0,(0,r.fetchPost)("/api/setting/getCustomCSS",{theme:t.appearance.element.querySelector("#appearanceCustomName").textContent},(e=>{t.appearance.onGetcustomcss(e.data)})),e.textContent=window.siyuan.languages.close),t.appearance._send()})),t.appearance.element.querySelector("#resetLayout").addEventListener("click",(()=>{(0,r.fetchPost)("/api/system/setUILayout",{layout:{}},(()=>{window.location.reload()}))})),t.appearance.element.querySelectorAll("select").forEach((e=>{e.addEventListener("change",(()=>{let n;"themeLight"===e.id?n=0:"themeDark"===e.id&&(n=1),t.appearance._send(n)}))})),t.appearance.element.querySelectorAll(".b3-switch").forEach((e=>{e.addEventListener("change",(()=>{t.appearance._send()}))}))},onSetappearance(e){if(e.lang!==window.siyuan.config.appearance.lang||e.nativeEmoji!==window.siyuan.config.appearance.nativeEmoji)return void(0,a.exportLayout)(!0);if(window.siyuan.config.appearance=e,t.appearance.element){const n=0===e.mode?e.themeLight:e.themeDark,i=t.appearance.element.querySelector("#mode");i&&(i.innerHTML=`<option value="0" ${0===e.mode?"selected":""}>${window.siyuan.languages.themeLight}</option>\n<option value="1" ${1===e.mode?"selected":""}>${window.siyuan.languages.themeDark}</option>`,t.appearance.element.querySelector("#appearanceCustomName").textContent=n);const a=t.appearance.element.querySelector("#themeLight");a&&(a.value=e.themeLight);const o=t.appearance.element.querySelector("#themeDark");o&&(o.value=e.themeDark);const s=t.appearance.element.querySelector("#icon");s&&(s.value=e.icon),e.customCSS&&(0,r.fetchPost)("/api/setting/getCustomCSS",{theme:n},(e=>{t.appearance.onGetcustomcss(e.data)}))}(0,l.loadAssets)(e);const n=document.getElementById("barThemeMode");n&&(1===e.mode?(n.classList.add("toolbar__item--active"),n.setAttribute("aria-label",window.siyuan.languages.themeLight)):(n.classList.remove("toolbar__item--active"),n.setAttribute("aria-label",window.siyuan.languages.themeDark)))}}},8556:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bazaar=void 0;const i=n(2186),a=n(1890),o=n(734),s=n(3607),r=n(1377),l=n(1248),c=n(3371),u=n(8792),d=n(3274);t.bazaar={element:void 0,genHTML(){const e=localStorage.getItem(u.Constants.LOCAL_BAZAAR);let n;e?n=JSON.parse(e):(n={theme:"0",template:"0",icon:"0",widget:"0"},localStorage.setItem(u.Constants.LOCAL_BAZAAR,JSON.stringify(n)));const i=`<div style="height: ${t.bazaar.element.clientHeight-72}px;display: flex;align-items: center;justify-content: center;"><img src="/stage/loading-pure.svg"></div>`;return`<div class="fn__flex-column" style="height: 100%">\n<div class="layout-tab-bar fn__flex">\n    <div data-type="theme" class="item item--focus"><span class="item__text">${window.siyuan.languages.theme}</span></div>\n    <div data-type="template" class="item"><span class="item__text">${window.siyuan.languages.template}</span></div>\n    <div data-type="icon" class="item"><span class="item__text">${window.siyuan.languages.icon}</span></div>\n    <div data-type="widget" class="item"><span class="item__text">${window.siyuan.languages.widget}</span></div>\n    <div data-type="downloaded" class="item"><span class="item__text">${window.siyuan.languages.downloaded}</span></div>\n</div>\n<div class="fn__flex-1">\n    <div data-type="theme" class="bazaarPanel" data-init="true">\n        <div class="fn__hr"></div>\n        <div class="fn__flex">\n            <div class="fn__space"></div>\n            <div class="fn__space"></div>\n            <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconSort"></use></svg>\n            <div class="fn__space"></div>\n            <select class="b3-select fn__size200">\n                <option ${"0"===n.theme?"selected":""} value="0">${window.siyuan.languages.sortByUpdateTimeDesc}</option>\n                <option ${"1"===n.theme?"selected":""} value="1">${window.siyuan.languages.sortByUpdateTimeAsc}</option>\n                <option ${"2"===n.theme?"selected":""} value="2">${window.siyuan.languages.sortByDownloadsDesc}</option>\n                <option ${"3"===n.theme?"selected":""} value="3">${window.siyuan.languages.sortByDownloadsAsc}</option>\n            </select>\n            <div class="fn__flex-1"></div>\n            <select id="bazaarSelect" class="b3-select fn__size200">\n                <option selected value="2">${window.siyuan.languages.all}</option>\n                <option value="0">${window.siyuan.languages.themeLight}</option>\n                <option value="1">${window.siyuan.languages.themeDark}</option>\n            </select>\n            <div class="fn__space"></div>\n            <div class="fn__space"></div>\n        </div>\n        <div id="configBazaarTheme">\n            ${i}\n        </div>\n    </div>\n    <div class="fn__none bazaarPanel" data-type="template">\n        <div class="fn__hr"></div>\n        <div class="fn__flex">\n            <div class="fn__space"></div>\n            <div class="fn__space"></div>\n            <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconSort"></use></svg>\n            <div class="fn__space"></div>\n            <select class="b3-select fn__size200">\n                <option ${"0"===n.template?"selected":""} value="0">${window.siyuan.languages.sortByUpdateTimeDesc}</option>\n                <option ${"1"===n.template?"selected":""} value="1">${window.siyuan.languages.sortByUpdateTimeAsc}</option>\n                <option ${"2"===n.template?"selected":""} value="2">${window.siyuan.languages.sortByDownloadsDesc}</option>\n                <option ${"3"===n.template?"selected":""} value="3">${window.siyuan.languages.sortByDownloadsAsc}</option>\n            </select>\n        </div>\n        <div id="configBazaarTemplate">\n            ${i}\n        </div>\n    </div>\n    <div class="fn__none bazaarPanel" data-type="icon">\n        <div class="fn__hr"></div>\n        <div class="fn__flex">\n            <div class="fn__space"></div>\n            <div class="fn__space"></div>\n            <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconSort"></use></svg>\n            <div class="fn__space"></div>\n            <select class="b3-select fn__size200">\n                <option ${"0"===n.icon?"selected":""} value="0">${window.siyuan.languages.sortByUpdateTimeDesc}</option>\n                <option ${"1"===n.icon?"selected":""} value="1">${window.siyuan.languages.sortByUpdateTimeAsc}</option>\n                <option ${"2"===n.icon?"selected":""} value="2">${window.siyuan.languages.sortByDownloadsDesc}</option>\n                <option ${"3"===n.icon?"selected":""} value="3">${window.siyuan.languages.sortByDownloadsAsc}</option>\n            </select>\n        </div>\n        <div id="configBazaarIcon">\n            ${i}\n        </div>\n    </div>\n    <div class="fn__none bazaarPanel" data-type="widget">\n        <div class="fn__hr"></div>\n        <div class="fn__flex">\n            <div class="fn__space"></div>\n            <div class="fn__space"></div>\n            <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconSort"></use></svg>\n            <div class="fn__space"></div>\n            <select class="b3-select fn__size200">\n                <option ${"0"===n.widget?"selected":""} value="0">${window.siyuan.languages.sortByUpdateTimeDesc}</option>\n                <option ${"1"===n.widget?"selected":""} value="1">${window.siyuan.languages.sortByUpdateTimeAsc}</option>\n                <option ${"2"===n.widget?"selected":""} value="2">${window.siyuan.languages.sortByDownloadsDesc}</option>\n                <option ${"3"===n.widget?"selected":""} value="3">${window.siyuan.languages.sortByDownloadsAsc}</option>\n            </select>\n        </div>\n        <div id="configBazaarWidget">\n            ${i}\n        </div>\n    </div>\n    <div class="bazaarPanel fn__none" data-type="downloaded">\n        <div class="fn__hr"></div>\n        <div class="fn__flex">\n            <div class="fn__space"></div>\n            <div class="fn__space"></div>\n            <button data-type="myTheme" class="b3-button">${window.siyuan.languages.theme}</button>\n            <div class="fn__space"></div>\n            <button data-type="myTemplate" class="b3-button b3-button--outline">${window.siyuan.languages.template}</button>\n            <div class="fn__space"></div>\n            <button data-type="myIcon" class="b3-button b3-button--outline">${window.siyuan.languages.icon}</button>\n            <div class="fn__space"></div>\n            <button data-type="myWidget" class="b3-button b3-button--outline">${window.siyuan.languages.widget}</button>\n        </div>\n        <div id="configBazaarDownloaded">\n            ${i}\n        </div>\n    </div>\n</div>\n<div id="configBazaarReadme" class="config-bazaar__readme"></div>\n</div>`},getHTML(e,n){let i=!1,a="";if("themes"===n){const n=t.bazaar.element.querySelector("#bazaarSelect").value;("0"===n&&e.modes.includes("dark")||"1"===n&&e.modes.includes("light"))&&(i=!0),a=e.modes.toString()}let o=!1;return["icons","themes"].includes(n)&&(o=!0),`<div data-bazaar="${n}" class="b3-card${i?" fn__none":""}${e.current?" b3-card--current":""}" data-type="${a}" data-updated="${e.updated}">\n    <div class="b3-card__img"><img src="${e.previewURLThumb}"/></div>\n    <div class="b3-card__info fn__flex">\n        <span class="fn__flex-center fn__ellipsis">${e.name}</span>\n        <span class="fn__space"></span>\n        <span class="fn__flex-1"></span>\n        <svg class="svg fn__flex-center"><use xlink:href="#iconDownload"></use></svg>\n        <span class="fn__space"></span>\n        <span class="fn__flex-center">${e.downloads}</span>\n    </div>\n    <div class="b3-card__actions" data-name="${e.name}" data-url="${e.repoURL}" data-hash="${e.repoHash}">\n        <div class="fn__flex-1"></div>\n        <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${e.installed?"":" fn__none"}" data-type="uninstall" aria-label="${window.siyuan.languages.uninstall}">\n            <svg><use xlink:href="#iconTrashcan"></use></svg>\n        </span>\n        <div class="fn__space${!e.current&&e.installed&&o?"":" fn__none"}"></div>\n        <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${!e.current&&e.installed&&o?"":" fn__none"}" data-type="switch" aria-label="${window.siyuan.languages.use}">\n            <svg><use xlink:href="#iconSelect"></use></svg>\n        </span>\n        <div class="fn__space${e.outdated?"":" fn__none"}"></div>\n        <span data-type="install-t" class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${e.outdated?"":" fn__none"}" aria-label="${window.siyuan.languages.update}">\n            <svg class="ft__primary"><use xlink:href="#iconRefresh"></use></svg>\n        </span>\n    </div>\n</div>`},_genMyHTML(e){let n="/api/bazaar/getInstalledTheme";"icons"===e?n="/api/bazaar/getInstalledIcon":"widgets"===e?n="/api/bazaar/getInstalledWidget":"templates"===e&&(n="/api/bazaar/getInstalledTemplate"),(0,o.fetchPost)(n,{},(n=>{let i="",a=!1;["icons","themes"].includes(e)&&(a=!0),n.data.packages.forEach((t=>{var n;i+=`<div data-bazaar="${e}" data-type="${null===(n=t.modes)||void 0===n?void 0:n.toString()}" data-downloaded="true" class="b3-card${t.current?" b3-card--current":""}">\n    <div class="b3-card__img"><img src="${t.previewURLThumb}"/></div>\n    <div class="b3-card__info">\n        ${t.name}\n    </div>\n    <div class="b3-card__actions" data-url="${t.repoURL}" data-name="${t.name}" data-hash="${t.repoHash}">\n        <div class="fn__flex-1"></div>\n        <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show" data-type="uninstall" aria-label="${window.siyuan.languages.uninstall}">\n            <svg><use xlink:href="#iconTrashcan"></use></svg>\n        </span>\n        <span class="fn__space${(0,d.isBrowser)()?" fn__none":""}"></span>\n        <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${(0,d.isBrowser)()?" fn__none":""}" data-type="open" aria-label="${window.siyuan.languages.showInFolder}">\n            <svg><use xlink:href="#iconFolder"></use></svg>\n        </span>\n        <span class="fn__space${!t.current&&a?"":" fn__none"}"></span>\n        <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${!t.current&&a?"":" fn__none"}" data-type="switch" aria-label="${window.siyuan.languages.use}">\n            <svg><use xlink:href="#iconSelect"></use></svg>\n        </span>\n        <span class="fn__space${t.outdated?"":" fn__none"}"></span>\n        <span data-type="install-t" aria-label="${window.siyuan.languages.update}" class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${t.outdated?"":" fn__none"}">\n            <svg class="ft__primary"><use xlink:href="#iconRefresh"></use></svg>\n        </span>\n    </div>\n</div>`})),t.bazaar.data.downloaded=n.data.packages,t.bazaar.element.querySelector("#configBazaarDownloaded").innerHTML=i?`<div class="b3-cards">${i}</div>`:`<div class="fn__hr"></div><ul class="b3-list b3-list--background"><li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li></ul>`}))},data:{themes:[],templates:[],icons:[],widgets:[],downloaded:[]},renderReadme(e,n){var i;const a="true"===e.getAttribute("data-downloaded"),s=e.querySelector(".b3-card__actions").getAttribute("data-url");let r;(a?t.bazaar.data.downloaded:t.bazaar.data[n]).find((e=>{if(e.repoURL===s)return r=e,!0}));const c=t.bazaar.element.querySelector("#configBazaarReadme"),u=r.repoURL.split("/");u.pop();let d=window.siyuan.languages.icon;if("themes"===n?d=r.modes.includes("dark")?window.siyuan.languages.themeDark+" "+window.siyuan.languages.theme:window.siyuan.languages.themeLight+" "+window.siyuan.languages.theme:"widgets"===n?d=window.siyuan.languages.widget:"templates"===n&&(d=window.siyuan.languages.template),c.innerHTML=` <div class="item__side">\n    <div class="fn__flex">\n        <button class="b3-button b3-button--outline" data-type="goBack" title="Go back"><svg><use xlink:href="#iconLeft"></use></svg></button>\n        <div class="item__nav">${d}</div>\n    </div>\n    <div class="fn__flex-1"></div>\n    <a href="${r.repoURL}" target="_blank" class="item__title" title="GitHub Repo">${r.name}</a>\n    <div class="fn__hr--b"></div>\n    <div class="fn__hr--b"></div>\n    <div style="line-height: 20px;"><span class="ft__smaller">Made with ❤️ by</span><br><a href="${u.join("/")}" target="_blank" title="Creator">${r.author}</a></div>\n    <div class="fn__hr--b"></div>\n    <div class="fn__hr--b"></div>\n    <div class="ft__on-surface ft__smaller" style="line-height: 20px;">${window.siyuan.languages.currentVer}<br>v${r.version}</div>\n    <div class="fn__hr"></div>\n    <div class="ft__on-surface ft__smaller" style="line-height: 20px;">${a?window.siyuan.languages.installDate:window.siyuan.languages.releaseDate}<br>${a?r.hInstallDate:r.hUpdated}</div>\n    <div class="fn__hr"></div>\n    <div class="ft__on-surface ft__smaller" style="line-height: 20px;">${a?window.siyuan.languages.installSize:window.siyuan.languages.pkgSize}<br>${a?r.hInstallSize:r.hSize}</div>\n    <div class="fn__hr--b"></div>\n    <div class="fn__hr--b"></div>\n    <div class="${r.installed||a?"fn__none":""}" data-type="${null===(i=r.modes)||void 0===i?void 0:i.toString()}">\n        <button class="b3-button" style="width: 168px" data-hash="${r.repoHash}" data-name="${r.name}" data-bazaar="${n}" data-url="${r.repoURL}" data-type="install">${window.siyuan.languages.download}</button>\n    </div>\n    <div class="fn__hr--b${a?" fn__none":""}"></div>\n    <div class="fn__hr--b${a?" fn__none":""}"></div>\n    <div class="fn__flex${a?" fn__none":""}" style="justify-content: center;">\n        <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconGithub"></use></svg>\n        <span class="fn__space"></span>\n        <a href="${r.repoURL}" target="_blank" title="GitHub Repo">Repo</a>\n        <span class="fn__space"></span>\n        <span class="fn__space"></span>\n        <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconStar"></use></svg>\n        <span class="fn__space"></span>\n        <a href="${r.repoURL}/stargazers" target="_blank" title="Starts">${r.stars}</a>\n        <span class="fn__space"></span>\n        <span class="fn__space"></span>\n        <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconGitHubI"></use></svg>\n        <span class="fn__space"></span>\n        <a href="${r.repoURL}/issues" target="_blank" title="Open issues">${r.openIssues}</a>\n        <span class="fn__space"></span>\n        <span class="fn__space"></span>\n        <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconDownload"></use></svg>\n        <span class="fn__space"></span>\n        ${r.downloads}\n    </div>\n    <div class="fn__flex-1"></div>\n</div>\n<div class="item__main">\n    <div class="item__preview" style="background-image: url(${r.previewURL})"></div>\n    <div class="item__readme b3-typography b3-typography--default" style="position:relative;">\n        <img data-type="img-loading" style="position: absolute;top: 0;left: 0;height: 100%;width: 100%;padding: 48px;box-sizing: border-box;" src="/stage/loading-pure.svg">\n    </div>\n</div>`,a){const e=c.querySelector(".item__readme");e.innerHTML=r.readme,(0,l.highlightRender)(e)}else(0,o.fetchPost)("/api/bazaar/getBazaarPackageREAME",{repoURL:r.repoURL,repoHash:r.repoHash},(e=>{const t=c.querySelector(".item__readme");t.innerHTML=e.data.html,(0,l.highlightRender)(t)}));c.style.right="0"},bindEvent(){(0,o.fetchPost)("/api/bazaar/getBazaarTheme",{},(e=>{t.bazaar.onBazaar(e,"themes",!1),t.bazaar.data.themes=e.data.packages})),t.bazaar.element.addEventListener("click",(e=>{let n=e.target;for(;n&&!n.isEqualNode(t.bazaar.element);){const l=n.getAttribute("data-type");if("open"===l){e.preventDefault(),e.stopPropagation();break}if("myTheme"===l||"myTemplate"===l||"myIcon"===l||"myWidget"===l){n.classList.contains("b3-button--outline")&&(n.parentElement.childNodes.forEach((e=>{3!==e.nodeType&&e.classList.contains("b3-button")&&e.classList.add("b3-button--outline")})),n.classList.remove("b3-button--outline"),this._genMyHTML(l.replace("my","").toLowerCase()+"s")),e.preventDefault(),e.stopPropagation();break}if("goBack"===l){t.bazaar.element.querySelector("#configBazaarReadme").style.right="-100%",e.preventDefault(),e.stopPropagation();break}if("install"===l){if(!n.classList.contains("b3-button--progress")){const e=n.getAttribute("data-bazaar");let i="/api/bazaar/installBazaarTemplate";"themes"===e?i="/api/bazaar/installBazaarTheme":"icons"===e?i="/api/bazaar/installBazaarIcon":"widgets"===e&&(i="/api/bazaar/installBazaarWidget"),(0,o.fetchPost)(i,{repoURL:n.getAttribute("data-url"),packageName:n.getAttribute("data-name"),repoHash:n.getAttribute("data-hash"),mode:"dark"===n.parentElement.getAttribute("data-type")?1:0},(n=>{window.siyuan.config.appearance.themeJS&&"themes"===e?(0,c.exportLayout)(!0):t.bazaar.onBazaar(n,e,["themes","icons"].includes(e))}))}e.preventDefault(),e.stopPropagation();break}if("install-t"===l){(0,r.confirmDialog)(window.siyuan.languages.update,window.siyuan.languages.exportTplTip,(()=>{const e=(0,s.hasClosestByClassName)(n,"b3-card");let i="themes";e&&(i=e.getAttribute("data-bazaar"));let a="/api/bazaar/installBazaarTemplate";"themes"===i?a="/api/bazaar/installBazaarTheme":"icons"===i?a="/api/bazaar/installBazaarIcon":"widgets"===i&&(a="/api/bazaar/installBazaarWidget"),n.parentElement.insertAdjacentHTML("afterend",'<img data-type="img-loading" style="position: absolute;top: 0;left: 0;height: 100%;width: 100%;padding: 48px;box-sizing: border-box;" src="/stage/loading-pure.svg">');const r=n.parentElement.getAttribute("data-name");(0,o.fetchPost)(a,{repoURL:n.parentElement.getAttribute("data-url"),packageName:r,repoHash:n.parentElement.getAttribute("data-hash"),mode:"dark"===n.parentElement.parentElement.getAttribute("data-type")?1:0,update:!0},(n=>{if(e&&"true"===e.getAttribute("data-downloaded")?this._genMyHTML(i):t.bazaar.onBazaar(n,i,["icons"].includes(i)),"themes"===i&&(0===window.siyuan.config.appearance.mode&&window.siyuan.config.appearance.themeLight===r||1===window.siyuan.config.appearance.mode&&window.siyuan.config.appearance.themeDark===r))if(window.siyuan.config.appearance.themeJS)(0,c.exportLayout)(!0);else{const e=document.getElementById("themeDefaultStyle");e.href=e.href+"1"}}))})),e.preventDefault(),e.stopPropagation();break}if("uninstall"===l){const i=(0,s.hasClosestByClassName)(n,"b3-card");let r="themes";i&&(r=i.getAttribute("data-bazaar"));let l="/api/bazaar/uninstallBazaarTemplate";"themes"===r?l="/api/bazaar/uninstallBazaarTheme":"icons"===r?l="/api/bazaar/uninstallBazaarIcon":"widgets"===r&&(l="/api/bazaar/uninstallBazaarWidget");const c=n.parentElement.getAttribute("data-name");window.siyuan.config.appearance.themeDark===c||window.siyuan.config.appearance.themeLight===c||window.siyuan.config.appearance.icon===c?(0,a.showMessage)(window.siyuan.languages.uninstallTip):(0,o.fetchPost)(l,{packageName:c},(e=>{i&&"true"===i.getAttribute("data-downloaded")?this._genMyHTML(r):t.bazaar.onBazaar(e,r,["themes","icons"].includes(r))})),e.preventDefault(),e.stopPropagation();break}if("switch"===l){const a=n.parentElement.getAttribute("data-name"),r=(0,s.hasClosestByClassName)(n,"b3-card");let l,u="themes";r&&(u=r.getAttribute("data-bazaar"),l="dark"===r.getAttribute("data-type")?1:0),"icons"===u?(0,o.fetchPost)("/api/setting/setAppearance",{icon:a,mode:window.siyuan.config.appearance.mode,codeBlockThemeDark:window.siyuan.config.appearance.codeBlockThemeDark,codeBlockThemeLight:window.siyuan.config.appearance.codeBlockThemeLight,themeDark:window.siyuan.config.appearance.themeDark,themeLight:window.siyuan.config.appearance.themeLight,darkThemes:window.siyuan.config.appearance.darkThemes,lightThemes:window.siyuan.config.appearance.lightThemes,icons:window.siyuan.config.appearance.icons,lang:window.siyuan.config.appearance.lang,customCSS:window.siyuan.config.appearance.customCSS,closeButtonBehavior:window.siyuan.config.appearance.closeButtonBehavior,nativeEmoji:window.siyuan.config.appearance.nativeEmoji},(e=>{t.bazaar.element.querySelectorAll(`[data-name="${window.siyuan.config.appearance.icon}"]`).forEach((e=>{e.parentElement.classList.remove("b3-card--current");const t=e.querySelector('[data-type="switch"]');t.classList.remove("fn__none"),t.previousElementSibling.classList.remove("fn__none")})),i.appearance.onSetappearance(e.data),t.bazaar.element.querySelectorAll(`[data-name="${a}"]`).forEach((e=>{e.parentElement.classList.add("b3-card--current");const t=e.querySelector('[data-type="switch"]');t.classList.add("fn__none"),t.previousElementSibling.classList.add("fn__none")})),i.appearance.onSetappearance(e.data)})):"themes"===u&&(0,o.fetchPost)("/api/setting/setAppearance",{icon:window.siyuan.config.appearance.icon,mode:l,codeBlockThemeDark:window.siyuan.config.appearance.codeBlockThemeDark,codeBlockThemeLight:window.siyuan.config.appearance.codeBlockThemeLight,themeDark:1===l?a:window.siyuan.config.appearance.themeDark,themeLight:0===l?a:window.siyuan.config.appearance.themeLight,darkThemes:window.siyuan.config.appearance.darkThemes,lightThemes:window.siyuan.config.appearance.lightThemes,icons:window.siyuan.config.appearance.icons,lang:window.siyuan.config.appearance.lang,customCSS:window.siyuan.config.appearance.customCSS,closeButtonBehavior:window.siyuan.config.appearance.closeButtonBehavior,nativeEmoji:window.siyuan.config.appearance.nativeEmoji},(e=>{if((l!==window.siyuan.config.appearance.mode||1===l&&window.siyuan.config.appearance.themeDark!==a||0===l&&window.siyuan.config.appearance.themeLight!==a)&&window.siyuan.config.appearance.themeJS)(0,c.exportLayout)(!0);else{const n=1===window.siyuan.config.appearance.mode?window.siyuan.config.appearance.themeDark:window.siyuan.config.appearance.themeLight;t.bazaar.element.querySelectorAll(`[data-name="${n}"]`).forEach((e=>{e.parentElement.classList.remove("b3-card--current");const t=e.querySelector('[data-type="switch"]');t.classList.remove("fn__none"),t.previousElementSibling.classList.remove("fn__none")})),i.appearance.onSetappearance(e.data),t.bazaar.element.querySelectorAll(`[data-name="${a}"]`).forEach((e=>{e.parentElement.classList.add("b3-card--current");const t=e.querySelector('[data-type="switch"]');t.classList.add("fn__none"),t.previousElementSibling.classList.add("fn__none")}))}})),e.preventDefault(),e.stopPropagation();break}if(n.classList.contains("b3-card")){t.bazaar.renderReadme(n,n.getAttribute("data-bazaar")),e.preventDefault(),e.stopPropagation();break}if(n.classList.contains("item")&&!n.classList.contains("item--focus")){t.bazaar.element.querySelector(".layout-tab-bar .item--focus").classList.remove("item--focus"),n.classList.add("item--focus");const i=n.getAttribute("data-type");t.bazaar.element.querySelectorAll(".bazaarPanel").forEach((e=>{i===e.getAttribute("data-type")?(e.classList.remove("fn__none"),e.getAttribute("data-init")||("template"===i?(0,o.fetchPost)("/api/bazaar/getBazaarTemplate",{},(e=>{t.bazaar.onBazaar(e,"templates",!1),t.bazaar.data.templates=e.data.packages})):"icon"===i?(0,o.fetchPost)("/api/bazaar/getBazaarIcon",{},(e=>{t.bazaar.onBazaar(e,"icons",!1),t.bazaar.data.icons=e.data.packages})):"widget"===i?(0,o.fetchPost)("/api/bazaar/getBazaarWidget",{},(e=>{t.bazaar.onBazaar(e,"widgets",!1),t.bazaar.data.widgets=e.data.packages})):"downloaded"===i&&this._genMyHTML("themes"),e.setAttribute("data-init","true"))):e.classList.add("fn__none")})),e.preventDefault(),e.stopPropagation();break}if(n.classList.contains("item__preview")){n.classList.toggle("item__preview--fullscreen"),e.preventDefault(),e.stopPropagation();break}n=n.parentElement}})),t.bazaar.element.querySelectorAll(".b3-select").forEach((e=>{e.addEventListener("change",(()=>{if("bazaarSelect"===e.id)t.bazaar.element.querySelectorAll("#configBazaarTheme .b3-card").forEach((t=>{"0"===e.value?t.getAttribute("data-type").indexOf("light")>-1?t.classList.remove("fn__none"):t.classList.add("fn__none"):"1"===e.value?t.getAttribute("data-type").indexOf("dark")>-1?t.classList.remove("fn__none"):t.classList.add("fn__none"):t.classList.remove("fn__none")}));else{const t=JSON.parse(localStorage.getItem(u.Constants.LOCAL_BAZAAR)),n=e.parentElement.parentElement;let i="";"0"===e.value?Array.from(n.querySelectorAll(".b3-card")).sort(((e,t)=>t.getAttribute("data-updated")<e.getAttribute("data-updated")?-1:1)).forEach((e=>{i+=e.outerHTML})):"1"===e.value?Array.from(n.querySelectorAll(".b3-card")).sort(((e,t)=>t.getAttribute("data-updated")<e.getAttribute("data-updated")?1:-1)).forEach((e=>{i+=e.outerHTML})):"2"===e.value?Array.from(n.querySelectorAll(".b3-card")).sort(((e,t)=>parseInt(t.querySelector(".b3-card__info").lastElementChild.textContent)<parseInt(e.querySelector(".b3-card__info").lastElementChild.textContent)?-1:1)).forEach((e=>{i+=e.outerHTML})):"3"===e.value&&Array.from(n.querySelectorAll(".b3-card")).sort(((e,t)=>parseInt(t.querySelector(".b3-card__info").lastElementChild.textContent)<parseInt(e.querySelector(".b3-card__info").lastElementChild.textContent)?1:-1)).forEach((e=>{i+=e.outerHTML})),t[e.parentElement.parentElement.getAttribute("data-type")]=e.value,localStorage.setItem(u.Constants.LOCAL_BAZAAR,JSON.stringify(t)),n.querySelector(".b3-cards").innerHTML=i}}))}))},onBazaar(e,n,o){let s="#configBazaarTemplate";"themes"===n?s="#configBazaarTheme":"icons"===n?s="#configBazaarIcon":"widgets"===n&&(s="#configBazaarWidget");const r=t.bazaar.element.querySelector(s);1===e.code&&((0,a.showMessage)(e.msg),r.querySelectorAll("img[data-type='img-loading']").forEach((e=>{e.remove()})));let l="";e.data.packages.forEach((e=>{l+=this.getHTML(e,n)})),t.bazaar.data[n]=e.data.packages,r.innerHTML=`<div class="b3-cards">${l}</div>`;const c=JSON.parse(localStorage.getItem(u.Constants.LOCAL_BAZAAR));"1"===c[n.replace("s","")]?(l="",Array.from(r.querySelectorAll(".b3-card")).sort(((e,t)=>t.getAttribute("data-updated")<e.getAttribute("data-updated")?1:-1)).forEach((e=>{l+=e.outerHTML}))):"2"===c[n.replace("s","")]?(l="",Array.from(r.querySelectorAll(".b3-card")).sort(((e,t)=>parseInt(t.querySelector(".b3-card__info").lastElementChild.textContent)<parseInt(e.querySelector(".b3-card__info").lastElementChild.textContent)?-1:1)).forEach((e=>{l+=e.outerHTML}))):"3"===c[n.replace("s","")]&&(l="",Array.from(r.querySelectorAll(".b3-card")).sort(((e,t)=>parseInt(t.querySelector(".b3-card__info").lastElementChild.textContent)<parseInt(e.querySelector(".b3-card__info").lastElementChild.textContent)?1:-1)).forEach((e=>{l+=e.outerHTML}))),r.innerHTML=`<div class="b3-cards">${l}</div>`,o&&i.appearance.onSetappearance(e.data.appearance)}}},7252:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.editor=void 0;const i=n(2892),a=n(8785),o=n(734),s=n(1377),r=n(1384),l=n(5961);t.editor={element:void 0,genHTML:()=>{let e="";return e='<select id="fontFamily" class="b3-select fn__flex-center fn__size200"></select>',`<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.fullWidth}\n        <div class="b3-label__text">${window.siyuan.languages.fullWidthTip}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="fullWidth" type="checkbox"${window.siyuan.config.editor.fullWidth?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.md12}\n        <div class="b3-label__text">${window.siyuan.languages.md16}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="displayBookmarkIcon" type="checkbox"${window.siyuan.config.editor.displayBookmarkIcon?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.md7}\n        <div class="b3-label__text">${window.siyuan.languages.md8}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="displayNetImgMark" type="checkbox"${window.siyuan.config.editor.displayNetImgMark?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.md31}\n        <div class="b3-label__text">${window.siyuan.languages.md32}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="codeLineWrap" type="checkbox"${window.siyuan.config.editor.codeLineWrap?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.md2}\n        <div class="b3-label__text">${window.siyuan.languages.md3}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="codeLigatures" type="checkbox"${window.siyuan.config.editor.codeLigatures?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.md27}\n        <div class="b3-label__text">${window.siyuan.languages.md28}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="codeSyntaxHighlightLineNum" type="checkbox"${window.siyuan.config.editor.codeSyntaxHighlightLineNum?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.md33}\n        <div class="b3-label__text">${window.siyuan.languages.md34}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="virtualBlockRef" type="checkbox"${window.siyuan.config.editor.virtualBlockRef?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.md35}\n        <div class="b3-label__text">${window.siyuan.languages.md36}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="virtualBlockRefExclude" value="${window.siyuan.config.editor.virtualBlockRefExclude}" />\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.md39}\n        <div class="b3-label__text">${window.siyuan.languages.md40}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="plantUMLServePath" value="${window.siyuan.config.editor.plantUMLServePath}"/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.md37}\n        <div class="b3-label__text">${window.siyuan.languages.md38}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="blockRefDynamicAnchorTextMaxLen" type="number" min="1" max="5120" value="${window.siyuan.config.editor.blockRefDynamicAnchorTextMaxLen}"/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.generateHistory}\n        <div class="b3-label__text">${window.siyuan.languages.generateHistoryInterval}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="generateHistoryInterval" type="number" min="0" max="120" value="${window.siyuan.config.editor.generateHistoryInterval}"/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.historyRetentionDays} \n        <a href="javascript:void(0)" id="clearHistory">${window.siyuan.languages.clearHistory}</a>\n        <div class="b3-label__text">${window.siyuan.languages.historyRetentionDaysTip}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="historyRetentionDays" type="number" min="0" max="120" value="${window.siyuan.config.editor.historyRetentionDays}"/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.font}\n        <div class="b3-label__text">${window.siyuan.languages.font1}</div>\n    </div>\n    <span class="fn__space"></span>\n    <select id="fontFamily" class="b3-select fn__flex-center fn__size200"></select>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.fontSize}\n        <div class="b3-label__text">${window.siyuan.languages.fontSizeTip}</div>\n    </div>\n    <span class="fn__space"></span>\n    <div class="b3-tooltips b3-tooltips__n fn__flex-center" aria-label="${window.siyuan.config.editor.fontSize}">   \n        <input class="b3-slider fn__size200" id="fontSize" max="72" min="9" step="1" type="range" value="${window.siyuan.config.editor.fontSize}">\n    </div>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.md29}\n        <div class="b3-label__text">${window.siyuan.languages.md30}</div>\n    </div>\n    <span class="fn__space"></span>\n    <div class="b3-tooltips b3-tooltips__n fn__flex-center" aria-label="${window.siyuan.config.editor.codeTabSpaces}">   \n        <input class="b3-slider fn__size200" id="codeTabSpaces" max="8" min="0" step="2" type="range" value="${window.siyuan.config.editor.codeTabSpaces}">\n    </div>\n</label>\n<div class="b3-label">\n    ${window.siyuan.languages.katexMacros}\n    <div class="b3-label__text">${window.siyuan.languages.katexMacrosTip}</div>\n    <div class="fn__hr"></div>\n    <textarea class="b3-text-field fn__block" id="katexMacros">${window.siyuan.config.editor.katexMacros}</textarea>\n</div>`},bindEvent:()=>{const e=t.editor.element.querySelector("#fontFamily");if("SELECT"===e.tagName){let t=`<option value="">${window.siyuan.languages.default}</option>`;(0,o.fetchPost)("/api/system/getSysFonts",{},(n=>{n.data.forEach((e=>{t+=`<option value="${e}"${window.siyuan.config.editor.fontFamily===e?" selected":""}>${e}</option>`})),e.innerHTML=t}))}t.editor.element.querySelector("#clearHistory").addEventListener("click",(()=>{(0,s.confirmDialog)(window.siyuan.languages.clearHistory,window.siyuan.languages.confirmClearHistory,(()=>{(0,o.fetchPost)("/api/history/clearWorkspaceHistory",{})}))}));const n=()=>{(0,o.fetchPost)("/api/setting/setEditor",{fullWidth:t.editor.element.querySelector("#fullWidth").checked,displayBookmarkIcon:t.editor.element.querySelector("#displayBookmarkIcon").checked,displayNetImgMark:t.editor.element.querySelector("#displayNetImgMark").checked,codeSyntaxHighlightLineNum:t.editor.element.querySelector("#codeSyntaxHighlightLineNum").checked,plantUMLServePath:t.editor.element.querySelector("#plantUMLServePath").value,katexMacros:t.editor.element.querySelector("#katexMacros").value,codeLineWrap:t.editor.element.querySelector("#codeLineWrap").checked,virtualBlockRef:t.editor.element.querySelector("#virtualBlockRef").checked,virtualBlockRefExclude:t.editor.element.querySelector("#virtualBlockRefExclude").value,blockRefDynamicAnchorTextMaxLen:parseInt(t.editor.element.querySelector("#blockRefDynamicAnchorTextMaxLen").value),codeLigatures:t.editor.element.querySelector("#codeLigatures").checked,codeTabSpaces:parseInt(t.editor.element.querySelector("#codeTabSpaces").value),fontSize:parseInt(t.editor.element.querySelector("#fontSize").value),generateHistoryInterval:parseInt(t.editor.element.querySelector("#generateHistoryInterval").value),historyRetentionDays:parseInt(t.editor.element.querySelector("#historyRetentionDays").value),fontFamily:e.value,emoji:window.siyuan.config.editor.emoji},(e=>{t.editor.onSetEditor(e.data)}))};t.editor.element.querySelectorAll("input.b3-switch, select.b3-select, input.b3-slider").forEach((e=>{e.addEventListener("change",(()=>{n()}))})),t.editor.element.querySelectorAll("textarea.b3-text-field, input.b3-text-field, input.b3-slider").forEach((e=>{e.addEventListener("blur",(()=>{n()}))})),t.editor.element.querySelectorAll("input.b3-slider").forEach((e=>{e.addEventListener("input",(e=>{const t=e.target;t.parentElement.setAttribute("aria-label",t.value)}))}))},onSetEditor:e=>{window.siyuan.config.editor=e,(0,i.getAllModels)().editor.forEach((e=>{(0,l.reloadProtyle)(e.editor.protyle),(0,r.setPadding)(e.editor.protyle),window.siyuan.config.editor.fullWidth?e.editor.protyle.contentElement.setAttribute("data-fullwidth","true"):e.editor.protyle.contentElement.removeAttribute("data-fullwidth")})),(0,a.setInlineStyle)()}}},9224:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exportConfig=void 0;const i=n(734),a=n(3274);t.exportConfig={element:void 0,genHTML:()=>`<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.paragraphBeginningSpace}\n        <div class="b3-label__text">${window.siyuan.languages.md4}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="paragraphBeginningSpace" type="checkbox"${window.siyuan.config.export.paragraphBeginningSpace?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.export17}\n        <div class="b3-label__text">${window.siyuan.languages.export18}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="addTitle" type="checkbox"${window.siyuan.config.export.addTitle?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.blockRef}\n        <div class="b3-label__text">${window.siyuan.languages.export11}</div>\n    </div>\n    <span class="fn__space"></span>\n    <select id="blockRefMode" class="b3-select fn__flex-center fn__size200">\n        <option value="2" ${2===window.siyuan.config.export.blockRefMode?"selected":""}>${window.siyuan.languages.export2}</option>\n        <option value="3" ${3===window.siyuan.config.export.blockRefMode?"selected":""}>${window.siyuan.languages.export3}</option>\n        <option value="4" ${4===window.siyuan.config.export.blockRefMode?"selected":""}>${window.siyuan.languages.export4}</option>\n    </select>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.blockEmbed}\n        <div class="b3-label__text">${window.siyuan.languages.export12}</div>\n    </div>\n    <span class="fn__space"></span>\n    <select id="blockEmbedMode" class="b3-select fn__flex-center fn__size200">\n        <option value="0" ${0===window.siyuan.config.export.blockEmbedMode?"selected":""}>${window.siyuan.languages.export0}</option>\n        <option value="1" ${1===window.siyuan.config.export.blockEmbedMode?"selected":""}>${window.siyuan.languages.export1}</option>\n    </select>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.export5}\n        <div class="b3-label__text">${window.siyuan.languages.export6}</div>\n    </div>\n    <span class="fn__space"></span>\n    <select id="fileAnnotationRefMode" class="b3-select fn__flex-center fn__size200">\n        <option value="0" ${0===window.siyuan.config.export.fileAnnotationRefMode?"selected":""}>${window.siyuan.languages.export7}</option>\n        <option value="1" ${1===window.siyuan.config.export.fileAnnotationRefMode?"selected":""}>${window.siyuan.languages.export8}</option>\n    </select>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.export13}\n        <div class="b3-label__text">${window.siyuan.languages.export14}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center" id="blockRefTextLeft" style="width: 96px">\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center" id="blockRefTextRight" style="width: 96px">\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.export15}\n        <div class="b3-label__text">${window.siyuan.languages.export16}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center" id="tagOpenMarker" style="width: 96px">\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center" id="tagCloseMarker" style="width: 96px">\n</label>\n<label class="fn__flex b3-label${(0,a.isBrowser)()?" fn__none":""}">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.export19}\n        <span class="fn__space"></span>\n        <a href="javascript:void(0)" id="pandocBinPath">${window.siyuan.config.export.pandocBin}</a>\n        <div class="b3-label__text">${window.siyuan.languages.export20}</div>\n    </div>\n    <span class="fn__space"></span>\n    <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="pandocBin"><svg><use xlink:href="#iconSettings"></use></svg>${window.siyuan.languages.config}</button>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1 fn__flex-center">\n        ${window.siyuan.languages.export} Data\n        <div class="b3-label__text">${window.siyuan.languages.exportDataTip}</div>\n    </div>\n    <span class="fn__space"></span>\n    <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="exportData"><svg><use xlink:href="#iconUpload"></use></svg>${window.siyuan.languages.export}</button>\n</label>\n<div class="fn__flex b3-label">\n    <div class="fn__flex-1 fn__flex-center">\n        ${window.siyuan.languages.import} Data\n        <div class="b3-label__text">${window.siyuan.languages.importDataTip}</div>\n    </div>\n    <span class="fn__space"></span>\n    <button class="b3-button b3-button--outline fn__flex-center fn__size200" style="position: relative">\n        <input id="importData" class="b3-form__upload" type="file">\n        <svg><use xlink:href="#iconDownload"></use></svg>${window.siyuan.languages.import}\n    </button>\n</div>`,bindEvent:()=>{t.exportConfig.element.querySelector("#blockRefTextLeft").value=window.siyuan.config.export.blockRefTextLeft,t.exportConfig.element.querySelector("#blockRefTextRight").value=window.siyuan.config.export.blockRefTextRight,t.exportConfig.element.querySelector("#tagOpenMarker").value=window.siyuan.config.export.tagOpenMarker,t.exportConfig.element.querySelector("#tagCloseMarker").value=window.siyuan.config.export.tagCloseMarker;const e=t.exportConfig.element.querySelector("#pandocBinPath"),n=n=>{(0,i.fetchPost)("/api/setting/setExport",{paragraphBeginningSpace:t.exportConfig.element.querySelector("#paragraphBeginningSpace").checked,addTitle:t.exportConfig.element.querySelector("#addTitle").checked,blockRefMode:parseInt(t.exportConfig.element.querySelector("#blockRefMode").value,10),blockEmbedMode:parseInt(t.exportConfig.element.querySelector("#blockEmbedMode").value,10),fileAnnotationRefMode:parseInt(t.exportConfig.element.querySelector("#fileAnnotationRefMode").value,10),blockRefTextLeft:t.exportConfig.element.querySelector("#blockRefTextLeft").value,blockRefTextRight:t.exportConfig.element.querySelector("#blockRefTextRight").value,tagOpenMarker:t.exportConfig.element.querySelector("#tagOpenMarker").value,tagCloseMarker:t.exportConfig.element.querySelector("#tagCloseMarker").value,pandocBin:n||window.siyuan.config.export.pandocBin},(n=>{t.exportConfig.onSetexport(n.data),e.textContent=n.data.pandocBin}))};t.exportConfig.element.querySelectorAll("select").forEach((e=>{e.addEventListener("change",(()=>{n()}))})),t.exportConfig.element.querySelectorAll("input").forEach((e=>{"importData"==e.id?e.addEventListener("change",(e=>{const t=new FormData;t.append("file",e.target.files[0]),(0,i.fetchPost)("/api/import/importData",t)})):e.addEventListener("change",(()=>{n()}))})),t.exportConfig.element.querySelector("#exportData").addEventListener("click",(()=>{(0,i.fetchPost)("/api/export/exportData",{},(e=>{window.location.href=e.data.zip}))}))},onSetexport:e=>{window.siyuan.config.export=e}}},1340:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fileTree=void 0;const i=n(734);t.fileTree={element:void 0,genHTML:()=>`<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.selectOpen}\n        <div class="b3-label__text">${window.siyuan.languages.fileTree2}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="alwaysSelectOpenedFile" type="checkbox"${window.siyuan.config.fileTree.alwaysSelectOpenedFile?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.fileTree7}\n        <div class="b3-label__text">${window.siyuan.languages.fileTree8}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="openFilesUseCurrentTab" type="checkbox"${window.siyuan.config.fileTree.openFilesUseCurrentTab?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.fileTree9}\n        <div class="b3-label__text">${window.siyuan.languages.fileTree10}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="closeTabsOnStart" type="checkbox"${window.siyuan.config.fileTree.closeTabsOnStart?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.fileTree18}\n        <div class="b3-label__text">${window.siyuan.languages.fileTree19}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="allowCreateDeeper" type="checkbox"${window.siyuan.config.fileTree.allowCreateDeeper?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.fileTree3}\n        <div class="b3-label__text">${window.siyuan.languages.fileTree4}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="removeDocWithoutConfirm" type="checkbox"${window.siyuan.config.fileTree.removeDocWithoutConfirm?" checked":""}/>\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.fileTree12}\n        <div class="b3-label__text">${window.siyuan.languages.fileTree13}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="createDocNameTemplate" value="">\n</label>\n<label class="b3-label fn__flex">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.fileTree5}\n        <div class="b3-label__text">${window.siyuan.languages.fileTree6}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="refCreateSavePath" value="${window.siyuan.config.fileTree.refCreateSavePath}">\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.fileTree16}\n        <div class="b3-label__text">${window.siyuan.languages.fileTree17}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="maxListCount" type="number" min="1" max="10240" value="${window.siyuan.config.fileTree.maxListCount}">\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.tabLimit}\n        <div class="b3-label__text">${window.siyuan.languages.tabLimit1}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="maxOpenTabCount" type="number" min="1" max="32" value="${window.siyuan.config.fileTree.maxOpenTabCount}">\n</label>`,_send(){(0,i.fetchPost)("/api/setting/setFiletree",{sort:window.siyuan.config.fileTree.sort,alwaysSelectOpenedFile:t.fileTree.element.querySelector("#alwaysSelectOpenedFile").checked,refCreateSavePath:t.fileTree.element.querySelector("#refCreateSavePath").value,createDocNameTemplate:t.fileTree.element.querySelector("#createDocNameTemplate").value,openFilesUseCurrentTab:t.fileTree.element.querySelector("#openFilesUseCurrentTab").checked,closeTabsOnStart:t.fileTree.element.querySelector("#closeTabsOnStart").checked,allowCreateDeeper:t.fileTree.element.querySelector("#allowCreateDeeper").checked,removeDocWithoutConfirm:t.fileTree.element.querySelector("#removeDocWithoutConfirm").checked,maxListCount:parseInt(t.fileTree.element.querySelector("#maxListCount").value),maxOpenTabCount:parseInt(t.fileTree.element.querySelector("#maxOpenTabCount").value)},(e=>{t.fileTree.onSetfiletree(e.data)}))},bindEvent:()=>{t.fileTree.element.querySelector("#createDocNameTemplate").value=window.siyuan.config.fileTree.createDocNameTemplate,t.fileTree.element.querySelector("#refCreateSavePath").value=window.siyuan.config.fileTree.refCreateSavePath,t.fileTree.element.querySelectorAll("input").forEach((e=>{e.addEventListener("change",(()=>{t.fileTree._send()}))}))},onSetfiletree:e=>{window.siyuan.config.fileTree=e}}},3153:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.image=void 0;const i=n(3863),a=n(1377),o=n(8813),s=n(3274),r=n(3607),l=n(734),c=n(2892),u=n(4382);t.image={element:void 0,genHTML:()=>`\n<div class="b3-label config-assets">\n    <div class="fn__flex">\n        ${window.siyuan.languages.clearUnused}\n        <div class="fn__flex-1"></div>\n        <button id="removeAll" class="b3-button b3-button--outline fn__flex-center fn__size200">\n            <svg class="svg"><use xlink:href="#iconTrashcan"></use></svg>\n            ${window.siyuan.languages.delete}\n        </button>\n    </div>\n    <div class="fn__hr"></div>\n    <ul class="b3-list b3-list--background" id="assetsList">\n        <li class="ft__center" style="list-style: none"><img src="/stage/loading-pure.svg"></li>\n    </ul><div class="config-assets__preview"></div>\n</div>`,bindEvent:()=>{t.image.element.querySelector("#removeAll").addEventListener("click",(()=>{(0,a.confirmDialog)(window.siyuan.languages.clearUnused,`${window.siyuan.languages.clearAll}`,(()=>{(0,l.fetchPost)("/api/asset/removeUnusedAssets",{},(e=>{(0,c.getAllModels)().asset.forEach((t=>{e.data.paths.includes(t.path)&&t.parent.parent.removeTab(t.parent.id)})),(0,l.fetchPost)("/api/asset/getUnusedAssets",{},(e=>{t.image.onUnusedassets(e.data)}))}))}))}));const e=t.image.element.querySelector("#assetsList");e.addEventListener("click",(n=>{let i=n.target;for(;i&&!i.isEqualNode(e);){if(i.classList.contains("b3-tooltips")){const e=i.parentElement.getAttribute("data-path"),s=i.getAttribute("data-type");"open"===s||"clear"===s&&(0,a.confirmDialog)(window.siyuan.languages.clearUnused,`${window.siyuan.languages.delete} <b>${(0,o.pathPosix)().basename(e)}</b>`,(()=>{(0,l.fetchPost)("/api/asset/removeUnusedAsset",{path:e},(e=>{(0,c.getAllModels)().asset.forEach((t=>{e.data.path===t.path&&t.parent.parent.removeTab(t.parent.id)}))}));const n=i.parentElement;1===n.parentElement.querySelectorAll("li").length?n.parentElement.remove():n.remove(),t.image.element.querySelector(".config-assets__preview").innerHTML=""})),n.preventDefault(),n.stopPropagation();break}i=i.parentElement}})),e.addEventListener("mouseover",(t=>{const n=(0,r.hasClosestByClassName)(t.target,"b3-list-item");if(n&&n.getAttribute("data-path")!==e.nextElementSibling.getAttribute("data-path")){const t=n.getAttribute("data-path");e.nextElementSibling.setAttribute("data-path",t),e.nextElementSibling.innerHTML=(0,u.renderAssetsPreview)(t)}})),(0,l.fetchPost)("/api/asset/getUnusedAssets",{},(e=>{t.image.onUnusedassets(e.data)}))},onUnusedassets:e=>{let n="",a="";(0,s.isBrowser)()||(a=`<span data-type="open" class="b3-tooltips b3-tooltips__w b3-list-item__action" aria-label="${window.siyuan.languages.showInFolder}">\n    <svg><use xlink:href="#iconFolder"></use></svg>\n</span>`);const o=`<span data-type="clear" class="b3-tooltips b3-tooltips__w b3-list-item__action" aria-label="${window.siyuan.languages.delete}">\n    <svg><use xlink:href="#iconTrashcan"></use></svg>\n</span>`;e.unusedAssets.forEach((e=>{const t=e.indexOf("assets/"),s=e.substr(t);n+=`<li data-path="${s}"  class="b3-list-item b3-list-item--hide-action">\n    <span class="b3-list-item__text">${(0,i.escapeHtml)(e)}</span>\n    ${a}\n    ${o}\n</li>`})),t.image.element.querySelector("#assetsList").innerHTML=n||`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`,t.image.element.querySelector(".config-assets__preview").innerHTML=""}}},3559:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openSetting=void 0;const i=n(7252),a=n(9685),o=n(2186),s=n(3153),r=n(7245),l=n(1340),c=n(9224),u=n(7956),d=n(7766),p=n(4299),h=n(8556),f=n(5838),g=n(9866);t.openSetting=()=>{const e=window.siyuan.dialogs.find((e=>{if(e.element.querySelector(".b3-tab-container"))return e.destroy(),!0}));if(e)return e;const t=Math.min(.9*window.innerHeight,Math.max(.7*window.innerHeight,572)),n=new g.Dialog({content:`<div class="fn__flex-column" style="border-radius: 4px;overflow: hidden;position: relative">\n<div class="b3-form__icon search__header"><svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg><input class="b3-text-field b3-text-field--text fn__block b3-form__icon-input"></div>\n<div class="fn__flex-1 fn__flex">\n  <ul class="b3-tab-bar b3-list b3-list--background" style="user-select:none;width: 180px;height:${t}px;overflow: auto">\n    <li data-name="editor" class="b3-list-item--focus b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconEdit"></use></svg>${window.siyuan.languages.editor}</li>\n    <li data-name="filetree" class="b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconFiles"></use></svg>${window.siyuan.languages.fileTree}</li>\n    <li data-name="image" class="b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconImage"></use></svg>${window.siyuan.languages.assets}</li>\n    <li data-name="export" class="b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconUpload"></use></svg>${window.siyuan.languages.export}</li>\n    <li data-name="appearance" class="b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconTheme"></use></svg>${window.siyuan.languages.appearance}</li>\n    <li data-name="bazaar" class="b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconBazaar"></use></svg>${window.siyuan.languages.bazaar}</li>\n    <li data-name="search" class="b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconSearch"></use></svg>${window.siyuan.languages.search}</li>\n    <li data-name="keymap" class="b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconKeymap"></use></svg>${window.siyuan.languages.keymap}</li>\n    <li data-name="account" class="b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconAccount"></use></svg>${window.siyuan.languages.account}</li>\n    <li data-name="repos" class="b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconCloud"></use></svg>${window.siyuan.languages.cloud}</li>\n    <li data-name="about" class="b3-list-item b3-list-item--big"><svg class="b3-list-item__graphic"><use xlink:href="#iconInfo"></use></svg>${window.siyuan.languages.about}</li>\n  </ul>\n  <div class="b3-tab-container" style="height:${t}px" data-name="editor">${i.editor.genHTML()}</div>\n  <div class="b3-tab-container fn__none" style="height:${t}px" data-name="filetree"></div>\n  <div class="b3-tab-container fn__none" style="height:${t}px" data-name="image"></div>\n  <div class="b3-tab-container fn__none" style="height:${t}px" data-name="export"></div>\n  <div class="b3-tab-container fn__none" style="height:${t}px" data-name="appearance"></div>\n  <div class="b3-tab-container fn__none" style="height:${t}px" data-name="bazaar"></div>\n  <div class="b3-tab-container fn__none" style="height:${t}px" data-name="search"></div>\n  <div class="b3-tab-container fn__none" style="height:${t}px" data-name="keymap"></div>\n  <div class="b3-tab-container fn__none" style="height:${t}px" data-name="account"></div>\n  <div class="b3-tab-container fn__none" style="height:${t}px" data-name="repos"></div>\n  <div class="b3-tab-container fn__none" style="height:${t}px" data-name="about"></div>\n</div>\n</div>`,width:"80vw"});return(0,r.initConfigSearch)(n.element),n.element.querySelectorAll(".b3-tab-bar .b3-list-item").forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("data-name"),i=n.element.querySelector(`.b3-tab-container[data-name="${t}"]`);if(n.element.querySelectorAll(".b3-tab-container").forEach((e=>{e.classList.add("fn__none")})),n.element.querySelector(".b3-tab-bar .b3-list-item.b3-list-item--focus").classList.remove("b3-list-item--focus"),e.classList.add("b3-list-item--focus"),i.classList.remove("fn__none"),""===i.innerHTML||"repos"===t||"bazaar"===t)switch(t){case"filetree":i.innerHTML=l.fileTree.genHTML(),l.fileTree.element=n.element.querySelector('.b3-tab-container[data-name="filetree"]'),l.fileTree.bindEvent();break;case"image":i.innerHTML=s.image.genHTML(),s.image.element=n.element.querySelector('.b3-tab-container[data-name="image"]'),s.image.bindEvent();break;case"export":i.innerHTML=c.exportConfig.genHTML(),c.exportConfig.element=n.element.querySelector('.b3-tab-container[data-name="export"]'),c.exportConfig.bindEvent();break;case"appearance":i.innerHTML=o.appearance.genHTML(),o.appearance.element=n.element.querySelector('.b3-tab-container[data-name="appearance"]'),o.appearance.bindEvent();break;case"keymap":i.innerHTML=p.keymap.genHTML(),p.keymap.element=n.element.querySelector('.b3-tab-container[data-name="keymap"]'),p.keymap.bindEvent();break;case"bazaar":h.bazaar.element=n.element.querySelector('.b3-tab-container[data-name="bazaar"]'),i.innerHTML=h.bazaar.genHTML(),h.bazaar.bindEvent();break;case"account":i.innerHTML=u.account.genHTML(),u.account.element=n.element.querySelector('.b3-tab-container[data-name="account"]'),u.account.bindEvent(u.account.element);break;case"repos":i.innerHTML=d.repos.genHTML(),d.repos.element=n.element.querySelector('.b3-tab-container[data-name="repos"]'),d.repos.bindEvent();break;case"about":i.innerHTML=a.about.genHTML(),a.about.element=n.element.querySelector('.b3-tab-container[data-name="about"]'),a.about.bindEvent();break;case"search":i.innerHTML=f.query.genHTML(),f.query.element=n.element.querySelector('.b3-tab-container[data-name="search"]'),f.query.bindEvent()}}))})),i.editor.element=n.element.querySelector('.b3-tab-container[data-name="editor"]'),i.editor.bindEvent(),n}},4299:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keymap=void 0;const i=n(7954),a=n(8792),o=n(1890),s=n(734),r=n(3371);t.keymap={element:void 0,_genItem(e,t){let n="";return Object.keys(e).forEach((o=>{window.siyuan.languages[o]&&(n+=`<li class="b3-list-item b3-list-item--hide-action">\n    <span class="b3-list-item__text">${window.siyuan.languages[o]}</span>\n    <span class="fn__space fn__flex-1"></span>\n    <input data-key="${t+a.Constants.ZWSP+o}" data-value="${e[o].custom}" data-default="${e[o].default}" class="b3-text-field" value="${(0,i.updateHotkeyTip)(e[o].custom)}">\n    <span class="fn__space"></span>\n    <span data-type="reset" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.reset}">\n        <svg><use xlink:href="#iconUndo"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="clear" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.remove}">\n        <svg><use xlink:href="#iconTrashcan"></use></svg>\n    </span>\n</li>`)})),n},genHTML:()=>`<div class="fn__flex b3-label">\n    <span class="fn__flex-center">${window.siyuan.languages.keymapTip}</span>\n    <span class="fn__flex-1"></span>\n    <button id="keymapRefreshBtn" class="b3-button b3-button--outline fn__flex-center fn__size200">\n        <svg><use xlink:href="#iconRefresh"></use></svg>\n        ${window.siyuan.languages.refresh}\n    </button>\n</div>\n<div class="fn__flex b3-label">\n    <span class="fn__flex-center">${window.siyuan.languages.keymapTip2}</span>\n    <span class="fn__flex-1"></span>\n    <span class="fn__space"></span>\n    <button id="keymapResetBtn" class="b3-button b3-button--outline fn__flex-center fn__size200">\n        <svg><use xlink:href="#iconUndo"></use></svg>\n        ${window.siyuan.languages.reset}\n    </button>\n</div>\n<div class="b3-label file-tree config-keymap" id="keymapList">\n    <label class="b3-form__icon" style="display:block;">\n        <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>\n        <input id="keymapInput" class="b3-form__icon-input b3-text-field fn__block" placeholder="${window.siyuan.languages.search}">\n    </label>\n    <div class="fn__hr"></div>\n    <ul class="b3-list b3-list--border b3-list--background">\n        <li class="b3-list-item toggle">\n            <span class="b3-list-item__toggle"><svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg></span>\n            <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.general}</span>\n        </li>\n        <ul class="fn__none">${t.keymap._genItem(window.siyuan.config.keymap.general,"general")}</ul>\n    </ul>\n    <ul class="b3-list b3-list--border b3-list--background">\n        <li class="b3-list-item toggle">\n            <span class="b3-list-item__toggle">\n                <svg class="b3-list-item__arrow b3-list-item__arrow--open"><use xlink:href="#iconRight"></use></svg>\n            </span>\n            <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.editor}</span>\n        </li>\n        <ul>\n            <li class="b3-list-item toggle">\n                <span class="b3-list-item__toggle">\n                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>\n                </span>\n                <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.general}</span>\n            </li>\n            <ul class="fn__none">${t.keymap._genItem(window.siyuan.config.keymap.editor.general,"editor"+a.Constants.ZWSP+"general")}</ul>\n            <li class="b3-list-item toggle">\n                <span class="b3-list-item__toggle">\n                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>\n                </span>\n                <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.insert}</span>\n            </li>\n            <ul class="fn__none">${t.keymap._genItem(window.siyuan.config.keymap.editor.insert,"editor"+a.Constants.ZWSP+"insert")}</ul>\n            <li class="b3-list-item toggle">\n                <span class="b3-list-item__toggle">\n                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>\n                </span>\n                <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.headings}</span>\n            </li>\n            <ul class="fn__none">${t.keymap._genItem(window.siyuan.config.keymap.editor.heading,"editor"+a.Constants.ZWSP+"heading")}</ul>\n            <li class="b3-list-item toggle">\n                <span class="b3-list-item__toggle">\n                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>\n                </span>\n                <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.list1}</span>\n            </li>\n            <ul class="fn__none">${t.keymap._genItem(window.siyuan.config.keymap.editor.list,"editor"+a.Constants.ZWSP+"list")}</ul>\n            <li class="b3-list-item toggle">\n                <span class="b3-list-item__toggle">\n                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>\n                </span>\n                <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.table}</span>\n            </li>\n            <ul class="fn__none">${t.keymap._genItem(window.siyuan.config.keymap.editor.table,"editor"+a.Constants.ZWSP+"table")}</ul>\n        </ul>\n    </ul>\n</div>`,_setkeymap(){const e=Object.assign({},a.Constants.SIYUAN_KEYMAP);t.keymap.element.querySelectorAll("ul input").forEach((t=>{const n=t.getAttribute("data-key").split(a.Constants.ZWSP);"general"===n[0]?e[n[0]][n[1]].custom=t.getAttribute("data-value"):"editor"!==n[0]||"general"!==n[1]&&"insert"!==n[1]&&"heading"!==n[1]&&"list"!==n[1]&&"table"!==n[1]||(e[n[0]][n[1]][n[2]].custom=t.getAttribute("data-value"))})),window.siyuan.config.keymap=e,(0,s.fetchPost)("/api/setting/setKeymap",{data:e},(()=>{}))},_search(e){t.keymap.element.querySelectorAll("#keymapList .b3-list-item--hide-action > .b3-list-item__text").forEach((t=>{t.textContent.toLowerCase().indexOf(e.toLowerCase())>-1||""===e?(t.parentElement.classList.remove("fn__none"),t.parentElement.parentElement.classList.remove("fn__none")):t.parentElement.classList.add("fn__none")}))},bindEvent(){t.keymap.element.querySelector("#keymapRefreshBtn").addEventListener("click",(()=>{(0,r.exportLayout)(!0)}));const e=t.keymap.element.querySelector("#keymapInput");this.element.addEventListener("compositionend",(()=>{t.keymap._search(e.value)})),e.addEventListener("input",(n=>{n.isComposing||t.keymap._search(e.value)})),t.keymap.element.querySelector("#keymapResetBtn").addEventListener("click",(()=>{window.siyuan.config.keymap=a.Constants.SIYUAN_KEYMAP,(0,s.fetchPost)("/api/setting/setKeymap",{data:a.Constants.SIYUAN_KEYMAP},(()=>{window.location.reload()}))}));const n=t.keymap.element.querySelector("#keymapList");let l;n.addEventListener("click",(e=>{let a=e.target;for(;a&&!a.isEqualNode(n);){if(a.classList.contains("b3-tooltips")){const n=a.getAttribute("data-type"),o=a.parentElement.querySelector(".b3-text-field");"reset"===n?(o.value=(0,i.updateHotkeyTip)(o.getAttribute("data-default")),o.setAttribute("data-value",o.getAttribute("data-default"))):"clear"===n&&(o.value="",o.setAttribute("data-value","")),t.keymap._setkeymap(),e.preventDefault(),e.stopPropagation();break}if(a.classList.contains("toggle")){a.nextElementSibling.classList.contains("fn__none")?(a.firstElementChild.firstElementChild.classList.add("b3-list-item__arrow--open"),a.nextElementSibling.classList.remove("fn__none")):(a.firstElementChild.firstElementChild.classList.remove("b3-list-item__arrow--open"),a.nextElementSibling.classList.add("fn__none")),e.preventDefault(),e.stopPropagation();break}a=a.parentElement}})),n.querySelectorAll("ul input").forEach((e=>{e.addEventListener("keydown",(function(e){e.stopPropagation(),e.preventDefault();let n="";if(e.ctrlKey&&!e.metaKey&&(0,i.isMac)()&&(n+="⌃"),e.altKey&&(n+="⌥"),e.shiftKey&&(n+="⇧"),(0,i.isCtrl)(e)&&(n+="⌘"),"Shift"!==e.key&&"Alt"!==e.key&&"Meta"!==e.key&&"Control"!==e.key)if("ArrowUp"===e.key)n+="↑";else if("ArrowDown"===e.key)n+="↓";else if("ArrowLeft"===e.key)n+="←";else if("ArrowRight"===e.key)n+="→";else if("Tab"===e.key)n+="⇥";else if("BracketLeft"===e.code)n+="[";else if("BracketRight"===e.code)n+="]";else if("Backspace"===e.key)n+="⌫";else if("Delete"===e.key)n+="⌦";else if("Enter"===e.key)n+="↩";else if(e.altKey){const t=e.code.substr(e.code.length-1,1).toUpperCase();"Enter"===e.key?n+="↩":e.key.startsWith("F")&&e.key.length>1?n+=e.key:"Period"===e.code?n+=".":"I"!==t&&"E"!==t&&"N"!==t&&"U"!==t?n+=t:229===e.which&&setTimeout((()=>{this.value=""}))}else"》"===e.key?n+=">":"《"===e.key?n+="<":"—"===e.key?n+="-":n+=e.key.length>1?e.key:e.key.toUpperCase();this.setAttribute("data-value",n),"—"===e.key?setTimeout((()=>{this.value=(0,i.updateHotkeyTip)(n)})):this.value=(0,i.updateHotkeyTip)(n),clearTimeout(l),l=window.setTimeout((()=>{const e=this.getAttribute("data-key").split(a.Constants.ZWSP);"list"===e[1]&&(e[1]="list1"),"heading"===e[1]&&(e[1]="headings");let i=`${window.siyuan.languages.keymap} [${window.siyuan.languages[e[0]]}-${window.siyuan.languages[e[1]]}`;if(e[2]&&(i+=`-${window.siyuan.languages[e[2]]}`),["⌘","⇧","⌥","⌃"].includes(n.substr(n.length-1,1))||["⌘A","⌘X","⌘C","⌘V","⌘/","⇧↑","⇧↓","⇧→","⇧←","⇧⇥","⇧⌘⇥","⌃⇥","⌃⌘⇥","⇧⌘→","⇧⌘←","⌘Home","⌘End","⇧↩","↩","PageUp","PageDown","⌫","⌦"].includes(n))return void(0,o.showMessage)(i+"] "+window.siyuan.languages.invalid);Array.from(t.keymap.element.querySelectorAll("ul input")).find((e=>{if(!e.isSameNode(this)&&e.getAttribute("data-value")===n){const t=e.getAttribute("data-key").split(a.Constants.ZWSP);"list"===t[1]&&(t[1]="list1"),"heading"===t[1]&&(t[1]="headings");let n=`${window.siyuan.languages[t[0]]}-${window.siyuan.languages[t[1]]}`;return t[2]&&(n+=`-${window.siyuan.languages[t[2]]}`),(0,o.showMessage)(`${i}] [${n}] ${window.siyuan.languages.conflict}`),!0}}))||t.keymap._setkeymap()}),1e3)}))}))}}},5838:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.query=void 0;const i=n(734);t.query={element:void 0,genHTML:()=>`<div class="b3-label">\n ${window.siyuan.languages.searchType}\n    <div class="fn__flex config-query">\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.math}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="mathBlock" type="checkbox"${window.siyuan.config.search.mathBlock?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.table}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="table" type="checkbox"${window.siyuan.config.search.table?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.quote}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="blockquote" type="checkbox"${window.siyuan.config.search.blockquote?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.superBlock}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="superBlock" type="checkbox"${window.siyuan.config.search.superBlock?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.paragraph}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="paragraph" type="checkbox"${window.siyuan.config.search.paragraph?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.doc}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="document" type="checkbox"${window.siyuan.config.search.document?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.headings}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="heading" type="checkbox"${window.siyuan.config.search.heading?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.list1}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="list" type="checkbox"${window.siyuan.config.search.list?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.listItem}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="listItem" type="checkbox"${window.siyuan.config.search.listItem?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.code}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="codeBlock" type="checkbox"${window.siyuan.config.search.codeBlock?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                HTML\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="htmlBlock" type="checkbox"${window.siyuan.config.search.htmlBlock?" checked":""}/>\n        </label>\n    </div>\n</div>\n<div class="b3-label">\n ${window.siyuan.languages.searchAttr}\n    <div class="config-query">\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.name}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="name" type="checkbox"${window.siyuan.config.search.name?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.alias}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="alias" type="checkbox"${window.siyuan.config.search.alias?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.memo}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="memo" type="checkbox"${window.siyuan.config.search.memo?" checked":""}/>\n        </label>\n                <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.custom}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="custom" type="checkbox"${window.siyuan.config.search.custom?" checked":""}/>\n        </label>\n    </div>\n</div>\n<div class="b3-label">\n ${window.siyuan.languages.searchBackmention}\n    <div class="config-query">\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.name}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="backlinkMentionName" type="checkbox"${window.siyuan.config.search.backlinkMentionName?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.alias}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="backlinkMentionAlias" type="checkbox"${window.siyuan.config.search.backlinkMentionAlias?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.anchor}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="backlinkMentionAnchor" type="checkbox"${window.siyuan.config.search.backlinkMentionAnchor?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.docName}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="backlinkMentionDoc" type="checkbox"${window.siyuan.config.search.backlinkMentionDoc?" checked":""}/>\n        </label>\n    </div>\n</div>\n<div class="b3-label">\n ${window.siyuan.languages.searchVirtualRef}\n    <div class="config-query">\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.name}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="virtualRefName" type="checkbox"${window.siyuan.config.search.virtualRefName?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.alias}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="virtualRefAlias" type="checkbox"${window.siyuan.config.search.virtualRefAlias?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.anchor}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="virtualRefAnchor" type="checkbox"${window.siyuan.config.search.virtualRefAnchor?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.docName}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="virtualRefDoc" type="checkbox"${window.siyuan.config.search.virtualRefDoc?" checked":""}/>\n        </label>\n    </div>\n</div>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.searchLimit}\n         <div class="b3-label__text">${window.siyuan.languages.searchLimit1}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-text-field fn__flex-center fn__size200" id="limit" type="number" min="1" max="10240" value="${window.siyuan.config.search.limit}">\n</label>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.searchCaseSensitive}\n         <div class="b3-label__text">${window.siyuan.languages.searchCaseSensitive1}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input class="b3-switch fn__flex-center" id="caseSensitive" type="checkbox"${window.siyuan.config.search.caseSensitive?" checked":""}/>\n</label>`,bindEvent:()=>{t.query.element.querySelectorAll("input").forEach((e=>{e.addEventListener("change",(()=>{(0,i.fetchPost)("/api/setting/setSearch",{document:t.query.element.querySelector("#document").checked,heading:t.query.element.querySelector("#heading").checked,list:t.query.element.querySelector("#list").checked,listItem:t.query.element.querySelector("#listItem").checked,codeBlock:t.query.element.querySelector("#codeBlock").checked,htmlBlock:t.query.element.querySelector("#htmlBlock").checked,mathBlock:t.query.element.querySelector("#mathBlock").checked,table:t.query.element.querySelector("#table").checked,blockquote:t.query.element.querySelector("#blockquote").checked,superBlock:t.query.element.querySelector("#superBlock").checked,paragraph:t.query.element.querySelector("#paragraph").checked,name:t.query.element.querySelector("#name").checked,alias:t.query.element.querySelector("#alias").checked,memo:t.query.element.querySelector("#memo").checked,custom:t.query.element.querySelector("#custom").checked,limit:parseInt(t.query.element.querySelector("#limit").value),caseSensitive:t.query.element.querySelector("#caseSensitive").checked,backlinkMentionName:t.query.element.querySelector("#backlinkMentionName").checked,backlinkMentionAlias:t.query.element.querySelector("#backlinkMentionAlias").checked,backlinkMentionAnchor:t.query.element.querySelector("#backlinkMentionAnchor").checked,backlinkMentionDoc:t.query.element.querySelector("#backlinkMentionDoc").checked,virtualRefName:t.query.element.querySelector("#virtualRefName").checked,virtualRefAlias:t.query.element.querySelector("#virtualRefAlias").checked,virtualRefAnchor:t.query.element.querySelector("#virtualRefAnchor").checked,virtualRefDoc:t.query.element.querySelector("#virtualRefDoc").checked},(e=>{window.siyuan.config.search=e.data}))}))}))}}},7766:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.repos=void 0;const i=n(8776),a=n(734),o=n(3274),s=n(1890),r=n(5370);t.repos={element:void 0,genHTML:()=>{if((0,i.needSubscribe)(""))return`<div class="b3-label">${"ios"===window.siyuan.config.system.container?window.siyuan.languages._kernel[122]:window.siyuan.languages._kernel[29]}</div>\n<div class="b3-label">\n    ${window.siyuan.languages.cloudIntro1}\n    <div class="b3-label__text">\n        <ul style="padding-left: 2em">\n            <li>${window.siyuan.languages.cloudIntro2}</li>\n            <li>${window.siyuan.languages.cloudIntro3}</li>\n            <li>${window.siyuan.languages.cloudIntro4}</li>\n            <li>${window.siyuan.languages.cloudIntro5}</li>\n            <li>${window.siyuan.languages.cloudIntro6}</li>\n            <li>${window.siyuan.languages.cloudIntro7}</li>\n            <li>${window.siyuan.languages.cloudIntro8}</li>\n        </ul>\n    </div>\n</div>\n<div class="b3-label">\n    ${window.siyuan.languages.cloudIntro9}\n    <div class="b3-label__text">\n        <ul style="padding-left: 2em">\n            <li>${window.siyuan.languages.cloudIntro10}</li>\n            <li>${window.siyuan.languages.cloudIntro11}</li>\n        </ul>\n    </div>\n</div>`;let e=`<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.syncMode}\n        <div class="b3-label__text">${window.siyuan.languages.syncModeTip}</div>\n    </div>\n    <span class="fn__space"></span>\n    <select id="syncMode" class="b3-select fn__flex-center fn__size200">\n        <option value="1" ${1===window.siyuan.config.sync.mode?"selected":""}>${window.siyuan.languages.syncMode1}</option>\n        <option value="2" ${2===window.siyuan.config.sync.mode?"selected":""}>${window.siyuan.languages.syncMode2}</option>\n    </select>\n</label>`;return(0,o.isMobile)()&&(e=`<div class="b3-label">\n    ${window.siyuan.languages.syncMode}\n    <div class="fn__hr"></div>\n    <select id="syncMode" class="b3-select fn__block">\n        <option value="1" ${1===window.siyuan.config.sync.mode?"selected":""}>${window.siyuan.languages.syncMode1}</option>\n        <option value="2" ${2===window.siyuan.config.sync.mode?"selected":""}>${window.siyuan.languages.syncMode2}</option>\n    </select>\n    <div class="b3-label__text">${window.siyuan.languages.syncModeTip}</div>\n</div>`),`<div><div style="position: fixed;width: 800px;height: 434px;box-sizing: border-box;text-align: center;display: flex;align-items: center;justify-content: center;z-index: 1;" id="reposLoading">\n    <img src="/stage/loading-pure.svg">\n</div>\n<div id="reposData" class="b3-label">\n    <div class="fn__flex">\n        <div class="fn__flex-1">\n            ${window.siyuan.languages.cloudStorage}\n        </div>\n        <div class="fn__flex-1">\n            ${window.siyuan.languages.trafficStat}\n        </div>\n    </div>\n</div>\n<label class="fn__flex b3-label">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.openSyncTip1}\n        <div class="b3-label__text">${window.siyuan.languages.openSyncTip2}</div>\n    </div>\n    <span class="fn__space"></span>\n    <input type="checkbox" id="reposCloudSyncSwitch"${window.siyuan.config.sync.enabled?" checked='checked'":""} class="b3-switch fn__flex-center">\n</label>\n${e}\n<div class="b3-label">\n    <div class="fn__flex">\n        <div class="fn__flex-center">${window.siyuan.languages.cloudSyncDir}</div>\n        <div class="fn__flex-1"></div>\n        <button class="b3-button b3-button--outline fn__flex-center${(0,o.isMobile)()?"":" fn__size200"}" data-type="config">\n            <svg><use xlink:href="#iconSettings"></use></svg>${window.siyuan.languages.config}\n        </button>\n    </div>\n    <div id="reposCloudSyncList" class="fn__none config-repos__sync"><img style="margin: 0 auto;display: block;width: 64px;height: 100%" src="/stage/loading-pure.svg"></div>\n</div>\n<div class="b3-label fn__flex">\n    <div class="fn__flex-center">${window.siyuan.languages.cloudBackup}</div>\n    <div class="b3-list-item__meta fn__flex-center">${window.siyuan.languages.cloudBackupTip}</div>\n</div>\n</div>`},bindEvent:()=>{if((0,i.needSubscribe)(""))return;(0,a.fetchPost)("/api/cloud/getCloudSpace",{},(e=>{t.repos.element.querySelector("#reposLoading").classList.add("fn__none"),1!==e.code?t.repos.element.querySelector("#reposData").innerHTML=`<div class="fn__flex">\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.cloudStorage}\n        <div class="fn__hr"></div>\n        <ul class="b3-list">\n            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.sync}<span class="b3-list-item__meta">${e.data.sync?e.data.sync.hSize:"0B"}</span></li>\n            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.backup}<span class="b3-list-item__meta">${e.data.backup?e.data.backup.hSize:"0B"}</span></li>\n            <li class="b3-list-item" style="cursor: auto;"><a href="https://ld246.com/settings/file?type=3" target="_blank">${window.siyuan.languages.cdn}</a><span class="b3-list-item__meta">${e.data.hAssetSize}</span></li>\n            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.total}<span class="b3-list-item__meta">${e.data.hSize}</span></li>\n            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.sizeLimit}<span class="b3-list-item__meta">${e.data.hTotalSize}</span></li>\n        </ul>\n    </div>\n    <div class="fn__flex-1">\n        ${window.siyuan.languages.trafficStat}\n        <div class="fn__hr"></div>\n        <ul class="b3-list">\n            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.upload}<span class="fn__space"></span><span class="ft__on-surface">${e.data.hTrafficUploadSize}</span></li>\n            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.download}<span class="fn__space"></span><span class="ft__on-surface">${e.data.hTrafficDownloadSize}</span></li>\n        </ul>\n    </div>\n</div>`:t.repos.element.querySelector("#reposData").innerHTML=e.msg}));const e=t.repos.element.querySelector("#reposCloudSyncSwitch");e.addEventListener("change",(()=>{if(e.checked&&""===window.siyuan.config.sync.cloudName)return e.checked=!1,void(0,s.showMessage)(window.siyuan.languages._kernel[123]);(0,a.fetchPost)("/api/sync/setSyncEnable",{enabled:e.checked},(t=>{1===t.code?((0,s.showMessage)(t.msg),e.checked=!1):window.siyuan.config.sync.enabled=e.checked}))}));const n=t.repos.element.querySelector("#syncMode");n.addEventListener("change",(()=>{(0,a.fetchPost)("/api/sync/setSyncMode",{mode:parseInt(n.value,10)},(e=>{1===e.code?((0,s.showMessage)(e.msg),n.value="1"):window.siyuan.config.sync.mode=parseInt(n.value,10)}))}));const o=t.repos.element.querySelector("#reposLoading");o.style.width=t.repos.element.clientWidth+"px",o.style.height=t.repos.element.clientHeight+"px";const l=t.repos.element.querySelector("#reposCloudSyncList");(0,r.bindSyncCloudListEvent)(l),t.repos.element.querySelector('[data-type="config"]').addEventListener("click",(()=>{l.classList.contains("fn__none")?((0,r.getSyncCloudList)(l),l.classList.remove("fn__none")):l.classList.add("fn__none")}))}}},7245:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initConfigSearch=void 0;const i=n(8792),a=e=>{const t=[];return e.forEach((e=>{t.push(window.siyuan.languages[e])})),t};t.initConfigSearch=e=>{const t=[a(["config","fullWidth","editor","md2","md3","md12","md16","md27","md28","md29","md30","md31","md32","md33","md34","md39","md40","fontSizeTip","fontSize","font","font1","generateHistory","generateHistoryInterval","historyRetentionDays","historyRetentionDaysTip","clearHistory","katexMacros","katexMacrosTip"]),a(["selectOpen","tabLimit","fileTree","fileTree2","fileTree3","fileTree4","fileTree5","fileTree6","fileTree7","fileTree8","fileTree9","fileTree10","fileTree12","fileTree13","fileTree15","fileTree16","fileTree17"]),a(["assets","clearUnused"]),a(["paragraphBeginningSpace","md4","export","export1","export2","export5","export11","export13","export14","export15","export19","export20","blockRef","blockEmbed"]),window.siyuan.config.appearance.darkThemes.concat(window.siyuan.config.appearance.icons).concat(window.siyuan.config.appearance.lightThemes).concat(i.Constants.SIYUAN_CONFIG_APPEARANCE_DARK_CODE).concat(i.Constants.SIYUAN_CONFIG_APPEARANCE_LIGHT_CODE).concat(["English","简体中文"]).concat(a(["language","language1"])).concat(a(["appearance","appearance1","appearance2","appearance3","appearance4","appearance5","appearance6","appearance7","appearance8","appearance9","appearance10","appearance11","appearance14","appearance15","resetLayout","reset","icon","themeLight","themeDark","open","close","theme","theme2","theme11","theme12","theme13","theme14","customEmoji"])),a(["bazaar","theme","template","icon","widget"]),a(["search","searchLimit","searchLimit1","memo","name","alias","doc","headings","list1","listItem","code","math","table","quote","superBlock","paragraph"]),a(["keymap","keymapTip2"].concat(Object.keys(i.Constants.SIYUAN_KEYMAP.general)).concat(Object.keys(i.Constants.SIYUAN_KEYMAP.editor.general)).concat(Object.keys(i.Constants.SIYUAN_KEYMAP.editor.heading)).concat(Object.keys(i.Constants.SIYUAN_KEYMAP.editor.insert)).concat(Object.keys(i.Constants.SIYUAN_KEYMAP.editor.list)).concat(Object.keys(i.Constants.SIYUAN_KEYMAP.editor.table))),a(["sync","cloudSpace","backup","cdn","total","cloudBackup","updatePath","cloudSync","syncTip","reposTip","openSyncTip1","openSyncTip2","cloudSyncDir"]),a(["accountTip","accountName","password","captcha","forgetPassword","login","register","twoFactorCaptcha","account1","account2","account5","networkProxy"]),a(["about","about1","about2","about3","about4","about5","about6","about7","about8","about11","about12","about13","about14","about15","about16","slogan","currentVer","checkUpdate","updatePath","snapshotPassword","systemLog","autoDownloadUpdatePkg"])],n=e.querySelector(".b3-form__icon input");"ios"!==window.siyuan.config.system.container&&n.focus();const o=()=>{const i=[],a=n.value;let o;t.map(((e,t)=>{e.map((e=>{e&&(a.toLowerCase().indexOf(e)>-1||e.toLowerCase().indexOf(a)>-1)&&i.push(t)}))})),e.querySelectorAll(".b3-tab-bar li").forEach(((e,t)=>{i.includes(t)?(o||(o=e),e.style.display=""):e.style.display="none"}));const s=e.querySelectorAll(".b3-tab-container");o?o.click():s.forEach((e=>{e.classList.add("fn__none")})),n.focus()};n.addEventListener("compositionend",(()=>{o()})),n.addEventListener("input",(e=>{e.isComposing||o()}))}},5299:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setAccessAuthCode=void 0;const i=n(9866),a=n(3274),o=n(734);t.setAccessAuthCode=()=>{const e=new i.Dialog({title:window.siyuan.languages.about5,content:`<div class="b3-dialog__content">\n    <input class="b3-text-field fn__block" placeholder="${window.siyuan.languages.about5}" value="${window.siyuan.config.accessAuthCode}">\n    <div class="b3-label__text">${window.siyuan.languages.about6}</div>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:(0,a.isMobile)()?"80vw":"520px"}),t=e.element.querySelector("input"),n=e.element.querySelectorAll(".b3-button");e.bindInput(t,(()=>{n[1].click()})),t.select(),n[0].addEventListener("click",(()=>{e.destroy()})),n[1].addEventListener("click",(()=>{(0,o.fetchPost)("/api/system/setAccessAuthCode",{accessAuthCode:t.value})}))}},8792:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0;class n{}t.Constants=n,n.SIYUAN_VERSION="2.2.0-alpha2",n.NODE_ENV="production",n.SIYUAN_APPID=Math.random().toString(36).substring(8),n.ASSETS_ADDRESS="https://assets.b3logfile.com/siyuan/",n.PROTYLE_CDN="/stage/protyle",n.UPLOAD_ADDRESS="/upload",n.SIYUAN_DROP_FILE="application/siyuan-file",n.SIYUAN_DROP_TAB="application/siyuan-tab",n.SIYUAN_DROP_EDITOR="application/siyuan-editor",n.SIYUAN_CONFIG_THEME="siyuan-config-theme",n.SIYUAN_CONFIG_CLOSE="siyuan-config-close",n.SIYUAN_CONFIG_TRAY="siyuan-config-tray",n.SIYUAN_CONFIG_CLOSETRAY="siyuan-config-closetray",n.SIYUAN_QUIT="siyuan-quit",n.SIYUAN_HOTKEY="siyuan-hotkey",n.SIYUAN_INIT="siyuan-init",n.SIYUAN_OPENURL="siyuan-openurl",n.SIYUAN_SAVE_CLOSE="siyuan-save-close",n.SIYUAN_EXPORT_PDF="siyuan-export-pdf",n.SIYUAN_EXPORT_CLOSE="siyuan-export-close",n.SIZE_TOOLBAR_HEIGHT=30,n.SIZE_GET=36,n.SIZE_GET_MAX=102400,n.SIZE_UNDO=64,n.SIZE_TITLE=512,n.SIZE_EDITOR_WIDTH=760,n.CB_MOUNT_HELP="cb-mount-help",n.CB_MOUNT_REMOVE="cb-mount-remove",n.CB_GET_APPEND="cb-get-append",n.CB_GET_BEFORE="cb-get-before",n.CB_GET_UNCHANGEID="cb-get-unchangeid",n.CB_GET_HL="cb-get-hl",n.CB_GET_FOCUS="cb-get-focus",n.CB_GET_FOCUSFIRST="cb-get-focusfirst",n.CB_GET_SETID="cb-get-setid",n.CB_GET_ALL="cb-get-all",n.CB_GET_UNUNDO="cb-get-unundo",n.CB_GET_SCROLL="cb-get-scroll",n.CB_GET_CONTEXT="cb-get-context",n.CB_GET_HTML="cb-get-html",n.CB_GET_HISTORY="cb-get-history",n.LOCAL_SEARCHEDATA="local-searchedata",n.LOCAL_SEARCHETABDATA="local-searchetabdata",n.LOCAL_DOCINFO="local-docinfo",n.LOCAL_DAILYNOTEID="local-dailynoteid",n.LOCAL_HISTORYNOTEID="local-historynoteid",n.LOCAL_CODELANG="local-codelang",n.LOCAL_FONTSTYLES="local-fontstyles",n.LOCAL_EXPORTPDF="local-exportpdf",n.LOCAL_EXPORTWORD="local-exportword",n.LOCAL_BAZAAR="local-bazaar",n.TIMEOUT_DBLCLICK=190,n.TIMEOUT_SEARCH=300,n.TIMEOUT_INPUT=256,n.TIMEOUT_BLOCKLOAD=300,n.HELP_PATH={zh_CN:"20210808180117-czj9bvb",zh_CHT:"20211226090932-5lcq56f",en_US:"20210808180117-6v0mkxr",fr_FR:"20210808180117-6v0mkxr"},n.HELP_START_PATH={zh_CN:"20200812220555-lj3enxa",zh_CHT:"20211226115423-d5z1joq",en_US:"20200923234011-ieuun1p",fr_FR:"20200923234011-ieuun1p"},n.SIYUAN_KEYMAP={general:{syncNow:{default:"F9",custom:"F9"},enterBack:{default:"⌥←",custom:"⌥←"},enter:{default:"⌥→",custom:"⌥→"},goForward:{default:"⌘]",custom:"⌘]"},goBack:{default:"⌘[",custom:"⌘["},newFile:{default:"⌘N",custom:"⌘N"},search:{default:"⌘F",custom:"⌘F"},globalSearch:{default:"⌘P",custom:"⌘P"},stickSearch:{default:"⇧⌘F",custom:"⇧⌘F"},replace:{default:"⌘R",custom:"⌘R"},closeTab:{default:"⌘W",custom:"⌘W"},fileTree:{default:"⌥1",custom:"⌥1"},outline:{default:"⌥2",custom:"⌥2"},bookmark:{default:"⌥3",custom:"⌥3"},tag:{default:"⌥4",custom:"⌥4"},dailyNote:{default:"⌥5",custom:"⌥5"},inbox:{default:"⌥6",custom:"⌥6"},backlinks:{default:"⌥7",custom:"⌥7"},graphView:{default:"⌥8",custom:"⌥8"},globalGraph:{default:"⌥9",custom:"⌥9"},config:{default:"⌥P",custom:"⌥P"},history:{default:"⌥H",custom:"⌥H"},toggleWin:{default:"⌥M",custom:"⌥M"},lockScreen:{default:"⌥N",custom:"⌥N"},move:{default:"",custom:""},selectOpen1:{default:"",custom:""}},editor:{general:{copyPlainText:{default:"",custom:""},copyID:{default:"",custom:""},netImg2LocalAsset:{default:"",custom:""},hLayout:{default:"",custom:""},vLayout:{default:"",custom:""},refPopover:{default:"",custom:""},expand:{default:"⌘↓",custom:"⌘↓"},collapse:{default:"⌘↑",custom:"⌘↑"},insertBottom:{default:"⌥⌘.",custom:"⌥⌘."},refTab:{default:"⇧⌘>",custom:"⇧⌘>"},openBy:{default:"⌘.",custom:"⌘."},insertRight:{default:"⌥.",custom:"⌥."},attr:{default:"⌥⌘A",custom:"⌥⌘A"},refresh:{default:"F5",custom:"F5"},copyBlockRef:{default:"⇧⌘C",custom:"⇧⌘C"},copyProtocol:{default:"⇧⌘H",custom:"⇧⌘H"},copyBlockEmbed:{default:"⇧⌘E",custom:"⇧⌘E"},copyHPath:{default:"⇧⌘P",custom:"⇧⌘P"},pasteAsPlainText:{default:"⇧⌘V",custom:"⇧⌘V"},undo:{default:"⌘Z",custom:"⌘Z"},redo:{default:"⌘Y",custom:"⌘Y"},rename:{default:"F2",custom:"F2"},newNameFile:{default:"F3",custom:"F3"},newContentFile:{default:"F4",custom:"F4"},showInFolder:{default:"⌥A",custom:"⌥A"},outline:{default:"⌥O",custom:"⌥O"},backlinks:{default:"⌥B",custom:"⌥B"},graphView:{default:"⌥G",custom:"⌥G"},fullscreen:{default:"⌥Y",custom:"⌥Y"},alignLeft:{default:"⌥L",custom:"⌥L"},alignCenter:{default:"⌥C",custom:"⌥C"},alignRight:{default:"⌥R",custom:"⌥R"},wysiwyg:{default:"⌥⌘7",custom:"⌥⌘7"},preview:{default:"⌥⌘9",custom:"⌥⌘9"},insertBefore:{default:"⇧⌘B",custom:"⇧⌘B"},insertAfter:{default:"⇧⌘A",custom:"⇧⌘A"},jumpToParentNext:{default:"⇧⌘N",custom:"⇧⌘N"},moveToUp:{default:"⇧⌘↑",custom:"⇧⌘↑"},moveToDown:{default:"⇧⌘↓",custom:"⇧⌘↓"}},insert:{font:{default:"⌥⌘X",custom:"⌥⌘X"},lastUsed:{default:"⌥X",custom:"⌥X"},blockRef:{default:"⌥[",custom:"⌥["},kbd:{default:"⌘'",custom:"⌘'"},sup:{default:"⌘H",custom:"⌘H"},sub:{default:"⌘J",custom:"⌘J"},bold:{default:"⌘B",custom:"⌘B"},"inline-math":{default:"⌘M",custom:"⌘M"},memo:{default:"⌥⌘M",custom:"⌥⌘M"},underline:{default:"⌘U",custom:"⌘U"},italic:{default:"⌘I",custom:"⌘I"},mark:{default:"⌘E",custom:"⌘E"},tag:{default:"⌘T",custom:"⌘T"},strike:{default:"⌘D",custom:"⌘D"},"inline-code":{default:"⌘G",custom:"⌘G"},link:{default:"⌘K",custom:"⌘K"},check:{default:"⌘L",custom:"⌘L"},table:{default:"⌘O",custom:"⌘O"},code:{default:"⇧⌘K",custom:"⇧⌘K"}},heading:{paragraph:{default:"⌥⌘0",custom:"⌥⌘0"},heading1:{default:"⌥⌘1",custom:"⌥⌘1"},heading2:{default:"⌥⌘2",custom:"⌥⌘2"},heading3:{default:"⌥⌘3",custom:"⌥⌘3"},heading4:{default:"⌥⌘4",custom:"⌥⌘4"},heading5:{default:"⌥⌘5",custom:"⌥⌘5"},heading6:{default:"⌥⌘6",custom:"⌥⌘6"}},list:{indent:{default:"⇥",custom:"⇥"},outdent:{default:"⇧⇥",custom:"⇧⇥"},checkToggle:{default:"⌘↩",custom:"⌘↩"}},table:{insertRowAbove:{default:"⇧⌘T",custom:"⇧⌘T"},insertRowBelow:{default:"⇧⌘D",custom:"⇧⌘D"},insertColumnLeft:{default:"⇧⌘L",custom:"⇧⌘L"},insertColumnRight:{default:"⇧⌘R",custom:"⇧⌘R"},moveToUp:{default:"⌥⌘T",custom:"⌥⌘T"},moveToDown:{default:"⌥⌘B",custom:"⌥⌘B"},moveToLeft:{default:"⌥⌘L",custom:"⌥⌘L"},moveToRight:{default:"⌥⌘R",custom:"⌥⌘R"},"delete-row":{default:"⌘-",custom:"⌘-"},"delete-column":{default:"⇧⌘_",custom:"⇧⌘_"}}}},n.SIYUAN_EMPTY_LAYOUT={hideDock:!1,layout:{direction:"tb",size:"0px",type:"normal",instance:"Layout",children:[{direction:"lr",size:"0px",type:"top",instance:"Layout",children:[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"lr",children:[]}]},{direction:"lr",resize:"tb",size:"auto",type:"normal",instance:"Layout",children:[{direction:"tb",size:"0px",type:"left",instance:"Layout",children:[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"tb",children:[]}]},{direction:"lr",resize:"lr",size:"auto",type:"center",instance:"Layout",children:[{instance:"Wnd",children:[{instance:"Tab",children:[]}]}]},{direction:"tb",size:"0px",resize:"lr",type:"right",instance:"Layout",children:[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"tb",children:[]}]}]},{direction:"lr",size:"0px",resize:"tb",type:"bottom",instance:"Layout",children:[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"lr",children:[]}]}]},top:[],bottom:[],left:[[{type:"file",size:{width:240,height:0},show:!0,icon:"iconFiles",hotkeyLangId:"fileTree"},{type:"outline",size:{width:240,height:0},show:!1,icon:"iconAlignCenter",hotkeyLangId:"outline"},{type:"inbox",size:{width:252,height:0},show:!1,icon:"iconInbox",hotkeyLangId:"inbox"}],[{type:"bookmark",size:{width:240,height:0},show:!1,icon:"iconBookmark",hotkeyLangId:"bookmark"},{type:"tag",size:{width:240,height:0},show:!1,icon:"iconTags",hotkeyLangId:"tag"}]],right:[[{type:"graph",size:{width:360,height:0},show:!1,icon:"iconGraph",hotkeyLangId:"graphView"},{type:"globalGraph",size:{width:360,height:0},show:!1,icon:"iconGlobalGraph",hotkeyLangId:"globalGraph"}],[{type:"backlink",size:{width:360,height:0},show:!1,icon:"iconLink",hotkeyLangId:"backlinks"}]]},n.SIYUAN_IMAGE_VIP='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">\n<path fill="#ffd00f" d="M2.288 12.643l23.487 12.853c0.286 0.153 0.477 0.45 0.477 0.791 0 0.082-0.011 0.161-0.032 0.237l0.001-0.006c-0.119 0.395-0.479 0.678-0.905 0.678-0.004 0-0.009-0-0.013-0h-19.439c-0.958 0-1.766-0.684-1.885-1.595l-1.691-12.956z"></path>\n<path fill="#ffd00f" d="M29.676 12.643l-1.691 12.957c-0.119 0.911-0.927 1.594-1.884 1.594h-19.442c-0.004 0-0.009 0-0.013 0-0.425 0-0.785-0.281-0.903-0.668l-0.002-0.007c-0.019-0.070-0.031-0.15-0.031-0.232 0-0.341 0.191-0.638 0.472-0.788l0.005-0.002 23.487-12.853z"></path>\n<path fill="#ffe668" d="M15.413 8.369l10.394 15.921c0.378 0.579 0.407 1.317 0.076 1.924-0.328 0.591-0.948 0.985-1.66 0.985-0 0-0.001 0-0.001 0h-17.617c-0.694 0-1.331-0.378-1.661-0.985-0.144-0.26-0.229-0.569-0.229-0.899 0-0.382 0.114-0.736 0.31-1.033l-0.004 0.007 10.394-15.921z"></path>\n<path fill="#ffdd4e" d="M15.396 8.403l11.659 15.921c0.401 0.579 0.432 1.317 0.081 1.924-0.361 0.594-1.005 0.985-1.741 0.985-0.008 0-0.017-0-0.025-0h-9.344l-0.63-18.83z"></path>\n<path fill="#ffd00f" d="M13.868 6.478c0 0.946 0.767 1.712 1.712 1.712s1.712-0.767 1.712-1.712v0c0-0.945-0.766-1.712-1.712-1.712s-1.712 0.766-1.712 1.712v0zM28.577 10.818c0 0.945 0.766 1.712 1.712 1.712s1.712-0.766 1.712-1.712v0c0-0.945-0.766-1.712-1.712-1.712s-1.712 0.766-1.712 1.712v0zM0 10.822c0 0.945 0.766 1.712 1.712 1.712s1.712-0.766 1.712-1.712v0c0-0.945-0.766-1.712-1.712-1.712s-1.712 0.766-1.712 1.712v0z"></path>\n</svg>',n.SIYUAN_IMAGE_FILE="1f4c4",n.SIYUAN_IMAGE_NOTE="1f5c3",n.SIYUAN_IMAGE_FOLDER="1f4d1",n.SIYUAN_ASSETS_IMAGE=[".apng",".ico",".cur",".jpg",".jpe",".jpeg",".jfif",".pjp",".pjpeg",".png",".gif",".webp",".bmp",".svg"],n.SIYUAN_ASSETS_AUDIO=[".mp3",".wav",".ogg",".m4a"],n.SIYUAN_ASSETS_VIDEO=[".mov",".weba",".mkv",".mp4",".webm"],n.SIYUAN_ASSETS_EXTS=[".pdf"].concat(n.SIYUAN_ASSETS_IMAGE).concat(n.SIYUAN_ASSETS_AUDIO).concat(n.SIYUAN_ASSETS_VIDEO),n.SIYUAN_CONFIG_APPEARANCE_DARK_CODE=["a11y-dark","agate","an-old-hope","androidstudio","arta","atom-one-dark","atom-one-dark-reasonable","base16/3024","base16/apathy","base16/apprentice","base16/ashes","base16/atelier-cave","base16/atelier-dune","base16/atelier-estuary","base16/atelier-forest","base16/atelier-heath","base16/atelier-lakeside","base16/atelier-plateau","base16/atelier-savanna","base16/atelier-seaside","base16/atelier-sulphurpool","base16/atlas","base16/bespin","base16/black-metal","base16/black-metal-bathory","base16/black-metal-burzum","base16/black-metal-dark-funeral","base16/black-metal-gorgoroth","base16/black-metal-immortal","base16/black-metal-khold","base16/black-metal-marduk","base16/black-metal-mayhem","base16/black-metal-nile","base16/black-metal-venom","base16/brewer","base16/bright","base16/brogrammer","base16/brush-trees-dark","base16/chalk","base16/circus","base16/classic-dark","base16/codeschool","base16/colors","base16/danqing","base16/darcula","base16/dark-violet","base16/darkmoss","base16/darktooth","base16/decaf","base16/default-dark","base16/dracula","base16/edge-dark","base16/eighties","base16/embers","base16/equilibrium-dark","base16/equilibrium-gray-dark","base16/espresso","base16/eva","base16/eva-dim","base16/flat","base16/framer","base16/gigavolt","base16/google-dark","base16/grayscale-dark","base16/green-screen","base16/gruvbox-dark-hard","base16/gruvbox-dark-medium","base16/gruvbox-dark-pale","base16/gruvbox-dark-soft","base16/hardcore","base16/harmonic16-dark","base16/heetch-dark","base16/helios","base16/hopscotch","base16/horizon-dark","base16/humanoid-dark","base16/ia-dark","base16/icy-dark","base16/ir-black","base16/isotope","base16/kimber","base16/london-tube","base16/macintosh","base16/marrakesh","base16/materia","base16/material","base16/material-darker","base16/material-palenight","base16/material-vivid","base16/mellow-purple","base16/mocha","base16/monokai","base16/nebula","base16/nord","base16/nova","base16/ocean","base16/oceanicnext","base16/onedark","base16/outrun-dark","base16/papercolor-dark","base16/paraiso","base16/pasque","base16/phd","base16/pico","base16/pop","base16/porple","base16/qualia","base16/railscasts","base16/rebecca","base16/ros-pine","base16/ros-pine-moon","base16/sandcastle","base16/seti-ui","base16/silk-dark","base16/snazzy","base16/solar-flare","base16/solarized-dark","base16/spacemacs","base16/summercamp","base16/summerfruit-dark","base16/synth-midnight-terminal-dark","base16/tango","base16/tender","base16/tomorrow-night","base16/twilight","base16/unikitty-dark","base16/vulcan","base16/windows-10","base16/windows-95","base16/windows-high-contrast","base16/windows-nt","base16/woodland","base16/xcode-dusk","base16/zenburn","codepen-embed","dark","devibeans","far","felipec","github-dark","github-dark-dimmed","gml","gradient-dark","hybrid","ir-black","isbl-editor-dark","kimbie-dark","lioshi","monokai","monokai-sublime","night-owl","nnfx-dark","nord","obsidian","paraiso-dark","pojoaque","qtcreator-dark","rainbow","shades-of-purple","srcery","stackoverflow-dark","sunburst","tomorrow-night-blue","tomorrow-night-bright","tokyo-night-dark","vs2015","xt256"],n.SIYUAN_CONFIG_APPEARANCE_LIGHT_CODE=["ant-design","a11y-light","arduino-light","ascetic","atom-one-light","base16/atelier-cave-light","base16/atelier-dune-light","base16/atelier-estuary-light","base16/atelier-forest-light","base16/atelier-heath-light","base16/atelier-lakeside-light","base16/atelier-plateau-light","base16/atelier-savanna-light","base16/atelier-seaside-light","base16/atelier-sulphurpool-light","base16/brush-trees","base16/classic-light","base16/cupcake","base16/cupertino","base16/default-light","base16/dirtysea","base16/edge-light","base16/equilibrium-gray-light","base16/equilibrium-light","base16/fruit-soda","base16/github","base16/google-light","base16/grayscale-light","base16/gruvbox-light-hard","base16/gruvbox-light-medium","base16/gruvbox-light-soft","base16/harmonic16-light","base16/heetch-light","base16/humanoid-light","base16/horizon-light","base16/ia-light","base16/material-lighter","base16/mexico-light","base16/one-light","base16/papercolor-light","base16/ros-pine-dawn","base16/sagelight","base16/shapeshifter","base16/silk-light","base16/solar-flare-light","base16/solarized-light","base16/summerfruit-light","base16/synth-midnight-terminal-light","base16/tomorrow","base16/unikitty-light","base16/windows-10-light","base16/windows-95-light","base16/windows-high-contrast-light","brown-paper","base16/windows-nt-light","color-brewer","docco","foundation","github","googlecode","gradient-light","grayscale","idea","intellij-light","isbl-editor-light","kimbie-light","lightfair","magula","mono-blue","nnfx-light","paraiso-light","purebasic","qtcreator-light","routeros","school-book","stackoverflow-light","tokyo-night-light","vs","xcode","default"],n.ZWSP="​",n.INLINE_TYPE=["block-ref","kbd","text","file-annotation-ref","a","strong","em","u","s","mark","sup","sub","tag","code","inline-math","inline-memo"],n.BLOCK_HINT_KEYS=["((","[[","（（","【【"],n.BLOCK_HINT_CLOSE_KEYS={"((":"))","[[":"]]","（（":"））","【【":"】】"},n.CODE_LANGUAGES=["js","ts","html","toml","c#","bat","bash","c","csharp","cpp","css","diff","go","xml","json","java","javascript","kotlin","less","lua","makefile","markdown","objectivec","php","php-template","perl","plaintext","python","python-repl","r","ruby","rust","scss","sql","shell","swift","ini","typescript","vbnet","yaml","properties","1c","armasm","avrasm","actionscript","ada","angelscript","accesslog","apache","applescript","arcade","arduino","asciidoc","aspectj","abnf","autohotkey","autoit","awk","basic","bnf","dos","brainfuck","cal","cmake","csp","cos","capnproto","ceylon","clean","clojure","clojure-repl","coffeescript","coq","crystal","d","dns","dart","delphi","dts","django","dockerfile","dust","erb","elixir","elm","erlang","erlang-repl","excel","ebnf","fsharp","fix","flix","fortran","gcode","gams","gauss","glsl","gml","gherkin","golo","gradle","groovy","haml","hsp","http","handlebars","haskell","haxe","hy","irpf90","isbl","inform7","x86asm","jboss-cli","julia","julia-repl","ldif","llvm","lsl","latex","lasso","leaf","lisp","livecodeserver","livescript","mel","mipsasm","matlab","maxima","mercury","axapta","routeros","mizar","mojolicious","monkey","moonscript","n1ql","nsis","nestedtext","nginx","nim","nix","node-repl","ocaml","openscad","ruleslanguage","oxygene","pf","parser3","pony","pgsql","powershell","processing","prolog","protobuf","puppet","purebasic","profile","q","qml","reasonml","rib","rsl","roboconf","sas","sml","sqf","step21","scala","scheme","scilab","smali","smalltalk","stan","stata","stylus","subunit","tp","taggerscript","tcl","tap","thrift","twig","vbscript","vbscript-html","vhdl","vala","verilog","vim","wasm","mathematica","wren","xl","xquery","zephir","crmsh","dsconfig","graphql","yul","solidity","abap"]},1377:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.confirmDialog=void 0;const i=n(3274),a=n(9866);t.confirmDialog=(e,t,n,o)=>{const s=new a.Dialog({title:e,content:`<div class="b3-dialog__content">${t}</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text" id="confirmDialogConfirmBtn">${window.siyuan.languages.confirm}</button>\n</div>`,width:(0,i.isMobile)()?"80vw":"520px"}),r=s.element.querySelectorAll(".b3-button");r[0].addEventListener("click",(()=>{o&&o(),s.destroy()})),r[1].addEventListener("click",(()=>{n&&n(),s.destroy()}))}},9866:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dialog=void 0;const i=n(7954),a=n(8303);t.Dialog=class{constructor(e){this.disableClose=e.disableClose,this.id=(0,a.genUUID)(),window.siyuan.dialogs.push(this),this.destroyCallback=e.destroyCallback,this.element=document.createElement("div"),this.element.innerHTML=`<div class="b3-dialog">\n<div class="b3-dialog__scrim"${e.transparent?'style="background-color:transparent"':""}></div>\n<div class="b3-dialog__container" style="width:${e.width||"auto"}">\n  <svg class="b3-dialog__close fn__a${this.disableClose?" fn__none":""}"><use xlink:href="#iconClose"></use></svg>\n  <div class="b3-dialog__header${e.title?"":" fn__none"}" onselectstart="return false;">${e.title||""}</div>\n  <div style="height:${e.height||"auto"}">${e.content}</div>\n</div></div>`,this.element.querySelector(".b3-dialog__scrim").addEventListener((0,i.getEventName)(),(e=>{this.disableClose||this.destroy(),e.stopPropagation(),window.siyuan.menus.menu.remove()})),this.disableClose||this.element.querySelector(".b3-dialog__close").addEventListener((0,i.getEventName)(),(e=>{this.destroy(),e.stopPropagation()})),document.body.append(this.element),e.disableAnimation?this.element.classList.add("b3-dialog--open"):setTimeout((()=>{this.element.classList.add("b3-dialog--open")}))}destroy(){this.element.remove(),this.destroyCallback&&this.destroyCallback(),window.siyuan.dialogs.find(((e,t)=>{if(e.id===this.id)return window.siyuan.dialogs.splice(t,1),!0}))}bindInput(e,t){e.focus(),e.addEventListener("keydown",(e=>{if(!e.isComposing)return"Escape"===e.key?(this.destroy(),e.preventDefault(),void e.stopPropagation()):void("Enter"===e.key&&t&&(t(),e.preventDefault()));e.preventDefault()}))}}},1890:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hideMessage=t.showMessage=t.initMessage=void 0;const i=n(8303),a=n(8792);t.initMessage=()=>{const e=document.getElementById("message");e.innerHTML=`<div class="fn__flex-1"></div>\n<button class="b3-button b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.clearMessage}"><svg style="margin-right: 0"><use xlink:href="#iconSelect"></use></svg></button>`,e.addEventListener("click",(n=>{let i=n.target;for(;i&&!i.isEqualNode(e);){if(i.classList.contains("b3-snackbar__close")){(0,t.hideMessage)(i.parentElement.getAttribute("data-id")),n.preventDefault();break}if(i.isSameNode(e.lastElementChild)){i.parentElement.classList.remove("b3-snackbars--show"),setTimeout((()=>{i.parentElement.firstElementChild.innerHTML=""}),a.Constants.TIMEOUT_INPUT),n.preventDefault();break}i=i.parentElement}}))};t.showMessage=(e,n=6e3,a="info",o)=>{const s=o||(0,i.genUUID)(),r=document.getElementById("message").firstElementChild,l=r.querySelector(`.b3-snackbar[data-id="${s}"]`);if(l){if(window.clearTimeout(parseInt(l.getAttribute("data-timeoutid"))),l.innerHTML=`<div class="b3-snackbar__content">${e}</div>${0===n?'<svg class="b3-snackbar__close"><use xlink:href="#iconClose"></use></svg>':""}`,"error"===a?l.classList.add("b3-snackbar--error"):l.classList.remove("b3-snackbar--error"),n>0){const e=window.setTimeout((()=>{(0,t.hideMessage)(s)}),n);l.setAttribute("data-timeoutid",e.toString())}return}let c=`<div data-id="${s}" class="b3-snackbar--hide b3-snackbar${"error"===a?" b3-snackbar--error":""}"><div class="b3-snackbar__content">${e}</div>`;if(0===n)c+='<svg class="b3-snackbar__close"><use xlink:href="#iconClose"></use></svg>';else if(-1!==n){const e=window.setTimeout((()=>{(0,t.hideMessage)(s)}),n);c=c.replace("<div data-id",`<div data-timeoutid="${e}" data-id`)}return 0===r.childElementCount&&r.parentElement.classList.add("b3-snackbars--show"),r.insertAdjacentHTML("afterbegin",c+"</div>"),setTimeout((()=>{r.querySelectorAll(".b3-snackbar--hide").forEach((e=>{e.classList.remove("b3-snackbar--hide")}))})),r.firstElementChild.nextElementSibling&&r.firstElementChild.nextElementSibling.innerHTML===r.firstElementChild.innerHTML&&r.firstElementChild.nextElementSibling.remove(),r.scrollTo({top:0,behavior:"smooth"}),s};t.hideMessage=e=>{const t=document.getElementById("message").firstElementChild;if(e){const n=t.querySelector(`[data-id="${e}"]`);n&&(n.classList.add("b3-snackbar--hide"),setTimeout((()=>{n.remove()}),a.Constants.TIMEOUT_INPUT)),t.childElementCount<2&&t.parentElement.classList.remove("b3-snackbars--show")}else t.parentElement.classList.remove("b3-snackbars--show"),setTimeout((()=>{t.innerHTML=""}),a.Constants.TIMEOUT_INPUT)}},1754:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.downloadProgress=t.setTitle=t.bootSync=t.progressLoading=t.progressStatus=t.transactionError=t.exitSiYuan=t.kernelError=t.lockFile=void 0;const i=n(8792),a=n(734),o=n(2892),s=n(3371),r=n(1890),l=n(9866),c=n(3274),u=n(1377);t.lockFile=e=>{const t=`<div class="b3-dialog__scrim"></div>\n<div class="b3-dialog__container">\n    <div class="b3-dialog__header" onselectstart="return false;">🔒 ${window.siyuan.languages.lockFile0} <small>v${i.Constants.SIYUAN_VERSION}</small></div>\n    <div class="b3-dialog__content">\n        <p>${window.siyuan.languages.lockFile1}</p>\n        <p>${window.siyuan.languages.lockFile2}</p>\n    </div>\n    <div class="b3-dialog__action">\n        <button class="b3-button b3-button--cancel">${window.siyuan.languages.closeTab}</button>\n        <div class="fn__space"></div>\n        <button class="b3-button b3-button--text">${window.siyuan.languages.retry}</button>\n    </div>\n</div>`;let n=document.getElementById("errorLog");n?n.innerHTML=t:(document.body.insertAdjacentHTML("beforeend",`<div id="errorLog" class="b3-dialog b3-dialog--open">${t}</div>`),n=document.getElementById("errorLog")),n.querySelector(".b3-button--cancel").addEventListener("click",(()=>{(0,o.getAllModels)().editor.find((t=>{if(t.editor.protyle.block.rootID===e)return t.parent.parent.removeTab(t.parent.id,!1,!1),!0})),n.remove()})),n.querySelector(".b3-button--text").addEventListener("click",(()=>{(0,a.fetchPost)("/api/filetree/lockFile",{id:e},(e=>{0===e.code&&window.location.reload()}))}))};t.kernelError=()=>{var e,t;let n="";"ios"===window.siyuan.config.system.container&&(null===(e=window.webkit)||void 0===e?void 0:e.messageHandlers)&&(n=`<div class="fn__hr"></div><div class="fn__flex"><div class="fn__flex-1"></div><button class="b3-button">${window.siyuan.languages.retry}</button></div>`);const a=`<div class="b3-dialog__scrim"></div>\n<div class="b3-dialog__container" style="width: ${(0,c.isMobile)()?"80vw":"520px"}">\n    <div class="b3-dialog__header" onselectstart="return false;">💔 ${window.siyuan.languages.kernelFault0} <small>v${i.Constants.SIYUAN_VERSION}</small></div>\n    <div class="b3-dialog__content">\n        <p>${window.siyuan.languages.kernelFault1}</p>\n        <div class="fn__hr"></div>\n        <p>${window.siyuan.languages.kernelFault2}</p>\n        ${n}\n    </div>\n</div>`;let o=document.getElementById("errorLog");o?o.innerHTML=a:(document.body.insertAdjacentHTML("beforeend",`<div id="errorLog" class="b3-dialog b3-dialog--open">${a}</div>`),o=document.getElementById("errorLog"));const s=o.querySelector(".b3-button");s&&(null===(t=window.webkit)||void 0===t?void 0:t.messageHandlers)&&s.addEventListener("click",(()=>{o.remove(),window.webkit.messageHandlers.startKernelFast.postMessage("startKernelFast")}))};t.exitSiYuan=()=>{(0,a.fetchPost)("/api/system/exit",{force:!1},(e=>{var t;if(1===e.code){const t=(0,r.showMessage)(e.msg,e.data.closeTimeout,"error"),n=document.querySelector(`#message [data-id="${t}"] button`);n&&n.addEventListener("click",(()=>{(0,a.fetchPost)("/api/system/exit",{force:!0},(()=>{var e;["ios","android"].includes(window.siyuan.config.system.container)&&((null===(e=window.webkit)||void 0===e?void 0:e.messageHandlers)||window.JSAndroid)&&(window.location.href="siyuan://api/system/exit")}))}))}else 2===e.code?((0,r.hideMessage)(),(0,u.confirmDialog)(window.siyuan.languages.tip,e.msg,(()=>{(0,a.fetchPost)("/api/system/exit",{force:!0,execInstallPkg:2},(()=>{}))}),(()=>{(0,a.fetchPost)("/api/system/exit",{force:!0,execInstallPkg:1},(()=>{}))}))):["ios","android"].includes(window.siyuan.config.system.container)&&((null===(t=window.webkit)||void 0===t?void 0:t.messageHandlers)||window.JSAndroid)&&(window.location.href="siyuan://api/system/exit")}))};let d;t.transactionError=e=>{if(1===e.code)return void(0,t.lockFile)(e.data);if(document.getElementById("transactionError"))return;const n=new l.Dialog({disableClose:!0,title:`${window.siyuan.languages.stateExcepted} v${i.Constants.SIYUAN_VERSION}`,content:`<div class="b3-dialog__content" id="transactionError">${window.siyuan.languages.rebuildIndexTip}</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--text">${window.siyuan.languages._kernel[97]}</button>\n    <div class="fn__space"></div>\n    <button class="b3-button">${window.siyuan.languages.rebuildIndex}</button>\n</div>`,width:(0,c.isMobile)()?"80vw":"520px"}).element.querySelectorAll(".b3-button");n[0].addEventListener("click",(()=>{(0,s.exportLayout)(!1,(()=>{(0,t.exitSiYuan)()}))})),n[1].addEventListener("click",(()=>{(0,a.fetchPost)("/api/filetree/refreshFiletree",{})}))};t.progressStatus=e=>{if((0,c.isMobile)()){clearTimeout(d);const t=document.querySelector("#status");return t.innerHTML=e.msg,t.classList.remove("status--hide"),void(d=window.setTimeout((()=>{t.classList.add("status--hide")}),6e3))}document.querySelector("#status .status__msg").innerHTML=e.msg};t.progressLoading=e=>{let t=document.getElementById("progress");t||(document.body.insertAdjacentHTML("beforeend",'<div id="progress"></div>'),t=document.getElementById("progress")),2!==e.code?0===e.code?t.innerHTML=`<div class="b3-dialog__scrim" style="z-index:400;opacity: 1"></div>\n<div style="position: fixed;top: 45vh;width: 70vw;left: 15vw;color:#fff;z-index:400;">\n    <div style="text-align: right">${e.data.current}/${e.data.total}</div>\n    <div style="margin: 8px 0;height: 8px;border-radius: 4px;overflow: hidden;background-color:#fff;"><div style="width: ${e.data.current/e.data.total*100}%;transition: var(--b3-transition);background-color: var(--b3-theme-primary);height: 8px;"></div></div>\n    <div>${e.msg}</div>\n</div>`:1===e.code&&(t.lastElementChild?t.lastElementChild.lastElementChild.innerHTML=e.msg:t.innerHTML=`<div class="b3-dialog__scrim" style="z-index:400;opacity: 1"></div>\n<div style="position: fixed;top: 45vh;width: 70vw;left: 15vw;color:#fff;z-index:400;">\n    <div style="margin: 8px 0;height: 8px;border-radius: 4px;overflow: hidden;background-color:#fff;"><div style="background-color: var(--b3-theme-primary);height: 8px;background-image: linear-gradient(-45deg, rgba(255, 255, 255, 0.2) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.2) 50%, rgba(255, 255, 255, 0.2) 75%, transparent 75%, transparent);animation: stripMove 450ms linear infinite;background-size: 50px 50px;"></div></div>\n    <div>${e.msg}</div>\n</div>`):t.remove()};t.bootSync=()=>{(0,a.fetchPost)("/api/sync/getBootSync",{},(e=>{if(1===e.code){const t=new l.Dialog({width:(0,c.isMobile)()?"80vw":"50vw",title:"🌩️ "+window.siyuan.languages.bootSyncFailed,content:`<div class="b3-dialog__content">${e.msg}</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.syncNow}</button>\n</div>`}),n=t.element.querySelectorAll(".b3-button");n[0].addEventListener("click",(()=>{t.destroy()})),n[1].addEventListener("click",(()=>{n[1].getAttribute("disabled")||(n[1].setAttribute("disabled","disabled"),(0,a.fetchPost)("/api/sync/performBootSync",{},(e=>{0===e.code&&t.destroy(),n[1].removeAttribute("disabled")})))}))}}))};t.setTitle=e=>{const t=document.getElementById("drag");if(e===window.siyuan.languages.siyuanNote){const n=e+" v"+i.Constants.SIYUAN_VERSION;document.title=n,t.textContent=n,t.setAttribute("title",n)}else document.title=e+" - "+window.siyuan.languages.siyuanNote+" v"+i.Constants.SIYUAN_VERSION,t.textContent=e,t.setAttribute("title",e)};t.downloadProgress=e=>{const t=document.getElementById("configBazaarReadme");if(!t)return;const n=t.querySelector(`[data-url="${e.id}"]`);n&&(e.percent>=1?n.parentElement.classList.add("fn__none"):(n.classList.add("b3-button--progress"),n.innerHTML=`<span style="width: ${100*e.percent}%"></span>`))}},5099:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hideTooltip=t.showTooltip=void 0;const i=n(6224),a=n(3274);t.showTooltip=(e,n)=>{if((0,a.isMobile)())return;const o=n.getBoundingClientRect();if(0===o.height||!e)return void(0,t.hideTooltip)();let s=document.getElementById("tooltip");s?s.innerHTML=e:(document.body.insertAdjacentHTML("beforeend",`<div class="tooltip" id="tooltip">${e}</div>`),s=document.getElementById("tooltip"));let r=o.left;const l=n.getAttribute("data-position");"right"===l?r=o.right-s.clientWidth:"center"===l&&(r=o.left+(o.width-s.clientWidth)/2),(0,i.setPosition)(s,r,o.top+o.height+8,2*o.height+8)};t.hideTooltip=()=>{const e=document.getElementById("tooltip");e&&e.remove()}},2509:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteFile=void 0;const i=n(734),a=n(8813),o=n(1377);t.deleteFile=(e,t,n)=>{window.siyuan.config.fileTree.removeDocWithoutConfirm?(0,i.fetchPost)("/api/filetree/removeDoc",{notebook:e,path:t}):(0,i.fetchPost)("/api/block/getDocInfo",{id:(0,a.getDisplayName)(t,!0,!0)},(a=>{let s=`${window.siyuan.languages.confirmDelete} <b>${n}</b>?`;a.data.subFileCount>0&&(s=`${window.siyuan.languages.confirmDelete} <b>${n}</b> ${window.siyuan.languages.andSubFile.replace("x",a.data.subFileCount)}?`),(0,o.confirmDialog)(window.siyuan.languages.delete,s,(()=>{(0,i.fetchPost)("/api/filetree/removeDoc",{notebook:e,path:t})}))}))}},1308:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getIconByType=void 0;t.getIconByType=(e,t)=>{let n="";switch(e){case"NodeDocument":n="iconFile";break;case"NodeThematicBreak":n="iconLine";break;case"NodeParagraph":n="iconParagraph";break;case"NodeHeading":n=t?"icon"+t.toUpperCase():"iconHeadings";break;case"NodeBlockquote":n="iconQuote";break;case"NodeList":n="t"===t?"iconCheck":"o"===t?"iconOrderedList":"iconList";break;case"NodeListItem":n="iconListItem";break;case"NodeCodeBlock":case"NodeYamlFrontMatter":n="iconCode";break;case"NodeTable":n="iconTable";break;case"NodeBlockQueryEmbed":n="iconSQL";break;case"NodeSuperBlock":n="iconSuper";break;case"NodeMathBlock":n="iconMath";break;case"NodeHTMLBlock":n="iconHTML5";break;case"NodeWidget":n="iconBoth";break;case"NodeIFrame":n="iconLanguage";break;case"NodeVideo":n="iconVideo";break;case"NodeAudio":n="iconRecord"}return n}},7876:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Editor=void 0;const i=n(2009),a=n(7924),o=n(7010),s=n(1384),r=n(2892);class l extends a.Model{constructor(e){super({id:e.tab.id}),window.siyuan.config.fileTree.openFilesUseCurrentTab&&e.tab.headElement.classList.add("item--unupdate"),this.headElement=e.tab.headElement,this.element=e.tab.panelElement,this.initProtyle(e)}initProtyle(e){this.editor=new i.default(this.element,{action:e.action||[],blockId:e.blockId,mode:e.mode,render:{title:!0,background:!0,scroll:!0},scrollAttr:e.scrollAttr,typewriterMode:!0,after:e=>{window.siyuan.config.readonly&&(0,o.disabledProtyle)(e.protyle),window.siyuan.editorIsFullscreen&&(e.protyle.element.classList.add("fullscreen"),(0,s.setPadding)(e.protyle),(0,r.getAllModels)().editor.forEach((t=>{!e.protyle.element.isSameNode(t.element)&&t.element.classList.contains("fullscreen")&&(t.element.classList.remove("fullscreen"),(0,s.setPadding)(t.editor.protyle))})))}}),this.editor.protyle.model=this}}t.Editor=l},8349:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newFileBySelect=t.newFileContentBySelect=t.renameAsset=t.rename=t.replaceLocalPath=t.replaceFileName=t.validateName=void 0;const i=n(1890),a=n(9866),o=n(4640),s=n(3607),r=n(6075),l=n(7276),c=n(9173),u=n(3274),d=n(8813),p=n(734),h=n(3863);t.validateName=e=>!/\r\n|\r|\n|\u2028|\u2029|\t|\//.test(e)||((0,i.showMessage)(window.siyuan.languages.fileNameRule),!1);t.replaceFileName=e=>e.replace(/\r\n|\r|\n|\u2028|\u2029|\t|\//g,"");t.replaceLocalPath=e=>e.replace(/\\\\|\/|:|\*|\?|\\|'|<|>|\|/g,"");t.rename=e=>{const n=new a.Dialog({title:window.siyuan.languages.rename,content:`<div class="b3-dialog__content"><input class="b3-text-field fn__block" value=""></div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:(0,u.isMobile)()?"80vw":"520px",destroyCallback(){e.range&&(0,o.focusByRange)(e.range)}}),i=n.element.querySelector("input"),s=n.element.querySelectorAll(".b3-button");n.bindInput(i,(()=>{s[1].click()})),i.value=Lute.UnEscapeHTMLStr(e.name),i.focus(),i.select(),s[0].addEventListener("click",(()=>{n.destroy()})),s[1].addEventListener("click",(()=>!!(0,t.validateName)(i.value)&&(i.value===e.name?(n.destroy(),!1):(""===i.value.trim()?i.value="Untitled":i.value=(0,t.replaceFileName)(i.value),"notebook"===e.type?(0,p.fetchPost)("/api/notebook/renameNotebook",{notebook:e.notebookId,name:i.value},(()=>{(0,d.setNotebookName)(e.notebookId,i.value)})):(0,p.fetchPost)("/api/filetree/renameDoc",{notebook:e.notebookId,path:e.path,title:i.value}),void n.destroy()))))};t.renameAsset=e=>{const t=new a.Dialog({title:window.siyuan.languages.rename,content:`<div class="b3-dialog__content"><input class="b3-text-field fn__block" value=""></div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:(0,u.isMobile)()?"80vw":"520px"}),n=t.element.querySelector("input"),i=t.element.querySelectorAll(".b3-button");t.bindInput(n,(()=>{i[1].click()}));const o=(0,d.getAssetName)(e);n.value=o,n.focus(),n.select(),i[0].addEventListener("click",(()=>{t.destroy()})),i[1].addEventListener("click",(()=>{if(n.value===o||!n.value)return t.destroy(),!1;(0,p.fetchPost)("/api/asset/renameAsset",{oldPath:e,newName:n.value})}))};t.newFileContentBySelect=e=>{if(0===getSelection().rangeCount)return;const n=getSelection().getRangeAt(0),i=(0,s.hasClosestBlock)(n.startContainer);if(!i)return;let a=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));0===a.length&&(a=[i]);let o="",l=n.toString();if(""===l){if(l=a[0].textContent,a.forEach((e=>{o+=(0,r.removeEmbed)(e)})),!l)return}else{const e=document.createElement("div");e.appendChild(n.cloneContents()),o=e.innerHTML}l.length>10&&(l=l.substr(0,10)+"..."),l=(0,t.replaceFileName)(l),(0,p.fetchPost)("/api/filetree/createDoc",{notebook:e.notebookId,path:(0,d.pathPosix)().join((0,d.getDisplayName)(e.path,!1,!0),Lute.NewNodeID()+".sy"),title:l,md:e.lute.BlockDOM2StdMd(o)})};t.newFileBySelect=(e,n)=>{e=(0,t.replaceFileName)(e);const i=Lute.NewNodeID();(0,p.fetchPost)("/api/filetree/createDoc",{notebook:n.notebookId,path:(0,d.pathPosix)().join((0,d.getDisplayName)(n.path,!1,!0),i+".sy"),title:e,md:""},(()=>{(0,l.insertHTML)((0,c.genEmptyBlock)(!1,!1,`<span data-type="block-ref" data-id="${i}" data-subtype="d">${(0,h.escapeHtml)(e)}</span>`),n)}))}},9516:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openBy=t.updateBacklinkGraph=t.isCurrentEditor=t.updatePanelByEditor=t.openAsset=t.openFileById=void 0;const i=n(2269),a=n(7876),o=n(3371),s=n(2892),r=n(8592),l=n(8813),c=n(8792),u=n(2319),d=n(1034),p=n(1384),h=n(734),f=n(4640),g=n(7010),m=n(9039),y=n(3319),b=n(4495),v=n(3607),w=n(6520),_=n(1754),E=n(407),k=n(7731);t.openFileById=e=>{(0,h.fetchPost)("/api/block/getBlockInfo",{id:e.id},(t=>{2!==t.code?C({fileName:t.data.rootTitle,rootIcon:t.data.rootIcon,id:e.id,rootID:t.data.rootID,position:e.position,mode:e.mode,action:e.action,zoomIn:e.zoomIn,keepCursor:e.keepCursor}):(0,_.lockFile)(t.data)}))};t.openAsset=(e,t,n)=>{C({assetPath:e,page:t,position:n})};const C=e=>{const t=(0,s.getAllModels)();if(e.assetPath){if(t.asset.find((t=>{if(t.path==e.assetPath)return t.parent.parent.switchTab(t.parent.headElement),t.parent.parent.showHeading(),t.goToPage(e.page),!0})))return}else if(!e.position){let n,i;if(t.editor.find((t=>{if(t.editor.protyle.block.rootID===e.rootID&&((0,v.hasClosestByClassName)(t.element,"layout__wnd--active")&&(i=t),n=t),i)return!0})),i&&(n=i),n)return D(n,e,t),!0;if((0,s.getAllTabs)().find((t=>{var n;const i=null===(n=t.headElement)||void 0===n?void 0:n.getAttribute("data-initdata");if(i){const n=JSON.parse(i);if(n.rootId===e.rootID||n.blockId===e.rootID)return n.blockId=e.id,n.mode=e.mode,e.zoomIn?n.action=[c.Constants.CB_GET_ALL,c.Constants.CB_GET_FOCUS]:n.action=e.action,delete n.scrollAttr,t.headElement.setAttribute("data-initdata",JSON.stringify(n)),t.parent.switchTab(t.headElement),!0}})))return}let n;const i=document.querySelector(".layout__wnd--active");if(i&&(n=(0,o.getInstanceById)(i.getAttribute("data-id"))),n||(n=(0,o.getWndByLayout)(window.siyuan.layout.centerLayout)),n){if("right"!==e.position&&"bottom"!==e.position||!n.children[0].headElement)if(e.keepCursor&&n.children[0].headElement){const t=x(e);t.headElement.setAttribute("keep-cursor",e.id),n.addTab(t,e.keepCursor)}else if(window.siyuan.config.fileTree.openFilesUseCurrentTab){let t;n.children.find((e=>{if(e.headElement&&e.headElement.classList.contains("item--unupdate")&&!e.headElement.classList.contains("item--pin")&&(t=e,e.headElement.classList.contains("item--focus")))return!0})),n.addTab(x(e)),t&&!window.siyuan.ctrlIsPressed&&n.removeTab(t.id)}else n.addTab(x(e));else{const i="right"===e.position?"lr":"tb";let o;if(n.parent.children.length>1&&n.parent instanceof b.Layout&&n.parent.direction===i&&n.parent.children.find(((e,t)=>{if(e.id===n.id){let e=n.parent.children[t+1];for(;e instanceof b.Layout;)e=e.children[0];return o=e,!0}})),o){o.children.find((n=>{if(n.model&&n.model instanceof a.Editor&&n.model.editor.protyle.block.rootID===e.rootID)return D(n.model,e,t),!0}))||o.addTab(x(e))}else n.split(i).addTab(x(e))}n.showHeading()}},D=(e,n,i)=>{if(i.editor.forEach((t=>{!t.element.isSameNode(e.element)&&window.siyuan.editorIsFullscreen&&t.element.classList.contains("fullscreen")&&(t.element.classList.remove("fullscreen"),(0,p.setPadding)(t.editor.protyle))})),window.siyuan.editorIsFullscreen&&(e.element.classList.add("fullscreen"),(0,p.setPadding)(e.editor.protyle)),n.keepCursor)return e.parent.headElement.setAttribute("keep-cursor",n.id),!0;if(e.parent.parent.switchTab(e.parent.headElement),e.parent.parent.showHeading(),"preview"!==n.mode&&!e.editor.protyle.preview.element.classList.contains("fn__none"))return!0;if(n.zoomIn)return(0,E.zoomOut)(e.editor.protyle,n.id),!0;let a=e.editor.protyle.wysiwyg.element.querySelector(`[data-node-id="${n.id}"]`);a&&0!==(null==a?void 0:a.clientHeight)||n.id===n.rootID?(n.action.includes(c.Constants.CB_GET_HL)?(0,r.highlightById)(e.editor.protyle,n.id,!0):n.action.includes(c.Constants.CB_GET_FOCUS)&&(a?((0,f.focusBlock)(a),(0,r.scrollCenter)(e.editor.protyle,a,!0)):e.editor.protyle.block.rootID===n.id||e.editor.protyle.toolbar.range&&(a=(0,v.hasClosestBlock)(e.editor.protyle.toolbar.range.startContainer),(0,f.focusByRange)(e.editor.protyle.toolbar.range),a&&(0,r.scrollCenter)(e.editor.protyle,a))),(0,m.pushBack)(e.editor.protyle,void 0,a||e.editor.protyle.wysiwyg.element.firstElementChild)):(0,h.fetchPost)("/api/filetree/getDoc",{id:n.id,mode:n.action&&n.action.includes(c.Constants.CB_GET_CONTEXT)?3:0,size:c.Constants.SIZE_GET},(a=>{(0,g.onGet)(a,e.editor.protyle,n.action),(0,t.updateBacklinkGraph)(i,e.editor.protyle)})),n.mode&&(0,u.setEditMode)(e.editor.protyle,n.mode)},x=e=>{let t;if(e.assetPath){const n=(0,l.pathPosix)().extname(e.assetPath.split("?page")[0]);if(c.Constants.SIYUAN_ASSETS_EXTS.includes(n)){let a="iconPDF";c.Constants.SIYUAN_ASSETS_IMAGE.includes(n)?a="iconImage":c.Constants.SIYUAN_ASSETS_AUDIO.includes(n)?a="iconRecord":c.Constants.SIYUAN_ASSETS_VIDEO.includes(n)&&(a="iconVideo"),t=new i.Tab({icon:a,title:(0,l.getDisplayName)(e.assetPath),callback(t){const n=new y.Asset({tab:t,path:e.assetPath,page:e.page});t.addModel(n)}})}}else t=new i.Tab({title:(0,l.getDisplayName)(e.fileName,!0,!0),docIcon:e.rootIcon,callback(t){let n;n=e.zoomIn?new a.Editor({tab:t,blockId:e.id,action:[c.Constants.CB_GET_ALL,c.Constants.CB_GET_FOCUS]}):new a.Editor({tab:t,blockId:e.id,mode:e.mode,action:e.action}),t.addModel(n)}});return t};t.updatePanelByEditor=(e,n=!0,i=!1,a=!1)=>{var r;let l=window.siyuan.languages.siyuanNote;if(e&&e.path){if(e.element.classList.contains("fn__none")||!(0,v.hasClosestByClassName)(e.element,"layout__wnd--active")&&document.querySelector(".layout__wnd--active"))return;if(l=e.title.editElement.textContent,(0,p.setPadding)(e),n&&(e.toolbar.range?((0,f.focusByRange)(e.toolbar.range),(0,k.countSelectWord)(e.toolbar.range),i&&e.preview.element.classList.contains("fn__none")&&(0,m.pushBack)(e,e.toolbar.range)):((0,f.focusBlock)(e.wysiwyg.element.firstElementChild),i&&e.preview.element.classList.contains("fn__none")&&(0,m.pushBack)(e,void 0,e.wysiwyg.element.firstElementChild),(0,k.countBlockWord)([]))),window.siyuan.config.fileTree.alwaysSelectOpenedFile&&e){const t=null===(r=(0,o.getDockByType)("file"))||void 0===r?void 0:r.data.file;t instanceof d.Files&&t.selectItem(e.notebookId,e.path)}const c=(0,s.getAllModels)();S(c,e,a),(0,t.updateBacklinkGraph)(c,e)}else{const n=(0,s.getAllModels)();S(n,e,a),(0,t.updateBacklinkGraph)(n,e)}(0,_.setTitle)(l)};t.isCurrentEditor=e=>{const t=document.querySelector(".layout__wnd--active > .fn__flex > .layout-tab-bar > .item--focus");if(t){const n=(0,o.getInstanceById)(t.getAttribute("data-id"));if(n instanceof i.Tab&&n.model instanceof a.Editor&&n.model.editor.protyle.block.rootID!==e&&n.model.editor.protyle.block.id!==e)return!1}return!0};const S=(e,n,i=!1)=>{e.outline.find((e=>{var a;if(!i&&("pin"!==e.type||n&&e.blockId===(null===(a=n.block)||void 0===a?void 0:a.rootID)));else{let a="";if(n&&n.block&&(a=n.block.rootID),a===e.blockId&&!i)return;(0,h.fetchPost)("/api/outline/getDocOutline",{id:a},(i=>{if((0,t.isCurrentEditor)(a))if(e.update(i,a),n){if(e.updateDocTitle(n.background.ial),getSelection().rangeCount>0){const t=getSelection().getRangeAt(0).startContainer;if(n.wysiwyg.element.contains(t)){const n=(0,v.hasClosestByAttribute)(t,"data-node-id",null);if(n)if("NodeHeading"===n.getAttribute("data-type"))e.setCurrent(n.getAttribute("data-node-id"));else{const t=(0,w.getPreviousHeading)(n);t&&e.setCurrent(t.getAttribute("data-node-id"))}}}}else e.updateDocTitle()}))}}))};t.updateBacklinkGraph=(e,n)=>{n&&n.element.classList.contains("fn__none")||n&&!(0,v.hasClosestByClassName)(n.element,"layout__wnd--active")&&document.querySelector(".layout__wnd--active")||(e.graph.forEach((e=>{var t,i;if("global"!==e.type&&(!n||e.blockId!==(null===(t=n.block)||void 0===t?void 0:t.id))){if("local"===e.type&&e.rootId!==(null===(i=null==n?void 0:n.block)||void 0===i?void 0:i.rootID))return;let t="";if(n&&n.block&&(t=n.block.showAll?n.block.id:n.block.parentID),t===e.blockId)return;e.searchGraph(!0,t)}})),e.backlinks.forEach((e=>{var i;if("local"===e.type&&e.rootId!==(null===(i=null==n?void 0:n.block)||void 0===i?void 0:i.rootID))return;let a="";n&&n.block&&(a=n.block.showAll?n.block.id:n.block.parentID),a!==e.blockId&&(e.element.querySelector('.block__icon[data-type="refresh"] svg').classList.add("fn__rotate"),(0,h.fetchPost)("/api/ref/getBacklink",{id:a||"",beforeLen:e.element.querySelector('.block__icon[data-type="more"]').classList.contains("ft__primary")?20*e.beforeLen:e.beforeLen,k:e.inputsElement[0].value,mk:e.inputsElement[1].value},(n=>{(0,t.isCurrentEditor)(a)?(e.blockId=a,e.render(n.data)):e.element.querySelector('.block__icon[data-type="refresh"] svg').classList.remove("fn__rotate")})))})))};t.openBy=(e,t)=>{}},7640:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateFileTreeEmoji=t.updateOutlineEmoji=t.openEmojiPanel=t.addEmoji=t.filterEmoji=t.lazyLoadEmoji=t.unicode2Emoji=t.getRandomEmoji=void 0;const i=n(3274),a=n(734),o=n(3607),s=n(8792),r=n(3371),l=n(2892),c=n(8813);t.getRandomEmoji=()=>{const e=window.siyuan.emojis[(0,i.getRandom)(0,window.siyuan.emojis.length-1)];return void 0===e.items[(0,i.getRandom)(0,e.items.length-1)]?"1f600":e.items[(0,i.getRandom)(0,e.items.length-1)].unicode};t.unicode2Emoji=(e,t=!1)=>{if(!e)return"";let n="";if(e.indexOf(".")>-1)n=`<img src="/emojis/${e}"/>`;else if((0,i.isMobile)()||window.siyuan.config.appearance.nativeEmoji||t)try{e.split("-").forEach((e=>{e.length<5?n+=String.fromCodePoint(parseInt("0"+e,16)):n+=String.fromCodePoint(parseInt(e,16))}))}catch(e){}else n=`<svg class="custom-icon"><use xlink:href="#icon-${e}"></use></svg>`;return n};t.lazyLoadEmoji=(e,n=!1)=>{const i=new IntersectionObserver((e=>{e.forEach((e=>{const i=e.target.getAttribute("data-index");if((void 0===e.isIntersecting?0!==e.intersectionRatio:e.isIntersecting)&&i){let a="";window.siyuan.emojis[parseInt(i)].items.forEach((e=>{a+=`<button data-unicode="${e.unicode}" class="emojis__item" aria-label="${"zh_CN"===window.siyuan.config.lang?e.description_zh_cn:e.description}">\n${(0,t.unicode2Emoji)(e.unicode,n)}</button>`})),e.target.innerHTML=a,e.target.removeAttribute("data-index")}}))}));e.querySelectorAll(".emojis__content").forEach((e=>{i.observe(e)}))};t.filterEmoji=(e="",n,i=!1)=>{let a="";const o=[];e&&(a=`<div class="emojis__title">${window.siyuan.languages.emoji}</div><div class="emojis__content">`);let s=0,r="";const l=[];window.siyuan.emojis.forEach(((c,u)=>{e||(a+=`<div class="emojis__title" data-type="${u+1}">${"zh_CN"===window.siyuan.config.lang?c.title_zh_cn:c.title}</div><div style="min-height:${0===u?"28px":"336px"}" class="emojis__content"${u>1?' data-index="'+u+'"':""}>`),0!==c.items.length||0!==u||e||(a+=`<div style="margin-left: 4px">${window.siyuan.languages.setEmojiTip}</div>`),c.items.forEach((d=>{if(e){if(window.siyuan.config.editor.emoji.includes(d.unicode)&&((0,t.unicode2Emoji)(d.unicode,!0)===e||d.keywords.toLowerCase().indexOf(e.toLowerCase())>-1||d.description.toLowerCase().indexOf(e.toLowerCase())>-1||d.description_zh_cn.toLowerCase().indexOf(e.toLowerCase())>-1)&&o.push(d),n&&s>n)return;((0,t.unicode2Emoji)(d.unicode,!0)===e||d.keywords.toLowerCase().indexOf(e.toLowerCase())>-1||d.description.toLowerCase().indexOf(e.toLowerCase())>-1||d.description_zh_cn.toLowerCase().indexOf(e.toLowerCase())>-1)&&("custom"===c.id?l.push(d):r+=`<button data-unicode="${d.unicode}" class="emojis__item" aria-label="${"zh_CN"===window.siyuan.config.lang?d.description_zh_cn:d.description}">\n${(0,t.unicode2Emoji)(d.unicode,i)}</button>`,s++)}else window.siyuan.config.editor.emoji.includes(d.unicode)&&o.push(d),u<2&&(a+=`<button data-unicode="${d.unicode}" class="emojis__item" aria-label="${"zh_CN"===window.siyuan.config.lang?d.description_zh_cn:d.description}">\n${(0,t.unicode2Emoji)(d.unicode,i)}</button>`)})),e||(a+="</div>")})),e&&(l.sort(((t,n)=>{const i=t.keywords.split("/"),a=n.keywords.split("/");return i[i.length-1].toLowerCase().indexOf(e.toLowerCase())<a[a.length-1].toLowerCase().indexOf(e.toLowerCase())?-1:0})).sort(((t,n)=>{const i=t.keywords.split("/"),a=n.keywords.split("/");return i[i.length-1].toLowerCase().indexOf(e.toLowerCase())===a[a.length-1].toLowerCase().indexOf(e.toLowerCase())&&i[i.length-1].length<a[a.length-1].length?-1:0})).forEach((e=>{a+=`<button data-unicode="${e.unicode}" class="emojis__item" aria-label="${"zh_CN"===window.siyuan.config.lang?e.description_zh_cn:e.description}">\n${(0,t.unicode2Emoji)(e.unicode,i)}</button>`})),a=a+r+"</div>");let c="";return o.length>0&&(c=`<div class="emojis__title" data-type="0">${window.siyuan.languages.recentEmoji}</div><div class="emojis__content">`,window.siyuan.config.editor.emoji.forEach((e=>{const n=o.filter((t=>t.unicode===e));n[0]&&(c+=`<button data-unicode="${n[0].unicode}" class="emojis__item" aria-label="${"zh_CN"===window.siyuan.config.lang?n[0].description_zh_cn:n[0].description}">\n${(0,t.unicode2Emoji)(n[0].unicode,i)}\n</button>`)})),c+="</div>"),c+a===""?`<div class="emojis__title">${window.siyuan.languages.emptyContent}</div>`:c+a};t.addEmoji=e=>{window.siyuan.config.editor.emoji.unshift(e),window.siyuan.config.editor.emoji.length>s.Constants.SIZE_UNDO&&window.siyuan.config.editor.emoji.pop(),window.siyuan.config.editor.emoji=Array.from(new Set(window.siyuan.config.editor.emoji)),(0,a.fetchPost)("/api/setting/setEmoji",{emoji:window.siyuan.config.editor.emoji})};t.openEmojiPanel=(e,n,s=!1)=>{window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.innerHTML=`<div class="emojis" style="width: ${(0,i.isMobile)()?"80vw":"360px"}">\n<div class="fn__flex">\n    <span class="fn__space"></span>\n    <label class="b3-form__icon fn__flex-1">\n        <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>\n        <input class="b3-form__icon-input b3-text-field fn__block" placeholder="${window.siyuan.languages.search}">\n    </label>\n    <span class="fn__space"></span>\n    <span class="block__icon fn__flex-center b3-tooltips b3-tooltips__sw" style="opacity: 1" aria-label="${window.siyuan.languages.random}"><svg><use xlink:href="#iconRefresh"></use></svg></span>\n    <span class="fn__space"></span>\n    <span class="block__icon fn__flex-center b3-tooltips b3-tooltips__sw" style="opacity: 1" aria-label="${window.siyuan.languages.remove}"><svg><use xlink:href="#iconTrashcan"></use></svg></span>\n    <span class="fn__space"></span>\n</div>\n<div class="emojis__panel">${(0,t.filterEmoji)()}</div>\n<div class="fn__flex">\n    <div data-type="0" class="emojis__type" aria-label="${window.siyuan.languages.recentEmoji}">${(0,t.unicode2Emoji)("2b50")}</div>\n    <div data-type="1" class="emojis__type" aria-label="${window.siyuan.emojis[0]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,t.unicode2Emoji)("1f527")}</div>\n    <div data-type="2" class="emojis__type" aria-label="${window.siyuan.emojis[1]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,t.unicode2Emoji)("1f60d")}</div>\n    <div data-type="3" class="emojis__type" aria-label="${window.siyuan.emojis[2]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,t.unicode2Emoji)("1f433")}</div>\n    <div data-type="4" class="emojis__type" aria-label="${window.siyuan.emojis[3]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,t.unicode2Emoji)("1f96a")}</div>\n    <div data-type="5" class="emojis__type" aria-label="${window.siyuan.emojis[4]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,t.unicode2Emoji)("1f3a8")}</div>\n    <div data-type="6" class="emojis__type" aria-label="${window.siyuan.emojis[5]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,t.unicode2Emoji)("1f3dd")}</div>\n    <div data-type="7" class="emojis__type" aria-label="${window.siyuan.emojis[6]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,t.unicode2Emoji)("1f52e")}</div>\n    <div data-type="8" class="emojis__type" aria-label="${window.siyuan.emojis[7]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,t.unicode2Emoji)("267e")}</div>\n    <div data-type="9" class="emojis__type" aria-label="${window.siyuan.emojis[8]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,t.unicode2Emoji)("1f6a9")}</div>\n</div>\n</div>`,window.siyuan.menus.menu.element.firstElementChild.querySelector(".emojis__item").classList.add("emojis__item--current");const r=n.getBoundingClientRect();window.siyuan.menus.menu.popup({x:r.left,y:r.top+r.height});const l=window.siyuan.menus.menu.element.querySelector(".b3-text-field"),c=window.siyuan.menus.menu.element.querySelector(".emojis__panel");l.addEventListener("compositionend",(()=>{var e;c.innerHTML=(0,t.filterEmoji)(l.value),l.value?c.nextElementSibling.classList.add("fn__none"):c.nextElementSibling.classList.remove("fn__none"),c.scrollTop=0,null===(e=window.siyuan.menus.menu.element.firstElementChild.querySelector(".emojis__item"))||void 0===e||e.classList.add("emojis__item--current"),""===l.value&&(0,t.lazyLoadEmoji)(window.siyuan.menus.menu.element)})),l.addEventListener("input",(e=>{var n;e.isComposing||(c.innerHTML=(0,t.filterEmoji)(l.value),l.value?c.nextElementSibling.classList.add("fn__none"):c.nextElementSibling.classList.remove("fn__none"),c.scrollTop=0,null===(n=window.siyuan.menus.menu.element.firstElementChild.querySelector(".emojis__item"))||void 0===n||n.classList.add("emojis__item--current"),""===l.value&&(0,t.lazyLoadEmoji)(window.siyuan.menus.menu.element))})),l.addEventListener("keydown",(n=>{var i,o;if(n.isComposing)return;if(-1===n.key.indexOf("Arrow")&&"Enter"!==n.key)return;const r=window.siyuan.menus.menu.element.firstElementChild.querySelector(".emojis__item--current");if(!r)return;if("Enter"===n.key){const i=r.getAttribute("data-unicode");return s?(0,a.fetchPost)("/api/notebook/setNotebookIcon",{notebook:e,icon:i},(()=>{window.siyuan.menus.menu.remove(),(0,t.addEmoji)(i),(0,t.updateFileTreeEmoji)(i,e,"iconFilesRoot")})):(0,a.fetchPost)("/api/attr/setBlockAttrs",{id:e,attrs:{icon:i}},(()=>{window.siyuan.menus.menu.remove(),(0,t.addEmoji)(i),(0,t.updateFileTreeEmoji)(i,e),u(i,e),(0,t.updateOutlineEmoji)(i)})),n.preventDefault(),void n.stopPropagation()}let d;if("ArrowLeft"===n.key||"ArrowUp"===n.key?r.previousElementSibling?(r.classList.remove("emojis__item--current"),d=r.previousElementSibling,n.preventDefault(),n.stopPropagation()):(null===(i=r.parentElement.previousElementSibling)||void 0===i?void 0:i.previousElementSibling)&&(r.classList.remove("emojis__item--current"),d=r.parentElement.previousElementSibling.previousElementSibling.lastElementChild,n.preventDefault(),n.stopPropagation()):"ArrowRight"!==n.key&&"ArrowDown"!==n.key||(r.nextElementSibling?(r.classList.remove("emojis__item--current"),d=r.nextElementSibling,n.preventDefault(),n.stopPropagation()):(null===(o=r.parentElement.nextElementSibling)||void 0===o?void 0:o.nextElementSibling)&&(r.classList.remove("emojis__item--current"),d=r.parentElement.nextElementSibling.nextElementSibling.firstElementChild,n.preventDefault(),n.stopPropagation())),d){d.classList.add("emojis__item--current");const e=l.clientHeight+6;d.offsetTop-e<c.scrollTop?c.scrollTop=d.offsetTop-e:d.offsetTop-e-c.clientHeight+d.clientHeight>c.scrollTop&&(c.scrollTop=d.offsetTop-e-c.clientHeight+d.clientHeight)}})),(0,i.isMobile)()||l.focus(),(0,t.lazyLoadEmoji)(window.siyuan.menus.menu.element),window.siyuan.menus.menu.element.firstElementChild.addEventListener("click",(n=>{const i=n.target,r=(0,o.hasClosestByClassName)(i,"emojis__type");if(r){const e=c.querySelector(`[data-type="${r.getAttribute("data-type")}"]`);if(e){const n=e.nextElementSibling.getAttribute("data-index");if(n){let i="";window.siyuan.emojis[parseInt(n)].items.forEach((e=>{i+=`<button data-unicode="${e.unicode}" class="emojis__item" aria-label="${"zh_CN"===window.siyuan.config.lang?e.description_zh_cn:e.description}">\n${(0,t.unicode2Emoji)(e.unicode)}</button>`})),e.nextElementSibling.innerHTML=i,e.nextElementSibling.removeAttribute("data-index")}c.scrollTo({top:e.offsetTop-34})}return}const l=(0,o.hasClosestByClassName)(i,"block__icon");if(l&&l.getAttribute("aria-label")===window.siyuan.languages.remove)return void(s?(0,a.fetchPost)("/api/notebook/setNotebookIcon",{notebook:e,icon:""},(()=>{window.siyuan.menus.menu.remove(),(0,t.updateFileTreeEmoji)("",e,"iconFilesRoot")})):(0,a.fetchPost)("/api/attr/setBlockAttrs",{id:e,attrs:{icon:""}},(()=>{window.siyuan.menus.menu.remove(),(0,t.updateFileTreeEmoji)("",e),u("",e),(0,t.updateOutlineEmoji)("")})));const d=(0,o.hasClosestByClassName)(i,"emojis__item");if(d||l){let n="";return d?(n=d.getAttribute("data-unicode"),window.siyuan.menus.menu.remove()):n=(0,t.getRandomEmoji)(),void(s?(0,a.fetchPost)("/api/notebook/setNotebookIcon",{notebook:e,icon:n},(()=>{(0,t.addEmoji)(n),(0,t.updateFileTreeEmoji)(n,e,"iconFilesRoot")})):(0,a.fetchPost)("/api/attr/setBlockAttrs",{id:e,attrs:{icon:n}},(()=>{(0,t.addEmoji)(n),(0,t.updateFileTreeEmoji)(n,e),u(n,e),(0,t.updateOutlineEmoji)(n)})))}}))};t.updateOutlineEmoji=e=>{(0,l.getAllModels)().outline.forEach((n=>{n.headerElement.nextElementSibling.firstElementChild.innerHTML=(0,t.unicode2Emoji)(e||s.Constants.SIYUAN_IMAGE_FILE)}))};t.updateFileTreeEmoji=(e,n,i="iconFile")=>{let a;const o=(0,r.getDockByType)("file").data.file;a="iconFile"===i?o.element.querySelector(`[data-node-id="${n}"] .b3-list-item__icon`):o.element.querySelector(`[data-node-id="${n}"] .b3-list-item__icon`)||o.element.querySelector(`[data-url="${n}"] .b3-list-item__icon`)||o.closeElement.querySelector(`[data-url="${n}"] .b3-list-item__icon`),a&&(a.innerHTML=(0,t.unicode2Emoji)(e||("iconFile"===i?a.previousElementSibling.classList.contains("fn__hidden")?s.Constants.SIYUAN_IMAGE_FILE:s.Constants.SIYUAN_IMAGE_FOLDER:s.Constants.SIYUAN_IMAGE_NOTE))),"iconFile"!==i&&(0,c.setNoteBook)()};const u=(e,t)=>{(0,l.getAllModels)().editor.find((n=>{if(n.editor.protyle.block.rootID===t)return n.editor.protyle.background.ial.icon=e,n.editor.protyle.background.render(n.editor.protyle.background.ial,n.editor.protyle.block.rootID),n.parent.setDocIcon(e),!0}))}},7924:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Model=void 0;const i=n(8792),a=n(3371),o=n(4369),s=n(1754);t.Model=class{constructor(e){e.msgCallback&&this.connect(e)}connect(e){const t=`${"https:"===window.location.protocol?"wss":"ws"}://${window.location.host}/ws`,n=new WebSocket(`${t}?app=${i.Constants.SIYUAN_APPID}&id=${e.id}${e.type?"&type="+e.type:""}`);n.onopen=()=>{e.callback&&e.callback.call(this);document.getElementById("errorLog")&&(0,a.exportLayout)(!0)},n.onmessage=t=>{if(e.msgCallback){const n=(0,o.processMessage)(JSON.parse(t.data));e.msgCallback.call(this,n)}},n.onclose=t=>{0<=t.reason.indexOf("unauthenticated")||0>t.reason.indexOf("close websocket")&&(console.warn("WebSocket is closed. Reconnect will be attempted in 3 second.",t),setTimeout((()=>{this.connect({id:e.id,type:e.type,msgCallback:e.msgCallback})}),3e3))},n.onerror=e=>{const t=document.getElementById("errorLog");e.target.url.endsWith("&type=main")&&3===e.target.readyState&&!t&&(0,s.kernelError)()},this.ws=n}send(e,t,n=!1){this.ws&&(this.reqId=n?0:(new Date).getTime(),this.ws.send(JSON.stringify({cmd:e,reqId:this.reqId,param:t})))}}},2269:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tab=void 0;const i=n(8303),a=n(7876),o=n(3607),s=n(8792),r=n(3863),l=n(7640),c=n(734),u=n(5099);t.Tab=class{constructor(e){if(this.id=(0,i.genUUID)(),this.callback=e.callback,e.title||e.icon){this.title=e.title,this.icon=e.icon,this.docIcon=e.docIcon,this.headElement=document.createElement("li"),this.headElement.setAttribute("data-type","tab-header"),this.headElement.setAttribute("draggable","true"),this.headElement.setAttribute("data-id",this.id),this.headElement.setAttribute("data-position","center"),this.headElement.classList.add("item","item--focus");let t="";e.icon?t=`<svg class="item__graphic"><use xlink:href="#${e.icon}"></use></svg>`:e.docIcon&&(t=`<span class="item__icon">${(0,l.unicode2Emoji)(e.docIcon)}</span>`),this.headElement.innerHTML=`${t}<span class="item__text">${(0,r.escapeHtml)(e.title)}</span>\n<span class="item__close"><svg><use xlink:href='#iconClose'></use></svg></span>`,this.headElement.addEventListener("mouseenter",(e=>{var t,n,i;e.stopPropagation(),e.preventDefault();let o="";if(this.model instanceof a.Editor&&(null===(i=null===(n=null===(t=this.model.editor)||void 0===t?void 0:t.protyle)||void 0===n?void 0:n.block)||void 0===i?void 0:i.rootID))o=this.model.editor.protyle.block.rootID;else if(!this.model){const e=JSON.parse(this.headElement.getAttribute("data-initdata")||"{}");e&&(o=e.blockId)}o&&(0,c.fetchPost)("/api/filetree/getFullHPathByID",{id:o},(e=>{this.headElement.getAttribute("aria-label")||(0,u.showTooltip)((0,r.escapeHtml)(e.data),this.headElement),this.headElement.setAttribute("aria-label",(0,r.escapeHtml)(e.data))}))})),this.headElement.addEventListener("dragstart",(e=>{window.getSelection().removeAllRanges();const t=(0,o.hasClosestByTag)(e.target,"LI");t&&(e.dataTransfer.setData("text/html",t.outerHTML),e.dataTransfer.setData(s.Constants.SIYUAN_DROP_TAB,this.id),e.dataTransfer.dropEffect="move",t.style.opacity="0.1",window.siyuan.dragElement=this.headElement)})),this.headElement.addEventListener("dragend",(e=>{const t=(0,o.hasClosestByTag)(e.target,"LI");t&&(t.style.opacity="1",document.querySelectorAll(".layout-tab-bar li[data-clone='true']").forEach((e=>{e.remove()}))),window.siyuan.dragElement=void 0,"none"===e.dataTransfer.dropEffect&&this.parent.children.forEach(((e,t)=>{const n=this.headElement.parentElement.children[t];e.headElement.isSameNode(n)||(0===t?this.headElement.parentElement.firstElementChild.before(e.headElement):this.headElement.parentElement.children[t-1].after(e.headElement))}))}))}this.panelElement=document.createElement("div"),this.panelElement.classList.add("fn__flex-1"),this.panelElement.innerHTML=e.panel||"",this.panelElement.setAttribute("data-id",this.id)}updateTitle(e){this.title=e,this.headElement.querySelector(".item__text").innerHTML=(0,r.escapeHtml)(e)}addModel(e){this.model=e,e.parent=this}pin(){if(!this.headElement.previousElementSibling||this.headElement.previousElementSibling&&this.headElement.previousElementSibling.classList.contains("item--pin"));else{let e,t,n=0;this.parent.children.find(((i,a)=>{if(i.headElement.classList.contains("item--pin")&&(n=a+1,t=i.headElement),i.id===this.id)return e=this.parent.children.splice(a,1)[0],!0})),t?t.after(e.headElement):this.parent.children[0].headElement.before(e.headElement),this.parent.children.splice(n,0,e)}this.headElement.classList.add("item--pin"),(this.docIcon||this.icon)&&this.headElement.querySelector(".item__text").classList.add("fn__none")}setDocIcon(e){if(this.docIcon=e,this.docIcon){const t=this.headElement.querySelector(".item__icon");t?t.innerHTML=(0,l.unicode2Emoji)(e):this.headElement.querySelector(".item__text").insertAdjacentHTML("beforebegin",`<span class="item__icon">${(0,l.unicode2Emoji)(e)}</span>`),this.headElement.classList.contains("item--pin")&&this.headElement.querySelector(".item__text").classList.add("fn__none")}else this.headElement.querySelector(".item__icon").remove(),this.headElement.querySelector(".item__text").classList.remove("fn__none")}unpin(){if(!this.headElement.nextElementSibling||this.headElement.nextElementSibling&&!this.headElement.nextElementSibling.classList.contains("item--pin"));else{let e,t,n=0;for(let i=0;i<this.parent.children.length;i++)this.parent.children[i].id===this.id&&(e=this.parent.children.splice(i,1)[0],i--),i>-1&&this.parent.children[i].headElement.classList.contains("item--pin")&&(n=i+1,t=this.parent.children[i].headElement);t.after(e.headElement),this.parent.children.splice(n,0,e)}this.headElement.classList.remove("item--pin"),(this.docIcon||this.icon)&&this.headElement.querySelector(".item__text").classList.remove("fn__none")}}},8943:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wnd=void 0;const i=n(4495),a=n(8303),o=n(3371),s=n(7876),r=n(4341),l=n(3607),c=n(8792),u=n(7729),d=n(1890),p=n(9516),h=n(8592),f=n(2892),g=n(7731),m=n(3914),y=n(3319),b=n(4779),v=n(2640);class w{constructor(e,t){this.children=[],this.removeTabAction=(e,t=!1,n=!0)=>{if(this.children.find(((i,a)=>{if(i.id===e){if(i.model instanceof s.Editor&&n&&(0,m.saveScroll)(i.model.editor.protyle),1===this.children.length){this.destroyModel(this.children[0].model),this.children=[],["top","bottom","left","right"].includes(this.parent.type)?i.panelElement.remove():this.remove();const e=(0,f.getAllModels)().editor;return void(0===e.length?(0,p.updatePanelByEditor)():e.forEach((e=>{if(!e.element.classList.contains("fn__none"))return(0,o.setPanelFocus)(e.parent.parent.headersElement.parentElement.parentElement),void(0,p.updatePanelByEditor)(e.editor.protyle,!0,!0)})))}if(i.headElement){if(i.headElement.classList.contains("item--focus")){let e=a+1;a===this.children.length-1&&(e=a-1),this.children[e]&&!t&&this.switchTab(this.children[e].headElement,!0)}i.headElement.remove()}return i.panelElement.remove(),this.destroyModel(i.model),this.children.splice(a,1),(0,o.resizeTabs)(),!0}})),window.siyuan.layout.centerLayout){if(!(0,o.getWndByLayout)(window.siyuan.layout.centerLayout)){const e=new w;window.siyuan.layout.centerLayout.addWnd(e),e.addTab((0,o.newCenterEmptyTab)())}}},this.id=(0,a.genUUID)(),this.resize=e,this.element=document.createElement("div"),this.element.classList.add("fn__flex-1","fn__flex");let n='<div class="layout-tab-container__drag fn__none"></div>';"left"!==t&&"right"!==t&&"top"!==t&&"bottom"!==t||(n=""),this.element.innerHTML=`<div data-type="wnd" data-id="${this.id}" class="fn__flex-column fn__flex fn__flex-1">\n    <div class="fn__flex fn__none">\n        <ul class="fn__flex layout-tab-bar fn__flex-1"></ul>\n        <ul class="layout-tab-bar">\n            <li class="item item--readonly">\n                <span data-type="new" class="item__close" title="${window.siyuan.languages.newFile}"><svg style="height: 10px;width: 10px;padding: 3px"><use xlink:href="#iconAdd"></use></svg></span>\n                <span data-type="more" data-menu="true" class="item__close" title="${window.siyuan.languages.more}"><svg><use xlink:href="#iconDown"></use></svg></span>\n            </li>\n        </ul>\n    </div>\n    <div class="layout-tab-container fn__flex-1">${n}</div>\n</div>`,this.headersElement=this.element.querySelector(".layout-tab-bar"),this.headersElement.addEventListener("mousedown",(e=>{if(1!==e.button)return;let t=e.target;for(;t&&!t.isEqualNode(this.headersElement);){if("LI"===t.tagName){this.removeTab(t.getAttribute("data-id")),window.siyuan.menus.menu.remove(),e.stopPropagation(),e.preventDefault();break}t=t.parentElement}})),this.headersElement.addEventListener("mousewheel",(e=>{this.headersElement.scrollLeft=this.headersElement.scrollLeft+e.deltaY}),{passive:!0}),this.headersElement.parentElement.addEventListener("click",(e=>{let t=e.target;for(;t&&!t.isEqualNode(this.headersElement);){if(t.classList.contains("item__close")&&"new"===t.getAttribute("data-type")){(0,o.setPanelFocus)(this.headersElement.parentElement.parentElement),(0,b.newFile)(void 0,void 0,!0);break}if(t.classList.contains("item__close")&&"more"===t.getAttribute("data-type")){this.renderTabList(e);break}if("LI"===t.tagName&&t.getAttribute("data-id")){this.switchTab(t,!0);break}t=t.parentElement}})),this.headersElement.addEventListener("dblclick",(e=>{if(window.siyuan.config.fileTree.openFilesUseCurrentTab){let t=e.target;for(;t&&!t.isEqualNode(this.headersElement);){if("LI"===t.tagName){t.classList.remove("item--unupdate");break}t=t.parentElement}}}));const i=this.element.querySelector(".layout-tab-container__drag");i&&(this.element.addEventListener("dragenter",(e=>{if(e.dataTransfer.types.includes(c.Constants.SIYUAN_DROP_TAB)){if((0,l.hasClosestByClassName)(e.target,"layout-tab-bar"))return;(0,l.hasClosestByClassName)(e.target,"layout-tab-container",!0)&&(i.classList.remove("fn__none"),i.setAttribute("style","height:100%;width:100%;right:auto;bottom:auto"))}})),this.headersElement.addEventListener("dragover",(function(e){if(!window.siyuan.dragElement||!e.dataTransfer.types.includes(c.Constants.SIYUAN_DROP_TAB))return;e.preventDefault();const t=this,n=(0,l.hasClosestByTag)(e.target,"LI");let i=window.siyuan.dragElement,a=!1;if(Array.from(t.childNodes).find((e=>{if("0.1"===e.style.opacity)return i=e,a=!0,!0})),n||i.classList.contains("item--pin")||t.classList.add("layout-tab-bar--drag"),!a){if(i.classList.contains("item--pin"))return;return i=i.cloneNode(!0),i.setAttribute("data-clone","true"),void t.append(i)}if(n&&!n.isSameNode(i)&&(i.classList.contains("item--pin")&&n.classList.contains("item--pin")||!i.classList.contains("item--pin")&&!n.classList.contains("item--pin"))){const t=n.getClientRects()[0];e.clientX>t.left+t.width/2?n.after(i):n.before(i)}})),this.headersElement.addEventListener("dragleave",(function(){const e=this;e.classList.remove("layout-tab-bar--drag"),document.querySelectorAll(".layout-tab-bar").forEach((t=>{if(t!==e){const e=t.querySelector("li[data-clone='true']");e&&e.remove()}}))})),this.headersElement.addEventListener("drop",(function(e){var t;const n=(0,o.getInstanceById)(e.dataTransfer.getData(c.Constants.SIYUAN_DROP_TAB)),i=this;i.classList.remove("layout-tab-bar--drag");const a=null===(t=Array.from(i.childNodes).find((e=>{if("0.1"===e.style.opacity)return!0})))||void 0===t?void 0:t.nextElementSibling;if(!i.contains(n.headElement)){const e=i.querySelector("[data-clone='true']");if(!e)return;e.before(n.headElement),e.remove();return(0,o.getInstanceById)(i.parentElement.parentElement.getAttribute("data-id")).moveTab(n,a?a.getAttribute("data-id"):void 0),void(0,o.resizeTabs)()}let s;n.parent.children.find(((e,t)=>{if(e.id===n.id)return s=n.parent.children.splice(t,1)[0],!0})),a?n.parent.children.find(((e,t)=>{if(e.id===a.getAttribute("data-id"))return n.parent.children.splice(t,0,s),!0})):n.parent.children.push(s)})),i.addEventListener("dragover",(e=>{if(e.preventDefault(),!i.nextElementSibling)return;const t=i.parentElement.getBoundingClientRect(),n=t.height,a=t.width,o=e.clientX-t.left,s=e.clientY-t.top;o<=a/3&&(s<=n/8||s>=7*n/8)||o<=a/8&&(s>n/8||s<7*n/8)?i.setAttribute("style","height:100%;width:50%;right:50%;bottom:0;left:0;top:0"):o>2*a/3&&(s<=n/8||s>=7*n/8)||o>=7*a/8&&(s>n/8||s<7*n/8)?i.setAttribute("style","height:100%;width:50%;right:0;bottom:0;left:50%;top:0"):o>a/3&&o<2*a/3&&s<=n/8?i.setAttribute("style","height:50%;width:100%;right:0;bottom:50%;left:0;top:0"):o>a/3&&o<2*a/3&&s>=7*n/8?i.setAttribute("style","height:50%;width:100%;right:0;bottom:0;left:0;top:50%"):i.setAttribute("style","height:100%;width:100%;right:0;bottom:0;top:0;left:0")})),i.addEventListener("dragleave",(()=>{i.classList.add("fn__none")})),i.addEventListener("drop",(e=>{i.classList.add("fn__none");const t=e.target.parentElement.parentElement,n=(0,o.getInstanceById)(t.getAttribute("data-id")),a=e.dataTransfer.getData(c.Constants.SIYUAN_DROP_TAB),s=(0,o.getInstanceById)(a);if("50%"!==i.style.height&&"50%"!==i.style.width)t.contains(document.querySelector(`[data-id="${a}"]`))||n&&(n.headersElement.append(s.headElement),n.headersElement.parentElement.classList.remove("fn__none"),n.moveTab(s),(0,o.resizeTabs)());else if("50%"===i.style.height){const e=n.split("tb");e.headersElement.append(s.headElement),e.headersElement.parentElement.classList.remove("fn__none"),e.moveTab(s),"50%"===i.style.bottom&&e.element.previousElementSibling&&n.element.parentElement&&(0,o.switchWnd)(e,n)}else if("50%"===i.style.width){const e=n.split("lr");e.headersElement.append(s.headElement),e.headersElement.parentElement.classList.remove("fn__none"),e.moveTab(s),"50%"===i.style.right&&e.element.previousElementSibling&&n.element.parentElement&&(0,o.switchWnd)(e,n)}})))}showHeading(){const e=this.headersElement.querySelector(".item--focus");e.offsetLeft+e.clientWidth>this.headersElement.scrollLeft+this.headersElement.clientWidth?this.headersElement.scrollLeft=e.offsetLeft+e.clientWidth-this.headersElement.clientWidth:e.offsetLeft<this.headersElement.scrollLeft&&(this.headersElement.scrollLeft=e.offsetLeft)}switchTab(e,t=!1,n=!0){let i;(0,o.setPanelFocus)(this.headersElement.parentElement.parentElement),this.children.forEach((t=>{var n;e===t.headElement?(t.headElement&&t.headElement.classList.contains("fn__none")||(t.headElement&&(t.headElement.classList.add("item--focus"),t.headElement.setAttribute("data-activetime",(new Date).getTime().toString())),t.panelElement.classList.remove("fn__none")),i=t):(null===(n=t.headElement)||void 0===n||n.classList.remove("item--focus"),t.panelElement.classList.contains("fn__none")||t.panelElement.classList.add("fn__none"))}));const a=i.headElement.getAttribute("data-initdata");if(a){const e=JSON.parse(a);return i.addModel(new s.Editor({tab:i,blockId:e.blockId,mode:e.mode,action:"string"==typeof e.action?[e.action]:e.action,scrollAttr:e.scrollAttr})),void i.headElement.removeAttribute("data-initdata")}if(i&&e===i.headElement&&(i.model instanceof r.Graph?i.model.onGraph(!1):i.model instanceof y.Asset&&i.model.pdfObject&&i.model.pdfObject.pdfViewer.container.focus()),i&&i.model instanceof s.Editor){const e=i.headElement.getAttribute("keep-cursor");if(e){let t;if(Array.from(i.model.editor.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${e}"]`)).find((e=>{if(!(0,l.hasClosestByAttribute)(e,"data-type","NodeBlockQueryEmbed",!0))return t=e,!0})),t){if(!i.model.editor.protyle.toolbar.range){const e=document.createRange();e.selectNodeContents(t),e.collapse(),i.model.editor.protyle.toolbar.range=e}(0,h.scrollCenter)(i.model.editor.protyle,t,!0)}else(0,p.openFileById)({id:e,action:[c.Constants.CB_GET_FOCUS,c.Constants.CB_GET_CONTEXT]});i.headElement.removeAttribute("keep-cursor")}n&&(0,p.updatePanelByEditor)(i.model.editor.protyle,!0,t)}else(0,p.updatePanelByEditor)(void 0,!1)}addTab(e,t=!1){var n;t&&(null===(n=e.headElement)||void 0===n||n.classList.remove("item--focus"),e.panelElement.classList.add("fn__none"));let i=0;this.children.forEach(((e,n)=>{var a;if(e.headElement&&e.headElement.classList.contains("item--focus")){i=n;let t=e.headElement.nextElementSibling;for(;t&&t.classList.contains("item--pin");)i++,t=t.nextElementSibling}t||(null===(a=e.headElement)||void 0===a||a.classList.remove("item--focus"),e.panelElement.classList.add("fn__none"))})),this.children.splice(i+1,0,e),e.headElement&&(this.headersElement.parentElement.classList.remove("fn__none"),0===this.headersElement.childElementCount?this.headersElement.append(e.headElement):this.headersElement.children[i].after(e.headElement),e.headElement.querySelector(".item__close").addEventListener("click",(t=>{e.headElement.classList.contains("item--pin")?e.unpin():e.parent.removeTab(e.id),window.siyuan.menus.menu.remove(),t.stopPropagation(),t.preventDefault()})),e.headElement.setAttribute("data-activetime",(new Date).getTime().toString()));const a=this.element.querySelector(".layout-tab-container");a.querySelector(".fn__flex-1")?a.querySelector(".layout-tab-container__drag")?a.children[i+1].after(e.panelElement):a.children[i].after(e.panelElement):a.append(e.panelElement),e.parent=this,e.callback&&e.callback(e),"center"!==this.parent.type||2!==this.children.length||this.children[0].headElement?this.children.length>window.siyuan.config.fileTree.maxOpenTabCount&&this.removeOverCounter(i):this.removeTab(this.children[0].id)}renderTabList(e){window.siyuan.menus.menu.remove(),Array.from(this.headersElement.children).forEach((e=>{const t=e.querySelector(".item__icon"),n=e.querySelector(".item__graphic");window.siyuan.menus.menu.append(new v.MenuItem({label:e.querySelector(".item__text").textContent,iconHTML:t?`<span class="b3-menu__icon">${t.innerHTML}</span>`:"",icon:n?n.firstElementChild.getAttribute("xlink:href").substring(1):"",click:()=>{this.switchTab(e,!0)},current:e.classList.contains("item--focus")}).element)})),window.siyuan.menus.menu.popup({x:e.clientX,y:e.clientY})}removeOverCounter(e){let t,n;void 0===e&&this.children.forEach(((t,n)=>{t.headElement&&t.headElement.classList.contains("item--focus")&&(e=n)})),this.children.forEach(((i,a)=>{i.headElement.classList.contains("item--pin")||i.headElement.classList.contains("item--focus")||a===e||(n?i.headElement.getAttribute("data-activetime")<n&&(n=i.headElement.getAttribute("data-activetime"),t=this.children[a].id):(n=i.headElement.getAttribute("data-activetime"),t=this.children[a].id))})),t&&this.removeTab(t)}destroyModel(e){if(e)return e instanceof s.Editor&&e.editor?(window.siyuan.blockPanels.forEach((t=>{t.element&&e.editor.protyle.wysiwyg.element.contains(t.element)&&t.destroy()})),e.editor.destroy(),void(0,g.countBlockWord)([])):void(e instanceof u.Search?e.protyle&&e.protyle.destroy():(e instanceof y.Asset&&e.pdfObject&&e.pdfObject.pdfLoadingTask.destroy(),e.send("closews",{})))}removeTab(e,t=!1,n=!0){var i;for(let a=0;a<this.children.length;a++){const o=this.children[a];if(o.id===e){if(o.model instanceof s.Editor&&(null===(i=o.model.editor)||void 0===i?void 0:i.protyle)){if(o.model.editor.protyle.upload.isUploading)return void(0,d.showMessage)(window.siyuan.languages.uploading);this.removeTabAction(e,t,n)}else this.removeTabAction(e,t,n);return}}}moveTab(e,t){this.element.querySelector(".layout-tab-container").append(e.panelElement),e.model instanceof s.Editor&&(e.model.editor.protyle.toolbar.range=null),t?this.children.find(((n,i)=>{if(n.id===t)return this.children.splice(i,0,e),!0})):this.children.push(e),this.children.length>window.siyuan.config.fileTree.maxOpenTabCount&&this.removeOverCounter(),this.switchTab(e.headElement);const n=e.parent;1===n.children.length?(n.children=[],n.remove()):(n.children.find(((t,i)=>{if(t.id===e.id)return n.children.splice(i,1),(0,o.resizeTabs)(),!0})),n.switchTab(n.children[n.children.length-1].headElement)),e.parent=this,(0,o.resizeTabs)()}split(e){if(1===this.children.length&&!this.children[0].headElement)return this;const t=new w(e);return e===this.parent.direction?this.parent.addWnd(t,this.id):1===this.parent.children.length?(this.parent.direction=e,"tb"===e?(this.parent.element.classList.add("fn__flex-column"),this.parent.element.classList.remove("fn__flex")):(this.parent.element.classList.remove("fn__flex-column"),this.parent.element.classList.add("fn__flex")),this.parent.addWnd(t,this.id)):this.parent.children.find(((n,a)=>{if(n.id===this.id){const o=new i.Layout({resize:n.resize,direction:e});this.parent.addLayout(o,n.id);const s=this.parent.children.splice(a,1)[0];return s.resize&&(s.element.previousElementSibling.remove(),s.resize=void 0),o.addWnd.call(o,s),o.addWnd.call(o,t),"tb"===e&&s.element.style.width?(o.element.style.width=s.element.style.width,o.element.classList.remove("fn__flex-1"),s.element.style.width="",s.element.classList.add("fn__flex-1")):"lr"===e&&s.element.style.height&&(o.element.style.height=s.element.style.height,o.element.classList.remove("fn__flex-1"),s.element.style.height="",s.element.classList.add("fn__flex-1")),!0}})),t}remove(){let e=this.parent,t=this.element,n=this.id;for(;e&&1===e.children.length&&"center"!==e.type;)n=e.id,t=e.element,e=e.parent;e.children.find(((i,a)=>{if(i.id===n){if(e.children.length>1){let n=e.children[a-1];0===a&&(n=e.children[1]),2===e.children.length?("lr"===e.direction?n.element.style.width="":n.element.style.height="",n.resize=void 0,n.element.classList.add("fn__flex-1")):n.element.classList.contains("fn__flex-1")||("lr"===e.direction?n.element.style.width=n.element.clientWidth+t.clientWidth+"px":n.element.style.height=n.element.clientHeight+t.clientHeight+"px"),e.children.length>2&&0===a&&(e.children[1].resize=void 0)}return e.children.splice(a,1),!0}})),t.previousElementSibling&&t.previousElementSibling.classList.contains("layout__resize")?t.previousElementSibling.remove():t.nextElementSibling&&t.nextElementSibling.classList.contains("layout__resize")&&t.nextElementSibling.remove(),t.remove(),(0,o.resizeTabs)()}}t.Wnd=w},4972:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Backlinks=void 0;const i=n(7924),a=n(8813),o=n(237),s=n(3607),r=n(3371),l=n(734),c=n(8792),u=n(2892),d=n(7010),p=n(7954),h=n(9516),f=n(2640);class g extends i.Model{constructor(e){super({id:e.tab.id,callback(){"local"===this.type&&(0,l.fetchPost)("/api/block/checkBlockExist",{id:this.blockId},(e=>{e.data||this.parent.parent.removeTab(this.parent.id)}))},msgCallback(e){var t;if(e)switch(e.cmd){case"rename":"local"===this.type&&this.blockId===e.data.id&&this.parent.updateTitle(e.data.title);break;case"unmount":this.notebookId===e.data.box&&"local"===this.type&&this.parent.parent.removeTab(this.parent.id);break;case"remove":0===(null===(t=this.path)||void 0===t?void 0:t.indexOf((0,a.getDisplayName)(e.data.path,!1,!0)))&&"local"===this.type&&this.parent.parent.removeTab(this.parent.id)}}}),this.beforeLen=10,this.blockId=e.blockId,this.rootId=e.rootId,this.type=e.type,this.element=e.tab.panelElement,this.element.classList.add("fn__flex-column","file-tree","sy__backlink"),this.element.innerHTML=`<div class="block__icons">\n    <div class="block__logo">\n        <svg><use xlink:href="#iconLink"></use></svg>\n        ${window.siyuan.languages.backlinks}\n    </div>\n    <span class="counter listCount"></span>\n    <span class="fn__space"></span>\n    <label class="b3-form__icon b3-form__icon--small search__label">\n        <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>\n        <input class="b3-text-field b3-text-field--small b3-form__icon-input" placeholder="Enter ${window.siyuan.languages.search}" />\n    </label>\n    <span class="fn__space"></span>\n    <span data-type="refresh" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href='#iconRefresh'></use></svg></span>\n    <span class="fn__space"></span>\n    <span data-type="more" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.showMore}">\n        <svg><use xlink:href="#iconAlignCenter"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="expand" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.expand} ${(0,p.updateHotkeyTip)(window.siyuan.config.keymap.editor.general.expand.custom)}">\n        <svg><use xlink:href="#iconFullscreen"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="collapse" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.collapse} ${(0,p.updateHotkeyTip)(window.siyuan.config.keymap.editor.general.collapse.custom)}">\n        <svg><use xlink:href="#iconContract"></use></svg>\n    </span>\n    <span class="${"local"===this.type?"fn__none ":""}fn__space"></span>\n    <span data-type="min" class="${"local"===this.type?"fn__none ":""}block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min} ${(0,p.updateHotkeyTip)(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>\n</div>\n<div class="backlinkList fn__flex-1"></div>\n<div class="block__icons">\n    <div class="block__logo">\n        <svg><use xlink:href="#iconLink"></use></svg>\n        ${window.siyuan.languages.mentions}\n    </div>\n    <span class="counter listMCount"></span>\n    <span class="fn__space"></span>\n    <label class="b3-form__icon b3-form__icon--small search__label">\n        <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>\n        <input class="b3-text-field b3-text-field--small b3-form__icon-input" placeholder="Enter ${window.siyuan.languages.search}" />\n    </label>\n    <span class="fn__space"></span>\n    <span data-type="mExpand" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.expand}">\n        <svg><use xlink:href="#iconFullscreen"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="mCollapse" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.collapse}">\n        <svg><use xlink:href="#iconContract"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="layout" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.down}">\n        <svg><use xlink:href="#iconDown"></use></svg>\n    </span>\n</div>\n<div class="backlinkMList fn__flex-1"></div>`,this.inputsElement=this.element.querySelectorAll("input"),this.inputsElement.forEach((e=>{e.addEventListener("keydown",(e=>{e.isComposing||"Enter"!==e.key||this.searchBacklinks()})),e.addEventListener("input",(e=>{const t=e.target;""===t.value?t.classList.remove("search__input--block"):t.classList.add("search__input--block")}))})),this.tree=new o.Tree({element:this.element.querySelector(".backlinkList"),data:null,click(e){(0,h.openFileById)({id:e.getAttribute("data-node-id"),action:[c.Constants.CB_GET_FOCUS,c.Constants.CB_GET_CONTEXT]})},ctrlClick(e){(0,h.openFileById)({id:e.getAttribute("data-node-id"),keepCursor:!0,action:[c.Constants.CB_GET_CONTEXT]})},altClick(e){(0,h.openFileById)({id:e.getAttribute("data-node-id"),position:"right",action:[c.Constants.CB_GET_FOCUS,c.Constants.CB_GET_CONTEXT]})},shiftClick(e){(0,h.openFileById)({id:e.getAttribute("data-node-id"),position:"bottom",action:[c.Constants.CB_GET_FOCUS,c.Constants.CB_GET_CONTEXT]})}}),this.mTree=new o.Tree({element:this.element.querySelector(".backlinkMList"),data:null,click:(e,t)=>{const n=(0,s.hasClosestByClassName)(t.target,"b3-list-item__action");if(n){if(n.firstElementChild.classList.contains("fn__rotate"))return;window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new f.MenuItem({label:window.siyuan.languages.turnInto+" "+window.siyuan.languages.turnToStaticRef,click:()=>{this.turnToRef(e,!1)}}).element),window.siyuan.menus.menu.append(new f.MenuItem({label:window.siyuan.languages.turnInto+" "+window.siyuan.languages.turnToDynamicRef,click:()=>{this.turnToRef(e,!0)}}).element),window.siyuan.menus.menu.popup({x:t.clientX,y:t.clientY})}else(0,h.openFileById)({id:e.getAttribute("data-node-id"),action:[c.Constants.CB_GET_FOCUS,c.Constants.CB_GET_CONTEXT]})},ctrlClick(e){(0,h.openFileById)({id:e.getAttribute("data-node-id"),keepCursor:!0,action:[c.Constants.CB_GET_CONTEXT]})},altClick(e){(0,h.openFileById)({id:e.getAttribute("data-node-id"),position:"right",action:[c.Constants.CB_GET_FOCUS,c.Constants.CB_GET_CONTEXT]})},shiftClick(e){(0,h.openFileById)({id:e.getAttribute("data-node-id"),position:"bottom",action:[c.Constants.CB_GET_FOCUS,c.Constants.CB_GET_CONTEXT]})},blockExtHTML:`<span class="b3-list-item__action b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.more}"><svg><use xlink:href="#iconMore"></use></svg></span>`}),this.element.querySelector('[data-type="collapse"]').addEventListener("click",(()=>{this.tree.collapseAll()})),this.element.querySelector('[data-type="expand"]').addEventListener("click",(()=>{this.tree.expandAll()})),this.element.addEventListener("click",(e=>{"local"===this.type?(0,r.setPanelFocus)(this.element.parentElement.parentElement):(0,r.setPanelFocus)(this.element.firstElementChild);let t=e.target;for(;t&&!t.isEqualNode(this.element);){if(t.classList.contains("block__icon")){switch(t.getAttribute("data-type")){case"refresh":this.refresh();break;case"mExpand":this.mTree.expandAll();break;case"mCollapse":this.mTree.collapseAll();break;case"min":(0,r.getDockByType)("backlink").toggleModel("backlink");break;case"more":t.classList.contains("ft__primary")?(this.searchBacklinks(this.beforeLen),t.classList.remove("ft__primary"),t.parentElement.nextElementSibling.classList.remove("backlink--more")):(this.searchBacklinks(20*this.beforeLen),t.classList.add("ft__primary"),t.parentElement.nextElementSibling.classList.add("backlink--more"));break;case"layout":this.mTree.element.style.flex?"0px"===this.mTree.element.style.height?(this.tree.element.classList.remove("fn__none"),this.mTree.element.removeAttribute("style"),t.setAttribute("aria-label",window.siyuan.languages.up),t.querySelector("use").setAttribute("xlink:href","#iconUp")):(this.tree.element.classList.remove("fn__none"),this.mTree.element.removeAttribute("style"),t.setAttribute("aria-label",window.siyuan.languages.down),t.querySelector("use").setAttribute("xlink:href","#iconDown")):t.getAttribute("aria-label")===window.siyuan.languages.down?(this.tree.element.classList.remove("fn__none"),this.mTree.element.setAttribute("style","flex:none;height:0px"),t.setAttribute("aria-label",window.siyuan.languages.up),t.querySelector("use").setAttribute("xlink:href","#iconUp")):(this.tree.element.classList.add("fn__none"),this.mTree.element.setAttribute("style",`flex:none;height:${this.element.clientHeight-2*this.tree.element.previousElementSibling.clientHeight}px`),t.setAttribute("aria-label",window.siyuan.languages.down),t.querySelector("use").setAttribute("xlink:href","#iconDown")),t.setAttribute("data-clicked","true")}}t=t.parentElement}})),this.searchBacklinks(),"pin"===this.type&&(0,r.setPanelFocus)(this.element.firstElementChild)}turnToRef(e,t){e.querySelector(".b3-list-item__action").innerHTML='<svg class="fn__rotate"><use xlink:href="#iconRefresh"></use></svg>',this.element.querySelector('.block__icon[data-type="refresh"] svg').classList.add("fn__rotate"),(0,l.fetchPost)("/api/ref/createBacklink",{refID:e.getAttribute("data-node-id"),refText:decodeURIComponent(e.getAttribute("data-ref-text")),defID:this.blockId,pushMode:0,isDynamic:t},(e=>{e.data.defID===this.blockId&&this.searchBacklinks(void 0,!0),(0,u.getAllModels)().editor.forEach((t=>{e.data.refRootID===t.editor.protyle.block.rootID&&(0,l.fetchPost)("/api/filetree/getDoc",{id:t.editor.protyle.block.id,size:c.Constants.SIZE_GET},(e=>{(0,d.onGet)(e,t.editor.protyle)}))}))}))}refresh(){(0,l.fetchPost)("/api/ref/refreshBacklink",{id:this.blockId},(()=>{this.searchBacklinks()}))}searchBacklinks(e,t=!1){const n=this.element.querySelector('.block__icon[data-type="refresh"] svg');if(n.classList.contains("fn__rotate")&&!t)return;let i;n.classList.add("fn__rotate"),i=e||(this.element.querySelector('.block__icon[data-type="more"]').classList.contains("ft__primary")?20*this.beforeLen:this.beforeLen),(0,l.fetchPost)("/api/ref/getBacklink",{k:this.inputsElement[0].value,mk:this.inputsElement[1].value,beforeLen:i,id:this.blockId},(e=>{this.render(e.data)}))}render(e){e||(e={box:"",backlinks:[],backmentions:[],linkRefsCount:0,mentionsCount:0,k:"",mk:""}),this.element.querySelector('.block__icon[data-type="refresh"] svg').classList.remove("fn__rotate"),this.notebookId=e.box,this.inputsElement[0].value=e.k,this.inputsElement[1].value=e.mk,this.tree.updateData(e.backlinks),this.mTree.updateData(e.backmentions);const t=this.element.querySelector(".listCount");0===e.linkRefsCount?t.classList.add("fn__none"):(t.classList.remove("fn__none"),t.textContent=e.linkRefsCount.toString());const n=this.element.querySelector(".listMCount");0===e.mentionsCount?n.classList.add("fn__none"):(n.classList.remove("fn__none"),n.textContent=e.mentionsCount.toString());const i=this.element.querySelector("[data-type='layout']");if(!i.getAttribute("data-clicked"))return 0===e.mentionsCount?(this.tree.element.classList.remove("fn__none"),this.mTree.element.setAttribute("style","flex:none;height:0px"),i.setAttribute("aria-label",window.siyuan.languages.up),void i.querySelector("use").setAttribute("xlink:href","#iconUp")):void(0===e.linkRefsCount?(this.tree.element.classList.add("fn__none"),this.mTree.element.setAttribute("style",`flex:none;height:${this.element.clientHeight-2*this.tree.element.previousElementSibling.clientHeight}px`),i.setAttribute("aria-label",window.siyuan.languages.down),i.querySelector("use").setAttribute("xlink:href","#iconDown")):(this.tree.element.classList.remove("fn__none"),this.mTree.element.removeAttribute("style"),i.setAttribute("aria-label",window.siyuan.languages.down),i.querySelector("use").setAttribute("xlink:href","#iconDown")))}}t.Backlinks=g},4684:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bookmark=void 0;const i=n(7924),a=n(237),o=n(3371),s=n(2640),r=n(734),l=n(7954),c=n(9516),u=n(8792),d=n(9866),p=n(1377),h=n(3863);class f extends i.Model{constructor(e){super({id:e.id,msgCallback(e){if(e)switch(e.cmd){case"transactions":e.data[0].doOperations.forEach((e=>{let t=!1;(("update"===e.action||"insert"===e.action)&&e.data.indexOf('class="protyle-attr--bookmark"')>-1||"delete"===e.action)&&(t=!0),t&&(0,r.fetchPost)("/api/bookmark/getBookmark",{},(e=>{this.update(e.data)}))}));break;case"unmount":case"remove":case"mount":"mount"===e.cmd&&1===e.code||(0,r.fetchPost)("/api/bookmark/getBookmark",{},(e=>{this.update(e.data)}))}}}),this.element=e.panelElement,this.element.classList.add("fn__flex-column","file-tree","sy__bookmark"),this.element.innerHTML=`<div class="block__icons">\n    <div class="block__logo">\n        <svg><use xlink:href="#iconBookmark"></use></svg>\n        ${window.siyuan.languages.bookmark}\n    </div>\n    <span class="fn__flex-1"></span>\n    <span class="fn__space"></span>\n    <span data-type="refresh" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href='#iconRefresh'></use></svg></span>\n    <span class="fn__space"></span>\n    <span data-type="expand" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.expand} ${(0,l.updateHotkeyTip)(window.siyuan.config.keymap.editor.general.expand.custom)}">\n        <svg><use xlink:href="#iconFullscreen"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="collapse" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.collapse} ${(0,l.updateHotkeyTip)(window.siyuan.config.keymap.editor.general.collapse.custom)}">\n        <svg><use xlink:href="#iconContract"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="min" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min} ${(0,l.updateHotkeyTip)(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>\n</div>\n<div class="fn__flex-1"></div>`,this.tree=new a.Tree({element:this.element.lastElementChild,data:null,click(e){const t=e.getAttribute("data-node-id");(0,r.fetchPost)("/api/block/checkBlockFold",{id:t},(e=>{(0,c.openFileById)({id:t,action:e.data?[u.Constants.CB_GET_FOCUS,u.Constants.CB_GET_ALL]:[u.Constants.CB_GET_FOCUS,u.Constants.CB_GET_CONTEXT]})}))},rightClick:(e,t)=>{window.siyuan.menus.menu.remove();const n=e.getAttribute("data-node-id");n||window.siyuan.menus.menu.append(new s.MenuItem({label:window.siyuan.languages.rename,click:()=>{const t=e.querySelector(".b3-list-item__text").textContent,n=new d.Dialog({title:window.siyuan.languages.rename,content:`<div class="b3-dialog__content"><input class="b3-text-field fn__block"></div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:"520px"}),i=n.element.querySelectorAll(".b3-button");i[0].addEventListener("click",(()=>{n.destroy()}));const a=n.element.querySelector("input");n.bindInput(a,(()=>{i[1].click()})),a.value=t,a.focus(),a.select(),i[1].addEventListener("click",(()=>{(0,r.fetchPost)("/api/bookmark/renameBookmark",{oldBookmark:t,newBookmark:a.value},(()=>{n.destroy()}))}))}}).element),window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconTrashcan",label:window.siyuan.languages.remove,click:()=>{const t=(n?e.parentElement.previousElementSibling:e).querySelector(".b3-list-item__text").textContent;(0,p.confirmDialog)(window.siyuan.languages.delete,`${window.siyuan.languages.confirmDelete} <b>${(0,h.escapeHtml)(t)}</b>?`,(()=>{n?((0,r.fetchPost)("/api/attr/setBlockAttrs",{id:n,attrs:{bookmark:""}},(()=>{this.update()})),document.querySelectorAll(`.protyle-wysiwyg [data-node-id="${n}"]`).forEach((e=>{e.setAttribute("bookmark","");const t=e.querySelector(".protyle-attr--bookmark");t&&t.remove()}))):(0,r.fetchPost)("/api/bookmark/removeBookmark",{bookmark:t})}))}}).element),window.siyuan.menus.menu.popup({x:t.clientX,y:t.clientY})},ctrlClick(e){(0,c.openFileById)({id:e.getAttribute("data-node-id"),keepCursor:!0,action:[u.Constants.CB_GET_CONTEXT]})},altClick(e){(0,c.openFileById)({id:e.getAttribute("data-node-id"),position:"right",action:[u.Constants.CB_GET_FOCUS,u.Constants.CB_GET_CONTEXT]})},shiftClick(e){(0,c.openFileById)({id:e.getAttribute("data-node-id"),position:"bottom",action:[u.Constants.CB_GET_FOCUS,u.Constants.CB_GET_CONTEXT]})}}),this.element.querySelector('[data-type="collapse"]').addEventListener("click",(()=>{this.tree.collapseAll()})),this.element.querySelector('[data-type="expand"]').addEventListener("click",(()=>{this.tree.expandAll()})),this.element.addEventListener("click",(e=>{(0,o.setPanelFocus)(this.element.firstElementChild);let t=e.target;for(;t&&!t.isEqualNode(this.element);){if(t.classList.contains("block__icon")){switch(t.getAttribute("data-type")){case"min":(0,o.getDockByType)("bookmark").toggleModel("bookmark");break;case"refresh":this.update()}}t=t.parentElement}})),this.update(),(0,o.setPanelFocus)(this.element.firstElementChild)}update(){const e=this.element.querySelector('.block__icon[data-type="refresh"] svg');e.classList.contains("fn__rotate")||(e.classList.add("fn__rotate"),(0,r.fetchPost)("/api/bookmark/getBookmark",{},(t=>{this.openNodes&&(this.openNodes=this.tree.getExpandIds()),this.tree.updateData(t.data),this.openNodes?this.tree.setExpandIds(this.openNodes):this.openNodes=this.tree.getExpandIds(),e.classList.remove("fn__rotate")})))}}t.Bookmark=f},1034:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Files=void 0;const a=n(3863),o=n(7924),s=n(3371),r=n(8792),l=n(8813),c=n(4779),u=n(9472),d=n(2640),p=n(7876),h=n(1890),f=n(734),g=n(7640),m=n(4275),y=n(1377),b=n(7954),v=n(9516),w=n(3607);class _ extends o.Model{constructor(e){let t,n;super({type:"filetree",id:e.tab.id,msgCallback(e){if(e)switch(e.cmd){case"moveDoc":this.onMove(e.data);break;case"mount":this.onMount(e);break;case"createnotebook":(0,l.setNoteBook)(),this.element.insertAdjacentHTML("beforeend",this.genNotebook(e.data.box));break;case"unmount":case"remove":this.onRemove(e);break;case"createdailynote":case"create":case"heading2doc":case"li2doc":this.onMkdir(e.data);break;case"renamenotebook":this.element.querySelector(`[data-url="${e.data.box}"] .b3-list-item__text`).innerHTML=(0,a.escapeHtml)(e.data.name);break;case"rename":this.onRename(e.data)}}}),this.genFileHTML=e=>{let t="";return e.count&&e.count>0&&(t=`<span class="popover__block counter b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.blockRef}">${e.count}</span>`),`<li title="${(0,l.getDisplayName)(e.name,!0,!0)} ${e.hSize}${e.bookmark?"\n"+window.siyuan.languages.bookmark+" "+e.bookmark:""}${e.name1?"\n"+window.siyuan.languages.name+" "+e.name1:""}${e.alias?"\n"+window.siyuan.languages.alias+" "+e.alias:""}${e.memo?"\n"+window.siyuan.languages.memo+" "+e.memo:""}${0!==e.subFileCount?window.siyuan.languages.includeSubFile.replace("x",e.subFileCount):""}\n${window.siyuan.languages.modifiedAt} ${e.hMtime}\n${window.siyuan.languages.createdAt} ${e.hCtime}" \ndata-node-id="${e.id}" data-name="${Lute.EscapeHTMLStr(e.name)}" draggable="true" data-count="${e.subFileCount}" \ndata-type="navigation-file" \nclass="b3-list-item b3-list-item--hide-action" data-path="${e.path}">\n    <span style="padding-left: ${16*(e.path.split("/").length-1)}px" class="b3-list-item__toggle b3-list-item__toggle--hl${0===e.subFileCount?" fn__hidden":""}">\n        <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>\n    </span>\n    <span class="b3-list-item__icon b3-tooltips b3-tooltips__n" aria-label="${window.siyuan.languages.changeIcon}">${(0,g.unicode2Emoji)(e.icon||(0===e.subFileCount?r.Constants.SIYUAN_IMAGE_FILE:r.Constants.SIYUAN_IMAGE_FOLDER))}</span>\n    <span class="b3-list-item__text">${(0,l.getDisplayName)(e.name,!0,!0)}</span>\n    <span data-type="more-file" class="b3-list-item__action b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.more}">\n        <svg><use xlink:href="#iconMore"></use></svg>\n    </span>\n    <span data-type="new" class="b3-list-item__action b3-tooltips b3-tooltips__nw${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.newFile}">\n        <svg><use xlink:href="#iconAdd"></use></svg>\n    </span>\n    ${t}\n</li>`},e.tab.panelElement.classList.add("fn__flex-column","file-tree","sy__file"),e.tab.panelElement.innerHTML=`<div class="block__icons">\n    <div class="block__logo">\n        <svg><use xlink:href="#iconFiles"></use></svg>\n        ${window.siyuan.languages.fileTree}\n    </div>\n    <span class="fn__flex-1 fn__space"></span>\n    <span data-type="focus" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.selectOpen1} ${(0,b.updateHotkeyTip)(window.siyuan.config.keymap.general.selectOpen1.custom)}"><svg><use xlink:href='#iconFocus'></use></svg></span>\n    <span class="fn__space"></span>\n    <span data-type="collapse" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.collapse} ${(0,b.updateHotkeyTip)(window.siyuan.config.keymap.editor.general.collapse.custom)}">\n        <svg><use xlink:href="#iconContract"></use></svg>\n    </span>\n    <div class="fn__space${window.siyuan.config.readonly?" fn__none":""}"></div>\n    <div data-type="more" class="b3-tooltips b3-tooltips__sw block__icon${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.more}">\n        <svg><use xlink:href="#iconMore"></use></svg>\n    </div> \n    <span class="fn__space"></span>\n    <span data-type="min" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min} ${(0,b.updateHotkeyTip)(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>\n</div>\n<div class="fn__flex-1" data-type="navigation"></div>\n<ul class="b3-list fn__flex-column" style="min-height: auto;transition: var(--b3-transition)">\n    <li class="b3-list-item" data-type="toggle">\n        <span class="b3-list-item__toggle">\n            <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>\n        </span>\n        <span class="b3-list-item__text">${window.siyuan.languages.closeNotebook}</span>\n    </li>\n    <ul class="fn__none fn__flex-1"></ul>\n</ul>`,this.actionsElement=e.tab.panelElement.firstElementChild,this.element=this.actionsElement.nextElementSibling,this.closeElement=e.tab.panelElement.lastElementChild,this.closeElement.addEventListener("click",(e=>{(0,s.setPanelFocus)(this.actionsElement);let t=e.target;for(;t&&!t.isEqualNode(this.closeElement);){const n=t.getAttribute("data-type");if(t.classList.contains("b3-list-item__icon")){e.preventDefault(),e.stopPropagation(),(0,g.openEmojiPanel)(t.parentElement.getAttribute("data-url"),t,!0);break}if("toggle"===n){this.closeElement.classList.contains("fn__flex-1")?(this.closeElement.lastElementChild.classList.add("fn__none"),this.closeElement.classList.remove("fn__flex-1"),t.querySelector("svg").classList.remove("b3-list-item__arrow--open")):(this.closeElement.lastElementChild.classList.remove("fn__none"),this.closeElement.classList.add("fn__flex-1"),t.querySelector("svg").classList.add("b3-list-item__arrow--open")),window.siyuan.menus.menu.remove(),e.stopPropagation(),e.preventDefault();break}if("remove"===n){(0,y.confirmDialog)(window.siyuan.languages.delete,`${window.siyuan.languages.confirmDelete} <b>${(0,a.escapeHtml)(t.parentElement.querySelector(".b3-list-item__text").textContent)}</b>?`,(()=>{(0,f.fetchPost)("/api/notebook/removeNotebook",{notebook:t.getAttribute("data-url"),callback:r.Constants.CB_MOUNT_REMOVE})})),window.siyuan.menus.menu.remove(),e.stopPropagation(),e.preventDefault();break}if("open"===n){(0,f.fetchPost)("/api/notebook/openNotebook",{notebook:t.getAttribute("data-url")}),window.siyuan.menus.menu.remove(),e.stopPropagation(),e.preventDefault();break}t=t.parentElement}})),this.actionsElement.querySelector('[data-type="collapse"]').addEventListener("click",(()=>{Array.from(this.element.children).forEach((e=>{const t=e.firstElementChild,n=t.querySelector(".b3-list-item__arrow");n.classList.contains("b3-list-item__arrow--open")&&(n.classList.remove("b3-list-item__arrow--open"),t.nextElementSibling.remove())}))})),this.actionsElement.addEventListener("click",(e=>{let t=e.target;for(;t&&!t.isEqualNode(this.actionsElement);){const n=t.getAttribute("data-type");if("min"===n){(0,s.getDockByType)("file").toggleModel("file",!1,!0),e.preventDefault(),e.stopPropagation(),window.siyuan.menus.menu.remove();break}if("focus"===n){const t=document.querySelector(".layout__wnd--active > .fn__flex > .layout-tab-bar > .item--focus")||document.querySelector(".layout-tab-bar > .item--focus");if(t){const e=(0,s.getInstanceById)(t.getAttribute("data-id"));e&&e.model instanceof p.Editor&&this.selectItem(e.model.editor.protyle.notebookId,e.model.editor.protyle.path)}e.preventDefault();break}if("more"===n){this.initMoreMenu().popup({x:e.clientX,y:e.clientY}),e.preventDefault(),e.stopPropagation();break}t=t.parentElement}(0,s.setPanelFocus)(this.actionsElement)})),this.element.addEventListener("click",(e=>{let n=e.target;const i=(0,w.hasTopClosestByTag)(n,"UL");let a=!0;if(i){const o=i.getAttribute("data-url");for(;n&&!n.isEqualNode(this.element);){if(n.classList.contains("b3-list-item__icon")&&"ios"!==window.siyuan.config.system.container){e.preventDefault(),e.stopPropagation(),"navigation-file"===n.parentElement.getAttribute("data-type")?(0,g.openEmojiPanel)(n.parentElement.getAttribute("data-node-id"),n):(0,g.openEmojiPanel)(n.parentElement.parentElement.getAttribute("data-url"),n,!0);break}if(n.classList.contains("b3-list-item__toggle")){this.getLeaf(n.parentElement,o),this.setCurrent(n.parentElement),e.preventDefault(),e.stopPropagation(),window.siyuan.menus.menu.remove();break}if(n.classList.contains("b3-list-item__action")){const t=n.getAttribute("data-type"),i=n.parentElement.getAttribute("data-path");window.siyuan.config.readonly||("new"===t?(0,c.newFile)(o,i,!0):"more-root"===t&&(0,u.initNavigationMenu)(n.parentElement).popup({x:e.clientX,y:e.clientY})),"more-file"===t&&(0,u.initFileMenu)(o,i,n.parentElement).popup({x:e.clientX,y:e.clientY}),e.preventDefault(),e.stopPropagation();break}if("LI"===n.tagName){1===e.detail?(a=!1,t=window.setTimeout((()=>{this.setCurrent(n),"navigation-file"===n.getAttribute("data-type")?window.siyuan.altIsPressed?(0,v.openFileById)({id:n.getAttribute("data-node-id"),position:"right",action:[r.Constants.CB_GET_FOCUS,r.Constants.CB_GET_SCROLL]}):(0,v.openFileById)({id:n.getAttribute("data-node-id"),action:[r.Constants.CB_GET_FOCUS,r.Constants.CB_GET_SCROLL]}):"navigation-root"===n.getAttribute("data-type")&&(this.getLeaf(n,o),(0,s.setPanelFocus)(this.actionsElement))}),r.Constants.TIMEOUT_DBLCLICK)):2===e.detail&&(clearTimeout(t),this.getLeaf(n,o),this.setCurrent(n)),window.siyuan.menus.menu.remove(),e.stopPropagation(),e.preventDefault();break}n=n.parentElement}}a&&(0,s.setPanelFocus)(this.actionsElement)})),this.element.addEventListener("dragstart",(e=>{window.getSelection().removeAllRanges(),n=this.element.querySelector(".b3-list-item--focus"),n&&n.classList.remove("b3-list-item--focus");const t=(0,w.hasClosestByTag)(e.target,"LI");if(t){const n=(0,w.hasTopClosestByTag)(t,"UL");e.dataTransfer.setData("text/html",t.outerHTML),n&&e.dataTransfer.setData(r.Constants.SIYUAN_DROP_FILE,n.getAttribute("data-url")),e.dataTransfer.dropEffect="move",t.style.opacity="0.1",window.siyuan.dragElement=t}})),this.element.addEventListener("dragend",(e=>{const t=(0,w.hasClosestByTag)(e.target,"LI");t&&(t.style.opacity="1"),n&&(n.classList.add("b3-list-item--focus"),n=void 0),window.siyuan.dragElement=void 0})),this.element.addEventListener("dragover",(e=>{var t;if(window.siyuan.config.readonly)return;const n=(0,w.hasClosestByTag)(e.target,"LI");if(!n||!window.siyuan.dragElement||n.isSameNode(window.siyuan.dragElement))return void e.preventDefault();n.classList.remove("dragover__top","dragover__bottom","dragover");const i=window.siyuan.dragElement.getAttribute("data-type");if(null===(t=window.siyuan.dragElement.parentElement)||void 0===t?void 0:t.classList.contains("protyle-gutters"))return["NodeListItem","NodeHeading"].includes(i)&&n.classList.add("dragover"),void e.preventDefault();const a=n.getAttribute("data-type");if("navigation-root"!==i||"navigation-root"===a){if(6===window.siyuan.config.fileTree.sort&&("navigation-file"!==i||"navigation-root"!==a)){const t=n.getBoundingClientRect();e.clientY>t.top+20?(n.classList.add("dragover__bottom"),e.preventDefault()):e.clientY<t.bottom-20&&(n.classList.add("dragover__top"),e.preventDefault())}n.classList.contains("dragover__top")||n.classList.contains("dragover__bottom")||"navigation-root"===a&&"navigation-root"===i||n.classList.add("dragover"),e.preventDefault()}else e.preventDefault()})),this.element.addEventListener("dragleave",(e=>{const t=(0,w.hasClosestByTag)(e.target,"LI");t&&t.classList.remove("dragover","dragover__bottom","dragover__top")})),this.element.addEventListener("drop",(e=>i(this,void 0,void 0,(function*(){const t=(0,w.hasClosestByTag)(e.target,"LI");if(!t)return;const n=(0,w.hasTopClosestByTag)(t,"UL");if(!n)return;const i=n.getAttribute("data-url"),a=t.getAttribute("data-path"),o=window.siyuan.dragElement.getAttribute("data-type");if(t.classList.contains("dragover")&&["NodeListItem","NodeHeading"].includes(o))return"NodeHeading"===o?(0,f.fetchPost)("/api/filetree/heading2Doc",{targetNoteBook:i,srcHeadingID:window.siyuan.dragElement.getAttribute("data-node-id"),targetPath:a,pushMode:0}):(0,f.fetchPost)("/api/filetree/li2Doc",{pushMode:0,srcListItemID:window.siyuan.dragElement.getAttribute("data-node-id"),targetNoteBook:i,targetPath:a}),void t.classList.remove("dragover","dragover__bottom","dragover__top");const s=e.dataTransfer.getData(r.Constants.SIYUAN_DROP_FILE),c=window.siyuan.dragElement.getAttribute("data-path");if(s&&c&&c!==a||"navigation-root"===o){if(t.classList.contains("dragover")&&(yield(0,f.fetchPost)("/api/filetree/moveDoc",{fromNotebook:s,toNotebook:i,fromPath:c,toPath:a})),(t.classList.contains("dragover__bottom")||t.classList.contains("dragover__top"))&&6===window.siyuan.config.fileTree.sort)if("navigation-root"===o){t.classList.contains("dragover__top")?t.parentElement.before(window.siyuan.dragElement.parentElement):t.parentElement.after(window.siyuan.dragElement.parentElement);const e=[];Array.from(this.element.children).forEach((t=>{e.push(t.getAttribute("data-url"))})),(0,f.fetchPost)("/api/notebook/changeSortNotebook",{notebooks:e})}else{let e=!1;const n=(0,l.pathPosix)().dirname(a);let r;"navigation-root"===o||n===(0,l.pathPosix)().dirname(c)&&s===i||(yield(0,f.fetchPost)("/api/filetree/moveDoc",{fromNotebook:s,toNotebook:i,fromPath:c,toPath:"/"===n?"/":n+".sy"}),window.siyuan.dragElement.setAttribute("data-path",(0,l.pathPosix)().join(n,window.siyuan.dragElement.getAttribute("data-node-id")+".sy")),e=!0),window.siyuan.dragElement.nextElementSibling&&"UL"===window.siyuan.dragElement.nextElementSibling.tagName&&(r=window.siyuan.dragElement.nextElementSibling),t.classList.contains("dragover__bottom")?t.nextElementSibling&&"UL"===t.nextElementSibling.tagName?t.nextElementSibling.after(window.siyuan.dragElement):t.after(window.siyuan.dragElement):t.classList.contains("dragover__top")&&t.before(window.siyuan.dragElement),r&&window.siyuan.dragElement.after(r);const u=[];Array.from(t.parentElement.children).forEach((e=>{"LI"===e.tagName&&u.push(e.getAttribute("data-path"))})),(0,f.fetchPost)("/api/filetree/changeSort",{paths:u,notebook:i},(()=>{e&&(0,f.fetchPost)("/api/filetree/listDocsByPath",{notebook:i,path:(0,l.pathPosix)().dirname(a),sort:window.siyuan.config.fileTree.sort},(e=>{"/"!==e.data.path||0!==e.data.files.length?this.onLsHTML(e.data):(0,h.showMessage)(window.siyuan.languages.emptyContent)}))}))}t.classList.remove("dragover","dragover__bottom","dragover__top")}else t.classList.remove("dragover","dragover__bottom","dragover__top")})))),this.init(),(0,s.setPanelFocus)(this.actionsElement)}genNotebook(e){const t=`<span class="b3-list-item__icon b3-tooltips b3-tooltips__e" aria-label="${window.siyuan.languages.changeIcon}">${(0,g.unicode2Emoji)(e.icon||r.Constants.SIYUAN_IMAGE_NOTE)}</span>`;return e.closed?`<li data-type="open" data-url="${e.id}" class="b3-list-item b3-list-item--hide-action">\n    <span class="b3-list-item__toggle fn__hidden">\n        <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>\n    </span>\n    ${t}\n    <span class="b3-list-item__text">${(0,a.escapeHtml)(e.name)}</span>\n    <span data-type="remove" data-url="${e.id}" class="b3-list-item__action b3-tooltips b3-tooltips__w${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.delete}">\n        <svg><use xlink:href="#iconTrashcan"></use></svg>\n    </span>\n</li>`:`<ul class="b3-list b3-list--background" data-url="${e.id}" data-sort="${e.sort}">\n<li class="b3-list-item b3-list-item--hide-action" draggable="true" data-type="navigation-root" data-path="/">\n    <span class="b3-list-item__toggle">\n        <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>\n    </span>\n    ${t}\n    <span class="b3-list-item__text">${(0,a.escapeHtml)(e.name)}</span>\n    <span data-type="more-root" class="b3-list-item__action b3-tooltips b3-tooltips__w${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.more}">\n        <svg><use xlink:href="#iconMore"></use></svg>\n    </span>\n    <span data-type="new" class="b3-list-item__action b3-tooltips b3-tooltips__w${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.newFile}">\n        <svg><use xlink:href="#iconAdd"></use></svg>\n    </span>\n</li></ul>`}init(e=!0){let t="",n="";window.siyuan.notebooks.forEach((e=>{e.closed?n+=this.genNotebook(e):t+=this.genNotebook(e)})),this.element.innerHTML=t,this.closeElement.lastElementChild.innerHTML=n,e&&(""===t?(this.closeElement.lastElementChild.classList.remove("fn__none"),this.closeElement.classList.add("fn__flex-1")):(this.closeElement.lastElementChild.classList.add("fn__none"),this.closeElement.classList.remove("fn__flex-1")))}onMkdir(e){let t=this.element.querySelector(`ul[data-url="${e.box.id}"]`),n=(0,l.pathPosix)().dirname(e.path)+".sy";for(;"/"!==n&&(t=t.querySelector(`li[data-path="${n}"]`),!t);)t=this.element.querySelector(`ul[data-url="${e.box.id}"]`),n="/.sy"===n?"/":(0,l.pathPosix)().dirname(n)+".sy";if("UL"===t.tagName&&(t=t.firstElementChild),t){t.querySelector(".b3-list-item__arrow").classList.remove("b3-list-item__arrow--open"),t.querySelector(".b3-list-item__toggle").classList.remove("fn__hidden");const n=t.querySelector(".b3-list-item__icon");n.innerHTML===(0,g.unicode2Emoji)(r.Constants.SIYUAN_IMAGE_FILE)&&(n.innerHTML=(0,g.unicode2Emoji)(r.Constants.SIYUAN_IMAGE_FOLDER)),t.nextElementSibling&&"UL"===t.nextElementSibling.tagName&&t.nextElementSibling.remove(),this.getLeaf(t,e.box.id)}}onRemove(e){var t;const n=this.element.querySelector(`ul[data-url="${e.data.box}"] li[data-path="${e.data.path||"/"}"]`);if("unmount"===e.cmd){if((0,l.setNoteBook)((t=>{if(n&&(n.parentElement.remove(),r.Constants.CB_MOUNT_REMOVE!==e.callback)){let e="";t.find((t=>{t.closed&&(e+=this.genNotebook(t))})),this.closeElement.lastElementChild.innerHTML=e}})),r.Constants.CB_MOUNT_REMOVE===e.callback){const t=this.closeElement.querySelector(`li[data-url="${e.data.box}"]`);t&&t.remove()}}else if(n){"UL"===(null===(t=n.nextElementSibling)||void 0===t?void 0:t.tagName)&&n.nextElementSibling.remove();const e=n.parentElement.previousElementSibling;if(1===n.parentElement.childElementCount){if(e){const t=e.querySelector("svg");t.classList.remove("b3-list-item__arrow--open"),t.parentElement.classList.add("fn__hidden");const n=t.parentElement.nextElementSibling;n.innerHTML===(0,g.unicode2Emoji)(r.Constants.SIYUAN_IMAGE_FOLDER)&&(n.innerHTML=(0,g.unicode2Emoji)(r.Constants.SIYUAN_IMAGE_FILE))}n.parentElement.remove()}else n.remove()}}onMount(e){if(e.data.existed)return;const t=this.closeElement.querySelector(`li[data-url="${e.data.box.id}"]`);t&&t.remove(),(0,l.setNoteBook)((t=>{const n=this.genNotebook(e.data.box);if(0===this.element.childElementCount)this.element.innerHTML=n;else{let i;t.find(((n,a)=>{if(n.id===e.data.box.id){for(;a>0;){if(!t[a-1].closed){i=t[a-1].id;break}a--}return!0}})),i?this.element.querySelector(`[data-url="${i}"]`).insertAdjacentHTML("afterend",n):this.element.insertAdjacentHTML("afterbegin",n)}e.callback===r.Constants.CB_MOUNT_HELP&&(0,v.openFileById)({id:r.Constants.HELP_START_PATH[window.siyuan.config.appearance.lang],action:[r.Constants.CB_GET_FOCUS]})}))}onRename(e){const t=this.element.querySelector(`ul[data-url="${e.box}"] li[data-path="${e.path}"]`);t&&(t.setAttribute("data-name",Lute.EscapeHTMLStr(e.title)),t.querySelector(".b3-list-item__text").innerHTML=(0,a.escapeHtml)(e.title))}onMove(e){const t=this.element.querySelector(`ul[data-url="${e.fromNotebook}"] li[data-path="${e.fromPath}"]`);if(t)if(t.nextElementSibling&&"UL"===t.nextElementSibling.tagName&&t.nextElementSibling.remove(),1===t.parentElement.childElementCount){if(t.parentElement.previousElementSibling){t.parentElement.previousElementSibling.querySelector(".b3-list-item__toggle").classList.add("fn__hidden"),t.parentElement.previousElementSibling.querySelector(".b3-list-item__arrow").classList.remove("b3-list-item__arrow--open");const e=t.parentElement.previousElementSibling.querySelector(".b3-list-item__icon");e.innerHTML===(0,g.unicode2Emoji)(r.Constants.SIYUAN_IMAGE_FOLDER)&&(e.innerHTML=(0,g.unicode2Emoji)(r.Constants.SIYUAN_IMAGE_FILE))}t.parentElement.remove()}else t.remove();const n=this.element.querySelector(`[data-url="${e.toNotebook}"] li[data-path="${e.toPath}"]`);if(n){n.querySelector(".b3-list-item__toggle").classList.remove("fn__hidden");const t=n.querySelector(".b3-list-item__icon");t.innerHTML===(0,g.unicode2Emoji)(r.Constants.SIYUAN_IMAGE_FILE)&&(t.innerHTML=(0,g.unicode2Emoji)(r.Constants.SIYUAN_IMAGE_FOLDER));const i=n.querySelector(".b3-list-item__arrow");i.classList.contains("b3-list-item__arrow--open")&&(i.classList.remove("b3-list-item__arrow--open"),n.nextElementSibling&&"UL"===n.nextElementSibling.tagName&&n.nextElementSibling.remove(),this.getLeaf(n,e.toNotebook))}}onLsHTML(e){let t="";if(e.files.forEach((e=>{t+=this.genFileHTML(e)})),""===t)return;const n=this.element.querySelector(`ul[data-url="${e.box}"] li[data-path="${e.path}"]`);let i=n.nextElementSibling;i&&"UL"===i.tagName&&i.remove(),n.querySelector(".b3-list-item__arrow").classList.add("b3-list-item__arrow--open"),n.insertAdjacentHTML("afterend",`<ul class="file-tree__sliderDown">${t}</ul>`),i=n.nextElementSibling,setTimeout((()=>{i.setAttribute("style",`height:${i.childElementCount*n.clientHeight}px;`),setTimeout((()=>{this.element.querySelectorAll(".file-tree__sliderDown").forEach((e=>{e.classList.remove("file-tree__sliderDown"),e.removeAttribute("style")}))}),120)}),2)}onLsSelect(e,t){let n="";if(e.files.forEach((i=>{n+=this.genFileHTML(i),t===i.path?this.selectItem(e.box,t):t.startsWith(i.path.replace(".sy",""))&&(0,f.fetchPost)("/api/filetree/listDocsByPath",{notebook:e.box,path:i.path,sort:window.siyuan.config.fileTree.sort},(e=>{this.selectItem(e.data.box,t,e.data)}))})),""===n)return;const i=this.element.querySelector(`ul[data-url="${e.box}"] li[data-path="${e.path}"]`);i.nextElementSibling&&"UL"===i.nextElementSibling.tagName&&i.nextElementSibling.remove(),i.querySelector(".b3-list-item__arrow").classList.add("b3-list-item__arrow--open"),i.insertAdjacentHTML("afterend",`<ul>${n}</ul>`),this.setCurrent(this.element.querySelector(`ul[data-url="${e.box}"] li[data-path="${t}"]`))}setCurrent(e){if(!e)return;this.element.querySelectorAll("li").forEach((e=>{e.classList.remove("b3-list-item--focus")})),e.classList.add("b3-list-item--focus");const t=this.actionsElement.clientHeight;e.offsetTop-t<this.element.scrollTop?this.element.scrollTop=e.offsetTop-t:e.offsetTop-this.element.clientHeight-t+e.clientHeight>this.element.scrollTop&&(this.element.scrollTop=e.offsetTop-this.element.clientHeight-t+e.clientHeight)}getLeaf(e,t){var n;const i=e.querySelector(".b3-list-item__arrow");if(i.classList.contains("b3-list-item__arrow--open"))return i.classList.remove("b3-list-item__arrow--open"),void(null===(n=e.nextElementSibling)||void 0===n||n.remove());(0,f.fetchPost)("/api/filetree/listDocsByPath",{notebook:t,path:e.getAttribute("data-path"),sort:window.siyuan.config.fileTree.sort},(e=>{"/"!==e.data.path||0!==e.data.files.length?this.onLsHTML(e.data):(0,h.showMessage)(window.siyuan.languages.emptyContent)}))}selectItem(e,t,n){const i=this.element.querySelector(`[data-url="${e}"]`);if(!i)return;let a,o=t;for(;!a;)if(a=i.querySelector(`[data-path="${o}"]`),!a){const e=(0,l.pathPosix)().dirname(o);o="/"===e?e:e+".sy"}a.getAttribute("data-path")!==t?n&&n.path===o?this.onLsSelect(n,t):(0,f.fetchPost)("/api/filetree/listDocsByPath",{notebook:e,path:o,sort:window.siyuan.config.fileTree.sort},(e=>{this.onLsSelect(e.data,t)})):this.setCurrent(a)}initMoreMenu(){window.siyuan.menus.menu.remove();const e=e=>{window.siyuan.config.fileTree.sort=e,(0,f.fetchPost)("/api/setting/setFiletree",{sort:window.siyuan.config.fileTree.sort,alwaysSelectOpenedFile:window.siyuan.config.fileTree.alwaysSelectOpenedFile,refCreateSavePath:window.siyuan.config.fileTree.refCreateSavePath,createDocNameTemplate:window.siyuan.config.fileTree.createDocNameTemplate,openFilesUseCurrentTab:window.siyuan.config.fileTree.openFilesUseCurrentTab,maxListCount:window.siyuan.config.fileTree.maxListCount},(()=>{(0,l.setNoteBook)((()=>{this.init(!1)}))}))};return window.siyuan.config.readonly||window.siyuan.menus.menu.append(new d.MenuItem({icon:"iconFilesRoot",label:window.siyuan.languages.newNotebook,click:()=>{(0,m.newNotebook)()}}).element),window.siyuan.menus.menu.append(new d.MenuItem({icon:"iconRefresh",label:window.siyuan.languages.rebuildIndex,click:()=>{this.element.getAttribute("disabled")||(this.element.setAttribute("disabled","disabled"),(0,f.fetchPost)("/api/filetree/refreshFiletree",{},(()=>{this.element.removeAttribute("disabled"),this.init(!1)})))}}).element),window.siyuan.config.readonly||window.siyuan.menus.menu.append(new d.MenuItem({icon:"iconSort",label:window.siyuan.languages.sort,type:"submenu",submenu:[{icon:0===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.fileNameASC,click:()=>{e(0)}},{icon:1===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.fileNameDESC,click:()=>{e(1)}},{type:"separator"},{icon:4===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.fileNameNatASC,click:()=>{e(4)}},{icon:5===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.fileNameNatDESC,click:()=>{e(5)}},{type:"separator"},{icon:9===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.createdASC,click:()=>{e(9)}},{icon:10===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.createdDESC,click:()=>{e(10)}},{icon:2===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.modifiedASC,click:()=>{e(2)}},{icon:3===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.modifiedDESC,click:()=>{e(3)}},{type:"separator"},{icon:7===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.refCountASC,click:()=>{e(7)}},{icon:8===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.refCountDESC,click:()=>{e(8)}},{type:"separator"},{icon:6===window.siyuan.config.fileTree.sort?"iconSelect":void 0,label:window.siyuan.languages.customSort,click:()=>{e(6)}}]}).element),window.siyuan.menus.menu}}t.Files=_},4341:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Graph=void 0;const i=n(3371),a=n(7924),o=n(8792),s=n(8813),r=n(6555),l=n(3110),c=n(4293),u=n(734),d=n(9516),p=n(7954);class h extends a.Model{constructor(e){let t;super({id:e.tab.id,callback(){"local"===this.type&&(0,u.fetchPost)("/api/block/checkBlockExist",{id:this.blockId},(e=>{e.data||this.parent.parent.removeTab(this.parent.id)}))},msgCallback(e){if(e)switch(e.cmd){case"mount":"global"===this.type&&1!==e.code&&this.searchGraph(!1);break;case"rename":this.graphData&&e.data.box===this.graphData.box&&this.path===e.data.path&&(this.searchGraph(!1),"local"===this.type&&this.parent.updateTitle(e.data.title)),"global"===this.type&&this.searchGraph(!1);break;case"moveDoc":"global"===this.type?this.searchGraph(!1):!this.graphData||e.data.fromNotebook!==this.graphData.box&&e.data.toNotebook!==this.graphData.box||this.path!==e.data.fromPath||(this.path=e.data.newPath,this.graphData.box=e.data.toNotebook,this.searchGraph(!1));break;case"unmount":case"remove":"global"===this.type?this.searchGraph(!1):!this.graphData||this.graphData.box!==e.data.box||e.data.path&&0!==this.path.indexOf((0,s.getDisplayName)(e.data.path,!1,!0))||this.parent.parent.removeTab(this.parent.id)}}}),this.element=e.tab.panelElement,this.blockId=e.blockId,this.rootId=e.rootId,this.type=e.type,this.element.classList.add("graph","file-tree","global"===this.type?"sy__globalGraph":"sy__graph"),t="global"===this.type?`\n<label>\n    <span>${window.siyuan.languages.headings}</span> \n    <input data-type="heading" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.heading?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.list1}</span> \n    <input data-type="list" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.list?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.listItem}</span> \n    <input data-type="listItem" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.listItem?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.quote}</span> \n    <input data-type="blockquote" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.blockquote?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.superBlock}</span> \n    <input data-type="super" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.super?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.table}</span> \n    <input data-type="table" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.table?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.math}</span> \n    <input data-type="math" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.math?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.code}</span> \n    <input data-type="code" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.code?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.paragraph}</span> \n    <input data-type="paragraph" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.paragraph?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.dailyNote}</span>  \n    <input data-type="dailyNote" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.dailyNote?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.tag}</span>  \n    <input data-type="tag" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.tag?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.arrow}</span> \n    <input data-type="arrow" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.d3.arrow?" checked":""}/>\n</label>\n<label> \n    <span>${window.siyuan.languages.graphConfig2}</span>  \n    <input data-type="minRefs" class="b3-slider b3-tooltips__n b3-tooltips" max="16" min="0" step="1" type="range" value="${window.siyuan.config.graph.global.minRefs}" aria-label="${window.siyuan.config.graph.global.minRefs}" />\n</label>\n<label>\n    <span>${window.siyuan.languages.nodeSize}</span> \n    <input data-type="nodeSize" class="b3-slider b3-tooltips__n b3-tooltips" aria-label="${window.siyuan.config.graph.global.d3.nodeSize}" max="32" min="4" step="2" type="range" value="${window.siyuan.config.graph.global.d3.nodeSize}" />\n</label>\n<label>\n    <span>${window.siyuan.languages.lineWidth}</span> \n    <input data-type="linkWidth" class="b3-tooltips b3-tooltips__n b3-slider" max="32" min="4" step="2" type="range" value="${window.siyuan.config.graph.global.d3.linkWidth}" aria-label="${window.siyuan.config.graph.global.d3.linkWidth}"/>\n</label>\n<label>\n    <span>${window.siyuan.languages.lineOpacity}</span> \n    <input data-type="lineOpacity" class="b3-tooltips b3-tooltips__n b3-slider" max="1" min="0.1" step="0.01" type="range" value="${window.siyuan.config.graph.global.d3.lineOpacity}" aria-label="${window.siyuan.config.graph.global.d3.lineOpacity}"/>\n</label>\n<label>\n    <span>${window.siyuan.languages.centerStrength}</span> \n    <input data-type="centerStrength" class="b3-tooltips b3-tooltips__n b3-slider" max="0.1" min="0.005" step="0.01" type="range" value="${window.siyuan.config.graph.global.d3.centerStrength}" aria-label="${window.siyuan.config.graph.global.d3.centerStrength}"/>\n</label>\n<label>\n    <span>${window.siyuan.languages.collideRadius}</span> \n    <input data-type="collideRadius" class="b3-tooltips b3-tooltips__n b3-slider" max="5000" min="400" step="200" type="range" value="${window.siyuan.config.graph.global.d3.collideRadius}" aria-label="${window.siyuan.config.graph.global.d3.collideRadius}"/>\n</label>\n<label>\n    <span>${window.siyuan.languages.collideStrength}</span> \n    <input data-type="collideStrength" class="b3-tooltips b3-tooltips__n b3-slider" max="1" min="0.01" step="0.01" type="range" value="${window.siyuan.config.graph.global.d3.collideStrength}" aria-label="${window.siyuan.config.graph.global.d3.collideStrength}"/>\n</label>\n<label>\n    <span>${window.siyuan.languages.linkDistance}</span> \n    <input data-type="linkDistance" class="b3-tooltips b3-tooltips__n b3-slider" max="2000" min="100" step="100" type="range" value="${window.siyuan.config.graph.global.d3.linkDistance}" aria-label="${window.siyuan.config.graph.global.d3.linkDistance}"/>\n</label>\n<div class="fn__hr"></div>\n<button class="b3-button b3-button--small fn__block">${window.siyuan.languages.reset}</button>`:`\n<label>\n    <span>${window.siyuan.languages.headings}</span> \n    <input data-type="heading" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.heading?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.list1}</span> \n    <input data-type="list" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.list?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.listItem}</span> \n    <input data-type="listItem" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.listItem?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.quote}</span> \n    <input data-type="blockquote" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.blockquote?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.superBlock}</span> \n    <input data-type="super" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.super?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.table}</span> \n    <input data-type="table" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.table?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.math}</span> \n    <input data-type="math" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.math?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.code}</span> \n    <input data-type="code" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.code?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.paragraph}</span> \n    <input data-type="paragraph" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.paragraph?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.dailyNote}</span>  \n    <input data-type="dailyNote" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.dailyNote?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.tag}</span>  \n    <input data-type="tag" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.tag?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.arrow}</span> \n    <input data-type="arrow" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.d3.arrow?" checked":""}/>\n</label>\n<label>\n    <span>${window.siyuan.languages.nodeSize}</span> \n    <input data-type="nodeSize" class="b3-slider b3-tooltips__n b3-tooltips" aria-label="${window.siyuan.config.graph.local.d3.nodeSize}" max="32" min="4" step="2" type="range" value="${window.siyuan.config.graph.local.d3.nodeSize}" />\n</label>\n<label>\n    <span>${window.siyuan.languages.lineWidth}</span> \n    <input data-type="linkWidth" class="b3-tooltips b3-tooltips__n b3-slider" max="32" min="4" step="2" type="range" value="${window.siyuan.config.graph.local.d3.linkWidth}" aria-label="${window.siyuan.config.graph.local.d3.linkWidth}"/>\n</label>\n<label>\n    <span>${window.siyuan.languages.lineOpacity}</span> \n    <input data-type="lineOpacity" class="b3-tooltips b3-tooltips__n b3-slider" max="1" min="0.1" step="0.01" type="range" value="${window.siyuan.config.graph.local.d3.lineOpacity}" aria-label="${window.siyuan.config.graph.local.d3.lineOpacity}"/>\n</label>\n<label>\n    <span>${window.siyuan.languages.centerStrength}</span> \n    <input data-type="centerStrength" class="b3-tooltips b3-tooltips__n b3-slider" max="0.1" min="0.005" step="0.01" type="range" value="${window.siyuan.config.graph.local.d3.centerStrength}" aria-label="${window.siyuan.config.graph.local.d3.centerStrength}"/>\n</label>\n<label>\n    <span>${window.siyuan.languages.collideRadius}</span> \n    <input data-type="collideRadius" class="b3-tooltips b3-tooltips__n b3-slider" max="5000" min="400" step="200" type="range" value="${window.siyuan.config.graph.local.d3.collideRadius}" aria-label="${window.siyuan.config.graph.local.d3.collideRadius}"/>\n</label>\n<label>\n    <span>${window.siyuan.languages.collideStrength}</span> \n    <input data-type="collideStrength" class="b3-tooltips b3-tooltips__n b3-slider" max="1" min="0.01" step="0.01" type="range" value="${window.siyuan.config.graph.local.d3.collideStrength}" aria-label="${window.siyuan.config.graph.local.d3.collideStrength}"/>\n</label>\n<label>\n    <span>${window.siyuan.languages.linkDistance}</span> \n    <input data-type="linkDistance" class="b3-tooltips b3-tooltips__n b3-slider" max="2000" min="100" step="100" type="range" value="${window.siyuan.config.graph.local.d3.linkDistance}" aria-label="${window.siyuan.config.graph.local.d3.linkDistance}"/>\n</label>\n<div class="fn__hr"></div>\n<button class="b3-button b3-button--small fn__block">${window.siyuan.languages.reset}</button>`,this.element.innerHTML=`\n<div class="block__icons"> \n    <div class="block__logo">\n        <svg><use xlink:href="#icon${"global"===this.type?"GlobalGraph":"Graph"}"></use></svg>\n        ${"global"===this.type?window.siyuan.languages.globalGraph:window.siyuan.languages.graphView}\n    </div>\n    <label class="b3-form__icon b3-form__icon--small search__label">\n        <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>\n        <input class="b3-form__icon-input b3-text-field b3-text-field--small" placeholder="${window.siyuan.languages.search}" />\n    </label>\n    <span class="fn__space"></span>\n    <span data-type="refresh" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href='#iconRefresh'></use></svg></span>\n    <div class="fn__space"></div>\n    <div data-type="fullscreen" class="b3-tooltips b3-tooltips__sw block__icon" aria-label="${window.siyuan.languages.fullscreen}">\n        <svg><use xlink:href="#iconFullscreen"></use></svg>\n    </div>\n    <div class="fn__space"></div>\n    <div data-type="menu" class="b3-tooltips b3-tooltips__sw block__icon" aria-label="${window.siyuan.languages.more}">\n        <svg><use xlink:href="#iconMore"></use></svg>\n    </div> \n    <span class="${"local"===this.type?"fn__none ":""}fn__space"></span>\n    <span data-type="min"  class="${"local"===this.type?"fn__none ":""}block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min} ${(0,p.updateHotkeyTip)(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>\n</div>\n<div class="graph__panel">\n    ${t}\n</div>\n<div class="fn__flex-1 graph__svg"><div class="graph__loading"><div></div></div><div style="height: 100%"></div></div>`,this.graphElement=this.element.querySelector(".graph__svg"),this.inputElement=this.element.querySelector("input"),this.panelElement=this.element.querySelector(".graph__panel"),this.element.addEventListener("click",(e=>{"local"===this.type?(0,i.setPanelFocus)(this.element.parentElement.parentElement):(0,i.setPanelFocus)(this.element.firstElementChild);let t=e.target;for(;t&&!t.isEqualNode(this.element);){if(t.classList.contains("b3-button")){"global"===this.type?(0,u.fetchPost)("/api/graph/resetGraph",{},(e=>{this.reset(e.data.conf)})):(0,u.fetchPost)("/api/graph/resetLocalGraph",{},(e=>{this.reset(e.data.conf)}));break}if(t.classList.contains("block__icon")){const e=t.getAttribute("data-type");"min"===e?(0,i.getDockByType)("global"===this.type?"globalGraph":"graph").toggleModel("global"===this.type?"globalGraph":"graph"):"menu"===e?t.classList.contains("ft__primary")?(t.classList.remove("ft__primary"),this.panelElement.style.right=""):(t.classList.add("ft__primary"),this.panelElement.style.right="0"):"refresh"===e?this.searchGraph(!1):"fullscreen"===e&&(0,c.fullscreen)(this.element,t);break}if(t.classList.contains("graph__svg")){this.element.querySelectorAll(".block__icon.ft__primary").forEach((e=>{e.classList.remove("ft__primary")})),this.panelElement.style.right="";break}t=t.parentElement}})),this.inputElement.addEventListener("compositionend",(()=>{this.searchGraph(!1),this.inputElement.classList.add("search__input--block")})),this.inputElement.addEventListener("input",(e=>{e.isComposing||(""===this.inputElement.value?this.inputElement.classList.remove("search__input--block"):this.inputElement.classList.add("search__input--block"),this.searchGraph(!1))})),this.element.querySelectorAll(".b3-slider").forEach((e=>{e.addEventListener("input",(()=>{e.setAttribute("aria-label",e.value),this.searchGraph(!1)}))})),this.element.querySelectorAll(".b3-switch").forEach((e=>{e.addEventListener("change",(()=>{this.searchGraph(!1)}))})),this.searchGraph("global"!==e.type),"local"!==this.type&&(0,i.setPanelFocus)(this.element.firstElementChild)}reset(e){"global"===this.type?(window.siyuan.config.graph.global=e,this.panelElement.querySelector("[data-type='minRefs']").setAttribute("aria-label",window.siyuan.config.graph.global.minRefs.toString()),this.panelElement.querySelector("[data-type='minRefs']").value=window.siyuan.config.graph.global.minRefs.toString()):window.siyuan.config.graph.local=e,this.inputElement.value="",this.panelElement.querySelector("[data-type='nodeSize']").setAttribute("aria-label",e.d3.nodeSize.toString()),this.panelElement.querySelector("[data-type='centerStrength']").setAttribute("aria-label",e.d3.centerStrength.toString()),this.panelElement.querySelector("[data-type='collideRadius']").setAttribute("aria-label",e.d3.collideRadius.toString()),this.panelElement.querySelector("[data-type='collideStrength']").setAttribute("aria-label",e.d3.collideStrength.toString()),this.panelElement.querySelector("[data-type='lineOpacity']").setAttribute("aria-label",e.d3.lineOpacity.toString()),this.panelElement.querySelector("[data-type='linkDistance']").setAttribute("aria-label",e.d3.linkDistance.toString()),this.panelElement.querySelector("[data-type='linkWidth']").setAttribute("aria-label",e.d3.linkWidth.toString()),this.panelElement.querySelector("[data-type='nodeSize']").value=e.d3.nodeSize.toString(),this.panelElement.querySelector("[data-type='centerStrength']").value=e.d3.centerStrength.toString(),this.panelElement.querySelector("[data-type='collideRadius']").value=e.d3.collideRadius.toString(),this.panelElement.querySelector("[data-type='collideStrength']").value=e.d3.collideStrength.toString(),this.panelElement.querySelector("[data-type='lineOpacity']").value=e.d3.lineOpacity.toString(),this.panelElement.querySelector("[data-type='linkDistance']").value=e.d3.linkDistance.toString(),this.panelElement.querySelector("[data-type='linkWidth']").value=e.d3.linkWidth.toString(),this.panelElement.querySelector("[data-type='list']").checked=e.type.list,this.panelElement.querySelector("[data-type='listItem']").checked=e.type.listItem,this.panelElement.querySelector("[data-type='math']").checked=e.type.math,this.panelElement.querySelector("[data-type='paragraph']").checked=e.type.paragraph,this.panelElement.querySelector("[data-type='super']").checked=e.type.super,this.panelElement.querySelector("[data-type='table']").checked=e.type.table,this.panelElement.querySelector("[data-type='tag']").checked=e.type.tag,this.panelElement.querySelector("[data-type='dailyNote']").checked=e.dailyNote,this.panelElement.querySelector("[data-type='heading']").checked=e.type.heading,this.panelElement.querySelector("[data-type='arrow']").checked=e.d3.arrow,this.panelElement.querySelector("[data-type='blockquote']").checked=e.type.blockquote,this.panelElement.querySelector("[data-type='code']").checked=e.type.code,this.searchGraph(!1)}searchGraph(e,t){const n=this.element.querySelector('.block__icon[data-type="refresh"] svg');if(n.classList.contains("fn__rotate")&&!t)return;n.classList.add("fn__rotate");const i={list:this.panelElement.querySelector("[data-type='list']").checked,listItem:this.panelElement.querySelector("[data-type='listItem']").checked,math:this.panelElement.querySelector("[data-type='math']").checked,paragraph:this.panelElement.querySelector("[data-type='paragraph']").checked,super:this.panelElement.querySelector("[data-type='super']").checked,table:this.panelElement.querySelector("[data-type='table']").checked,tag:this.panelElement.querySelector("[data-type='tag']").checked,heading:this.panelElement.querySelector("[data-type='heading']").checked,blockquote:this.panelElement.querySelector("[data-type='blockquote']").checked,code:this.panelElement.querySelector("[data-type='code']").checked},a={arrow:this.panelElement.querySelector("[data-type='arrow']").checked,nodeSize:parseFloat(this.panelElement.querySelector("[data-type='nodeSize']").value),centerStrength:parseFloat(this.panelElement.querySelector("[data-type='centerStrength']").value),collideRadius:parseFloat(this.panelElement.querySelector("[data-type='collideRadius']").value),collideStrength:parseFloat(this.panelElement.querySelector("[data-type='collideStrength']").value),lineOpacity:parseFloat(this.panelElement.querySelector("[data-type='lineOpacity']").value),linkDistance:parseFloat(this.panelElement.querySelector("[data-type='linkDistance']").value),linkWidth:parseFloat(this.panelElement.querySelector("[data-type='linkWidth']").value)};"global"===this.type?(0,u.fetchPost)("/api/graph/getGraph",{k:this.inputElement.value,conf:{type:i,d3:a,dailyNote:this.panelElement.querySelector("[data-type='dailyNote']").checked,minRefs:parseFloat(this.panelElement.querySelector("[data-type='minRefs']").value)}},(e=>{this.graphData=e.data,window.siyuan.config.graph.global=e.data.conf,this.onGraph(!1),n.classList.remove("fn__rotate")})):(0,u.fetchPost)("/api/graph/getLocalGraph",{k:this.inputElement.value,id:t||this.blockId,conf:{type:i,d3:a,dailyNote:this.panelElement.querySelector("[data-type='dailyNote']").checked}},(i=>{n.classList.remove("fn__rotate"),t&&(this.blockId=t),(0,d.isCurrentEditor)(this.blockId)&&(this.graphData=i.data,window.siyuan.config.graph.local=i.data.conf,this.onGraph(e))}))}hlNode(e){0!==this.graphElement.clientHeight&&this.network&&0!==this.network.findNode(e).length&&(this.network.focus(e,{animation:{duration:1e3,easingFunction:"easeInOutQuad"}}),this.network.selectNodes([e]))}onGraph(e){if(0!==this.graphElement.clientHeight){if(!this.graphData||!this.graphData.nodes||0===this.graphData.nodes.length)return this.network&&this.network.destroy(),void this.graphElement.firstElementChild.classList.add("fn__none");clearTimeout(this.timeout),(0,r.addScript)(`${o.Constants.PROTYLE_CDN}/js/vis/vis-network.min.js?v=9.0.4`,"protyleVisScript").then((()=>{this.timeout=window.setTimeout((()=>{this.graphElement.firstElementChild.classList.remove("fn__none"),this.graphElement.firstElementChild.firstElementChild.setAttribute("style","width:3%");const t=window.siyuan.config.graph["global"===this.type?"global":"local"],n={nodes:this.graphData.nodes,edges:this.graphData.links},i=getComputedStyle(document.body),a={autoResize:!0,interaction:{hover:!0},nodes:{borderWidth:0,borderWidthSelected:5,shape:"dot",font:{face:i.getPropertyValue("--b3-font-family-graph").trim(),size:32,color:i.getPropertyValue("--b3-theme-on-background").trim()},color:{hover:{border:i.getPropertyValue("--b3-graph-hl-point").trim(),background:i.getPropertyValue("--b3-graph-hl-point").trim()},highlight:{border:i.getPropertyValue("--b3-graph-hl-point").trim(),background:i.getPropertyValue("--b3-graph-hl-point").trim()}}},edges:{width:t.d3.linkWidth,arrowStrikethrough:!1,smooth:!1,color:{opacity:t.d3.lineOpacity,hover:i.getPropertyValue("--b3-graph-hl-line").trim(),highlight:i.getPropertyValue("--b3-graph-hl-line").trim()}},layout:{improvedLayout:!1},physics:{enabled:!0,forceAtlas2Based:{theta:.5,gravitationalConstant:-t.d3.collideRadius,centralGravity:t.d3.centerStrength,springConstant:t.d3.collideStrength,springLength:t.d3.linkDistance,damping:.4,avoidOverlap:.5},maxVelocity:50,minVelocity:.1,solver:"forceAtlas2Based",stabilization:{enabled:!0,iterations:256,updateInterval:25,onlyDynamicEdges:!1,fit:!0},timestep:.5,adaptiveTimestep:!0,wind:{x:0,y:0}}},s=new vis.Network(this.graphElement.lastElementChild,n,a);this.network=s,s.on("stabilizationIterationsDone",(()=>{s.physics.stopSimulation(),this.graphElement.firstElementChild.classList.add("fn__none"),e&&this.hlNode(this.blockId)})),s.on("dragEnd",(()=>{setTimeout((()=>{s.physics.stopSimulation()}),5e3)})),s.on("stabilizationProgress",(e=>{this.graphElement.firstElementChild.firstElementChild.setAttribute("style",`width:${Math.max(5,e.iterations)/e.total*100}%`)})),s.on("click",(e=>{if(1!==e.nodes.length)return;const t=this.graphData.nodes.find((t=>t.id===e.nodes[0]));t&&(window.siyuan.shiftIsPressed?(0,d.openFileById)({id:t.id,position:"bottom",action:[o.Constants.CB_GET_FOCUS,o.Constants.CB_GET_CONTEXT]}):window.siyuan.altIsPressed?(0,d.openFileById)({id:t.id,position:"right",action:[o.Constants.CB_GET_FOCUS,o.Constants.CB_GET_CONTEXT]}):window.siyuan.ctrlIsPressed?window.siyuan.blockPanels.push(new l.BlockPanel({targetElement:this.inputElement,nodeIds:[t.id]})):(0,d.openFileById)({id:t.id,action:[o.Constants.CB_GET_FOCUS,o.Constants.CB_GET_CONTEXT]}))}))}),1e3)}))}}}t.Graph=h},9997:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Inbox=void 0;const i=n(3371),a=n(734),o=n(7954),s=n(7924),r=n(8776),l=n(2640),c=n(3607),u=n(1377);class d extends s.Model{constructor(e){super({id:e.id}),this.selectIds=[],this.currentPage=1,this.pageCount=1,this.data={},this.element=e.panelElement,this.element.classList.add("fn__flex-column","file-tree","sy__inbox"),this.element.innerHTML=`<div class="block__icons">\n    <div class="block__logo">\n        <svg><use xlink:href="#iconInbox"></use></svg>\n        ${window.siyuan.languages.inbox}&nbsp;\n         <span class="inboxSelectCount"></span>\n    </div>\n    <span class="fn__flex-1"></span>\n    <span class="fn__space"></span>\n    <div class="fn__flex">\n        <input class="fn__flex-center block__icon" data-type="selectall" type="checkbox">  \n        <span class="fn__space"></span>\n        <span data-type="refresh" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href='#iconRefresh'></use></svg></span>\n        <span data-type="more" data-menu="true" class="block__icon b3-tooltips b3-tooltips__sw fn__none" aria-label="${window.siyuan.languages.more}"><svg><use xlink:href='#iconMore'></use></svg></span>\n        <span class="fn__space"></span>\n        <span data-type="previous" class="block__icon b3-tooltips b3-tooltips__sw" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href='#iconLeft'></use></svg></span>\n        <span class="fn__space"></span>\n        <span data-type="next" class="block__icon b3-tooltips b3-tooltips__sw" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href='#iconRight'></use></svg></span>\n    </div>\n    <div class="fn__flex fn__none">\n        <span data-type="back" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.back}"><svg><use xlink:href='#iconLeft'></use></svg></span>\n        <span class="fn__space"></span>\n        <span data-type="move" data-menu="true" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.move}"><svg><use xlink:href='#iconMove'></use></svg></span>\n        <span class="fn__space"></span>\n        <span data-type="delete" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.remove}"><svg><use xlink:href='#iconTrashcan'></use></svg></span>\n    </div>\n    <span class="fn__space"></span>\n    <span data-type="min" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min} ${(0,o.updateHotkeyTip)(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>\n</div>\n<div class="inbox__details fn__none"></div>\n<div class="fn__flex-1 inbox__list"></div>`;const t=this.element.querySelector(".inboxSelectCount"),n=this.element.querySelector(".inbox__details"),a=this.element.querySelector(".block__icons input");this.element.addEventListener("click",(e=>{(0,i.setPanelFocus)(this.element.firstElementChild);let o=e.target;for(;o&&!o.isEqualNode(this.element);){const s=(0,c.hasClosestByAttribute)(o,"data-type",null);if(s&&this.element.contains(s)){switch(s.getAttribute("data-type")){case"min":(0,i.getDockByType)("inbox").toggleModel("inbox");break;case"selectall":s.checked?this.element.lastElementChild.querySelectorAll(".b3-list-item").forEach((e=>{e.querySelector("input").checked=!0,this.selectIds.push(e.getAttribute("data-id")),this.selectIds=[...new Set(this.selectIds)]})):this.element.lastElementChild.querySelectorAll(".b3-list-item").forEach((e=>{e.querySelector("input").checked=!1,this.selectIds.splice(this.selectIds.indexOf(e.getAttribute("data-id")),1)})),this.updateAction(),t.innerHTML=`${this.selectIds.length.toString()}/${this.pageCount.toString()}`;break;case"select":s.firstElementChild.nextElementSibling.checked?(this.selectIds.push(s.parentElement.getAttribute("data-id")),this.selectIds=[...new Set(this.selectIds)]):this.selectIds.splice(this.selectIds.indexOf(s.parentElement.getAttribute("data-id")),1),this.updateAction(),t.innerHTML=`${this.selectIds.length.toString()}/${this.pageCount.toString()}`,a.checked=this.element.lastElementChild.querySelectorAll("input:checked").length===this.element.lastElementChild.querySelectorAll(".b3-list-item").length;break;case"previous":"disabled"!==s.getAttribute("disabled")&&(this.currentPage--,this.update());break;case"next":"disabled"!==s.getAttribute("disabled")&&(this.currentPage++,this.update());break;case"refresh":this.currentPage=1,this.update();break;case"delete":(0,u.confirmDialog)(window.siyuan.languages.delete,window.siyuan.languages.confirmDelete+"?",(()=>{this.remove(n.getAttribute("data-id"))}));break;case"move":window.siyuan.menus.menu.remove(),window.siyuan.notebooks.forEach((e=>{e.closed||window.siyuan.menus.menu.append(new l.MenuItem({label:e.name,click:()=>{this.move(e.id,n.getAttribute("data-id"))}}).element)})),window.siyuan.menus.menu.popup({x:e.clientX,y:e.clientY});break;case"back":this.back();break;case"more":this.more(e)}break}{const e=(0,c.hasClosestByClassName)(o,"b3-list-item");if(e){const t=this.data[e.getAttribute("data-id")];this.element.querySelector('[data-type="back"]').parentElement.classList.remove("fn__none"),this.element.querySelector('[data-type="more"]').parentElement.classList.add("fn__none"),n.innerHTML=`<h3 class="fn__ellipsis">\n${t.shorthandTitle}\n</h3>\n<div class="fn__hr"></div>\n<a href="${t.shorthandURL}" target="_blank">${t.shorthandURL}</a>\n<div class="fn__hr"></div>\n<div class="b3-typography b3-typography--default">\n${Lute.New().MarkdownStr("",t.shorthandContent)}\n</div>`,n.setAttribute("data-id",t.oId),n.classList.remove("fn__none"),n.scrollTop=0;break}}o=o.parentElement}})),this.update(),(0,i.setPanelFocus)(this.element.firstElementChild)}updateAction(){0===this.selectIds.length?(this.element.querySelector('[data-type="refresh"]').classList.remove("fn__none"),this.element.querySelector('[data-type="more"]').classList.add("fn__none")):(this.element.querySelector('[data-type="refresh"]').classList.add("fn__none"),this.element.querySelector('[data-type="more"]').classList.remove("fn__none"))}back(){this.element.querySelector('[data-type="back"]').parentElement.classList.add("fn__none"),this.element.querySelector('[data-type="more"]').parentElement.classList.remove("fn__none"),this.element.querySelector(".inbox__details").classList.add("fn__none")}more(e){window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.refresh,icon:"iconRefresh",click:()=>{this.currentPage=1,this.update()}}).element);const t=[];window.siyuan.notebooks.forEach((e=>{e.closed||t.push({label:e.name,click:()=>{this.move(e.id)}})})),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.move,icon:"iconMove",submenu:t}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.remove,icon:"iconTrashcan",click:()=>{(0,u.confirmDialog)(window.siyuan.languages.delete,window.siyuan.languages.confirmDelete+"?",(()=>{this.remove()}))}}).element),window.siyuan.menus.menu.popup({x:e.clientX,y:e.clientY})}remove(e){let t;t=e?[e]:this.selectIds,(0,a.fetchPost)("/api/inbox/removeShorthands",{ids:t},(()=>{e?(this.back(),this.selectIds.find(((t,n)=>{if(t===e)return this.selectIds.splice(n,1),!0}))):this.selectIds=[],this.updateAction(),this.currentPage=1,this.update()}))}move(e,t){let n;n=t?[t]:this.selectIds,n.forEach((t=>{(0,a.fetchPost)("/api/filetree/createDoc",{notebook:e,path:`/${Lute.NewNodeID()}.sy`,title:this.data[t].shorthandTitle,md:this.data[t].shorthandContent},(()=>{this.remove(t)}))}))}update(){if((0,r.needSubscribe)(""))return void(this.element.lastElementChild.innerHTML=`<ul class="b3-list b3-list--background">\n    <li class="b3-list--empty">\n        相关功能可打开帮助文档搜索 <code>收集箱</code> 查看使用说明\n    </li>\n    <li class="b3-list--empty">\n        ${"ios"===window.siyuan.config.system.container?window.siyuan.languages._kernel[122]:window.siyuan.languages._kernel[29]}\n    </li>\n</ul>`);const e=this.element.querySelector('[data-type="refresh"] svg');e.classList.contains("fn__rotate")||(e.classList.add("fn__rotate"),(0,a.fetchPost)("/api/inbox/getShorthands",{page:this.currentPage},(t=>{e.classList.remove("fn__rotate");let n="";0===t.data.data.shorthands.length?n='<ul class="b3-list b3-list--background"><li class="b3-list--empty">打开帮助文档搜索 <b>收集箱</b> 查看使用说明</li></ul>':(n='<ul class="b3-list b3-list--background">',t.data.data.shorthands.forEach((e=>{n+=`<li style="padding-left: 0" data-id="${e.oId}" class="b3-list-item">\n    <label data-type="select" class="fn__flex">\n        <span class="fn__space"></span>\n        <input class="fn__flex-center" type="checkbox"${this.selectIds.includes(e.oId)?" checked":""}>\n        <span class="fn__space"></span>\n    </label>\n    <span class="b3-list-item__text" title="${e.shorthandTitle}${e.shorthandTitle===e.shorthandDesc?"":"\n"+e.shorthandDesc}">${e.shorthandTitle}</span>\n    <span class="b3-list-item__meta">${e.hCreated}</span>\n</li>`,this.data[e.oId]=e})),n+="</ul>"),this.element.lastElementChild.innerHTML=n,this.pageCount=t.data.data.pagination.paginationRecordCount,this.element.querySelector(".inboxSelectCount").innerHTML=`${this.selectIds.length}/${this.pageCount}`;const i=this.element.querySelector('span[data-type="previous"]'),a=this.element.querySelector('span[data-type="next"]');t.data.data.pagination.paginationPageCount>this.currentPage?a.removeAttribute("disabled"):a.setAttribute("disabled","disabled"),1===this.currentPage?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled");const o=this.element.lastElementChild.querySelectorAll(".b3-list-item").length;this.element.querySelector(".block__icons input").checked=this.element.lastElementChild.querySelectorAll("input:checked").length===o&&0!==o})))}}t.Inbox=d},2922:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Outline=void 0;const i=n(7924),a=n(237),o=n(3371),s=n(734),r=n(2892),l=n(3607),c=n(7954),u=n(9516),d=n(8792),p=n(3863),h=n(7640),f=n(7010);class g extends i.Model{constructor(e){super({id:e.tab.id,callback(){"local"===this.type&&(0,s.fetchPost)("/api/block/checkBlockExist",{id:this.blockId},(e=>{e.data||this.parent.parent.removeTab(this.parent.id)}))},msgCallback(e){if(e)switch(e.cmd){case"transactions":this.onTransaction(e);break;case"rename":"local"===this.type&&this.blockId===e.data.id?this.parent.updateTitle(e.data.title):this.updateDocTitle({title:e.data.title,icon:d.Constants.ZWSP});break;case"unmount":"local"===this.type&&(0,s.fetchPost)("/api/block/checkBlockExist",{id:this.blockId},(e=>{e.data||this.parent.parent.removeTab(this.parent.id)}))}}}),this.openNodes={},this.blockId=e.blockId,this.type=e.type,e.tab.panelElement.classList.add("fn__flex-column","file-tree","sy__outline"),e.tab.panelElement.innerHTML=`<div class="block__icons">\n    <div class="block__logo">\n        <svg><use xlink:href="#iconAlignCenter"></use></svg>\n        ${window.siyuan.languages.outline}\n    </div>\n    <span class="fn__flex-1 fn__space"></span>\n    <span data-type="expand" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.stickOpen} ${(0,c.updateHotkeyTip)(window.siyuan.config.keymap.editor.general.expand.custom)}">\n        <svg><use xlink:href="#iconFullscreen"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="collapse" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.collapse} ${(0,c.updateHotkeyTip)(window.siyuan.config.keymap.editor.general.collapse.custom)}">\n        <svg><use xlink:href="#iconContract"></use></svg>\n    </span>\n    <span class="${"local"===this.type?"fn__none ":""}fn__space"></span>\n    <span data-type="min" class="${"local"===this.type?"fn__none ":""}block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min} ${(0,c.updateHotkeyTip)(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>\n</div>\n<div class="b3-list-item"></div>\n<div class="fn__flex-1"></div>`,this.element=e.tab.panelElement.lastElementChild,this.headerElement=e.tab.panelElement.firstElementChild,this.tree=new a.Tree({element:e.tab.panelElement.lastElementChild,data:null,click:e=>{const t=e.getAttribute("data-node-id");(0,s.fetchPost)("/api/attr/getBlockAttrs",{id:t},(e=>{(0,u.openFileById)({id:t,action:"1"===e.data["heading-fold"]?[d.Constants.CB_GET_FOCUS,d.Constants.CB_GET_ALL,d.Constants.CB_GET_HTML]:[d.Constants.CB_GET_FOCUS,d.Constants.CB_GET_SETID,d.Constants.CB_GET_CONTEXT,d.Constants.CB_GET_HTML]})}))}}),e.tab.panelElement.querySelector('[data-type="collapse"]').addEventListener("click",(()=>{this.tree.collapseAll()})),e.tab.panelElement.querySelector('[data-type="expand"]').addEventListener("click",(e=>{const t=(0,l.hasClosestByClassName)(e.target,"block__icon");t&&(t.classList.contains("block__icon--active")?t.classList.remove("block__icon--active"):t.classList.add("block__icon--active"),this.tree.expandAll())})),e.tab.panelElement.addEventListener("click",(t=>{"local"===this.type?(0,o.setPanelFocus)(e.tab.panelElement.parentElement.parentElement):(0,o.setPanelFocus)(e.tab.panelElement.firstElementChild);let n=t.target;for(;n&&!n.isEqualNode(e.tab.panelElement);){if(n.classList.contains("block__icon")){if("min"===n.getAttribute("data-type"))(0,o.getDockByType)("outline").toggleModel("outline");break}if(n.isSameNode(this.headerElement.nextElementSibling)||n.classList.contains("block__icons")){(0,r.getAllModels)().editor.find((e=>{if(this.blockId===e.editor.protyle.block.rootID)return e.editor.protyle.scroll.element.classList.contains("fn__none")?e.editor.protyle.contentElement.scrollTop=0:(0,s.fetchPost)("/api/filetree/getDoc",{id:e.editor.protyle.block.rootID,mode:0,size:d.Constants.SIZE_GET},(t=>{(0,f.onGet)(t,e.editor.protyle,[d.Constants.CB_GET_FOCUS])})),!0}));break}n=n.parentElement}})),(0,s.fetchPost)("/api/outline/getDocOutline",{id:this.blockId},(e=>{this.update(e)})),"pin"===this.type&&(0,o.setPanelFocus)(e.tab.panelElement.firstElementChild)}updateDocTitle(e){if("pin"===this.type)if(e){let t=`<span class="b3-list-item__graphic">${(0,h.unicode2Emoji)(e.icon||d.Constants.SIYUAN_IMAGE_FILE)}</span>`;e.icon===d.Constants.ZWSP&&this.headerElement.nextElementSibling.firstElementChild&&(t=this.headerElement.nextElementSibling.firstElementChild.outerHTML),this.headerElement.nextElementSibling.innerHTML=`${t}\n<span class="b3-list-item__text">${(0,p.escapeHtml)(e.title)}</span>`,this.headerElement.nextElementSibling.setAttribute("title",e.title)}else this.headerElement.nextElementSibling.innerHTML="",this.headerElement.nextElementSibling.removeAttribute("title")}onTransaction(e){let t=!1;e.data[0].doOperations.forEach((e=>{("update"!==e.action&&"insert"!==e.action||!(e.data.indexOf('data-type="NodeHeading"')>-1||e.data.indexOf('<div contenteditable="true" spellcheck="false"><wbr></div>')>-1))&&"delete"!==e.action&&"move"!==e.action||(t=!0)})),e.data[0].undoOperations&&e.data[0].undoOperations.forEach((e=>{"update"===e.action&&e.data.indexOf('data-type="NodeHeading"')>-1&&(t=!0)})),t&&(0,s.fetchPost)("/api/outline/getDocOutline",{id:this.blockId},(e=>{this.update(e)}))}setCurrent(e){this.element.querySelectorAll(".b3-list-item.b3-list-item--focus").forEach((e=>{e.classList.remove("b3-list-item--focus")}));let t=this.element.querySelector(`.b3-list-item[data-node-id="${e}"]`);for(;t&&0===t.clientHeight;)t=t.parentElement.previousElementSibling;if(t){t.classList.add("b3-list-item--focus");const e=t.getBoundingClientRect(),n=this.element.getBoundingClientRect();e.top<n.top?t.scrollIntoView():e.bottom>n.bottom&&t.scrollIntoView(!1)}}update(e,t){let n,i=this.element.querySelector(".b3-list-item--focus");i&&(n=i.getAttribute("data-node-id")),this.openNodes[this.blockId]&&(this.openNodes[this.blockId]=this.tree.getExpandIds()),void 0!==t&&(this.blockId=t),this.tree.updateData(e.data),this.openNodes[this.blockId]&&!this.headerElement.querySelector('[data-type="expand"]').classList.contains("block__icon--active")?this.tree.setExpandIds(this.openNodes[this.blockId]):(this.tree.expandAll(),this.openNodes[this.blockId]=this.tree.getExpandIds()),n&&(i=this.element.querySelector(`[data-node-id="${n}"]`),i&&i.classList.add("b3-list-item--focus"))}}t.Outline=g},3179:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tag=void 0;const i=n(7924),a=n(237),o=n(3371),s=n(734),r=n(7954),l=n(4681),c=n(2640),u=n(9866),d=n(1377),p=n(3863);class h extends i.Model{constructor(e){super({id:e.id,msgCallback(e){if(e)switch(e.cmd){case"transactions":e.data[0].doOperations.forEach((e=>{let t=!1;(("update"===e.action||"insert"===e.action)&&e.data.indexOf('data-type="tag"')>-1||"delete"===e.action)&&(t=!0),t&&this.update()}));break;case"unmount":case"remove":case"mount":"mount"===e.cmd&&1===e.code||this.update()}}}),this.element=e.panelElement,this.element.classList.add("fn__flex-column","file-tree","sy__tag"),this.element.innerHTML=`<div class="block__icons">\n    <div class="block__logo">\n        <svg><use xlink:href="#iconTags"></use></svg>\n        ${window.siyuan.languages.tag}\n    </div>\n    <span class="fn__flex-1"></span>\n    <span class="fn__space"></span>\n    <span data-type="refresh" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href='#iconRefresh'></use></svg></span>\n    <span class="fn__space"></span>\n    <span data-type="expand" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.expand} ${(0,r.updateHotkeyTip)(window.siyuan.config.keymap.editor.general.expand.custom)}">\n        <svg><use xlink:href="#iconFullscreen"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="collapse" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.collapse} ${(0,r.updateHotkeyTip)(window.siyuan.config.keymap.editor.general.collapse.custom)}">\n        <svg><use xlink:href="#iconContract"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="sort" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.sort}">\n        <svg><use xlink:href="#iconSort"></use></svg>\n    </span>\n    <span class="fn__space"></span>\n    <span data-type="min" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min} ${(0,r.updateHotkeyTip)(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>\n</div>\n<div class="fn__flex-1"></div>`,this.tree=new a.Tree({element:this.element.lastElementChild,data:null,click(e){(0,l.openGlobalSearch)(`#${e.getAttribute("data-label")}#`,!window.siyuan.ctrlIsPressed)},rightClick:(e,t)=>{const n=e.getAttribute("data-label");window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new c.MenuItem({label:window.siyuan.languages.rename,click(){const e=new u.Dialog({title:window.siyuan.languages.rename,content:`<div class="b3-dialog__content"><input class="b3-text-field fn__block" value="${n}"></div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:"520px"}),t=e.element.querySelectorAll(".b3-button");t[0].addEventListener("click",(()=>{e.destroy()}));const i=e.element.querySelector("input");e.bindInput(i,(()=>{t[1].click()})),i.focus(),i.select(),t[1].addEventListener("click",(()=>{(0,s.fetchPost)("/api/tag/renameTag",{oldLabel:n,newLabel:i.value})}))}}).element),window.siyuan.menus.menu.append(new c.MenuItem({icon:"iconTrashcan",label:window.siyuan.languages.remove,click:()=>{(0,d.confirmDialog)(window.siyuan.languages.delete,`${window.siyuan.languages.confirmDelete} <b>${(0,p.escapeHtml)(n)}</b>?`,(()=>{(0,s.fetchPost)("/api/tag/removeTag",{label:n})}))}}).element),window.siyuan.menus.menu.popup({x:t.clientX,y:t.clientY})}}),this.element.querySelector('[data-type="collapse"]').addEventListener("click",(()=>{this.tree.collapseAll()})),this.element.querySelector('[data-type="expand"]').addEventListener("click",(()=>{this.tree.expandAll()})),this.element.addEventListener("click",(e=>{(0,o.setPanelFocus)(this.element.firstElementChild);let t=e.target;for(;t&&!t.isEqualNode(this.element);){if(t.classList.contains("block__icon")){switch(t.getAttribute("data-type")){case"min":(0,o.getDockByType)("tag").toggleModel("tag");break;case"sort":window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new c.MenuItem({icon:0===window.siyuan.config.tag.sort?"iconSelect":void 0,label:window.siyuan.languages.fileNameASC,click:()=>{window.siyuan.config.tag.sort=0,this.update()}}).element),window.siyuan.menus.menu.append(new c.MenuItem({icon:1===window.siyuan.config.tag.sort?"iconSelect":void 0,label:window.siyuan.languages.fileNameDESC,click:()=>{window.siyuan.config.tag.sort=1,this.update()}}).element),window.siyuan.menus.menu.append(new c.MenuItem({icon:4===window.siyuan.config.tag.sort?"iconSelect":void 0,label:window.siyuan.languages.fileNameNatASC,click:()=>{window.siyuan.config.tag.sort=4,this.update()}}).element),window.siyuan.menus.menu.append(new c.MenuItem({icon:5===window.siyuan.config.tag.sort?"iconSelect":void 0,label:window.siyuan.languages.fileNameNatDESC,click:()=>{window.siyuan.config.tag.sort=5,this.update()}}).element),window.siyuan.menus.menu.append(new c.MenuItem({icon:7===window.siyuan.config.tag.sort?"iconSelect":void 0,label:window.siyuan.languages.refCountASC,click:()=>{window.siyuan.config.tag.sort=7,this.update()}}).element),window.siyuan.menus.menu.append(new c.MenuItem({icon:8===window.siyuan.config.tag.sort?"iconSelect":void 0,label:window.siyuan.languages.refCountDESC,click:()=>{window.siyuan.config.tag.sort=8,this.update()}}).element),window.siyuan.menus.menu.popup({x:e.clientX,y:e.clientY}),e.preventDefault(),e.stopPropagation();break;case"refresh":this.update()}}t=t.parentElement}})),this.update(),(0,o.setPanelFocus)(this.element.firstElementChild)}update(){const e=this.element.querySelector('.block__icon[data-type="refresh"] svg');e.classList.contains("fn__rotate")||(e.classList.add("fn__rotate"),(0,s.fetchPost)("/api/tag/getTag",{sort:window.siyuan.config.tag.sort},(t=>{this.openNodes&&(this.openNodes=this.tree.getExpandIds()),this.tree.updateData(t.data),this.openNodes?this.tree.setExpandIds(this.openNodes):this.openNodes=this.tree.getExpandIds(),e.classList.remove("fn__rotate")})))}}t.Tag=h},660:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dock=void 0;const i=n(7954),a=n(2269),o=n(1034),s=n(2922),r=n(2892),l=n(4684),c=n(3179),u=n(4341),d=n(4972),p=n(3371),h=n(9997);t.Dock=class{constructor(e){switch(e.position){case"Left":this.layout=window.siyuan.layout.layout.children[1].children[0],this.resizeElement=this.layout.element.nextElementSibling;break;case"Right":this.layout=window.siyuan.layout.layout.children[1].children[2],this.resizeElement=this.layout.element.previousElementSibling;break;case"Top":this.layout=window.siyuan.layout.layout.children[0],this.resizeElement=this.layout.element.nextElementSibling;break;case"Bottom":this.layout=window.siyuan.layout.layout.children[2],this.resizeElement=this.layout.element.previousElementSibling}this.element=document.getElementById("dock"+e.position);const t="Bottom"===e.position||"Top"===e.position?' class="fn__flex"':"";this.element.innerHTML=`<div${t}></div><div class="fn__flex-1"></div><div${t}></div>`,this.position=e.position,this.data={},0===e.data.length?this.element.classList.add("fn__none"):(this.genButton(e.data[0],0),e.data[1]&&this.genButton(e.data[1],1));const n=this.element.querySelectorAll(".dock__item--active");this.element.querySelectorAll(".dock__item").forEach((e=>{"file"!==e.getAttribute("data-type")||e.classList.contains("dock__item--active")||(this.toggleModel("file",!0),this.toggleModel("file"))})),0===n.length?this.resizeElement.classList.add("fn__none"):n.forEach((e=>{this.toggleModel(e.getAttribute("data-type"),!0)})),this.element.addEventListener("click",(e=>{let t=e.target;for(;t&&!t.isEqualNode(this.element);){const n=t.getAttribute("data-type");if(n){this.toggleModel(n,!1,!0),e.preventDefault();break}t=t.parentElement}})),window.siyuan.config.uiLayout.hideDock&&this.element.classList.add("fn__none")}toggleModel(e,t=!1,n=!1){const i=this.element.querySelector(`[data-type="${e}"]`);t&&i.classList.contains("dock__item--active")&&i.classList.remove("dock__item--active");const f=parseInt(i.getAttribute("data-index")),g=this.layout.children[f];if(i.classList.contains("dock__item--active")){if(!n){let e=!1;if(Array.from(g.element.querySelector(".layout-tab-container").children).find((t=>{if(t.getAttribute("data-id")===i.getAttribute("data-id"))return t.firstElementChild.classList.contains("block__icons--active")||((0,p.setPanelFocus)(t.firstElementChild),e=!0),!0})),e)return}i.classList.remove("dock__item--active"),0===this.element.querySelectorAll(".dock__item--active").length&&("Left"===this.position||"Right"===this.position?this.layout.element.style.width="0px":this.layout.element.style.height="0px",document.querySelector("body").classList.contains("body--win32")&&document.getElementById("drag").classList.remove("fn__hidden"),this.resizeElement.classList.add("fn__none"))}else{if(this.element.querySelectorAll(`.dock__item--active[data-index="${f}"]`).forEach((e=>{e.classList.remove("dock__item--active")})),i.classList.add("dock__item--active"),i.getAttribute("data-id"))Array.from(g.element.querySelector(".layout-tab-container").children).forEach((e=>{e.getAttribute("data-id")===i.getAttribute("data-id")?(e.classList.remove("fn__none"),(0,p.setPanelFocus)(e.firstElementChild)):e.classList.add("fn__none")}));else{let t;let n;switch((0,r.getAllModels)().editor.find((e=>{var n,i;if(e.parent.headElement.classList.contains("item--focus")&&(null===(i=null===(n=e.editor)||void 0===n?void 0:n.protyle)||void 0===i?void 0:i.path))return t=e.editor,!0})),e){case"file":n=new a.Tab({callback(e){e.addModel(new o.Files({tab:e}))}});break;case"bookmark":n=new a.Tab({callback(e){e.addModel(new l.Bookmark(e))}});break;case"tag":n=new a.Tab({callback(e){e.addModel(new c.Tag(e))}});break;case"outline":n=new a.Tab({callback(e){var n,i,a,o,r,l;const c=new s.Outline({type:"pin",tab:e,blockId:null===(i=null===(n=null==t?void 0:t.protyle)||void 0===n?void 0:n.block)||void 0===i?void 0:i.rootID});(null===(o=null===(a=null==t?void 0:t.protyle)||void 0===a?void 0:a.title)||void 0===o?void 0:o.editElement)&&c.updateDocTitle(null===(l=null===(r=t.protyle)||void 0===r?void 0:r.background)||void 0===l?void 0:l.ial),e.addModel(c)}});break;case"graph":n=new a.Tab({callback(e){var n,i;e.addModel(new u.Graph({tab:e,blockId:null===(i=null===(n=null==t?void 0:t.protyle)||void 0===n?void 0:n.block)||void 0===i?void 0:i.rootID,type:"pin"}))}});break;case"globalGraph":n=new a.Tab({callback(e){e.addModel(new u.Graph({tab:e,type:"global"}))}});break;case"backlink":n=new a.Tab({callback(e){var n,i;e.addModel(new d.Backlinks({type:"pin",tab:e,blockId:null===(i=null===(n=null==t?void 0:t.protyle)||void 0===n?void 0:n.block)||void 0===i?void 0:i.rootID}))}});break;case"inbox":n=new a.Tab({callback(e){e.addModel(new h.Inbox(e))}})}g.addTab(n),i.setAttribute("data-id",n.id),this.data[e]=n.model}"Left"===this.position||"Right"===this.position?this.layout.element.style.width=this.getMaxSize()+"px":this.layout.element.style.height=this.getMaxSize()+"px",("graph"===e||"globalGraph"===e)&&document.querySelector("body").classList.contains("body--win32")&&this.layout.element.querySelector(".fullscreen")&&document.getElementById("drag").classList.add("fn__hidden"),this.resizeElement.classList.remove("fn__none")}const m=0===f?1:0,y=this.layout.children[m],b=this.element.querySelectorAll(`.dock__item--active[data-index="${m}"]`).length>0,v=this.element.querySelectorAll(`.dock__item--active[data-index="${f}"]`).length>0;if(v&&b){let e=g;0===m?(e=y,y.element.nextElementSibling.classList.remove("fn__none")):y.element.previousElementSibling.classList.remove("fn__none");const t=this.element.querySelector('.dock__item--active[data-index="0"]');if("Left"===this.position||"Right"===this.position){const n=parseInt(t.getAttribute("data-height"));0===n||isNaN(n)||(e.element.style.height=n+"px",e.element.classList.remove("fn__flex-1"))}else{const n=parseInt(t.getAttribute("data-width"));0===n||isNaN(n)||(e.element.style.width=n+"px",e.element.classList.remove("fn__flex-1"))}}else 0===m?y.element.nextElementSibling.classList.add("fn__none"):y.element.previousElementSibling.classList.add("fn__none");b?y.element.classList.remove("fn__none"):y.element.classList.add("fn__none"),v?g.element.classList.remove("fn__none"):g.element.classList.add("fn__none"),v&&!b?(g.element.classList.add("fn__flex-1"),g.element.style.height="",g.element.style.width=""):!v&&b&&(y.element.classList.add("fn__flex-1"),y.element.style.height="",y.element.style.width=""),(0,p.resizeTabs)()}add(e,t){t.setAttribute("data-height",""),t.setAttribute("data-width","");const n=t.getAttribute("data-type"),i=(0,p.getDockByType)(n);1===i.element.querySelectorAll(".dock__item").length&&i.element.classList.add("fn__none");const a=i.layout.children[parseInt(t.getAttribute("data-index"))];t.getAttribute("data-id")&&(a.removeTab(t.getAttribute("data-id")),t.removeAttribute("data-id"));const o=t.classList.contains("dock__item--active");o&&i.toggleModel(n),delete i.data[n],t.classList.remove("b3-tooltips__n","b3-tooltips__ne","b3-tooltips__nw","b3-tooltips__s","b3-tooltips__se","b3-tooltips__sw","b3-tooltips__e","b3-tooltips__w"),t.classList.add(`b3-tooltips__${this.getClassDirect(e)}`),t.setAttribute("data-index",e.toString()),0===e?this.element.firstElementChild.insertAdjacentElement("afterbegin",t):this.element.lastElementChild.insertAdjacentElement("afterbegin",t),this.element.classList.remove("fn__none"),this.data[n]=!0,o&&this.toggleModel(n,!0)}getClassDirect(e){let t="e";switch(this.position){case"Right":t="w";break;case"Top":t=0===e?"e":"sw";break;case"Bottom":t=0===e?"ne":"nw"}return t}setSize(){const e=this.element.querySelectorAll(".dock__item--active");e.forEach((t=>{"Left"===this.position||"Right"===this.position?("0"===t.getAttribute("data-index")&&e.length>1&&t.setAttribute("data-height",this.data[t.getAttribute("data-type")].parent.parent.element.clientHeight.toString()),t.setAttribute("data-width",this.layout.element.clientWidth.toString())):("0"===t.getAttribute("data-index")&&e.length>1&&t.setAttribute("data-width",this.data[t.getAttribute("data-type")].parent.parent.element.clientWidth.toString()),t.setAttribute("data-height",this.layout.element.clientHeight.toString()))}))}getMaxSize(){let e=0;return this.element.querySelectorAll(".dock__item--active").forEach((t=>{let n;n="Left"===this.position||"Right"===this.position?parseInt(t.getAttribute("data-width"))||240:parseInt(t.getAttribute("data-height"))||240,n>e&&(e=n)})),e}genButton(e,t){let n="";e.forEach((e=>{n+=`<span data-height="${e.size.height}" data-width="${e.size.width}" data-type="${e.type}" data-index="${t}" data-hotkeylangid="${e.hotkeyLangId}" class="dock__item${e.show?" dock__item--active":""} b3-tooltips b3-tooltips__${this.getClassDirect(t)}" aria-label="${window.siyuan.languages[e.hotkeyLangId]+" "+(0,i.updateHotkeyTip)(window.siyuan.config.keymap.general[e.hotkeyLangId].custom)}${window.siyuan.languages.dockTip}">\n    <svg><use xlink:href="#${e.icon}"></use></svg>\n</span>`,this.data[e.type]=!0})),0===t?this.element.firstElementChild.innerHTML=n:this.element.lastElementChild.innerHTML=n}}},6501:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openOutline=t.openGraph=t.openBacklink=void 0;const i=n(2892),a=n(2269),o=n(4972),s=n(4341),r=n(2922),l=n(3371);t.openBacklink=e=>{if((0,i.getAllModels)().backlinks.find((t=>{if(t.blockId===e.block.id&&"local"===t.type)return t.parent.parent.removeTab(t.parent.id),!0})))return;const t=e.model.parent.parent.split("lr"),n=new a.Tab({icon:"iconLink",title:e.title.editElement.textContent,callback(t){t.addModel(new o.Backlinks({type:"local",tab:t,blockId:e.block.id,rootId:e.block.rootID}))}});t.addTab(n)};t.openGraph=e=>{if((0,i.getAllModels)().graph.find((t=>{if(t.blockId===e.block.id&&"local"===t.type)return t.parent.parent.removeTab(t.parent.id),!0})))return;const t=e.model.parent.parent.split("lr"),n=new a.Tab({icon:"iconGraph",title:e.title.editElement.textContent,callback(t){t.addModel(new s.Graph({type:"local",tab:t,blockId:e.block.id,rootId:e.block.rootID}))}});t.addTab(n)};t.openOutline=e=>{if((0,i.getAllModels)().outline.find((t=>{if(t.blockId===e.block.rootID&&"local"===t.type)return t.parent.parent.removeTab(t.parent.id),!0})))return;const t=e.model.parent.parent.split("lr"),n=new a.Tab({icon:"iconAlignCenter",title:e.title.editElement.textContent,callback(t){t.addModel(new r.Outline({type:"local",tab:t,blockId:e.block.rootID}))}});t.addTab(n),t.element.classList.remove("fn__flex-1"),t.element.style.width="200px",(0,l.switchWnd)(t,e.model.parent.parent)}},2892:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAllDocks=t.getAllTabs=t.getAllModels=void 0;const i=n(2269),a=n(7876),o=n(4341),s=n(2922),r=n(4972),l=n(3319),c=n(7729);t.getAllModels=()=>{const e={editor:[],graph:[],asset:[],outline:[],backlinks:[],search:[]},t=n=>{for(let u=0;u<n.children.length;u++){const d=n.children[u];if(d instanceof i.Tab){const t=d.model;t instanceof a.Editor?e.editor.push(t):t instanceof o.Graph?e.graph.push(t):t instanceof s.Outline?e.outline.push(t):t instanceof r.Backlinks?e.backlinks.push(t):t instanceof l.Asset?e.asset.push(t):t instanceof c.Search&&e.search.push(t)}else t(d)}};return window.siyuan.layout.layout&&t(window.siyuan.layout.layout),e};t.getAllTabs=()=>{const e=[],t=n=>{for(let a=0;a<n.children.length;a++){const o=n.children[a];o instanceof i.Tab?e.push(o):t(o)}};return window.siyuan.layout.centerLayout&&t(window.siyuan.layout.centerLayout),e};t.getAllDocks=()=>{const e=[];return window.siyuan.config.uiLayout.left.forEach((t=>{t.forEach((t=>{e.push(t)}))})),window.siyuan.config.uiLayout.right.forEach((t=>{t.forEach((t=>{e.push(t)}))})),window.siyuan.config.uiLayout.top.forEach((t=>{t.forEach((t=>{e.push(t)}))})),window.siyuan.config.uiLayout.bottom.forEach((t=>{t.forEach((t=>{e.push(t)}))})),e}},4495:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Layout=void 0;const i=n(8303),a=n(3371);t.Layout=class{constructor(e){const t=Object.assign({direction:"tb",size:"auto",type:"normal"},e);this.id=(0,i.genUUID)(),this.direction=t.direction,this.type=t.type,this.size=t.size,this.resize=e.resize,this.children=[],this.element=e.element||document.createElement("div"),"center"===this.type&&this.element.classList.add("layout__center"),"tb"===t.direction?this.element.classList.add("fn__flex-column"):this.element.classList.add("fn__flex"),"left"===t.type&&this.element.classList.add("fn__flex-shrink")}addLayout(e,t){t?this.children.find(((n,i)=>{if(n.id===t)return this.children.splice(i+1,0,e),n.element.after(e.element),!0})):(this.children.splice(this.children.length,0,e),this&&this.element.append(e.element)),"auto"===e.size?e.element.classList.add("fn__flex-1"):e.element.style[this&&"lr"===this.direction?"width":"height"]=e.size,(0,a.addResize)(e),e.parent=this}addWnd(e,t){t?this.children.find(((n,i)=>{if(n.id===t)return this.children.splice(i+1,0,e),n.element.style.width="",n.element.style.height="",n.element.classList.add("fn__flex-1"),n.element.after(e.element),!0})):(this.children.splice(this.children.length,0,e),this.element.append(e.element)),(0,a.addResize)(e),(0,a.resizeTabs)(),e.parent=this}}},7731:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countBlockWord=t.countSelectWord=t.initStatus=void 0;const i=n(2892),a=n(7954),o=n(3371),s=n(3607),r=n(734),l=n(4275);t.initStatus=()=>{const e=(0,i.getAllDocks)();let t="";e.forEach((e=>{t+=`<button class="b3-menu__item" data-type="${e.type}"><svg class="b3-menu__icon""><use xlink:href="#${e.icon}"></use></svg><span class="b3-menu__label">${window.siyuan.languages[e.hotkeyLangId]}</span><span class="b3-menu__accelerator">${(0,a.updateHotkeyTip)(window.siyuan.config.keymap.general[e.hotkeyLangId].custom)}</span></button>`})),document.getElementById("status").innerHTML=`<div id="barDock" class="toolbar__item b3-tooltips b3-tooltips__e${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.config.uiLayout.hideDock?window.siyuan.languages.showDock:window.siyuan.languages.hideDock}">\n    <svg>\n        <use xlink:href="#${window.siyuan.config.uiLayout.hideDock?"iconDock":"iconHideDock"}"></use>\n    </svg>\n    <div class="b3-menu fn__none" style="bottom: 21px;left: 4px">\n        ${t}\n    </div>\n</div>\n<div class="status__msg"></div>\n<div class="fn__flex-1"></div>\n<div class="status__counter"></div>\n<div id="barFeedback" class="toolbar__item b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.feedback}">\n    <svg><use xlink:href="#iconHeart"></use></svg>\n</div>\n<div id="barLock" class="toolbar__item b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.lockScreen} ${(0,a.updateHotkeyTip)(window.siyuan.config.keymap.general.lockScreen.custom)}">\n    <svg><use xlink:href="#iconLock"></use></svg>\n</div>\n<div id="barDebug" class="toolbar__item b3-tooltips b3-tooltips__nw fn__none" aria-label="${window.siyuan.languages.debug}">\n    <svg>\n        <use xlink:href="#iconBug"></use>\n    </svg>\n</div>\n<div id="barHelp" class="toolbar__item b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.help}">\n    <svg><use xlink:href="#iconHelp"></use></svg>\n</div>`;const n=document.getElementById("barDock");n.addEventListener("mousemove",(()=>{n.querySelector(".b3-menu").classList.remove("fn__none")})),n.addEventListener("mouseleave",(()=>{n.querySelector(".b3-menu").classList.add("fn__none")})),document.querySelector("#status").addEventListener("click",(e=>{let t=e.target;for(;"status"!==t.id;){if("barDock"===t.id){const n=t.firstElementChild.firstElementChild,i="#iconHideDock"===n.getAttribute("xlink:href");i?(n.setAttribute("xlink:href","#iconDock"),t.setAttribute("aria-label",window.siyuan.languages.showDock)):(n.setAttribute("xlink:href","#iconHideDock"),t.setAttribute("aria-label",window.siyuan.languages.hideDock)),document.querySelectorAll(".dock").forEach((e=>{i?e.querySelector(".dock__item")&&e.classList.add("fn__none"):e.querySelector(".dock__item")&&e.classList.remove("fn__none")})),(0,o.resizeTabs)(),t.querySelector(".b3-menu").classList.add("fn__none"),e.stopPropagation();break}if(t.classList.contains("b3-menu__item")){const n=t.getAttribute("data-type");if((0,o.getDockByType)(n).toggleModel(n),"file"===n&&getSelection().rangeCount>0){const e=getSelection().getRangeAt(0),t=(0,s.hasClosestByClassName)(e.startContainer,"protyle-wysiwyg",!0);t&&t.blur()}t.parentElement.classList.add("fn__none"),e.stopPropagation();break}if("barLock"===t.id){(0,o.exportLayout)(!1,(()=>{(0,r.fetchPost)("/api/system/logoutAuth",{},(()=>{window.location.href="/"}))})),e.stopPropagation();break}if("barHelp"===t.id){(0,l.mountHelp)(),e.stopPropagation();break}if("barDebug"===t.id){e.stopPropagation();break}if("barFeedback"===t.id){"zh_CN"===window.siyuan.config.lang?window.open("https://ld246.com/article/1649901726096"):window.open("https://github.com/siyuan-note/siyuan/issues"),e.stopPropagation();break}t=t.parentElement}})),window.siyuan.config.appearance.hideStatusBar&&document.getElementById("status").classList.add("fn__none")};t.countSelectWord=e=>{if(document.getElementById("status").classList.contains("fn__none"))return;e.toString()?(0,r.fetchPost)("/api/block/getContentWordCount",{content:e.toString()},(e=>{document.querySelector("#status .status__counter").innerHTML=`<span class="ft__on-surface">${window.siyuan.languages.runeCount}</span>\n&nbsp;${e.data.runeCount}\n<span class="fn__space"></span>\n<span class="ft__on-surface">${window.siyuan.languages.wordCount}</span>\n&nbsp;${e.data.wordCount}<span class="fn__space"></span>`})):document.querySelector("#status .status__counter").innerHTML=""};t.countBlockWord=e=>{document.getElementById("status").classList.contains("fn__none")||(e.length>0?(0,r.fetchPost)("/api/block/getBlocksWordCount",{ids:e},(e=>{document.querySelector("#status .status__counter").innerHTML=`<span class="ft__on-surface">${window.siyuan.languages.runeCount}</span>\n&nbsp;${e.data.runeCount}\n<span class="fn__space"></span>\n<span class="ft__on-surface">${window.siyuan.languages.wordCount}</span>\n&nbsp;${e.data.wordCount}<span class="fn__space"></span>`})):document.querySelector("#status .status__counter").innerHTML="")}},3371:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newCenterEmptyTab=t.addResize=t.getInstanceById=t.copyTab=t.resizeTabs=t.resizeDrag=t.layoutToJSON=t.JSONToLayout=t.exportLayout=t.getWndByLayout=t.switchWnd=t.getDockByType=t.setPanelFocus=void 0;const i=n(4495),a=n(8943),o=n(4275),s=n(2269),r=n(4341),l=n(7876),c=n(1034),u=n(1384),d=n(4779),p=n(2922),h=n(4684),f=n(7954),g=n(4972),m=n(3179),y=n(2892),b=n(3319),v=n(7729),w=n(660),_=n(4640),E=n(5378),k=n(734),C=n(3607),D=n(6520),x=n(8792),S=n(5031),A=n(3914),L=n(4382);t.setPanelFocus=e=>{if(!e.classList.contains("block__icons--active")&&!e.classList.contains("layout__wnd--active"))if(document.querySelectorAll(".block__icons--active").forEach((e=>{e.classList.remove("block__icons--active")})),document.querySelectorAll(".layout__wnd--active").forEach((e=>{e.classList.remove("layout__wnd--active")})),e.classList.contains("block__icons")){e.classList.add("block__icons--active");const t=(0,C.hasClosestBlock)(document.activeElement);if(t){const e=(0,D.getContenteditableElement)(t);e&&e.blur()}}else e.classList.add("layout__wnd--active")};t.getDockByType=e=>{if(window.siyuan.layout.leftDock)return window.siyuan.layout.leftDock.data[e]?window.siyuan.layout.leftDock:window.siyuan.layout.rightDock.data[e]?window.siyuan.layout.rightDock:window.siyuan.layout.bottomDock.data[e]?window.siyuan.layout.bottomDock:window.siyuan.layout.topDock.data[e]?window.siyuan.layout.topDock:void 0};t.switchWnd=(e,t)=>{e.element.after(t.element),e.element.after(e.element.previousElementSibling),e.parent.children.find(((t,n)=>{if(t.id===e.id){const i=e.parent.children[n].resize;e.parent.children[n].resize=e.parent.children[n-1].resize,e.parent.children[n-1].resize=i;const a=t;return e.parent.children[n]=e.parent.children[n-1],e.parent.children[n-1]=a,!0}}))};t.getWndByLayout=e=>{for(let n=0;n<e.children.length;n++){const i=e.children[n];return i instanceof a.Wnd?i:(0,t.getWndByLayout)(i)}};const T=e=>{const t=[],n=t=>{const n=[];return e.element.querySelectorAll(`span[data-index="${t}"]`).forEach((e=>{n.push({type:e.getAttribute("data-type"),size:{height:parseInt(e.getAttribute("data-height")),width:parseInt(e.getAttribute("data-width"))},show:e.classList.contains("dock__item--active"),icon:e.querySelector("use").getAttribute("xlink:href").substring(1),hotkeyLangId:e.getAttribute("data-hotkeylangid")})})),n},i=n(0),a=n(1);return(i.length>0||a.length>0)&&t.push(i),a.length>0&&t.push(a),t};t.exportLayout=(e,n)=>{const i=document.querySelector("#barDock use");if(!i)return;const a={hideDock:"#iconDock"===i.getAttribute("xlink:href"),layout:{},top:T(window.siyuan.layout.topDock),bottom:T(window.siyuan.layout.bottomDock),left:T(window.siyuan.layout.leftDock),right:T(window.siyuan.layout.rightDock)};(0,t.layoutToJSON)(window.siyuan.layout.layout,a.layout),(0,k.fetchPost)("/api/system/setUILayout",{layout:a,exit:void 0!==n},(()=>{e?window.location.reload():n&&n()}))};const B=(e,n)=>{let o;if("Layout"===e.instance)n?(o=new i.Layout({direction:e.direction,size:e.size,type:e.type,resize:e.resize}),n.addLayout(o)):window.siyuan.layout.layout=new i.Layout({element:document.getElementById("layouts")});else if("Wnd"===e.instance)o=new a.Wnd(e.resize,n.type),n.addWnd(o),e.width&&(o.element.classList.remove("fn__flex-1"),o.element.style.width=e.width),e.height&&(o.element.classList.remove("fn__flex-1"),o.element.style.height=e.height);else if("Tab"===e.instance){if(e.title){let t=e.title;e.lang&&(t=window.siyuan.languages[e.lang]),o=new s.Tab({icon:e.icon,docIcon:e.docIcon,title:t})}else o=(0,t.newCenterEmptyTab)();e.pin&&(o.headElement.classList.add("item--pin"),(e.docIcon||e.icon)&&o.headElement.querySelector(".item__text").classList.add("fn__none")),e.active&&o.headElement.setAttribute("data-init-active","true"),n.addTab(o)}else"Editor"===e.instance&&e.blockId?n.headElement.setAttribute("data-initdata",JSON.stringify(e)):"Asset"===e.instance?n.addModel(new b.Asset({tab:n,path:e.path})):"Backlinks"===e.instance?n.addModel(new g.Backlinks({tab:n,blockId:e.blockId,rootId:e.rootId,type:e.type})):"Bookmark"===e.instance?n.addModel(new h.Bookmark(n)):"Files"===e.instance?n.addModel(new c.Files({tab:n})):"Graph"===e.instance?n.addModel(new r.Graph({tab:n,blockId:e.blockId,rootId:e.rootId,type:e.type})):"Outline"===e.instance?n.addModel(new p.Outline({tab:n,blockId:e.blockId,type:e.type})):"Tag"===e.instance?n.addModel(new m.Tag(n)):"Search"===e.instance&&n.addModel(new v.Search({tab:n,text:e.text}));e.children&&(Array.isArray(e.children)?e.children.forEach(((t,i)=>{if(B(t,n?o:window.siyuan.layout.layout),"Tab"===t.instance&&i===e.children.length-1){const e=o.headersElement.querySelector('[data-init-active="true"]');e&&(e.removeAttribute("data-init-active"),o.switchTab(e,!1,!1))}})):B(e.children,o))};t.JSONToLayout=e=>{var t;B(window.siyuan.config.uiLayout.layout),t=window.siyuan.config.uiLayout,window.siyuan.layout.centerLayout=window.siyuan.layout.layout.children[1].children[1],window.siyuan.layout.topDock=new w.Dock({position:"Top",data:t.top}),window.siyuan.layout.leftDock=new w.Dock({position:"Left",data:t.left}),window.siyuan.layout.rightDock=new w.Dock({position:"Right",data:t.right}),window.siyuan.layout.bottomDock=new w.Dock({position:"Bottom",data:t.bottom}),window.siyuan.config.fileTree.closeTabsOnStart&&e&&(0,y.getAllTabs)().forEach((e=>{e.headElement&&!e.headElement.classList.contains("item--pin")&&e.parent.removeTab(e.id)}))};t.layoutToJSON=(e,n)=>{e instanceof i.Layout?(n.direction=e.direction,e.parent&&(e.element.classList.contains("fn__flex-1")?n.size="auto":n.size=("tb"===e.parent.direction?e.element.clientHeight:e.element.clientWidth)+"px"),n.resize=e.resize,n.type=e.type,n.instance="Layout"):e instanceof a.Wnd?(n.resize=e.resize,n.height=e.element.style.height,n.width=e.element.style.width,n.instance="Wnd"):e instanceof s.Tab?(e.headElement&&(n.title=e.title,n.icon=e.icon,n.docIcon=e.docIcon,n.pin=e.headElement.classList.contains("item--pin"),e.model instanceof c.Files?n.lang="fileTree":e.model instanceof g.Backlinks&&"pin"===e.model.type?n.lang="backlinks":e.model instanceof h.Bookmark?n.lang="bookmark":e.model instanceof r.Graph&&"local"!==e.model.type?n.lang="graphView":e.model instanceof p.Outline&&"local"!==e.model.type?n.lang="outline":e.model instanceof m.Tag&&(n.lang="tag"),e.headElement.classList.contains("item--focus")&&(n.active=!0)),n.instance="Tab"):e instanceof l.Editor?(n.blockId=e.editor.protyle.block.id,n.rootId=e.editor.protyle.block.rootID,n.mode=e.editor.protyle.preview.element.classList.contains("fn__none")?"wysiwyg":"preview",n.action=e.editor.protyle.block.showAll?x.Constants.CB_GET_ALL:"",n.instance="Editor",n.scrollAttr=(0,A.saveScroll)(e.editor.protyle,!0)):e instanceof b.Asset?(n.path=e.path,n.instance="Asset"):e instanceof g.Backlinks?(n.blockId=e.blockId,n.rootId=e.rootId,n.type=e.type,n.instance="Backlinks"):e instanceof h.Bookmark?n.instance="Bookmark":e instanceof c.Files?n.instance="Files":e instanceof r.Graph?(n.blockId=e.blockId,n.rootId=e.rootId,n.type=e.type,n.instance="Graph"):e instanceof p.Outline?(n.blockId=e.blockId,n.type=e.type,n.instance="Outline"):e instanceof m.Tag?n.instance="Tag":e instanceof v.Search&&(n.instance="Search",n.text=e.text),e instanceof i.Layout||e instanceof a.Wnd?e instanceof i.Layout&&("top"===e.type||"bottom"===e.type||"left"===e.type||"right"===e.type)?"top"===e.type||"bottom"===e.type?n.children=[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"lr",children:[]}]:n.children=[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"tb",children:[]}]:(n.children=[],e.children.forEach((e=>{const i={};n.children.push(i),(0,t.layoutToJSON)(e,i)}))):e instanceof s.Tab&&(e.model?(n.children={},(0,t.layoutToJSON)(e.model,n.children)):e.headElement?n.children=JSON.parse(e.headElement.getAttribute("data-initdata")||"{}"):n.children={})};t.resizeDrag=()=>{const e=document.getElementById("drag"),t=e.getBoundingClientRect().left-document.querySelector("#windowControls").clientWidth;t<e.clientWidth?e.style.paddingRight=t+"px":e.style.paddingRight=""};t.resizeTabs=()=>{(0,y.getAllModels)().editor.forEach((e=>{e.editor&&e.editor.protyle&&e.element.parentElement&&((0,E.hideElements)(["gutter"],e.editor.protyle),setTimeout((()=>{(0,u.setPadding)(e.editor.protyle),"undefined"!=typeof echarts&&e.editor.protyle.wysiwyg.element.querySelectorAll('[data-subtype="echarts"], [data-subtype="mindmap"]').forEach((e=>{const t=echarts.getInstanceById(e.firstElementChild.nextElementSibling.getAttribute("_echarts_instance_"));t&&t.resize()}))}),200))})),(0,L.pdfResize)()};t.copyTab=e=>new s.Tab({icon:e.icon,docIcon:e.docIcon,title:e.title,callback(t){let n;if(e.model instanceof l.Editor)n=new l.Editor({tab:t,blockId:e.model.editor.protyle.block.rootID,scrollAttr:(0,A.saveScroll)(e.model.editor.protyle,!0)});else if(e.model instanceof b.Asset)n=new b.Asset({tab:t,path:e.model.path});else if(e.model instanceof r.Graph)n=new r.Graph({tab:t,blockId:e.model.blockId,rootId:e.model.rootId,type:e.model.type});else if(e.model instanceof c.Files)n=new c.Files({tab:t});else if(e.model instanceof p.Outline)n=new p.Outline({tab:t,blockId:e.model.blockId,type:e.model.type});else if(e.model instanceof g.Backlinks)n=new g.Backlinks({tab:t,blockId:e.model.blockId,rootId:e.model.rootId,type:e.model.type});else if(e.model instanceof h.Bookmark)n=new h.Bookmark(t);else if(e.model instanceof m.Tag)n=new m.Tag(t);else if(e.model instanceof v.Search)n=new v.Search({tab:t,text:e.model.text});else if(!e.model&&e.headElement){const i=JSON.parse(e.headElement.getAttribute("data-initdata")||"{}");n=new l.Editor({tab:t,blockId:i.rootId||i.blockId,mode:i.mode,action:"string"==typeof i.action?[i.action]:i.action,scrollAttr:i.scrollAttr})}t.addModel(n)}});t.getInstanceById=e=>{const t=(e,n)=>{if(e.id===n)return e;if(!e.children)return;let i;for(let a=0;a<e.children.length;a++)if(i=t(e.children[a],n),i)return i};return t(window.siyuan.layout.centerLayout,e)};t.addResize=e=>{if(e.resize){const n=(e,n)=>{const i=(e,t)=>{e.classList.contains("fn__flex-1")&&("lr"===t?e.style.width=e.clientWidth+"px":e.style.height=e.clientHeight+"px",e.classList.remove("fn__flex-1"))};let a;e.addEventListener("mousedown",(o=>{(0,y.getAllModels)().editor.forEach((e=>{e.editor&&e.editor.protyle&&e.element.parentElement&&(0,E.hideElements)(["gutter"],e.editor.protyle)})),getSelection().rangeCount>0&&(a=getSelection().getRangeAt(0));const s=document,r=e.nextElementSibling,l=e.previousElementSibling;r.style.transition="",l.style.transition="",i(r,n),i(l,n);const c=o["lr"===n?"clientX":"clientY"],u="lr"===n?l.clientWidth:l.clientHeight,d="lr"===n?r.clientWidth:r.clientHeight;s.ondragstart=()=>(document.querySelectorAll(".sy__file .b3-list-item").forEach((e=>{"0.1"===e.style.opacity&&(e.style.opacity="")})),!1),s.onmousemove=e=>{e.preventDefault(),e.stopPropagation();const t=u+(e["lr"===n?"clientX":"clientY"]-c),i=d-(e["lr"===n?"clientX":"clientY"]-c);t<8||i<8||window.siyuan.layout.leftDock.layout.element.contains(l)&&t<188||window.siyuan.layout.rightDock.layout.element.contains(r)&&i<188||(l.style["lr"===n?"width":"height"]=t+"px",r.style["lr"===n?"width":"height"]=i+"px")},s.onmouseup=()=>{var e;s.onmousemove=null,s.onmouseup=null,s.ondragstart=null,s.onselectstart=null,s.onselect=null,r.nextElementSibling?(null===(e=r.nextElementSibling)||void 0===e?void 0:e.nextElementSibling)&&r.parentElement.lastElementChild.isSameNode(r.nextElementSibling.nextElementSibling)&&(r.style["lr"===n?"width":"height"]="",r.classList.add("fn__flex-1")):l.previousElementSibling?(l.style["lr"===n?"width":"height"]="",l.classList.add("fn__flex-1")):(r.style["lr"===n?"width":"height"]="",r.classList.add("fn__flex-1")),(0,t.resizeTabs)(),window.siyuan.layout.leftDock.setSize(),window.siyuan.layout.topDock.setSize(),window.siyuan.layout.bottomDock.setSize(),window.siyuan.layout.rightDock.setSize(),a&&(0,_.focusByRange)(a),r.style.transition="var(--b3-width-transition)",l.style.transition="var(--b3-width-transition)"}}))},i=document.createElement("div");"lr"===e.resize&&i.classList.add("layout__resize--lr"),i.classList.add("layout__resize"),e.element.insertAdjacentElement("beforebegin",i),e.element.style.transition="var(--b3-width-transition)",i.previousElementSibling.style.transition="var(--b3-width-transition)",n(i,e.resize)}};t.newCenterEmptyTab=()=>new s.Tab({panel:`<div class="layout__empty b3-list">\n    <div class="${window.siyuan.config.readonly?"":" fn__none"}">\n        <div class="config-about__logo">\n            <img src="/stage/icon.png">\n            ${window.siyuan.languages.siyuanNote}\n        </div>\n        <div class="b3-label__text">${window.siyuan.languages.slogan}</div>\n    </div>\n    <h1>${window.siyuan.languages.noOpenFile}</h1>\n    <div class="fn__hr"></div>\n    <div class="fn__hr"></div>\n    <div class="b3-list-item" id="editorEmptySearch"><svg class="b3-list-item__graphic"><use xlink:href="#iconSearch"></use></svg><span>${window.siyuan.languages.search}</span><span class="b3-list-item__meta">${(0,f.updateHotkeyTip)(window.siyuan.config.keymap.general.globalSearch.custom)}</span></div>\n    <div class="b3-list-item${window.siyuan.config.readonly?" fn__none":""}" id="editorEmptyFile"><svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg><span>${window.siyuan.languages.newFile}</span><span class="b3-list-item__meta">${(0,f.updateHotkeyTip)(window.siyuan.config.keymap.general.newFile.custom)}</span></div>\n    <div class="b3-list-item${window.siyuan.config.readonly?" fn__none":""}" id="editorEmptyNewNotebook"><svg class="b3-list-item__graphic"><use xlink:href="#iconFilesRoot"></use></svg><span>${window.siyuan.languages.newNotebook}</span></div>\n    <div class="b3-list-item" id="editorEmptyHelp"><svg class="b3-list-item__graphic"><use xlink:href="#iconHelp"></use></svg><span>${window.siyuan.languages.help}</span></div>\n</div>`,callback(e){e.panelElement.querySelector("#editorEmptyHelp").addEventListener("click",(()=>{(0,o.mountHelp)()})),e.panelElement.querySelector("#editorEmptySearch").addEventListener("click",(()=>{(0,S.openSearch)(window.siyuan.config.keymap.general.globalSearch.custom)})),window.siyuan.config.readonly||(e.panelElement.querySelector("#editorEmptyNewNotebook").addEventListener("click",(()=>{(0,o.newNotebook)()})),e.panelElement.querySelector("#editorEmptyFile").addEventListener("click",(()=>{(0,d.newFile)(void 0,void 0,!0)})))}})},2640:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindMenuKeydown=t.MenuItem=t.Menu=void 0;const i=n(7954),a=n(6224),o=n(3607),s=n(3274);t.Menu=class{constructor(){this.wheelEvent="onwheel"in document.createElement("div")?"wheel":"mousewheel",this.element=document.getElementById("commonMenu"),this.element.addEventListener((0,s.isMobile)()?(0,i.getEventName)():"mouseover",(e=>{const t=e.target,n=(0,o.hasClosestByClassName)(t,"b3-menu__item");if(!n)return;if(n.classList.contains("b3-menu__item--readonly"))return;const i=n.querySelector(".b3-menu__submenu");this.element.querySelectorAll(".b3-menu__item--show").forEach((e=>{e.contains(n)||e.classList.remove("b3-menu__item--show")})),this.element.querySelectorAll(".b3-menu__item--current").forEach((e=>{e.classList.remove("b3-menu__item--current")})),n.classList.add("b3-menu__item--current"),i&&(n.classList.add("b3-menu__item--show"),this.showSubMenu(i))}))}showSubMenu(e){const t=e.getBoundingClientRect();let n="";const i=t.left-this.element.clientWidth-t.width;t.right>window.innerWidth&&(i>0||Math.abs(i)<t.right-window.innerWidth)?n=i>=0?"left:auto;right:100%;":`z-index:1;mix-blend-mode: normal;left:-${this.element.style.left};`:t.right>window.innerWidth&&(n=`z-index:1;mix-blend-mode: normal;left:${window.innerWidth-t.width-this.element.offsetLeft}px;`),t.bottom>window.innerHeight&&(n+=`top: auto;bottom:-5px;max-height:${Math.min(t.top,.4*window.innerHeight)}px`),n&&e.setAttribute("style",n)}preventDefault(e){(0,o.hasClosestByClassName)(e.target,"b3-menu")||e.preventDefault()}remove(){(0,s.isMobile)()?window.removeEventListener("touchmove",this.preventDefault,!1):window.removeEventListener(this.wheelEvent,this.preventDefault,!1),this.element.innerHTML="",this.element.classList.add("fn__none"),this.element.style.zIndex=""}append(e){e&&this.element.append(e)}popup(e,t=!1){(0,s.isMobile)()?window.addEventListener("touchmove",this.preventDefault,{passive:!1}):window.addEventListener(this.wheelEvent,this.preventDefault,{passive:!1}),this.element.classList.remove("fn__none"),(0,a.setPosition)(this.element,e.x-(t?window.siyuan.menus.menu.element.clientWidth:0),e.y,e.h)}};class r{constructor(e){if(this.element=document.createElement("button"),e.disabled&&this.element.setAttribute("disabled","disabled"),"separator"===e.type)return void this.element.classList.add("b3-menu__separator");this.element.classList.add("b3-menu__item"),e.current&&this.element.classList.add("b3-menu__item--selected"),e.click&&this.element.addEventListener((0,i.getEventName)(),(t=>{this.element.getAttribute("disabled")||(e.click(this.element),this.element.parentElement.classList.add("fn__none"),this.element.parentElement.innerHTML="",t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),window.siyuan.menus.menu.remove())}));let t=`<span class="b3-menu__label">${e.label}</span>`;if(t=e.iconHTML?e.iconHTML+t:`<svg class="b3-menu__icon${["HTML (SiYuan)",window.siyuan.languages.template].includes(e.label)?" ft__error":""}" style="${"iconClose"===e.icon?"height:10px;":""}"><use xlink:href="#${e.icon||""}"></use></svg>${t}`,e.accelerator&&(t+=`<span class="b3-menu__accelerator">${(0,i.updateHotkeyTip)(e.accelerator)}</span>`),e.id&&this.element.setAttribute("data-id",e.id),"readonly"===e.type&&this.element.classList.add("b3-menu__item--readonly"),this.element.innerHTML=t,e.bind&&(this.element.classList.add("b3-menu__item--custom"),e.bind(this.element)),e.submenu){const t=document.createElement("div");t.classList.add("b3-menu__submenu"),e.submenu.forEach((e=>{t.append(new r(e).element)})),this.element.insertAdjacentHTML("beforeend",'<svg class="b3-menu__icon b3-menu__icon--arrow"><use xlink:href="#iconRight"></use></svg>'),this.element.append(t)}}}t.MenuItem=r;const l=(e,t)=>{let n=e;for(;n&&(n.classList.contains("b3-menu__separator")||n.classList.contains("b3-menu__item--readonly"));)n=t?n.nextElementSibling:n.previousElementSibling;return n};t.bindMenuKeydown=e=>{if(window.siyuan.menus.menu.element.classList.contains("fn__none")||e.altKey||e.shiftKey||(0,i.isCtrl)(e))return!1;if("ArrowDown"===e.code){const e=window.siyuan.menus.menu.element.querySelector(".b3-menu__item--current");let t;e?(e.classList.remove("b3-menu__item--current","b3-menu__item--show"),t=l(e.nextElementSibling,!0),t||(t=l(e.parentElement.firstElementChild,!0))):t=l(window.siyuan.menus.menu.element.firstElementChild,!0),t&&(t.classList.add("b3-menu__item--current"),t.classList.remove("b3-menu__item--show"))}else if("ArrowUp"===e.code){const e=window.siyuan.menus.menu.element.querySelector(".b3-menu__item--current");let t;e?(e.classList.remove("b3-menu__item--current","b3-menu__item--show"),t=l(e.previousElementSibling,!1),t||(t=l(e.parentElement.lastElementChild,!1))):t=l(window.siyuan.menus.menu.element.lastElementChild,!1),t&&(t.classList.add("b3-menu__item--current"),t.classList.remove("b3-menu__item--show"))}else{if("ArrowRight"===e.code){const e=window.siyuan.menus.menu.element.querySelector(".b3-menu__item--current");if(!e)return!0;const t=e.querySelector(".b3-menu__submenu");if(!t)return!0;e.classList.remove("b3-menu__item--current"),e.classList.add("b3-menu__item--show");const n=l(t.firstElementChild,!0);n&&n.classList.add("b3-menu__item--current");const i=t.getBoundingClientRect();let a="";return i.right>window.innerWidth&&(i.left-t.clientWidth-i.width>0||Math.abs(i.left-t.clientWidth-i.width)<i.right-window.innerWidth)&&(a="left:auto;right:100%;"),i.bottom>window.innerHeight&&(a+=`top: auto;bottom:-5px;max-height:${Math.min(i.top,.4*window.innerHeight)}px`),a&&t.setAttribute("style",a),!0}if("ArrowLeft"===e.code){const e=window.siyuan.menus.menu.element.querySelector(".b3-menu__submenu .b3-menu__item--current");return!e||(e.parentElement.parentElement.classList.remove("b3-menu__item--show"),e.parentElement.parentElement.classList.add("b3-menu__item--current"),e.classList.remove("b3-menu__item--current"),!0)}if("Enter"===e.code){const e=window.siyuan.menus.menu.element.querySelector(".b3-menu__item--current");if(!e)return!1;{const t=e.querySelector(".b3-text-field"),n=e.querySelector(".b3-switch");if(t)return t.focus(),!0;n?n.click():e.dispatchEvent(new CustomEvent((0,i.getEventName)())),window.siyuan.menus.menu.remove()}return!0}}if("ArrowUp"===e.code||"ArrowDown"===e.code){const e=window.siyuan.menus.menu.element.querySelector(".b3-menu__item--current"),t=e.parentElement;return t.classList.contains("b3-menu__submenu")&&(e.offsetTop+e.clientHeight>t.scrollTop+t.clientHeight?t.scrollTop=e.offsetTop+e.clientHeight-t.clientHeight:e.offsetTop<t.scrollTop&&(t.scrollTop=e.offsetTop)),!0}}},8120:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.movePathToMenu=t.renameMenu=t.deleteMenu=t.openMenu=t.exportMd=t.copySubMenu=t.openAttr=t.openFileAttr=t.openFileWechatNotify=t.openWechatNotify=void 0;const i=n(3371),a=n(1377),o=n(3274),s=n(8813),r=n(2640),l=n(3607),c=n(7954),u=n(734),d=n(1890),p=n(9866),h=n(4640),f=n(6840),g=n(2892),m=n(4684),y=n(9516),b=n(8349),v=n(7422),w=n(5680),_=n(8792),E=n(2509),k=(e,t)=>{e.addEventListener("keydown",(e=>{e.isComposing||(0,v.matchHotKey)("⌘↩",e)&&(t.dispatchEvent(new CustomEvent("click")),e.stopPropagation(),e.preventDefault())}))};t.openWechatNotify=e=>{const t=e.getAttribute("data-node-id"),n=(0,h.getEditorRange)(e),i=e.getAttribute("custom-reminder-wechat");let a="";i&&(a=w(i).format("YYYY-MM-DDTHH:mm"));const s=new p.Dialog({width:(0,o.isMobile)()?"80vw":"50vw",title:window.siyuan.languages.wechatReminder,content:`<div class="b3-dialog__content custom-attr">\n    <div class="fn__flex">\n        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.notifyTime}</span>\n        <div class="fn__space"></div>\n        <input class="b3-text-field fn__flex-1" type="datetime-local" value="${a}">\n    </div>\n    <div class="b3-label__text" style="text-align: center">${window.siyuan.languages.wechatTip}</div>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.remove}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,destroyCallback(){(0,h.focusByRange)(n)}}),r=s.element.querySelectorAll(".b3-button");r[0].addEventListener("click",(()=>{s.destroy()})),r[1].addEventListener("click",(()=>{r[1].getAttribute("disabled")||(r[1].setAttribute("disabled","disabled"),(0,u.fetchPost)("/api/block/setBlockReminder",{id:t,timed:"0"},(()=>{e.removeAttribute("custom-reminder-wechat"),s.destroy()})))})),r[2].addEventListener("click",(()=>{const n=s.element.querySelector("input").value;if(n){if(new Date(n)<=new Date)return void(0,d.showMessage)(window.siyuan.languages.reminderTip);if(r[2].getAttribute("disabled"))return;r[2].setAttribute("disabled","disabled");const i=w(n).format("YYYYMMDDHHmmss");(0,u.fetchPost)("/api/block/setBlockReminder",{id:t,timed:i},(()=>{e.setAttribute("custom-reminder-wechat",i),s.destroy()}))}else(0,d.showMessage)(window.siyuan.languages.notEmpty)}))};t.openFileWechatNotify=e=>{(0,u.fetchPost)("/api/block/getDocInfo",{id:e.block.rootID},(t=>{const n=t.data.ial["custom-reminder-wechat"];let i="";n&&(i=w(n).format("YYYY-MM-DDTHH:mm"));const a=new p.Dialog({width:(0,o.isMobile)()?"80vw":"50vw",title:window.siyuan.languages.wechatReminder,content:`<div class="b3-dialog__content custom-attr">\n    <div class="fn__flex">\n        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.notifyTime}</span>\n        <div class="fn__space"></div>\n        <input class="b3-text-field fn__flex-1" type="datetime-local" value="${i}">\n    </div>\n    <div class="b3-label__text" style="text-align: center">${window.siyuan.languages.wechatTip}</div>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.remove}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`}),s=a.element.querySelectorAll(".b3-button");s[0].addEventListener("click",(()=>{a.destroy()})),s[1].addEventListener("click",(()=>{(0,u.fetchPost)("/api/block/setBlockReminder",{id:e.block.rootID,timed:"0"},(()=>{a.destroy()}))})),s[2].addEventListener("click",(()=>{const t=a.element.querySelector("input").value;if(t){if(new Date(t)<=new Date)return void(0,d.showMessage)(window.siyuan.languages.reminderTip);(0,u.fetchPost)("/api/block/setBlockReminder",{id:e.block.rootID,timed:w(t).format("YYYYMMDDHHmmss")},(()=>{a.destroy()}))}else(0,d.showMessage)(window.siyuan.languages.notEmpty)}))}))};t.openFileAttr=(e,t,n="bookmark")=>{let a="",s="";Object.keys(e).forEach((t=>{"custom-reminder-wechat"===t?s=`<label class="fn__flex customItem">\n    <span class="ft__on-surface fn__flex-center fn__ellipsis" style="text-align: right;width: 100px">${window.siyuan.languages.wechatReminder}</span>\n    <div class="fn__space"></div>\n    <input class="b3-text-field fn__flex-1" type="datetime-local" readonly data-name="${t}" value="${w(e[t]).format("YYYY-MM-DDTHH:mm")}">\n    <div class="fn__space"></div>\n    <span class="block__icon fn__flex-center" style="opacity: 1;"><svg></svg></span>\n</label><div class="fn__hr--b"></div>`:t.indexOf("custom")>-1&&(a+=`<label class="fn__flex customItem">\n    <span class="ft__on-surface fn__flex-center fn__ellipsis" title="${t.replace("custom-","")}" style="text-align: right;width: 100px">${t.replace("custom-","")}</span>\n    <div class="fn__space"></div>\n    <textarea class="b3-text-field fn__flex-1" rows="1" data-name="${t}">${e[t]}</textarea>\n    <div class="fn__space"></div>\n    <span data-action="remove" class="block__icon fn__flex-center" style="opacity: 1;"><svg><use xlink:href="#iconMin"></use></svg></span>\n</label><div class="fn__hr--b"></div>`)}));const c=new p.Dialog({width:(0,o.isMobile)()?"80vw":"50vw",title:window.siyuan.languages.attr,content:`<div class="b3-dialog__content custom-attr">\n    <div class="fn__flex">\n        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.bookmark}</span>\n        <div class="fn__space"></div>\n        <input class="b3-text-field fn__flex-1" data-name="bookmark">\n        <div class="fn__space"></div>\n        <span data-action="bookmark" class="block__icon fn__flex-center" style="opacity: 1;"><svg><use xlink:href="#iconDown"></use></svg></span>\n    </div>\n    <div class="fn__hr--b"></div>\n    <label class="fn__flex">\n        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.name}</span>\n        <div class="fn__space"></div>\n        <input class="b3-text-field fn__flex-1" data-name="name">\n        <div class="fn__space"></div>\n        <span class="block__icon fn__flex-center"><svg></svg></span>\n    </label>\n    <div class="fn__hr--b"></div>\n    <label class="fn__flex">\n        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.alias}</span>\n        <div class="fn__space"></div>\n        <input class="b3-text-field fn__flex-1" data-name="alias">\n        <div class="fn__space"></div>\n        <span class="block__icon fn__flex-center"><svg></svg></span>\n    </label>\n    <div class="fn__hr--b"></div>\n    <label class="fn__flex">\n        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.memo}</span>\n        <div class="fn__space"></div>\n        <textarea rows="2" class="b3-text-field fn__flex-1" data-name="memo">${e.memo||""}</textarea>\n        <div class="fn__space"></div>\n        <span class="block__icon fn__flex-center"><svg></svg></span>\n    </label>\n    <div style="background-color: var(--b3-border-color);height: 1px;margin: 16px 0;"></div>\n    <div class="custom-attr__add">\n        ${s}\n        ${a}\n        <button class="b3-button b3-button--outline" style="width: 100px">\n            <svg><use xlink:href="#iconAdd"></use></svg>\n            ${window.siyuan.languages.addAttr}\n        </button>\n    </div>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`});c.element.querySelector('.b3-text-field[data-name="bookmark"]').value=e.bookmark||"",c.element.querySelector('.b3-text-field[data-name="name"]').value=e.name||"",c.element.querySelector('.b3-text-field[data-name="alias"]').value=e.alias||"";const h=[];c.element.addEventListener("click",(e=>{const t=e.target,n=(0,l.hasClosestByClassName)(t,"block__icon");if(n)switch(n.getAttribute("data-action")){case"remove":"SPAN"===n.parentElement.firstElementChild.tagName&&h.push(n.parentElement.querySelector("textarea").getAttribute("data-name")),n.parentElement.nextElementSibling.remove(),n.parentElement.remove();break;case"bookmark":(0,u.fetchPost)("/api/attr/getBookmarkLabels",{},(t=>{window.siyuan.menus.menu.remove(),0===t.data.length?window.siyuan.menus.menu.append(new r.MenuItem({label:window.siyuan.languages.emptyContent,type:"readonly"}).element):t.data.forEach((e=>{window.siyuan.menus.menu.append(new r.MenuItem({label:e,click(){n.parentElement.querySelector("input").value=e}}).element)})),window.siyuan.menus.menu.element.style.zIndex="310",window.siyuan.menus.menu.popup({x:e.clientX,y:e.clientY+16})}))}}));const f=c.element.querySelectorAll(".b3-button");f[0].addEventListener("click",(()=>{f[0].insertAdjacentHTML("beforebegin",`<div class="fn__flex customItem">\n    <input placeholder="${window.siyuan.languages.attrName}" class="b3-text-field" style="width: 100px;text-align: right">\n    <div class="fn__space"></div>\n    <textarea rows="1" class="b3-text-field fn__flex-1" placeholder="${window.siyuan.languages.attrValue1}"></textarea>\n    <div class="fn__space"></div>\n    <span data-action="remove" class="block__icon fn__flex-center" style="opacity: 1;"><svg><use xlink:href="#iconMin"></use></svg></span>\n</div><div class="fn__hr--b"></div>`);const e=c.element.querySelectorAll(".b3-text-field");e[e.length-2].focus(),k(e[e.length-1],f[2]),k(e[e.length-2],f[2])})),f[1].addEventListener("click",(()=>{c.destroy()})),f[2].addEventListener("click",(()=>{let n="",a="";const o={};c.element.querySelectorAll(".fn__flex-1").forEach((e=>{const t=e.getAttribute("data-name")||"custom-"+e.previousElementSibling.previousElementSibling.value;if(e.value.trim()){if(!/^[0-9a-zA-Z\-]*$/.test(t.replace("custom-",""))||"custom-"===t)return void(a+=t.replace("custom-","")+", ");o[t]=e.value;const i=Lute.EscapeHTMLStr(e.value);"bookmark"===t?n+=`<div class="protyle-attr--bookmark">${i}</div>`:"name"===t?n+=`<div class="protyle-attr--name"><svg><use xlink:href="#iconN"></use></svg>${i}</div>`:"alias"===t?n+=`<div class="protyle-attr--alias"><svg><use xlink:href="#iconA"></use></svg>${i}</div>`:"memo"===t&&(n+=`<div class="protyle-attr--memo b3-tooltips b3-tooltips__sw" aria-label="${i}"><svg><use xlink:href="#iconM"></use></svg></div>`)}})),a&&(0,d.showMessage)(a.substr(0,a.length-2)+" "+window.siyuan.languages.invalid),(0,g.getAllModels)().editor.forEach((e=>{if(e.editor.protyle.block.rootID===t){const t=e.editor.protyle.title.element.querySelector(".protyle-attr--refcount");t&&(n+=t.outerHTML),e.editor.protyle.title.element.querySelector(".protyle-attr").innerHTML=n,e.editor.protyle.wysiwyg.renderCustom(o)}})),(0,u.fetchPost)("/api/attr/resetBlockAttrs",{id:t,attrs:o},(()=>{if(o.bookmark!==e.bookmark){const e=(0,i.getDockByType)("bookmark").data.bookmark;e instanceof m.Bookmark&&e.update()}})),c.destroy()})),c.element.querySelectorAll(".b3-text-field").forEach((e=>{n===e.getAttribute("data-name")&&e.focus(),k(e,f[2])}))};t.openAttr=(e,t,n="bookmark")=>{if("NodeThematicBreak"===e.getAttribute("data-type"))return;const a=e.getAttribute("data-node-id"),s=(0,h.getEditorRange)(e);(0,u.fetchPost)("/api/attr/getBlockAttrs",{id:a},(c=>{let g="",y="";Object.keys(c.data).forEach((e=>{"custom-reminder-wechat"===e?y=`<label class="fn__flex customItem">\n    <span class="ft__on-surface fn__flex-center fn__ellipsis" style="text-align: right;width: 100px">${window.siyuan.languages.wechatReminder}</span>\n    <div class="fn__space"></div>\n    <input class="b3-text-field fn__flex-1" type="datetime-local" readonly data-name="${e}" value="${w(c.data[e]).format("YYYY-MM-DDTHH:mm")}">\n    <div class="fn__space"></div>\n    <span class="block__icon fn__flex-center" style="opacity: 1;"><svg></svg></span>\n</label><div class="fn__hr--b"></div>`:e.indexOf("custom")>-1&&"custom-reminder-wechat"!==e&&(g+=`<label class="fn__flex customItem">\n    <span class="ft__on-surface fn__flex-center fn__ellipsis" style="text-align: right;width: 100px" title="${e.replace("custom-","")}">${e.replace("custom-","")}</span>\n    <div class="fn__space"></div>\n    <textarea class="b3-text-field fn__flex-1" rows="1" data-name="${e}">${c.data[e]}</textarea>\n    <div class="fn__space"></div>\n    <span data-action="remove" class="block__icon fn__flex-center" style="opacity: 1;"><svg><use xlink:href="#iconMin"></use></svg></span>\n</label><div class="fn__hr--b"></div>`)}));const b=new p.Dialog({width:(0,o.isMobile)()?"80vw":"50vw",title:window.siyuan.languages.attr,content:`<div class="b3-dialog__content custom-attr">\n    <div class="fn__flex">\n        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.bookmark}</span>\n        <div class="fn__space"></div>\n        <input class="b3-text-field fn__flex-1" data-name="bookmark">\n        <div class="fn__space"></div>\n        <span data-action="bookmark" class="block__icon fn__flex-center" style="opacity: 1;"><svg><use xlink:href="#iconDown"></use></svg></span>\n    </div>\n    <div class="fn__hr--b"></div>\n    <label class="fn__flex">\n        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.name}</span>\n        <div class="fn__space"></div>\n        <input class="b3-text-field fn__flex-1" data-name="name">\n        <div class="fn__space"></div>\n        <span class="block__icon fn__flex-center"><svg></svg></span>\n    </label>\n    <div class="fn__hr--b"></div>\n    <label class="fn__flex">\n        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.alias}</span>\n        <div class="fn__space"></div>\n        <input class="b3-text-field fn__flex-1" data-name="alias">\n        <div class="fn__space"></div>\n        <span class="block__icon fn__flex-center"><svg></svg></span>\n    </label>\n    <div class="fn__hr--b"></div>\n    <label class="fn__flex">\n        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.memo}</span>\n        <div class="fn__space"></div>\n        <textarea class="b3-text-field fn__flex-1" rows="2" data-name="memo">${c.data.memo||""}</textarea>\n        <div class="fn__space"></div>\n        <span class="block__icon fn__flex-center"><svg></svg></span>\n    </label>\n    <div style="background-color: var(--b3-border-color);height: 1px;margin: 16px 0;"></div>\n    <div class="custom-attr__add">\n        ${y}\n        ${g}\n        <button class="b3-button b3-button--outline" style="width: 100px">\n            <svg><use xlink:href="#iconAdd"></use></svg>\n            ${window.siyuan.languages.addAttr}\n        </button>\n    </div>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,destroyCallback(){(0,h.focusByRange)(s)}});b.element.querySelector('.b3-text-field[data-name="bookmark"]').value=c.data.bookmark||"",b.element.querySelector('.b3-text-field[data-name="name"]').value=c.data.name||"",b.element.querySelector('.b3-text-field[data-name="alias"]').value=c.data.alias||"";const v=[];b.element.addEventListener("click",(e=>{const t=e.target,n=(0,l.hasClosestByClassName)(t,"block__icon");if(n)switch(n.getAttribute("data-action")){case"remove":"SPAN"===n.parentElement.firstElementChild.tagName&&v.push(n.parentElement.querySelector("textarea").getAttribute("data-name")),n.parentElement.nextElementSibling.remove(),n.parentElement.remove();break;case"bookmark":(0,u.fetchPost)("/api/attr/getBookmarkLabels",{},(t=>{window.siyuan.menus.menu.remove(),0===t.data.length?window.siyuan.menus.menu.append(new r.MenuItem({label:window.siyuan.languages.emptyContent,type:"readonly"}).element):t.data.forEach((e=>{window.siyuan.menus.menu.append(new r.MenuItem({label:e,click(){n.parentElement.querySelector("input").value=e}}).element)})),window.siyuan.menus.menu.element.style.zIndex="310",window.siyuan.menus.menu.popup({x:e.clientX,y:e.clientY+16})}))}}));const E=b.element.querySelectorAll(".b3-button");E[0].addEventListener("click",(()=>{E[0].insertAdjacentHTML("beforebegin",`<div class="fn__flex customItem">\n    <input placeholder="${window.siyuan.languages.attrName}" class="b3-text-field" style="width: 100px;text-align: right">\n    <div class="fn__space"></div>\n    <textarea class="b3-text-field fn__flex-1" rows="1" placeholder="${window.siyuan.languages.attrValue1}"></textarea>\n    <div class="fn__space"></div>\n    <span data-action="remove" class="block__icon fn__flex-center" style="opacity: 1;"><svg><use xlink:href="#iconMin"></use></svg></span>\n</div><div class="fn__hr--b"></div>`);const e=b.element.querySelectorAll(".b3-text-field");e[e.length-2].focus(),k(e[e.length-1],E[2]),k(e[e.length-2],E[2])})),E[1].addEventListener("click",(()=>{b.destroy()})),E[2].addEventListener("click",(()=>{let n="";const o=e.outerHTML;let s="";b.element.querySelectorAll(".fn__flex-1").forEach((t=>{const a=t.getAttribute("data-name")||"custom-"+t.previousElementSibling.previousElementSibling.value;if(t.value.trim()){if(!/^[0-9a-zA-Z\-]*$/.test(a.replace("custom-",""))||"custom-"===a)return void(s+=a.replace("custom-","")+", ");v.includes(a)&&v.find(((e,t)=>{if(e===a)return v.splice(t,1),!0}));const o=Lute.EscapeHTMLStr(t.value);if(e.setAttribute(a,o),"bookmark"===a){if(o!==c.data.bookmark){const e=(0,i.getDockByType)("bookmark").data.bookmark;e instanceof m.Bookmark&&setTimeout((()=>{e.update()}),219)}n+=`<div class="protyle-attr--bookmark">${o}</div>`}else"name"===a?n+=`<div class="protyle-attr--name"><svg><use xlink:href="#iconN"></use></svg>${o}</div>`:"alias"===a?n+=`<div class="protyle-attr--alias"><svg><use xlink:href="#iconA"></use></svg>${o}</div>`:"memo"===a&&(n+=`<div class="protyle-attr--memo b3-tooltips b3-tooltips__sw" aria-label="${o}"><svg><use xlink:href="#iconM"></use></svg></div>`)}else e.removeAttribute(a)})),v.forEach((t=>{e.removeAttribute(t)})),s&&(0,d.showMessage)(s.substr(0,s.length-2)+" "+window.siyuan.languages.invalid);const r=e.lastElementChild.querySelector(".protyle-attr--refcount");r&&(n+=r.outerHTML),e.lastElementChild.innerHTML=n+_.Constants.ZWSP,(0,f.updateTransaction)(t,a,e.outerHTML,o),b.destroy()})),b.element.querySelectorAll(".b3-text-field").forEach((e=>{n===e.getAttribute("data-name")&&e.focus(),k(e,E[2])}))}))};t.copySubMenu=(e,t,n=!0,i)=>[{icon:"iconGraph",accelerator:n?window.siyuan.config.keymap.editor.general.copyBlockRef.custom:void 0,label:window.siyuan.languages.copyBlockRef,click:()=>{t?(0,c.writeText)(`((${e} "${t}"))`):(0,u.fetchPost)("/api/block/getRefText",{id:e},(t=>{(0,c.writeText)(`((${e} '${t.data}'))`)})),i&&(0,h.focusBlock)(i)}},{icon:"iconSQL",label:window.siyuan.languages.copyBlockEmbed,accelerator:n?window.siyuan.config.keymap.editor.general.copyBlockEmbed.custom:void 0,click:()=>{(0,c.writeText)(`{{select * from blocks where id='${e}'}}`),i&&(0,h.focusBlock)(i)}},{icon:"iconSiYuan",label:window.siyuan.languages.copyProtocol,accelerator:n?window.siyuan.config.keymap.editor.general.copyProtocol.custom:void 0,click:()=>{(0,c.writeText)(`siyuan://blocks/${e}`),i&&(0,h.focusBlock)(i)}},{label:window.siyuan.languages.copyHPath,accelerator:n?window.siyuan.config.keymap.editor.general.copyHPath.custom:void 0,click:()=>{(0,u.fetchPost)("/api/filetree/getHPathByID",{id:e},(e=>{(0,c.writeText)(e.data)}))}},{label:window.siyuan.languages.copyID,accelerator:n?window.siyuan.config.keymap.editor.general.copyID.custom:void 0,click:()=>{(0,c.writeText)(e),i&&(0,h.focusBlock)(i)}}];t.exportMd=e=>new r.MenuItem({label:window.siyuan.languages.export,type:"submenu",icon:"iconUpload",submenu:[{label:window.siyuan.languages.template,icon:"iconMarkdown",click:()=>{(0,u.fetchPost)("/api/template/docSaveAsTemplate",{id:e,overwrite:!1},(t=>{1!==t.code?(0,d.showMessage)(window.siyuan.languages.exportTplSucc):(0,a.confirmDialog)(window.siyuan.languages.export,window.siyuan.languages.exportTplTip,(()=>{(0,u.fetchPost)("/api/template/docSaveAsTemplate",{id:e,overwrite:!0})}))}))}},{label:"Markdown",icon:"iconMarkdown",click:()=>{const t=(0,d.showMessage)(window.siyuan.languages.exporting,-1);(0,u.fetchPost)("/api/export/exportMd",{id:e},(e=>{(0,d.hideMessage)(t),(0,c.openByMobile)(e.data.zip)}))}},{label:"SiYuan .sy.zip",icon:"iconSiYuan",click:()=>{const t=(0,d.showMessage)(window.siyuan.languages.exporting,-1);(0,u.fetchPost)("/api/export/exportSY",{id:e},(e=>{(0,d.hideMessage)(t),(0,c.openByMobile)(e.data.zip)}))}}]}).element;t.openMenu=(e,t,n)=>{const i=[];if((0,s.isLocalPath)(e)&&_.Constants.SIYUAN_ASSETS_EXTS.includes((0,s.pathPosix)().extname(e))&&(!e.endsWith(".pdf")||e.endsWith(".pdf")&&!e.startsWith("file://"))&&i.push({label:window.siyuan.languages.insertRight,accelerator:n?"Click":"",click(){(0,y.openAsset)(e.trim(),parseInt((0,o.getSearch)("page",e)),"right")}}),i.push({label:window.siyuan.languages.useBrowserView,accelerator:n?"Click":"",click:()=>{(0,c.openByMobile)(e)}}),t)return i;window.siyuan.menus.menu.append(new r.MenuItem({label:window.siyuan.languages.openBy,submenu:i}).element)};t.deleteMenu=(e,t,n)=>new r.MenuItem({icon:"iconTrashcan",label:window.siyuan.languages.delete,accelerator:"⌦",click:()=>{(0,E.deleteFile)(e,n,t)}}).element;t.renameMenu=e=>new r.MenuItem({accelerator:window.siyuan.config.keymap.editor.general.rename.custom,label:window.siyuan.languages.rename,click:()=>{(0,b.rename)(e)}}).element;t.movePathToMenu=(e,t)=>new r.MenuItem({label:window.siyuan.languages.move,icon:"iconMove",accelerator:window.siyuan.config.keymap.general.move.custom,click(){(0,s.movePathTo)(e,t)}}).element},3890:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initDockMenu=void 0;const i=n(2640),a=(e,t)=>new i.MenuItem({label:window.siyuan.languages[e],icon:e.replace("moveTo","icon"),click:()=>{e.indexOf("moveToLeft")>-1?window.siyuan.layout.leftDock.add(e.endsWith("Top")?0:1,t):e.indexOf("moveToRight")>-1?window.siyuan.layout.rightDock.add(e.endsWith("Top")?0:1,t):e.indexOf("moveToTop")>-1?window.siyuan.layout.topDock.add(e.endsWith("Left")?0:1,t):e.indexOf("moveToBottom")>-1&&window.siyuan.layout.bottomDock.add(e.endsWith("Left")?0:1,t)}});t.initDockMenu=e=>(window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(a("moveToLeftTop",e).element),window.siyuan.menus.menu.append(a("moveToLeftBottom",e).element),window.siyuan.menus.menu.append(a("moveToRightTop",e).element),window.siyuan.menus.menu.append(a("moveToRightBottom",e).element),window.siyuan.menus.menu.append(a("moveToTopLeft",e).element),window.siyuan.menus.menu.append(a("moveToTopRight",e).element),window.siyuan.menus.menu.append(a("moveToBottomLeft",e).element),window.siyuan.menus.menu.append(a("moveToBottomRight",e).element),window.siyuan.menus.menu)},3024:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Menus=void 0;const i=n(3371),a=n(4974),o=n(3890),s=n(9472),r=n(8922),l=n(2640),c=n(3607);t.Menus=class{constructor(){this.menu=new l.Menu,window.addEventListener("contextmenu",(e=>{let t=e.target;for(;t&&!t.parentElement.isEqualNode(document.querySelector("body"));){e.preventDefault();const n=t.getAttribute("data-type");if("tab-header"===n){this.unselect(),(0,r.initTabMenu)((0,i.getInstanceById)(t.getAttribute("data-id"))).popup({x:e.clientX,y:e.clientY}),e.stopPropagation();break}if("navigation-root"===n&&!window.siyuan.config.readonly){if(t.querySelector(".b3-list-item__text").classList.contains("ft__on-surface"))return;this.unselect(),(0,s.initNavigationMenu)(t).popup({x:e.clientX,y:e.clientY}),e.stopPropagation();break}if("navigation-file"===n){this.unselect(),(0,s.initFileMenu)(this.getDir(t),t.getAttribute("data-path"),t).popup({x:e.clientX,y:e.clientY}),e.stopPropagation();break}if("search-item"===n){(0,a.initSearchMenu)(t.getAttribute("data-node-id")).popup({x:e.clientX,y:e.clientY}),e.stopPropagation();break}if(t.classList.contains("dock__item")){(0,o.initDockMenu)(t).popup({x:e.clientX,y:e.clientY}),e.stopPropagation();break}t=t.parentElement}}),!1)}getDir(e){const t=(0,c.hasTopClosestByTag)(e,"UL");if(t)return t.getAttribute("data-url")}unselect(){getSelection().rangeCount>0&&getSelection().getRangeAt(0).collapse(!0)}}},9472:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initFileMenu=t.initNavigationMenu=void 0;const i=n(8120),a=n(2640),o=n(8813),s=n(1890),r=n(734),l=n(6619),c=n(5031),u=n(9516),d=n(1377),p=n(8792),h=n(4779);t.initNavigationMenu=e=>{const t=e.parentElement.getAttribute("data-url"),n=(0,o.getNotebookName)(t);return window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new a.MenuItem({icon:"iconFile",label:window.siyuan.languages.newFile,click:()=>{(0,h.newFile)(t,"/",!0)}}).element),window.siyuan.menus.menu.append(new a.MenuItem({type:"separator"}).element),window.siyuan.config.readonly||window.siyuan.menus.menu.append((0,i.renameMenu)({path:"/",notebookId:t,name:n,type:"notebook"})),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.config,icon:"iconSettings",click:()=>{(0,r.fetchPost)("/api/notebook/getNotebookConf",{notebook:t},(e=>{(0,l.onGetnotebookconf)(e.data)}))}}).element),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.search,accelerator:window.siyuan.config.keymap.general.search.custom,icon:"iconSearch",click(){(0,c.openSearch)(window.siyuan.config.keymap.general.search.custom,void 0,t)}}).element),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.replace,accelerator:window.siyuan.config.keymap.general.replace.custom,click(){(0,c.openSearch)(window.siyuan.config.keymap.general.replace.custom,void 0,t)}}).element),window.siyuan.config.readonly||(window.siyuan.menus.menu.append(new a.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.close,icon:"iconClose",click:()=>{(0,r.fetchPost)("/api/notebook/closeNotebook",{notebook:t})}}).element),window.siyuan.menus.menu.append(new a.MenuItem({icon:"iconTrashcan",label:window.siyuan.languages.delete,accelerator:"⌦",click:()=>{(0,d.confirmDialog)(window.siyuan.languages.delete,`${window.siyuan.languages.confirmDelete} <b>${Lute.EscapeHTMLStr(n)}</b>?`,(()=>{(0,r.fetchPost)("/api/notebook/removeNotebook",{notebook:t,callback:p.Constants.CB_MOUNT_REMOVE})}))}}).element)),window.siyuan.menus.menu.append(new a.MenuItem({type:"separator"}).element),f(t,"/"),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.export,type:"submenu",icon:"iconUpload",submenu:[{label:"Markdown",icon:"iconMarkdown",click:()=>{const e=(0,s.showMessage)(window.siyuan.languages.exporting,-1);(0,r.fetchPost)("/api/export/batchExportMd",{notebook:t,path:"/"},(t=>{(0,s.hideMessage)(e),window.open(t.data.zip)}))}},{label:"SiYuan .sy.zip",icon:"iconSiYuan",click:()=>{const e=(0,s.showMessage)(window.siyuan.languages.exporting,-1);(0,r.fetchPost)("/api/export/exportNotebookSY",{id:t},(t=>{(0,s.hideMessage)(e),window.open(t.data.zip)}))}}]}).element),window.siyuan.menus.menu};t.initFileMenu=(e,t,n)=>{const s=n.getAttribute("data-node-id");let l=n.getAttribute("data-name");window.siyuan.menus.menu.remove(),l=(0,o.getDisplayName)(l,!1,!0),window.siyuan.config.readonly||(window.siyuan.menus.menu.append(new a.MenuItem({icon:"iconFile",label:window.siyuan.languages.newSubDoc,click:()=>{(0,h.newFile)(e,t,!0)}}).element),6===window.siyuan.config.fileTree.sort&&(window.siyuan.menus.menu.append(new a.MenuItem({icon:"iconBefore",label:window.siyuan.languages.newDocAbove,click:()=>{const i=[];Array.from(n.parentElement.children).forEach((e=>{"LI"===e.tagName&&(e.isSameNode(n)&&i.push(void 0),i.push(e.getAttribute("data-path")))})),(0,h.newFile)(e,(0,o.pathPosix)().dirname(t),!0,i)}}).element),window.siyuan.menus.menu.append(new a.MenuItem({icon:"iconAfter",label:window.siyuan.languages.newDocBelow,click:()=>{const i=[];Array.from(n.parentElement.children).forEach((e=>{"LI"===e.tagName&&(i.push(e.getAttribute("data-path")),e.isSameNode(n)&&i.push(void 0))})),(0,h.newFile)(e,(0,o.pathPosix)().dirname(t),!0,i)}}).element)),window.siyuan.menus.menu.append(new a.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.copy,type:"submenu",icon:"iconCopy",submenu:(0,i.copySubMenu)(s,"",!1).concat([{label:window.siyuan.languages.duplicate,click(){(0,r.fetchPost)("/api/filetree/duplicateDoc",{id:s})}}])}).element),window.siyuan.menus.menu.append((0,i.movePathToMenu)(e,t)),window.siyuan.menus.menu.append((0,i.deleteMenu)(e,l,t)),window.siyuan.menus.menu.append(new a.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append((0,i.renameMenu)({path:t,notebookId:e,name:l,type:"file"})),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.attr,click(){(0,r.fetchPost)("/api/block/getDocInfo",{id:s},(e=>{(0,i.openFileAttr)(e.data.ial,s)}))}}).element),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.search,icon:"iconSearch",accelerator:window.siyuan.config.keymap.general.search.custom,click(){(0,c.openSearch)(window.siyuan.config.keymap.general.search.custom,void 0,e,(0,o.getDisplayName)(t,!1,!0))}}).element),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.replace,accelerator:window.siyuan.config.keymap.general.replace.custom,click(){(0,c.openSearch)(window.siyuan.config.keymap.general.replace.custom,void 0,e,(0,o.getDisplayName)(t,!1,!0))}}).element),window.siyuan.menus.menu.append(new a.MenuItem({type:"separator"}).element));const d=[{icon:"iconRight",label:window.siyuan.languages.insertRight,accelerator:"⌥Click",click:()=>{(0,u.openFileById)({id:s,position:"right",action:[p.Constants.CB_GET_FOCUS]})}},{icon:"iconDown",label:window.siyuan.languages.insertBottom,click:()=>{(0,u.openFileById)({id:s,position:"bottom",action:[p.Constants.CB_GET_FOCUS]})}}];return window.siyuan.config.fileTree.openFilesUseCurrentTab&&d.push({label:window.siyuan.languages.openInNewTab,accelerator:"⌘Click",click:()=>{window.siyuan.ctrlIsPressed=!0,(0,u.openFileById)({id:s,action:[p.Constants.CB_GET_FOCUS]}),setTimeout((()=>{window.siyuan.ctrlIsPressed=!1}),p.Constants.TIMEOUT_INPUT)}}),d.push({type:"separator"}),d.push({icon:"iconPreview",label:window.siyuan.languages.preview,click:()=>{(0,u.openFileById)({id:s,mode:"preview"})}}),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.openBy,submenu:d}).element),f(e,t),window.siyuan.menus.menu.append((0,i.exportMd)(s)),window.siyuan.menus.menu};const f=(e,t)=>{window.siyuan.config.readonly||window.siyuan.menus.menu.append(new a.MenuItem({icon:"iconDownload",label:window.siyuan.languages.import,submenu:[{icon:"iconSiYuan",label:'SiYuan .sy.zip<input class="b3-form__upload" type="file" accept="application/zip">',bind:n=>{n.querySelector(".b3-form__upload").addEventListener("change",(n=>{const i=new FormData;i.append("file",n.target.files[0]),i.append("notebook",e),i.append("toPath",t),(0,r.fetchPost)("/api/import/importSY",i)}))}}]}).element)}},6619:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onGetnotebookconf=void 0;const i=n(9866),a=n(734),o=n(3274),s=n(3863),r=n(7954),l=n(1890);t.onGetnotebookconf=e=>{const t=`<div class="fn__flex">${(0,s.escapeHtml)(e.name)}\n<div class="fn__space"></div>\n<button class="b3-button b3-button--small">${window.siyuan.languages.copy} ID</button></div>`,n=`<div style="max-height: 80vh;overflow: auto;">\n<div class="b3-label">\n    ${window.siyuan.languages.fileTree12}\n    <div class="fn__hr"></div>\n    <div class="b3-label__text">${window.siyuan.languages.fileTree13}</div>\n    <div class="fn__hr"></div>\n    <input class="b3-text-field fn__flex-center fn__block" id="createDocNameTemplate" value="">\n</div>\n<div class="b3-label">\n    ${window.siyuan.languages.fileTree5}\n    <div class="fn__hr"></div>\n    <div class="b3-label__text">${window.siyuan.languages.fileTree6}</div>\n    <div class="fn__hr"></div>\n    <input class="b3-text-field fn__flex-center fn__block" id="refCreateSavePath" value="${window.siyuan.config.fileTree.refCreateSavePath}">\n</div>\n<div class="b3-label">\n    ${window.siyuan.languages.fileTree11}\n    <div class="fn__hr"></div>\n    <div class="b3-label__text">${window.siyuan.languages.fileTree14}</div>\n    <div class="fn__hr"></div>\n    <input class="b3-text-field fn__flex-center fn__block" id="dailyNoteSavePath" value="">\n    <div class="fn__hr"></div>\n    <div class="b3-label__text">${window.siyuan.languages.fileTree15}</div>\n    <div class="fn__hr"></div>\n    <input class="b3-text-field fn__flex-center fn__block" id="dailyNoteTemplatePath" value="${e.conf.dailyNoteTemplatePath}">\n</div></div>`;let c;if((0,o.isMobile)())c=document.getElementById("model"),c.style.top="0",c.querySelector(".toolbar__icon").innerHTML='<use xlink:href="#iconSettings"></use>',c.querySelector(".toolbar__text").innerHTML=t,c.querySelector("#modelMain").innerHTML=n;else{c=new i.Dialog({width:"80vw",title:t,content:n}).element}c.querySelector(".b3-button--small").addEventListener("click",(()=>{(0,r.writeText)(e.box),(0,l.showMessage)(window.siyuan.languages.copied)}));const u=c.querySelector("#dailyNoteSavePath");u.value=e.conf.dailyNoteSavePath;const d=c.querySelector("#createDocNameTemplate");d.value=e.conf.createDocNameTemplate;const p=c.querySelector("#refCreateSavePath");p.value=e.conf.refCreateSavePath;const h=c.querySelector("#dailyNoteTemplatePath");h.value=e.conf.dailyNoteTemplatePath,c.querySelectorAll("input").forEach((t=>{t.addEventListener("change",(()=>{(0,a.fetchPost)("/api/notebook/setNotebookConf",{notebook:e.box,conf:{refCreateSavePath:p.value,createDocNameTemplate:d.value,dailyNoteSavePath:u.value,dailyNoteTemplatePath:h.value}})}))}))}},407:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setFold=t.tableMenu=t.videoMenu=t.iframeMenu=t.linkMenu=t.imgMenu=t.zoomOut=t.contentMenu=t.refMenu=void 0;const a=n(3607),o=n(2640),s=n(4640),r=n(2287),l=n(8527),c=n(6840),u=n(8120),d=n(734),p=n(8792),h=n(7954),f=n(7870),g=n(7010),m=n(2892),y=n(4705),b=n(9516),v=n(3274),w=n(6919),_=n(1248),E=n(5680),k=n(7822),C=n(8349),D=n(6520),x=n(525),S=n(484),A=n(2292);t.refMenu=(e,t)=>{const n=(0,a.hasClosestBlock)(t);if(!n)return;const i=t.getAttribute("data-id"),r=n.getAttribute("data-node-id"),l=n.outerHTML;window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new o.MenuItem({label:`<input style="margin: 4px 0" class="b3-text-field" placeholder="${window.siyuan.languages.anchor}">`,bind(a){const o=a.querySelector("input");o.value="d"===t.getAttribute("data-subtype")?"":t.textContent,o.addEventListener("blur",(i=>{n.outerHTML!==l&&(n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),t.setAttribute("data-subtype",o.value?"s":"d"),(0,c.updateTransaction)(e,r,n.outerHTML,l)),e.toolbar.range.selectNodeContents(t),e.toolbar.range.collapse(!1),(0,s.focusByRange)(e.toolbar.range),i.stopPropagation()})),o.addEventListener("input",(()=>{o.value?t.textContent=Lute.EscapeHTMLStr(o.value):(0,d.fetchPost)("/api/block/getRefText",{id:i},(e=>{t.innerHTML=e.data}))})),o.addEventListener("keydown",(e=>{if("Enter"!==e.key||e.isComposing){if((0,x.electronUndo)(e))return}else window.siyuan.menus.menu.remove()}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.openBy,accelerator:window.siyuan.config.keymap.editor.general.openBy.custom+"/Click",click(){(0,d.fetchPost)("/api/block/checkBlockFold",{id:i},(e=>{(0,b.openFileById)({id:i,action:e.data?[p.Constants.CB_GET_FOCUS,p.Constants.CB_GET_ALL]:[p.Constants.CB_GET_FOCUS,p.Constants.CB_GET_CONTEXT],zoomIn:e.data})}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.refTab,accelerator:window.siyuan.config.keymap.editor.general.refTab.custom+"/⌘Click",click(){(0,d.fetchPost)("/api/block/checkBlockFold",{id:i},(e=>{(0,b.openFileById)({id:i,action:e.data?[p.Constants.CB_GET_FOCUS,p.Constants.CB_GET_ALL]:[p.Constants.CB_GET_HL,p.Constants.CB_GET_CONTEXT],keepCursor:!0,zoomIn:e.data})}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.insertRight,icon:"iconRight",accelerator:window.siyuan.config.keymap.editor.general.insertRight.custom+"/⌥Click",click(){(0,d.fetchPost)("/api/block/checkBlockFold",{id:i},(e=>{(0,b.openFileById)({id:i,position:"right",action:e.data?[p.Constants.CB_GET_FOCUS,p.Constants.CB_GET_ALL]:[p.Constants.CB_GET_FOCUS,p.Constants.CB_GET_CONTEXT],zoomIn:e.data})}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.insertBottom,icon:"iconDown",accelerator:window.siyuan.config.keymap.editor.general.insertBottom.custom+(window.siyuan.config.keymap.editor.general.insertBottom.custom?"/":"")+"⇧Click",click(){(0,d.fetchPost)("/api/block/checkBlockFold",{id:i},(e=>{(0,b.openFileById)({id:i,position:"bottom",action:e.data?[p.Constants.CB_GET_FOCUS,p.Constants.CB_GET_ALL]:[p.Constants.CB_GET_FOCUS,p.Constants.CB_GET_CONTEXT],zoomIn:e.data})}))}}).element);let u=[];"s"===t.getAttribute("data-subtype")?u.push({label:window.siyuan.languages.turnToDynamic,click(){t.setAttribute("data-subtype","d"),(0,d.fetchPost)("/api/block/getRefText",{id:i},(i=>{t.innerHTML=i.data,n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,r,n.outerHTML,l)})),(0,s.focusByRange)(e.toolbar.range)}}):u.push({label:window.siyuan.languages.turnToStatic,click(){t.setAttribute("data-subtype","s"),n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,r,n.outerHTML,l),(0,s.focusByRange)(e.toolbar.range)}}),u=u.concat([{label:window.siyuan.languages.text,click(){t.outerHTML=`${t.innerHTML}<wbr>`,n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,r,n.outerHTML,l),(0,s.focusByWbr)(n,e.toolbar.range)}},{label:"*",click(){t.setAttribute("data-subtype","s"),t.textContent="*",n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,r,n.outerHTML,l),(0,s.focusByRange)(e.toolbar.range)}},{label:window.siyuan.languages.text+" *",click(){t.insertAdjacentHTML("beforebegin",t.innerHTML+" "),t.setAttribute("data-subtype","s"),t.textContent="*",n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,r,n.outerHTML,l),(0,s.focusByRange)(e.toolbar.range)}},{label:window.siyuan.languages.link,icon:"iconLink",click(){t.outerHTML=`<span data-type="a" data-href="siyuan://blocks/${t.getAttribute("data-id")}">${t.innerHTML}</span><wbr>`,n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,r,n.outerHTML,l),(0,s.focusByWbr)(n,e.toolbar.range)}}]),t.parentElement.textContent.trim()===t.textContent.trim()&&"DIV"===t.parentElement.tagName&&u.push({label:window.siyuan.languages.blockEmbed,icon:"iconSQL",click(){const t=`<div data-content="select * from blocks where id='${i}'" data-node-id="${r}" data-type="NodeBlockQueryEmbed" class="render-node" updated="${E().format("YYYYMMDDHHmmss")}">${n.querySelector(".protyle-attr").outerHTML}</div>`;n.outerHTML=t,(0,c.updateTransaction)(e,r,t,l),(0,k.blockRender)(e,e.wysiwyg.element)}}),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.turnInto,icon:"iconRefresh",submenu:u}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.copy,icon:"iconCopy",click(){const e="s"===t.getAttribute("data-subtype")?'"':"'";(0,h.writeText)(`((${i} ${e}${t.textContent}${e}))`)}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.remove,icon:"iconTrashcan",click(){t.insertAdjacentHTML("afterend","<wbr>"),t.remove(),n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,r,n.outerHTML,l),(0,s.focusByWbr)(n,e.toolbar.range)}}).element);const f=t.getBoundingClientRect();window.siyuan.menus.menu.popup({x:f.left,y:f.top+26,h:26}),window.siyuan.menus.menu.element.querySelector("input").select()};t.contentMenu=(e,n)=>{const r=(0,s.getEditorRange)(n);if(window.siyuan.menus.menu.remove(),""!==r.toString()&&(window.siyuan.menus.menu.append(new o.MenuItem({icon:"iconCopy",accelerator:"⌘C",label:window.siyuan.languages.copy,click(){(0,s.focusByRange)((0,s.getEditorRange)(n)),document.execCommand("copy")}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.copyPlainText,accelerator:window.siyuan.config.keymap.editor.general.copyPlainText.custom,click(){(0,s.focusByRange)((0,s.getEditorRange)(n));const e=getSelection().getRangeAt(0).cloneContents();e.querySelectorAll('[data-type="backslash"]').forEach((e=>{e.firstElementChild.remove()})),(0,h.writeText)(e.textContent)}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.copy+" HTML",click(){(0,s.focusByRange)((0,s.getEditorRange)(n));let t="";getSelection().getRangeAt(0).cloneContents().childNodes.forEach((e=>{3===e.nodeType?t+=e.textContent:t+=e.outerHTML}));const i=document.createElement("template");i.innerHTML=e.lute.BlockDOM2HTML(t),(0,h.writeText)(i.content.firstElementChild.innerHTML)}}).element),window.siyuan.menus.menu.append(new o.MenuItem({icon:"iconCut",accelerator:"⌘X",label:window.siyuan.languages.cut,click(){(0,s.focusByRange)((0,s.getEditorRange)(n)),document.execCommand("cut")}}).element),window.siyuan.menus.menu.append(new o.MenuItem({icon:"iconTrashcan",accelerator:"⌫",label:window.siyuan.languages.delete,click(){const t=(0,s.getEditorRange)(n);t.insertNode(document.createElement("wbr"));const i=n.outerHTML;t.extractContents(),(0,s.focusByWbr)(n,t),(0,s.focusByRange)(t),(0,c.updateTransaction)(e,n.getAttribute("data-node-id"),n.outerHTML,i)}}).element)),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.paste,accelerator:"⌘V",click(){return i(this,void 0,void 0,(function*(){if(document.queryCommandSupported("paste"))document.execCommand("paste");else try{const t=yield navigator.clipboard.readText();(0,y.pasteText)(e,t,n)}catch(e){console.log(e)}}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.pasteEscaped,click(){return i(this,void 0,void 0,(function*(){try{let t=yield navigator.clipboard.readText();t=t.replace(/\\/g,"\\\\").replace(/\*/g,"\\*").replace(/\_/g,"\\_").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\!/g,"\\!").replace(/\`/g,"\\`").replace(/\</g,"\\<").replace(/\>/g,"\\>").replace(/\&/g,"\\&").replace(/\~/g,"\\~").replace(/\{/g,"\\{").replace(/\}/g,"\\}").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\=/g,"\\=").replace(/\#/g,"\\#").replace(/\$/g,"\\$").replace(/\^/g,"\\^").replace(/\|/g,"\\|"),(0,y.pasteText)(e,t,n)}catch(e){console.log(e)}}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.selectAll,accelerator:"⌘A",click(){(0,s.selectAll)(e,n,r)}}).element),n.classList.contains("table")){const i=(0,a.hasClosestByMatchTag)(r.startContainer,"TD")||(0,a.hasClosestByMatchTag)(r.startContainer,"TH");i&&window.siyuan.menus.menu.append(new o.MenuItem({type:"submenu",icon:"iconTable",label:window.siyuan.languages.table,submenu:(0,t.tableMenu)(e,n,i,r)}).element)}};t.zoomOut=(e,t,n,i=!0,a)=>{var o;const r=null===(o=e.breadcrumb)||void 0===o?void 0:o.element.querySelector(".protyle-breadcrumb__item--active");if(r&&r.getAttribute("data-node-id")===t){if(t===e.block.rootID)return;const i=e.wysiwyg.element.querySelector(`[data-node-id="${n||t}"]`);if(i)return(0,s.focusBlock)(i),void i.scrollIntoView()}window.siyuan.mobileEditor&&(window.localStorage.setItem(p.Constants.LOCAL_DOCINFO,JSON.stringify({id:t,action:t===e.block.rootID?[p.Constants.CB_GET_HL,p.Constants.CB_GET_CONTEXT]:[p.Constants.CB_GET_ALL]})),i&&(0,S.pushBack)()),(0,d.fetchPost)("/api/filetree/getDoc",{id:t,size:t===e.block.rootID?p.Constants.SIZE_GET:p.Constants.SIZE_GET_MAX},(o=>{if(i?(0,g.onGet)(o,e,t===e.block.rootID?[p.Constants.CB_GET_FOCUS]:[p.Constants.CB_GET_ALL,p.Constants.CB_GET_FOCUS]):(0,g.onGet)(o,e,t===e.block.rootID?[p.Constants.CB_GET_FOCUS,p.Constants.CB_GET_UNUNDO]:[p.Constants.CB_GET_ALL,p.Constants.CB_GET_FOCUS,p.Constants.CB_GET_UNUNDO]),n){const a=e.wysiwyg.element.querySelector(`[data-node-id="${n}"]`);if(a)(0,s.focusBlock)(a),a.scrollIntoView();else if(t===e.block.rootID)return void(0,d.fetchPost)("/api/filetree/getDoc",{id:n,mode:3,size:p.Constants.SIZE_GET},(t=>{(0,g.onGet)(t,e,i?[p.Constants.CB_GET_FOCUS]:[p.Constants.CB_GET_FOCUS,p.Constants.CB_GET_UNUNDO])}))}e.model&&(0,b.updateBacklinkGraph)((0,m.getAllModels)(),e),a&&a()}))};t.imgMenu=(e,t,n,i)=>{window.siyuan.menus.menu.remove();const r=(0,a.hasClosestBlock)(n);if(!r)return;const d=r.getAttribute("data-node-id"),f=n.querySelector("img"),g=n.querySelector(".protyle-action__title");let m=r.outerHTML;window.siyuan.menus.menu.append(new o.MenuItem({label:`<div class="fn__hr--small"></div><input class="b3-text-field fn__size200" value="${f.getAttribute("src")}" placeholder="${window.siyuan.languages.imageURL}"><div class="fn__hr--small"></div>`,bind(t){t.querySelector("input").addEventListener("change",(t=>{const i=t.target.value;if(f.setAttribute("src",i),f.setAttribute("data-src",i),i.startsWith("assets/")){const e=n.querySelector(".img__net");e&&e.remove()}else window.siyuan.config.editor.displayNetImgMark&&n.querySelector(".protyle-action__drag").insertAdjacentHTML("afterend",'<span class="img__net"><svg><use xlink:href="#iconLanguage"></use></svg></span>');r.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,d,r.outerHTML,m),m=r.outerHTML}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:`<div class="fn__hr--small"></div><input class="b3-text-field fn__size200" placeholder="${window.siyuan.languages.title}"><div class="fn__hr--small"></div>`,bind(t){const i=t.querySelector("input");i.value=g.textContent,i.addEventListener("input",(e=>{const t=e.target.value;f.setAttribute("title",t),g.textContent=t,(0,l.mathRender)(g),n.style.maxWidth=f.clientWidth+10+"px"})),i.addEventListener("change",(()=>{r.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,d,r.outerHTML,m),m=r.outerHTML}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:`<div class="fn__hr--small"></div><input class="b3-text-field fn__size200" placeholder="${window.siyuan.languages.tooltipText}"><div class="fn__hr--small"></div>`,bind(t){const n=t.querySelector("input");n.value=f.getAttribute("alt")||"",n.addEventListener("change",(t=>{f.setAttribute("alt",t.target.value),r.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,d,r.outerHTML,m),m=r.outerHTML}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.copy,accelerator:"⌘C",icon:"iconCopy",click(){(0,h.writeText)(e.lute.BlockDOM2StdMd(n.outerHTML))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.copy+" PNG",icon:"iconImage",click(){if("android"===window.siyuan.config.system.container&&window.JSAndroid)window.JSAndroid.writeImageClipboard(f.getAttribute("src"));else{const e=document.createElement("canvas"),t=document.createElement("img");t.onload=t=>{e.width=t.target.width,e.height=t.target.height,e.getContext("2d").drawImage(t.target,0,0,t.target.width,t.target.height),e.toBlob((e=>{navigator.clipboard.write([new ClipboardItem({"image/png":e})])}),"image/png",1)},t.src=f.getAttribute("src")}}}).element),window.siyuan.menus.menu.append(new o.MenuItem({icon:"iconCut",accelerator:"⌘X",label:window.siyuan.languages.cut,click(){(0,h.writeText)(e.lute.BlockDOM2StdMd(n.outerHTML)),n.outerHTML="<wbr>",r.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,d,r.outerHTML,m),(0,s.focusByWbr)(e.wysiwyg.element,t)}}).element),window.siyuan.menus.menu.append(new o.MenuItem({icon:"iconTrashcan",accelerator:"⌫",label:window.siyuan.languages.delete,click:function(){n.outerHTML="<wbr>",r.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,d,r.outerHTML,m),(0,s.focusByWbr)(e.wysiwyg.element,t)}}).element),window.siyuan.menus.menu.append(new o.MenuItem({type:"separator"}).element);const y=f.getAttribute("data-src");y.startsWith("assets/")&&window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.rename,click(){(0,C.renameAsset)(y)}}).element),window.siyuan.menus.menu.append(new o.MenuItem({icon:"iconAlignCenter",label:window.siyuan.languages.alignCenter,accelerator:window.siyuan.config.keymap.editor.general.alignCenter.custom,click(){r.setAttribute("updated",E().format("YYYYMMDDHHmmss")),n.style.display="block";let t=n.nextSibling;for(;t;){if(""!==t.textContent){if(t.textContent===p.Constants.ZWSP){t.textContent="";break}break}t=t.nextSibling}(0,c.updateTransaction)(e,d,r.outerHTML,m)}}).element),window.siyuan.menus.menu.append(new o.MenuItem({icon:"iconAlignLeft",label:window.siyuan.languages.alignLeft,accelerator:window.siyuan.config.keymap.editor.general.alignLeft.custom,click(){r.setAttribute("updated",E().format("YYYYMMDDHHmmss")),n.style.display="",(0,D.hasNextSibling)(n)||n.insertAdjacentText("afterend",p.Constants.ZWSP),(0,c.updateTransaction)(e,d,r.outerHTML,m)}}).element);const b=parseInt(n.style.width||"0");window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.width,submenu:[L("25%",n,f,e,d,r,m),L("33%",n,f,e,d,r,m),L("50%",n,f,e,d,r,m),L("67%",n,f,e,d,r,m),L("75%",n,f,e,d,r,m),L("100%",n,f,e,d,r,m),{type:"separator"},{label:`<div aria-label="${0===b?window.siyuan.languages.default:b+"%"}" class="b3-tooltips b3-tooltips__n${(0,v.isMobile)()?"":" fn__size200"}">\n    <input style="box-sizing: border-box" value="${b}" class="b3-slider fn__block" max="100" min="1" step="1" type="range">\n</div>`,bind(t){const i=t.querySelector("input");i.addEventListener("input",(()=>{n.style.width=i.value+"%",f.style.width="10000px",n.style.maxWidth="",i.parentElement.setAttribute("aria-label",`${i.value}%`)})),i.addEventListener("change",(()=>{r.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,d,r.outerHTML,m),window.siyuan.menus.menu.remove(),(0,s.focusBlock)(r)}))}},{type:"separator"},L(window.siyuan.languages.default,n,f,e,d,r,m)]}).element);const w=f.getAttribute("src");w&&(window.siyuan.menus.menu.append(new o.MenuItem({type:"separator"}).element),(0,u.openMenu)(w,!1,!1)),window.siyuan.menus.menu.popup({x:i.clientX,y:i.clientY}),window.siyuan.menus.menu.element.querySelector("input").focus()};t.linkMenu=(e,t,n=!1)=>{window.siyuan.menus.menu.remove();const i=(0,a.hasClosestBlock)(t);if(!i)return;const r=i.getAttribute("data-node-id");let l=i.outerHTML;const d=t.getAttribute("data-href");window.siyuan.menus.menu.append(new o.MenuItem({label:`<div class="fn__hr--small"></div><input class="b3-text-field fn__size200" placeholder="${window.siyuan.languages.link}"><div class="fn__hr--small"></div>`,bind(n){const a=n.querySelector("input");a.value=d||"",a.addEventListener("change",(()=>{t.setAttribute("data-href",a.value),(0,c.updateTransaction)(e,r,i.outerHTML,l),l=i.outerHTML})),a.addEventListener("keydown",(i=>{if("Enter"!==i.key&&"Escape"!==i.key||i.isComposing)if("Tab"!==i.key||i.isComposing){if((0,x.electronUndo)(i))return}else i.preventDefault(),i.stopPropagation(),n.nextElementSibling.querySelector("input").focus();else i.preventDefault(),i.stopPropagation(),""===t.textContent||t.textContent===p.Constants.ZWSP?(0,A.removeLink)(t,e.toolbar.range):(e.toolbar.range.selectNodeContents(t),e.toolbar.range.collapse(!1),(0,s.focusByRange)(e.toolbar.range)),window.siyuan.menus.menu.remove()}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:`<div class="fn__hr--small"></div><input class="b3-text-field fn__size200" placeholder="${window.siyuan.languages.anchor}"><div class="fn__hr--small"></div>`,bind(n){const a=n.querySelector("input");a.value=t.textContent.replace(p.Constants.ZWSP,""),a.addEventListener("change",(()=>{a.value||t.remove(),(0,c.updateTransaction)(e,r,i.outerHTML,l),l=i.outerHTML})),a.addEventListener("compositionend",(()=>{t.innerHTML=Lute.EscapeHTMLStr(a.value)||""})),a.addEventListener("input",(e=>{e.isComposing||(t.innerHTML=Lute.EscapeHTMLStr(a.value).replace(/\\]/g,'<span data-type="backslash"><span>\\</span>]</span>').replace(/\\\[/g,'<span data-type="backslash"><span>\\</span>[</span>')||"")})),a.addEventListener("keydown",(i=>{if("Enter"!==i.key&&"Escape"!==i.key||i.isComposing)if("Tab"!==i.key||i.isComposing){if((0,x.electronUndo)(i))return}else i.preventDefault(),i.stopPropagation(),i.shiftKey?n.previousElementSibling.querySelector("input").focus():n.nextElementSibling.querySelector("input").focus();else i.preventDefault(),i.stopPropagation(),a.value?(e.toolbar.range.selectNodeContents(t),e.toolbar.range.collapse(!1),(0,s.focusByRange)(e.toolbar.range)):(0,A.removeLink)(t,e.toolbar.range),window.siyuan.menus.menu.remove()}))}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:`<div class="fn__hr--small"></div><input class="b3-text-field fn__size200" placeholder="${window.siyuan.languages.title}"><div class="fn__hr--small"></div>`,bind(n){const a=n.querySelector("input");a.value=Lute.UnEscapeHTMLStr(t.getAttribute("data-title")||""),a.addEventListener("change",(()=>{a.value?t.setAttribute("data-title",Lute.EscapeHTMLStr(a.value)):t.removeAttribute("data-title"),(0,c.updateTransaction)(e,r,i.outerHTML,l),l=i.outerHTML})),a.addEventListener("keydown",(i=>{if("Enter"!==i.key&&"Escape"!==i.key||i.isComposing){if("Tab"===i.key&&i.shiftKey&&!i.isComposing)i.preventDefault(),i.stopPropagation(),n.previousElementSibling.querySelector("input").focus();else if((0,x.electronUndo)(i))return}else i.preventDefault(),i.stopPropagation(),""===t.textContent||t.textContent===p.Constants.ZWSP?(0,A.removeLink)(t,e.toolbar.range):(e.toolbar.range.selectNodeContents(t),e.toolbar.range.collapse(!1),(0,s.focusByRange)(e.toolbar.range)),window.siyuan.menus.menu.remove()}))}}).element),d&&(0,u.openMenu)(d,!1,!0),(null==d?void 0:d.startsWith("siyuan://blocks/"))&&window.siyuan.menus.menu.append(new o.MenuItem({label:`${window.siyuan.languages.turnInto} <b>${window.siyuan.languages.blockRef}</b>`,icon:"iconGraph",click(){t.setAttribute("data-subtype","s");const n=t.getAttribute("data-type").split(" ");n.push("block-ref"),n.splice(n.indexOf("a"),1),t.setAttribute("data-type",n.join(" ")),t.setAttribute("data-id",null==d?void 0:d.replace("siyuan://blocks/","")),t.removeAttribute("data-href"),t.removeAttribute("data-title"),i.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,r,i.outerHTML,l),e.toolbar.range.selectNode(t),e.toolbar.range.collapse(!1),(0,s.focusByRange)(e.toolbar.range)}}).element),window.siyuan.menus.menu.append(new o.MenuItem({label:`${window.siyuan.languages.turnInto} <b>${window.siyuan.languages.text}</b>`,icon:"iconRefresh",click(){(0,A.removeLink)(t,e.toolbar.range)}}).element),(null==d?void 0:d.startsWith("assets/"))&&window.siyuan.menus.menu.append(new o.MenuItem({label:window.siyuan.languages.rename,click(){(0,C.renameAsset)(d)}}).element),window.siyuan.menus.menu.append(new o.MenuItem({icon:"iconTrashcan",label:window.siyuan.languages.remove,click(){const n=i.outerHTML;t.insertAdjacentHTML("afterend","<wbr>"),t.remove(),i.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,c.updateTransaction)(e,r,i.outerHTML,n),(0,s.focusByWbr)(i,e.toolbar.range)}}).element);const h=t.getBoundingClientRect();window.siyuan.menus.menu.popup({x:h.left,y:h.top+26,h:26}),n||e.lute.IsValidLinkDest(d)?window.siyuan.menus.menu.element.querySelectorAll("input")[1].select():window.siyuan.menus.menu.element.querySelector("input").select()};const L=(e,t,n,i,a,o,r)=>({label:e,click(){o.setAttribute("updated",E().format("YYYYMMDDHHmmss")),t.style.width=e===window.siyuan.languages.default?"":e,n.style.width=e===window.siyuan.languages.default?"":"10000px",t.style.maxWidth=e===window.siyuan.languages.default?n.clientWidth+10+"px":"",(0,c.updateTransaction)(i,a,o.outerHTML,r),(0,s.focusBlock)(o)}});t.iframeMenu=(e,t)=>{const n=t.getAttribute("data-node-id"),i=t.querySelector("iframe");let a=t.outerHTML;const o=[{label:`<div class="fn__hr--small"></div><input style="margin: 4px 0" class="b3-text-field fn__size200" value="${i.getAttribute("src")||""}" placeholder="${window.siyuan.languages.link}"><div class="fn__hr--small"></div>`,bind(o){o.querySelector("input").addEventListener("change",(o=>{const s=o.target.value,r=s.match(/(?:www\.|\/\/)bilibili\.com\/video\/(\w+)/);if(s.indexOf("bilibili.com")>-1&&(s.indexOf("bvid=")>-1||r&&r[1])){const e={bvid:s.indexOf("bvid=")>-1?s.split("bvid=")[1].split("&")[0]:r&&r[1],page:"1",high_quality:"1",as_wide:"1",allowfullscreen:"true"};s.indexOf("player.bilibili.com/player.html")>-1&&new URL(s.startsWith("http")?s:"https:"+s).search.split("&").forEach(((t,n)=>{0===n&&(t=t.substr(1));const i=t.split("=");e[i[0]]=i[1]}));let t="https://player.bilibili.com/player.html?";const n=Object.keys(e);n.forEach(((i,a)=>{t+=`${i}=${e[i]}`,a<n.length-1&&(t+="&")})),i.setAttribute("src",t),i.setAttribute("sandbox","allow-top-navigation-by-user-activation allow-same-origin allow-forms allow-scripts allow-popups"),i.style.height||(i.style.height="360px"),i.style.width||(i.style.width="640px")}else i.setAttribute("src",s);(0,c.updateTransaction)(e,n,t.outerHTML,a),a=t.outerHTML,o.stopPropagation()}))}}],s=i.getAttribute("src");return s?(o.push({type:"separator"}),o.concat((0,u.openMenu)(s,!0,!1))):o};t.videoMenu=(e,t,n)=>{const i=t.getAttribute("data-node-id"),a=t.querySelector("NodeVideo"===n?"video":"audio");let o=t.outerHTML;const s=[{label:`<input style="margin: 4px 0" class="b3-text-field" value="${a.getAttribute("src")}" placeholder="${window.siyuan.languages.link}">`,bind(n){n.querySelector("input").addEventListener("change",(n=>{const s=n.target.value;a.setAttribute("src",s),(0,c.updateTransaction)(e,i,t.outerHTML,o),o=t.outerHTML,n.stopPropagation()}))}}],r=a.getAttribute("src");r.startsWith("assets/")&&(s.push({type:"separator"}),s.push({label:window.siyuan.languages.rename,click(){(0,C.renameAsset)(r)}}));const l=a.getAttribute("src");return l?s.concat((0,u.openMenu)(l,!0,!1)):s};t.tableMenu=(e,t,n,i)=>{var a;const o=[],s=(0,r.getColIndex)(n);(n.rowSpan>1||n.colSpan>1)&&o.push({label:window.siyuan.languages.cancelMerged,click:()=>{const i=t.outerHTML;let a=n.rowSpan,o=n.parentElement;const r=n.colSpan;for(;a>0&&o;){let e=o.children[s],t=r;for(;t>0&&e;)e.classList.remove("fn__none"),e.colSpan=1,e.rowSpan=1,e=e.nextElementSibling,t--;o=o.nextElementSibling,a--}if(n.rowSpan=1,n.colSpan=1,"TH"===n.tagName){let e;if(Array.from(t.querySelectorAll("thead tr")).find((t=>{if(e=t,Array.from(t.children).forEach((t=>{(1!==t.rowSpan||t.classList.contains("fn__none"))&&(e=void 0)})),e)return!0})),e){const n=t.querySelector("tbody"),i=t.querySelector("thead");for(;!e.isSameNode(i.lastElementChild);)n.insertAdjacentElement("afterbegin",i.lastElementChild)}}(0,c.updateTransaction)(e,t.getAttribute("data-node-id"),t.outerHTML,i)}});const l=t.querySelectorAll("col")[s];l.style.width&&o.push({label:window.siyuan.languages.useDefaultWidth,click:()=>{const n=t.outerHTML;l.style.width="",(0,c.updateTransaction)(e,t.getAttribute("data-node-id"),t.outerHTML,n)}}),(n.rowSpan>1||n.colSpan>1||l.style.width)&&o.push({type:"separator"}),o.push({icon:"iconAlignLeft",accelerator:window.siyuan.config.keymap.editor.general.alignLeft.custom,label:window.siyuan.languages.alignLeft,click:()=>{(0,r.setTableAlign)(e,[n],t,"left",i)}}),o.push({icon:"iconAlignCenter",label:window.siyuan.languages.alignCenter,accelerator:window.siyuan.config.keymap.editor.general.alignCenter.custom,click:()=>{(0,r.setTableAlign)(e,[n],t,"center",i)}}),o.push({icon:"iconAlignRight",label:window.siyuan.languages.alignRight,accelerator:window.siyuan.config.keymap.editor.general.alignRight.custom,click:()=>{(0,r.setTableAlign)(e,[n],t,"right",i)}}),o.push({type:"separator"});const u=t.querySelector("table"),d=n.parentElement.querySelector(".fn__none");let p=!1,h=!1;Array.from(n.parentElement.children).forEach((e=>{e.colSpan>1&&(p=!0),e.rowSpan>1&&(h=!0)}));let f=!1,g=!1,m=!1,y=n.parentElement.previousElementSibling;y||"TBODY"!==n.parentElement.parentElement.tagName||(y=u.querySelector("thead").lastElementChild),y&&(f=y.querySelector(".fn__none"),Array.from(y.children).forEach((e=>{e.colSpan>1&&(g=!0),e.rowSpan>1&&(m=!0)})));let b=!1,v=!1,w=!1,_=n.parentElement.nextElementSibling;_||"THEAD"!==n.parentElement.parentElement.tagName||(_=null===(a=u.querySelector("tbody"))||void 0===a?void 0:a.firstElementChild),_&&(b=_.querySelector(".fn__none"),Array.from(_.children).forEach((e=>{e.colSpan>1&&(v=!0),e.rowSpan>1&&(w=!0)})));let E=!0;Array.from(u.rows).find((e=>{const t=e.cells[s];if(t.classList.contains("fn__none")||t.colSpan>1||t.rowSpan>1)return E=!1,!0}));let k=!0;Array.from(u.rows).find((e=>{const t=e.cells[s+1];if(t&&(t.classList.contains("fn__none")||t.colSpan>1||t.rowSpan>1))return k=!1,!0}));let C=!0;return Array.from(u.rows).find((e=>{const t=e.cells[s-1];if(t&&(t.classList.contains("fn__none")||t.colSpan>1||t.rowSpan>1))return C=!1,!0})),o.push({icon:"iconBefore",label:window.siyuan.languages.insertRowAbove,accelerator:window.siyuan.config.keymap.editor.table.insertRowAbove.custom,click:()=>{(0,r.insertRowAbove)(e,i,n,t)}}),(!b||b&&!w&&v)&&o.push({icon:"iconAfter",label:window.siyuan.languages.insertRowBelow,accelerator:window.siyuan.config.keymap.editor.table.insertRowBelow.custom,click:()=>{(0,r.insertRow)(e,i,n,t)}}),(E||C)&&o.push({icon:"iconInsertLeft",label:window.siyuan.languages.insertColumnLeft,accelerator:window.siyuan.config.keymap.editor.table.insertColumnLeft.custom,click:()=>{(0,r.insertColumn)(e,t,n,"beforebegin",i)}}),(E||k)&&o.push({icon:"iconInsertRight",label:window.siyuan.languages.insertColumnRight,accelerator:window.siyuan.config.keymap.editor.table.insertColumnRight.custom,click:()=>{(0,r.insertColumn)(e,t,n,"afterend",i)}}),((!d||d&&!h&&p)&&(!f||f&&!m&&g)||(!d||d&&!h&&p)&&(!b||b&&!w&&v)||E&&C||E&&k)&&o.push({type:"separator"}),(!d||d&&!h&&p)&&(!f||f&&!m&&g)&&o.push({icon:"iconUp",label:window.siyuan.languages.moveToUp,accelerator:window.siyuan.config.keymap.editor.table.moveToUp.custom,click:()=>{(0,r.moveRowToUp)(e,i,n,t)}}),(!d||d&&!h&&p)&&(!b||b&&!w&&v)&&o.push({icon:"iconDown",label:window.siyuan.languages.moveToDown,accelerator:window.siyuan.config.keymap.editor.table.moveToDown.custom,click:()=>{(0,r.moveRowToDown)(e,i,n,t)}}),E&&C&&o.push({icon:"iconLeft",label:window.siyuan.languages.moveToLeft,accelerator:window.siyuan.config.keymap.editor.table.moveToLeft.custom,click:()=>{(0,r.moveColumnToLeft)(e,i,n,t)}}),E&&k&&o.push({icon:"iconRight",label:window.siyuan.languages.moveToRight,accelerator:window.siyuan.config.keymap.editor.table.moveToRight.custom,click:()=>{(0,r.moveColumnToRight)(e,i,n,t)}}),("THEAD"!==n.parentElement.parentElement.tagName&&(!d&&!h||d&&!h&&p)||E)&&o.push({type:"separator"}),"THEAD"!==n.parentElement.parentElement.tagName&&(!d&&!h||d&&!h&&p)&&o.push({icon:"iconDeleteRow",label:window.siyuan.languages["delete-row"],accelerator:window.siyuan.config.keymap.editor.table["delete-row"].custom,click:()=>{(0,r.deleteRow)(e,i,n,t)}}),E&&o.push({icon:"iconDeleteColumn",label:window.siyuan.languages["delete-column"],accelerator:window.siyuan.config.keymap.editor.table["delete-column"].custom,click:()=>{(0,r.deleteColumn)(e,i,t,n)}}),o};t.setFold=(e,t,n,i)=>{if("NodeListItem"===t.getAttribute("data-type")&&t.childElementCount<4)return-1;let o="0";if("1"===t.getAttribute("fold")){if("boolean"==typeof n&&!n)return-1;t.removeAttribute("fold"),t.querySelectorAll(".protyle-linenumber").forEach((e=>{(0,_.lineNumberRender)(e)}))}else{if("boolean"==typeof n&&n)return-1;if(o="1",t.setAttribute("fold","1"),getSelection().rangeCount>0){const e=getSelection().getRangeAt(0),n=(0,a.hasClosestBlock)(e.startContainer);n&&0===n.getBoundingClientRect().width&&(0,s.focusBlock)(t,void 0,!1)}}const r=t.getAttribute("data-node-id");return"NodeHeading"===t.getAttribute("data-type")?"0"===o?(t.insertAdjacentHTML("beforeend",'<div spin="1" style="text-align: center"><img width="24px" src="/stage/loading-pure.svg"></div>'),(0,c.transaction)(e,[{action:"unfoldHeading",id:r,data:i?"remove":void 0}],[{action:"foldHeading",id:r}])):((0,c.transaction)(e,[{action:"foldHeading",id:r}],[{action:"unfoldHeading",id:r}]),(0,w.removeFoldHeading)(t)):(0,c.transaction)(e,[{action:"setAttrs",id:r,data:JSON.stringify({fold:o})}],[{action:"setAttrs",id:r,data:JSON.stringify({fold:"0"===o?"1":"0"})}]),(0,f.preventScroll)(e),o}},4974:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initSearchMenu=void 0;const i=n(2640),a=n(8120);t.initSearchMenu=e=>(window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new i.MenuItem({label:window.siyuan.languages.copy,type:"submenu",submenu:(0,a.copySubMenu)(e,"",!1)}).element),window.siyuan.menus.menu)},8922:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initTabMenu=void 0;const a=n(2640),o=n(7876),s=n(3371),r=n(8120),l=e=>{const t=[{icon:"iconSplitLR",label:window.siyuan.languages.splitLR,click:()=>{e.parent.split("lr").addTab((0,s.copyTab)(e))}}];return e.parent.children.length>1&&t.push({icon:"iconRight",label:window.siyuan.languages.splitMoveR,click:()=>{const t=e.parent.split("lr");t.headersElement.append(e.headElement),t.headersElement.parentElement.classList.remove("fn__none"),t.moveTab(e)}}),t.push({icon:"iconSplitTB",label:window.siyuan.languages.splitTB,click:()=>{e.parent.split("tb").addTab((0,s.copyTab)(e))}}),e.parent.children.length>1&&t.push({icon:"iconDown",label:window.siyuan.languages.splitMoveB,click:()=>{const t=e.parent.split("tb");t.headersElement.append(e.headElement),t.headersElement.parentElement.classList.remove("fn__none"),t.moveTab(e)}}),t};t.initTabMenu=e=>{window.siyuan.menus.menu.remove(),(e=>{const t=[],n=[],o=[],s=[];let r=-1;e.parent.children.forEach(((i,a)=>{var l,c;const u=i.model;(!u||(null===(l=u.editor)||void 0===l?void 0:l.protyle)&&!(null===(c=u.editor)||void 0===c?void 0:c.protyle.updated))&&n.push(i),i.id===e.id&&(r=a),-1===r?o.push(i):a>r&&s.push(i),t.push(i)})),window.siyuan.menus.menu.append(new a.MenuItem({icon:"iconClose",label:window.siyuan.languages.close,accelerator:window.siyuan.config.keymap.general.closeTab.custom,click:()=>{e.parent.removeTab(e.id)}}).element),t.length>1&&(window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.closeOthers,click:()=>i(void 0,void 0,void 0,(function*(){for(let n=0;n<t.length;n++)t[n].id===e.id||t[n].headElement.classList.contains("item--pin")||(yield t[n].parent.removeTab(t[n].id,!0));e.headElement.parentElement.querySelector(".item--focus")||e.parent.switchTab(e.headElement,!0)}))}).element),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.closeAll,click:()=>i(void 0,void 0,void 0,(function*(){for(let e=0;e<t.length;e++)t[e].headElement.classList.contains("item--pin")||(yield t[e].parent.removeTab(t[e].id,!0));t[0].headElement.parentElement&&t[0].parent.switchTab(t[0].headElement,!0)}))}).element),o.length>0&&window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.closeLeft,click:()=>i(void 0,void 0,void 0,(function*(){for(let e=0;e<o.length;e++)o[e].headElement.classList.contains("item--pin")||(yield o[e].parent.removeTab(o[e].id));e.headElement.parentElement.querySelector(".item--focus")||e.parent.switchTab(e.headElement,!0)}))}).element),s.length>0&&window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.closeRight,click:()=>i(void 0,void 0,void 0,(function*(){for(let e=0;e<s.length;e++)s[e].headElement.classList.contains("item--pin")||(yield s[e].parent.removeTab(s[e].id));e.headElement.parentElement.querySelector(".item--focus")||e.parent.switchTab(e.headElement,!0)}))}).element),n.length>0&&window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.closeUnmodified,click:()=>i(void 0,void 0,void 0,(function*(){for(let e=0;e<n.length;e++)n[e].headElement.classList.contains("item--pin")||(yield n[e].parent.removeTab(n[e].id));e.headElement.parentElement&&!e.headElement.parentElement.querySelector(".item--focus")?e.parent.switchTab(e.headElement,!0):t[0].headElement.parentElement&&t[0].parent.switchTab(t[0].headElement,!0)}))}).element)),window.siyuan.menus.menu.append(new a.MenuItem({type:"separator"}).element)})(e),window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.split,submenu:l(e)}).element);const t=e.model;let n;if(t&&t instanceof o.Editor)n=t.editor.protyle.block.rootID;else{const t=e.headElement.getAttribute("data-initdata");if(t){const e=JSON.parse(t);n=e.rootId||e.blockId}}return n&&window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.copy,icon:"iconCopy",type:"submenu",submenu:(0,r.copySubMenu)(n,"",!1)}).element),e.headElement.classList.contains("item--pin")?window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.unpin,icon:"iconPin",click:()=>{e.unpin()}}).element):window.siyuan.menus.menu.append(new a.MenuItem({label:window.siyuan.languages.pin,icon:"iconPin",click:()=>{e.pin()}}).element),window.siyuan.menus.menu}},484:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.goBack=t.goForward=t.pushBack=void 0;const i=n(8792),a=n(5378),o=n(2319),s=n(734),r=n(407),l=n(6057),c=n(1248),u=n(7822),d=n(7010),p=[],h=e=>{const t=window.siyuan.mobileEditor.protyle;window.localStorage.setItem(i.Constants.LOCAL_DOCINFO,JSON.stringify({id:e.id,action:e.callback})),(0,a.hideElements)(["toolbar","hint","util"],window.siyuan.mobileEditor.protyle),t.contentElement.classList.contains("fn__none")&&(0,o.setEditMode)(t,"wysiwyg");const n=e.endId.split(i.Constants.ZWSP);n[0]!==t.wysiwyg.element.firstElementChild.getAttribute("data-node-id")||n[1]!==t.wysiwyg.element.lastElementChild.getAttribute("data-node-id")?(e.id!==t.block.rootID&&(0,s.fetchPost)("/api/block/getDocInfo",{id:e.id},(e=>{document.getElementById("toolbarName").value="Untitled"===e.data.name?"":e.data.name,t.background.render(e.data.ial,t.block.rootID),t.wysiwyg.renderCustom(e.data.ial)})),e.isZoom?(0,s.fetchPost)("/api/block/checkBlockExist",{id:e.id},(n=>{n.data&&(0,r.zoomOut)(t,e.id,void 0,!1,(()=>{t.contentElement.scrollTop=e.scrollTop}))})):(0,s.fetchPost)("/api/filetree/getDoc",{id:e.id,startID:n[0],endID:n[1]},(n=>{var i;t.block.parentID=n.data.parentID,t.block.parent2ID=n.data.parent2ID,t.block.rootID=n.data.rootID,t.block.showAll=!1,t.block.mode=n.data.mode,t.block.blockCount=n.data.blockCount,t.block.id=n.data.id,t.block.action=e.callback,t.wysiwyg.element.setAttribute("data-doc-type",n.data.type),t.wysiwyg.element.innerHTML=n.data.content,(0,l.processRender)(t.wysiwyg.element),(0,c.highlightRender)(t.wysiwyg.element),(0,u.blockRender)(t,t.wysiwyg.element),t.disabled?(0,d.disabledProtyle)(t):(0,d.enableProtyle)(t),t.contentElement.scrollTop=e.scrollTop,null===(i=window.siyuan.mobileEditor.protyle.breadcrumb)||void 0===i||i.render(t)}))):window.siyuan.mobileEditor.protyle.contentElement.scrollTo({top:e.scrollTop,behavior:"smooth"})};t.pushBack=()=>{const e=window.siyuan.mobileEditor.protyle;window.siyuan.backStack.push({id:e.block.showAll?e.block.id:e.block.rootID,endId:e.wysiwyg.element.firstElementChild.getAttribute("data-node-id")+i.Constants.ZWSP+e.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),scrollTop:e.contentElement.scrollTop,callback:e.block.action,isZoom:e.block.showAll})};t.goForward=()=>{window.JSAndroid&&p.length<2?window.JSAndroid.returnDesktop():p.length<2||(window.siyuan.backStack.push(p.pop()),h(p[p.length-1]))};t.goBack=()=>{if(window.JSAndroid&&window.siyuan.backStack.length<1)return void window.JSAndroid.returnDesktop();if(window.siyuan.backStack.length<1)return;const e=window.siyuan.mobileEditor.protyle;0===p.length&&p.push({id:e.block.showAll?e.block.id:e.block.rootID,endId:e.wysiwyg.element.firstElementChild.getAttribute("data-node-id")+i.Constants.ZWSP+e.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),scrollTop:e.contentElement.scrollTop,callback:e.block.action,isZoom:e.block.showAll});const t=window.siyuan.backStack.pop();p.push(t),h(t)}},4293:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fullscreen=t.netImg2LocalAssets=void 0;const i=n(2892),a=n(1384),o=n(734),s=n(8792),r=n(7010),l=n(3914),c=n(5378);t.netImg2LocalAssets=e=>{e.element.querySelector(".wysiwygLoading")||((0,a.addLoading)(e),(0,c.hideElements)(["toolbar"],e),(0,o.fetchPost)("/api/format/netImg2LocalAssets",{id:e.block.rootID},(()=>{(0,i.getAllModels)().editor.forEach((t=>{t.editor.protyle.block.rootID===e.block.rootID&&(0,o.fetchPost)("/api/filetree/getDoc",{id:t.editor.protyle.block.rootID,mode:0,size:s.Constants.SIZE_GET},(n=>{(0,r.onGet)(n,t.editor.protyle,[s.Constants.CB_GET_FOCUS],(0,l.saveScroll)(e,!0))}))}))})))};t.fullscreen=(e,t)=>{const n=e.className.includes("fullscreen");n?(e.classList.remove("fullscreen"),document.querySelector("body").classList.contains("body--win32")&&document.getElementById("drag").classList.remove("fn__hidden")):(e.classList.add("fullscreen"),document.querySelector("body").classList.contains("body--win32")&&document.getElementById("drag").classList.add("fn__hidden")),t&&(n?t.querySelector("use").setAttribute("xlink:href","#iconFullscreen"):t.querySelector("use").setAttribute("xlink:href","#iconContract")),e.classList.contains("protyle")&&(window.siyuan.editorIsFullscreen=!n),(0,i.getAllModels)().editor.forEach((t=>{window.siyuan.editorIsFullscreen?!e.isSameNode(t.element)&&t.element.classList.contains("fullscreen")&&(t.element.classList.remove("fullscreen"),(0,a.setPadding)(t.editor.protyle)):t.element.classList.contains("fullscreen")&&(t.element.classList.remove("fullscreen"),(0,a.setPadding)(t.editor.protyle))}))}},3889:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Breadcrumb=void 0;const i=n(1308),a=n(734),o=n(8792),s=n(2640),r=n(4293),l=n(8120),c=n(2319),u=n(8604),d=n(1890),p=n(2239),h=n(3607),f=n(8776),g=n(3274),m=n(407),y=n(4640),b=n(1384),v=n(9516),w=n(2892),_=n(7010),E=n(3914),k=n(5378);t.Breadcrumb=class{constructor(e){const t=document.createElement("div");t.className="protyle-breadcrumb";let n=`<div class="protyle-breadcrumb__bar"></div>\n<span class="fn__flex-1 fn__flex-shrink"></span>\n<button class="b3-tooltips b3-tooltips__w block__icon fn__flex-center" style="opacity: 1;" data-menu="true" aria-label="${window.siyuan.languages.more}"><svg><use xlink:href="#iconMore"></use></svg></button>`;e.options.render.breadcrumbContext&&(n+=`<span class="fn__space"></span>\n<div class="b3-tooltips b3-tooltips__w block__icon fn__flex-center" style="opacity: 1;" data-type="context" aria-label="${window.siyuan.languages.context}"><svg><use xlink:href="#iconAlignCenter"></use></svg></div>`),t.innerHTML=n,this.element=t.firstElementChild,t.addEventListener("click",(n=>{let i=n.target;for(;i&&!i.isEqualNode(t);){const t=i.getAttribute("data-node-id");if(t){e.options.render.breadcrumbDocName&&window.siyuan.ctrlIsPressed?(0,v.openFileById)({id:t,action:[o.Constants.CB_GET_FOCUS]}):(0,m.zoomOut)(e,t),n.preventDefault();break}if("true"===i.getAttribute("data-menu")){this.showMenu(e,{x:n.clientX,y:n.clientY}),n.preventDefault();break}if("context"===i.getAttribute("data-type")){i.classList.contains("block__icon--active")?((0,a.fetchPost)("/api/filetree/getDoc",{id:e.options.blockId,mode:0,size:o.Constants.SIZE_GET},(t=>{(0,_.onGet)(t,e)})),i.classList.remove("block__icon--active")):((0,a.fetchPost)("/api/filetree/getDoc",{id:e.options.blockId,mode:3,size:o.Constants.SIZE_GET},(t=>{(0,_.onGet)(t,e,[o.Constants.CB_GET_HL])})),i.classList.add("block__icon--active")),n.preventDefault();break}i=i.parentElement}})),t.addEventListener("mouseleave",(()=>{e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--hl").forEach((e=>{e.classList.remove("protyle-wysiwyg--hl")}))})),this.element.addEventListener("mouseover",(t=>{if(!e.selectElement.classList.contains("fn__none"))return;const n=t.target,i=(0,h.hasClosestByAttribute)(n,"data-node-id",null);if(i){e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--hl").forEach((e=>{e.classList.remove("protyle-wysiwyg--hl")}));const t=e.wysiwyg.element.querySelector(`[data-node-id="${i.getAttribute("data-node-id")}"]`);t&&t.classList.add("protyle-wysiwyg--hl")}})),this.element.addEventListener("mousewheel",(e=>{this.element.scrollLeft=this.element.scrollLeft+e.deltaY}),{passive:!0})}showMenu(e,t){let n;const i=(0,h.hasClosestBlock)((0,y.getEditorRange)(e.element).startContainer);i&&(n=i.getAttribute("data-node-id")),(0,a.fetchPost)("/api/block/getBlockWordCount",{id:n||e.block.id},(n=>{var i,h;if(window.siyuan.menus.menu.remove(),!e.contentElement.classList.contains("fn__none")){let t="";e.disabled||(t='<input class="b3-form__upload" type="file" multiple="multiple"',e.options.upload.accept?t+=` accept="${e.options.upload.accept}">`:t+=">");const n=new s.MenuItem({disabled:e.disabled,icon:"iconDownload",label:`${window.siyuan.languages.insertAsset}${t}`}).element;e.disabled||n.querySelector("input").addEventListener("change",(t=>{0!==t.target.files.length&&((0,p.uploadFiles)(e,t.target.files,t.target),window.siyuan.menus.menu.remove())})),window.siyuan.menus.menu.append(n),"android"===window.siyuan.config.system.container&&window.JSAndroid||window.siyuan.menus.menu.append(new s.MenuItem({disabled:e.disabled&&(!this.mediaRecorder||this.mediaRecorder&&!this.mediaRecorder.isRecording),current:this.mediaRecorder&&this.mediaRecorder.isRecording,icon:"iconRecord",label:(null===(i=this.mediaRecorder)||void 0===i?void 0:i.isRecording)?window.siyuan.languages.endRecord:window.siyuan.languages.startRecord,click:()=>{let t="";if(this.mediaRecorder)if(this.mediaRecorder.isRecording){this.mediaRecorder.stopRecording(),(0,d.hideMessage)(t);const n=new File([this.mediaRecorder.buildWavFileBlob()],`record${(new Date).getTime()}.wav`,{type:"video/webm"});(0,p.uploadFiles)(e,[n])}else(0,d.hideMessage)(t),t=(0,d.showMessage)(window.siyuan.languages.recording,-1),this.mediaRecorder.startRecordingNewWavFile();else navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{this.mediaRecorder=new u.RecordMedia(e),this.mediaRecorder.recorder.onaudioprocess=e=>{if(!this.mediaRecorder.isRecording)return;const t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1);this.mediaRecorder.cloneChannelData(t,n)},this.mediaRecorder.startRecordingNewWavFile(),t=(0,d.showMessage)(window.siyuan.languages.recording,-1)})).catch((()=>{(0,d.showMessage)(window.siyuan.languages["record-tip"])}))}}).element)}window.siyuan.menus.menu.append(new s.MenuItem({label:window.siyuan.languages.uploadAssets2CDN,icon:"iconCloud",click(){(0,f.needSubscribe)()||(0,a.fetchPost)("/api/asset/uploadCloud",{id:e.block.parentID})}}).element),window.siyuan.menus.menu.append(new s.MenuItem({label:window.siyuan.languages.netImg2LocalAsset,icon:"iconTransform",accelerator:window.siyuan.config.keymap.editor.general.netImg2LocalAsset.custom,click(){(0,r.netImg2LocalAssets)(e)}}).element),window.siyuan.menus.menu.append(new s.MenuItem({label:window.siyuan.languages.optimizeTypography,icon:"iconFormat",click:()=>{(0,k.hideElements)(["toolbar"],e),(0,a.fetchPost)("/api/format/autoSpace",{id:e.block.rootID},(()=>{(0,w.getAllModels)().editor.forEach((t=>{t.editor.protyle.block.rootID===e.block.rootID&&(0,a.fetchPost)("/api/filetree/getDoc",{id:t.editor.protyle.block.rootID,mode:0,size:o.Constants.SIZE_GET},(n=>{(0,_.onGet)(n,t.editor.protyle,[o.Constants.CB_GET_FOCUS],(0,E.saveScroll)(e,!0))}))}))}))}}).element),(null===(h=e.scroll)||void 0===h?void 0:h.element.classList.contains("fn__none"))||window.siyuan.menus.menu.append(new s.MenuItem({current:e.scroll.keepLazyLoad,label:window.siyuan.languages.keepLazyLoad,click:()=>{e.scroll.keepLazyLoad=!e.scroll.keepLazyLoad}}).element),window.siyuan.menus.menu.append(new s.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconRefresh",accelerator:window.siyuan.config.keymap.editor.general.refresh.custom,label:window.siyuan.languages.refresh,click:()=>{(0,a.fetchPost)("/api/filetree/getDoc",{id:e.block.showAll?e.block.id:e.block.rootID,mode:0,size:e.block.showAll?o.Constants.SIZE_GET_MAX:o.Constants.SIZE_GET},(t=>{(0,_.onGet)(t,e,e.block.showAll?[o.Constants.CB_GET_ALL,o.Constants.CB_GET_FOCUS]:[o.Constants.CB_GET_FOCUS],(0,E.saveScroll)(e,!0),!0)}))}}).element),(0,g.isMobile)()||window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconFullscreen",accelerator:window.siyuan.config.keymap.editor.general.fullscreen.custom,label:window.siyuan.languages.fullscreen,click:()=>{(0,r.fullscreen)(e.element),(0,b.setPadding)(e)}}).element);const m=[{current:!e.contentElement.classList.contains("fn__none"),label:window.siyuan.languages.wysiwyg,accelerator:window.siyuan.config.keymap.editor.general.wysiwyg.custom,click:()=>{(0,c.setEditMode)(e,"wysiwyg"),e.scroll.lastScrollTop=0,(0,a.fetchPost)("/api/filetree/getDoc",{id:e.block.rootID,size:o.Constants.SIZE_GET},(t=>{(0,_.onGet)(t,e),window.siyuan.menus.menu.remove()}))}}];m.push({current:!e.preview.element.classList.contains("fn__none"),icon:"iconPreview",label:window.siyuan.languages.preview,accelerator:window.siyuan.config.keymap.editor.general.preview.custom,click:()=>{(0,c.setEditMode)(e,"preview"),window.siyuan.menus.menu.remove()}}),window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconEdit",label:window.siyuan.languages["edit-mode"],type:"submenu",submenu:m}).element),window.siyuan.menus.menu.append((0,l.exportMd)(e.block.parentID)),window.siyuan.menus.menu.append(new s.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new s.MenuItem({type:"readonly",label:`<div class="fn__flex">${window.siyuan.languages.docRuneCount}<span class="fn__space fn__flex-1"></span>${n.data.rootBlockRuneCount}</div>\n<div class="fn__flex">${window.siyuan.languages.docWordCount}<span class="fn__space fn__flex-1"></span>${n.data.rootBlockWordCount}</div>\n<div class="fn__flex">${window.siyuan.languages.blockRuneCount}<span class="fn__space fn__flex-1"></span>${n.data.blockRuneCount}</div>\n<div class="fn__flex">${window.siyuan.languages.blockWordCount}<span class="fn__space fn__flex-1"></span>${n.data.blockWordCount}</div>`}).element),window.siyuan.menus.menu.popup(t)}))}render(e,t=!1){let n,o;getSelection().rangeCount>0&&(n=getSelection().getRangeAt(0),o=e.wysiwyg.element.isEqualNode(n.startContainer)||e.wysiwyg.element.contains(n.startContainer)?(0,h.hasClosestBlock)(n.startContainer):e.wysiwyg.element.firstElementChild),o||(o=e.wysiwyg.element.firstElementChild);const s=o.getAttribute("data-node-id");if(s!==this.id||t)this.id=s,(0,a.fetchPost)("/api/block/getBlockBreadcrumb",{id:s},(t=>{let n="";t.data.forEach(((a,o)=>{let s=!1;e.block.showAll||a.id!==e.block.parentID?e.block.showAll&&a.id===e.block.id&&(s=!0):s=!0,0!==o||e.options.render.breadcrumbDocName?n+=`<span class="protyle-breadcrumb__item${s?" protyle-breadcrumb__item--active":""}" data-node-id="${a.id}">\n    <svg class="popover__block" data-id="${a.id}"><use xlink:href="#${(0,i.getIconByType)(a.type,a.subType)}"></use></svg>\n    <span class="protyle-breadcrumb__text" title="${a.name}">${a.name}</span>\n</span>`:n+=`<span class="protyle-breadcrumb__item${s?" protyle-breadcrumb__item--active":""}" data-node-id="${a.id}">\n    <svg class="popover__block" data-id="${a.id}"><use xlink:href="#${(0,i.getIconByType)(a.type,a.subType)}"></use></svg>\n</span>`,o!==t.data.length-1&&(n+='<svg class="protyle-breadcrumb__arrow"><use xlink:href="#iconRight"></use></svg>')})),this.element.classList.remove("protyle-breadcrumb__bar--nowrap"),this.element.innerHTML=n;const a=Array.from(this.element.querySelectorAll(".protyle-breadcrumb__text"));if(0===a.length)return;let o=!1;for(;this.element.scrollHeight>30&&!o;)a.find(((e,t)=>1===a.length?(e.classList.add("protyle-breadcrumb__text--ellipsis"),o=!0,!0):e.classList.contains("protyle-breadcrumb__text--ellipsis")?void(t===a.length-1&&e.classList.contains("protyle-breadcrumb__text--ellipsis")&&(o=!0)):(e.classList.add("protyle-breadcrumb__text--ellipsis"),!0)));this.element.classList.add("protyle-breadcrumb__bar--nowrap"),this.element.lastElementChild&&(this.element.scrollLeft=this.element.lastElementChild.offsetLeft-this.element.clientWidth-8)}));else{e.breadcrumb.element.querySelectorAll(".protyle-breadcrumb__item--active").forEach((e=>{e.classList.remove("protyle-breadcrumb__item--active")}));const t=e.breadcrumb.element.querySelector(`[data-node-id="${e.block.showAll?e.block.id:e.block.parentID}"]`);t&&t.classList.add("protyle-breadcrumb__item--active")}}hide(){this.element.classList.add("protyle-breadcrumb__bar--hide"),window.siyuan.hideBreadcrumb=!0}show(){this.element.classList.remove("protyle-breadcrumb__bar--hide"),window.siyuan.hideBreadcrumb=!1}}},4745:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))},a=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,a){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,a,(t=e[n](t)).done,t.value)}))}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Gutter=void 0;const o=n(3607),s=n(1308),r=n(407),l=n(2640),c=n(8120),u=n(7954),d=n(6840),p=n(4403),h=n(4640),f=n(5378),g=n(6057),m=n(1248),y=n(7822),b=n(6075),v=n(6520),w=n(5680),_=n(734),E=n(9173),k=n(8592),C=n(3274),D=n(1377),x=n(7010),S=n(7731),A=n(9516),L=n(8792);t.Gutter=class{constructor(e){this.element=document.createElement("div"),this.element.className="protyle-gutters",this.element.setAttribute("aria-label",window.siyuan.languages.gutterTip.replace("⌘Click",(0,u.updateHotkeyTip)("⌘Click")).replace("⌥Click",(0,u.updateHotkeyTip)("⌥Click")).replace("⇧Click",(0,u.updateHotkeyTip)("⇧Click"))),this.element.setAttribute("data-type","a"),this.element.setAttribute("data-position","right"),this.element.addEventListener("dragstart",(t=>{let n=[t.target.getAttribute("data-node-id")];const i=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");i.length>0&&(n=[],i.forEach((e=>{n.push(e.getAttribute("data-node-id"))}))),0===i.length&&t.dataTransfer.setDragImage(e.wysiwyg.element.querySelector(`[data-node-id="${n[0]}"]`),0,0),t.target.style.opacity="0.1",t.dataTransfer.effectAllowed="move",window.siyuan.dragElement=t.target,window.siyuan.dragElement.setAttribute("data-selected-ids",n.toString())})),this.element.addEventListener("dragend",(()=>{window.siyuan.dragElement&&(window.siyuan.dragElement.removeAttribute("data-selected-ids"),window.siyuan.dragElement.style.opacity="",window.siyuan.dragElement=void 0)})),this.element.addEventListener("click",(t=>{const n=(0,o.hasClosestByTag)(t.target,"BUTTON");if(!n)return;t.preventDefault(),t.stopPropagation();const i=n.getAttribute("data-node-id");if(!i){const t=()=>{n.setAttribute("disabled","disabled");const t=e.wysiwyg.element.querySelector(`[data-node-id="${(n.previousElementSibling||n.nextElementSibling).getAttribute("data-node-id")}"]`);if(window.siyuan.altIsPressed){let i=!0;const a=t.outerHTML;Array.from(t.children).find((e=>{if(e.classList.contains("list")){if(Array.from(e.children).find((e=>{if(e.classList.contains("li")&&"1"!==e.getAttribute("fold")&&e.childElementCount>3)return i=!1,!0})))return!0}})),Array.from(t.children).forEach((e=>{e.classList.contains("list")&&Array.from(e.children).forEach((e=>{e.classList.contains("li")&&(i?e.removeAttribute("fold"):e.childElementCount>3&&e.setAttribute("fold","1"))}))})),(0,d.updateTransaction)(e,t.getAttribute("data-node-id"),t.outerHTML,a),n.removeAttribute("disabled")}else{const i=(0,r.setFold)(e,t);"1"===i?n.firstElementChild.style.transform="":"0"===i&&(n.firstElementChild.style.transform="rotate(90deg)")}};if(n.getAttribute("disabled"))return;return e.disabled?(0,D.confirmDialog)(window.siyuan.languages._kernel[34],window.siyuan.languages.foldTip,(()=>{(0,C.isMobile)()&&(document.getElementById("toolbarName").readOnly=!1,document.querySelector("#toolbarEdit use").setAttribute("xlink:href","#iconPreview")),(0,x.enableProtyle)(e),t()})):t(),(0,f.hideElements)(["select"],e),void window.siyuan.menus.menu.remove()}if(!e.disabled)if(window.siyuan.ctrlIsPressed)(0,r.zoomOut)(e,i);else if(window.siyuan.altIsPressed){const t=e.wysiwyg.element.querySelector(`[data-node-id="${i}"]`);if("NodeListItem"===n.getAttribute("data-type")){let n=!0;const i=t.parentElement.outerHTML;Array.from(t.parentElement.children).find((e=>{if(e.classList.contains("li")&&"1"!==e.getAttribute("fold")&&e.childElementCount>3)return n=!1,!0})),Array.from(t.parentElement.children).find((e=>{e.classList.contains("li")&&(n?e.removeAttribute("fold"):e.childElementCount>3&&e.setAttribute("fold","1"))})),(0,d.updateTransaction)(e,t.parentElement.getAttribute("data-node-id"),t.parentElement.outerHTML,i)}else(0,r.setFold)(e,t);t.classList.remove("protyle-wysiwyg--hl")}else window.siyuan.shiftIsPressed?(0,c.openAttr)(e.wysiwyg.element.querySelector(`[data-node-id="${i}"]`),e):(this.renderMenu(e,n),window.siyuan.menus.menu.popup({x:t.clientX-16,y:t.clientY-16},!0),e.toolbar.range||(e.toolbar.range=(0,h.getEditorRange)(e.wysiwyg.element.firstElementChild)),(0,h.focusByRange)(e.toolbar.range))})),this.element.addEventListener("contextmenu",(t=>{const n=(0,o.hasClosestByTag)(t.target,"BUTTON");n&&!e.disabled&&"fold"!==n.getAttribute("data-type")&&(window.siyuan.ctrlIsPressed||window.siyuan.altIsPressed||window.siyuan.shiftIsPressed||(this.renderMenu(e,n),window.siyuan.menus.menu.popup({x:t.clientX-16,y:t.clientY-16},!0)),t.preventDefault(),t.stopPropagation())})),this.element.addEventListener("mouseover",(t=>{const n=(0,o.hasClosestByTag)(t.target,"BUTTON");if(!n||"fold"===(null==n?void 0:n.getAttribute("data-type")))return;let i;Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${n.getAttribute("data-node-id")}"]`)).find((e=>{if(!(0,o.hasClosestByAttribute)(e.parentElement,"data-type","NodeBlockQueryEmbed"))return i=e,!0})),i&&(i.classList.add("protyle-wysiwyg--hl"),t.preventDefault())})),this.element.addEventListener("mouseout",(t=>{const n=(0,o.hasClosestByTag)(t.target,"BUTTON");if(!n||"fold"===(null==n?void 0:n.getAttribute("data-type")))return;let i;Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${n.getAttribute("data-node-id")}"]`)).find((e=>{if(!(0,o.hasClosestByAttribute)(e.parentElement,"data-type","NodeBlockQueryEmbed"))return i=e,!0})),i&&(i.classList.remove("protyle-wysiwyg--hl"),t.preventDefault(),t.stopPropagation())}))}turnsOneInto(e){return{icon:e.icon,label:e.label,accelerator:e.accelerator,click(){var t,n,o,s;return i(this,void 0,void 0,(function*(){if(e.nodeElement.querySelector("wbr")||null===(o=(0,v.getContenteditableElement)(e.nodeElement))||void 0===o||o.insertAdjacentHTML("afterbegin","<wbr>"),"CancelList"===e.type||"CancelBlockquote"===e.type)try{for(var i,r=a(e.nodeElement.querySelectorAll('[data-type="NodeHeading"][fold="1"]'));!(i=yield r.next()).done;){const t=i.value,n=t.getAttribute("data-node-id");t.removeAttribute("fold");const a=yield(0,_.fetchSyncPost)("/api/transactions",{session:e.protyle.id,app:L.Constants.SIYUAN_APPID,transactions:[{doOperations:[{action:"unfoldHeading",id:n}],undoOperations:[{action:"foldHeading",id:n}]}]});e.protyle.undo.add([{action:"unfoldHeading",id:n}],[{action:"foldHeading",id:n}]),t.insertAdjacentHTML("afterend",a.data[0].doOperations[0].retData)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&(yield n.call(r))}finally{if(t)throw t.error}}const l=e.nodeElement.outerHTML,c=null===(s=e.nodeElement.previousElementSibling)||void 0===s?void 0:s.getAttribute("data-node-id"),u=e.nodeElement.parentElement.getAttribute("data-node-id")||e.protyle.block.parentID,p=e.protyle.lute[e.type](e.nodeElement.outerHTML,e.level);if(e.nodeElement.outerHTML=p,"CancelList"===e.type||"CancelBlockquote"===e.type){const t=document.createElement("template");t.innerHTML=p;const n=[{action:"delete",id:e.id}],i=[];let a=c;Array.from(t.content.children).forEach((e=>{const t=e.getAttribute("data-node-id");n.push({action:"insert",data:e.outerHTML,id:t,previousID:a,parentID:u}),i.push({action:"delete",id:t}),a=t})),i.push({action:"insert",data:l,id:e.id,previousID:c,parentID:u}),(0,d.transaction)(e.protyle,n,i)}else(0,d.updateTransaction)(e.protyle,e.id,p,l);(0,h.focusByWbr)(e.protyle.wysiwyg.element,(0,h.getEditorRange)(e.protyle.wysiwyg.element)),e.protyle.wysiwyg.element.querySelectorAll('[data-type~="block-ref"]').forEach((e=>{""===e.textContent&&(0,_.fetchPost)("/api/block/getRefText",{id:e.getAttribute("data-id")},(t=>{e.innerHTML=t.data}))})),(0,y.blockRender)(e.protyle,e.protyle.wysiwyg.element),(0,g.processRender)(e.protyle.wysiwyg.element),(0,m.highlightRender)(e.protyle.wysiwyg.element)}))}}}turnsIntoOne(e){return{icon:e.icon,label:e.label,accelerator:e.accelerator,click(){(0,d.turnsIntoOneTransaction)(e)}}}turnsInto(e){return{icon:e.icon,label:e.label,accelerator:e.accelerator,click(){(0,d.turnsIntoTransaction)(e)}}}renderMultipleMenu(e,t){let n=!1,i=!1,a=!1;if(t.find(((e,o)=>{if(e.classList.contains("li"))return n=!0,!0;if((e.classList.contains("bq")||e.classList.contains("sb")||e.classList.contains("p"))&&(a=!0),e.nextElementSibling&&t[o+1]&&e.nextElementSibling.isSameNode(t[o+1]))i=!0;else if(o!==t.length-1)return i=!1,!0})),!n&&!window.siyuan.config.readonly){const n=[];i&&(n.push(this.turnsIntoOne({icon:"iconList",label:window.siyuan.languages.list,protyle:e,selectsElement:t,type:"Blocks2ULs"})),n.push(this.turnsIntoOne({icon:"iconOrderedList",label:window.siyuan.languages["ordered-list"],protyle:e,selectsElement:t,type:"Blocks2OLs"})),n.push(this.turnsIntoOne({icon:"iconCheck",label:window.siyuan.languages.check,protyle:e,selectsElement:t,type:"Blocks2TLs"})),n.push(this.turnsIntoOne({icon:"iconQuote",label:window.siyuan.languages.quote,protyle:e,selectsElement:t,type:"Blocks2Blockquote"}))),a||n.push(this.turnsInto({icon:"iconParagraph",label:window.siyuan.languages.paragraph,accelerator:window.siyuan.config.keymap.editor.heading.paragraph.custom,protyle:e,selectsElement:t,type:"Blocks2Ps",isContinue:i})),n.push(this.turnsInto({icon:"iconH1",label:window.siyuan.languages.heading1,accelerator:window.siyuan.config.keymap.editor.heading.heading1.custom,protyle:e,selectsElement:t,level:1,type:"Blocks2Hs",isContinue:i})),n.push(this.turnsInto({icon:"iconH2",label:window.siyuan.languages.heading2,accelerator:window.siyuan.config.keymap.editor.heading.heading2.custom,protyle:e,selectsElement:t,level:2,type:"Blocks2Hs",isContinue:i})),n.push(this.turnsInto({icon:"iconH3",label:window.siyuan.languages.heading3,accelerator:window.siyuan.config.keymap.editor.heading.heading3.custom,protyle:e,selectsElement:t,level:3,type:"Blocks2Hs",isContinue:i})),n.push(this.turnsInto({icon:"iconH4",label:window.siyuan.languages.heading4,accelerator:window.siyuan.config.keymap.editor.heading.heading4.custom,protyle:e,selectsElement:t,level:4,type:"Blocks2Hs",isContinue:i})),n.push(this.turnsInto({icon:"iconH5",label:window.siyuan.languages.heading5,accelerator:window.siyuan.config.keymap.editor.heading.heading5.custom,protyle:e,selectsElement:t,level:5,type:"Blocks2Hs",isContinue:i})),n.push(this.turnsInto({icon:"iconH6",label:window.siyuan.languages.heading6,accelerator:window.siyuan.config.keymap.editor.heading.heading6.custom,protyle:e,selectsElement:t,level:6,type:"Blocks2Hs",isContinue:i})),window.siyuan.menus.menu.append(new l.MenuItem({icon:"iconRefresh",label:window.siyuan.languages.turnInto,type:"submenu",submenu:n}).element),i&&window.siyuan.menus.menu.append(new l.MenuItem({icon:"iconSuper",label:window.siyuan.languages.merge+" "+window.siyuan.languages.superBlock,type:"submenu",submenu:[this.turnsIntoOne({label:window.siyuan.languages.hLayout,accelerator:window.siyuan.config.keymap.editor.general.hLayout.custom,icon:"iconSplitLR",protyle:e,selectsElement:t,type:"BlocksMergeSuperBlock",level:"col"}),this.turnsIntoOne({label:window.siyuan.languages.vLayout,accelerator:window.siyuan.config.keymap.editor.general.vLayout.custom,icon:"iconSplitTB",protyle:e,selectsElement:t,type:"BlocksMergeSuperBlock",level:"row"})]}).element)}if(window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.copy,icon:"iconCopy",accelerator:"⌘C",click(){if((0,v.isNotEditBlock)(t[0])){let n="";t.forEach((e=>{n+=(0,b.removeEmbed)(e)})),(0,u.writeText)(e.lute.BlockDOM2StdMd(n).trimEnd())}else(0,h.focusByRange)((0,h.getEditorRange)(t[0])),document.execCommand("copy")}}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.copyPlainText,accelerator:window.siyuan.config.keymap.editor.general.copyPlainText.custom,click(){let e="";t.forEach((t=>{t.querySelectorAll('[contenteditable="true"]').forEach((t=>{const n=t.cloneNode(!0);n.querySelectorAll('[data-type="backslash"]').forEach((e=>{e.firstElementChild.remove()})),e+=n.textContent+"\n"}))})),(0,u.writeText)(e.trimEnd())}}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.copy+" HTML",click(){let n="";t.forEach((e=>{n+=e.outerHTML})),(0,u.writeText)(e.lute.BlockDOM2HTML(n))}}).element),window.siyuan.config.readonly)return;window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.cut,accelerator:"⌘X",icon:"iconCut",click:()=>{var n;if((0,v.isNotEditBlock)(t[0])){let i="";t.forEach((e=>{i+=(0,b.removeEmbed)(e)})),(0,u.writeText)(e.lute.BlockDOM2StdMd(i).trimEnd()),null===(n=e.breadcrumb)||void 0===n||n.hide(),(0,p.removeBlock)(e,t[0],(0,h.getEditorRange)(t[0]))}else(0,h.focusByRange)((0,h.getEditorRange)(t[0])),document.execCommand("cut")}}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.move,accelerator:window.siyuan.config.keymap.general.move.custom,icon:"iconMove",click:()=>{e.toolbar.showFile(e,t,(0,h.getEditorRange)(t[0]))}}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.delete,icon:"iconTrashcan",accelerator:"⌫",click:()=>{var n;null===(n=e.breadcrumb)||void 0===n||n.hide(),(0,p.removeBlock)(e,t[0],(0,h.getEditorRange)(t[0]))}}).element),window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element);const o=new l.MenuItem({label:window.siyuan.languages.appearance,submenu:this.genCardStyle(t,e).concat(this.genFontStyle(t,e)).concat(this.genBGStyle(t,e))}).element;return window.siyuan.menus.menu.append(o),o.lastElementChild.classList.add("b3-menu__submenu--row"),this.genAlign(t,e),this.genWidths(t,e),window.siyuan.menus.menu}renderMenu(e,t){var n,i;(0,f.hideElements)(["hint"],e),window.siyuan.menus.menu.remove();const a=t.getAttribute("data-node-id"),s=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(s.length>1){if(Array.from(s).find((e=>{if(a===e.getAttribute("data-node-id"))return!0})))return this.renderMultipleMenu(e,Array.from(s))}let g;if("BUTTON"===t.tagName?Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${a}"]`)).find((e=>{if(!(0,o.hasClosestByAttribute)(e.parentElement,"data-type","NodeBlockQueryEmbed"))return g=e,!0})):g=t,!g)return;const C=g.getAttribute("data-type"),D=g.getAttribute("data-subtype"),x=[];if((0,f.hideElements)(["select"],e),g.classList.add("protyle-wysiwyg--select"),(0,S.countBlockWord)([g.getAttribute("data-node-id")]),"NodeParagraph"!==C||window.siyuan.config.readonly?"NodeHeading"!==C||window.siyuan.config.readonly?"NodeList"!==C||window.siyuan.config.readonly?"NodeBlockquote"!==C||window.siyuan.config.readonly||x.push(this.turnsOneInto({icon:"iconParagraph",label:window.siyuan.languages.paragraph,protyle:e,nodeElement:g,id:a,type:"CancelBlockquote"})):(x.push(this.turnsOneInto({icon:"iconParagraph",label:window.siyuan.languages.paragraph,protyle:e,nodeElement:g,id:a,type:"CancelList"})),"o"===g.getAttribute("data-subtype")?(x.push(this.turnsOneInto({icon:"iconList",label:window.siyuan.languages.list,protyle:e,nodeElement:g,id:a,type:"OL2UL"})),x.push(this.turnsOneInto({icon:"iconCheck",label:window.siyuan.languages.check,protyle:e,nodeElement:g,id:a,type:"UL2TL"}))):"t"===g.getAttribute("data-subtype")?(x.push(this.turnsOneInto({icon:"iconList",label:window.siyuan.languages.list,protyle:e,nodeElement:g,id:a,type:"TL2UL"})),x.push(this.turnsOneInto({icon:"iconOrderedList",label:window.siyuan.languages["ordered-list"],protyle:e,nodeElement:g,id:a,type:"TL2OL"}))):(x.push(this.turnsOneInto({icon:"iconOrderedList",label:window.siyuan.languages["ordered-list"],protyle:e,nodeElement:g,id:a,type:"UL2OL"})),x.push(this.turnsOneInto({icon:"iconCheck",label:window.siyuan.languages.check,protyle:e,nodeElement:g,id:a,type:"OL2TL"})))):(x.push(this.turnsInto({icon:"iconParagraph",label:window.siyuan.languages.paragraph,accelerator:window.siyuan.config.keymap.editor.heading.paragraph.custom,protyle:e,selectsElement:[g],level:6,type:"Blocks2Ps"})),"h1"!==D&&x.push(this.turnsInto({icon:"iconH1",label:window.siyuan.languages.heading1,accelerator:window.siyuan.config.keymap.editor.heading.heading1.custom,protyle:e,selectsElement:[g],level:1,type:"Blocks2Hs"})),"h2"!==D&&x.push(this.turnsInto({icon:"iconH2",label:window.siyuan.languages.heading2,accelerator:window.siyuan.config.keymap.editor.heading.heading2.custom,protyle:e,selectsElement:[g],level:2,type:"Blocks2Hs"})),"h3"!==D&&x.push(this.turnsInto({icon:"iconH3",label:window.siyuan.languages.heading3,accelerator:window.siyuan.config.keymap.editor.heading.heading3.custom,protyle:e,selectsElement:[g],level:3,type:"Blocks2Hs"})),"h4"!==D&&x.push(this.turnsInto({icon:"iconH4",label:window.siyuan.languages.heading4,accelerator:window.siyuan.config.keymap.editor.heading.heading4.custom,protyle:e,selectsElement:[g],level:4,type:"Blocks2Hs"})),"h5"!==D&&x.push(this.turnsInto({icon:"iconH5",label:window.siyuan.languages.heading5,accelerator:window.siyuan.config.keymap.editor.heading.heading5.custom,protyle:e,selectsElement:[g],level:5,type:"Blocks2Hs"})),"h6"!==D&&x.push(this.turnsInto({icon:"iconH6",label:window.siyuan.languages.heading6,accelerator:window.siyuan.config.keymap.editor.heading.heading6.custom,protyle:e,selectsElement:[g],level:6,type:"Blocks2Hs"}))):(x.push(this.turnsIntoOne({icon:"iconList",label:window.siyuan.languages.list,protyle:e,selectsElement:[g],type:"Blocks2ULs"})),x.push(this.turnsIntoOne({icon:"iconOrderedList",label:window.siyuan.languages["ordered-list"],protyle:e,selectsElement:[g],type:"Blocks2OLs"})),x.push(this.turnsIntoOne({icon:"iconCheck",label:window.siyuan.languages.check,protyle:e,selectsElement:[g],type:"Blocks2TLs"})),x.push(this.turnsIntoOne({icon:"iconQuote",label:window.siyuan.languages.quote,protyle:e,selectsElement:[g],type:"Blocks2Blockquote"})),x.push(this.turnsInto({icon:"iconH1",label:window.siyuan.languages.heading1,accelerator:window.siyuan.config.keymap.editor.heading.heading1.custom,protyle:e,selectsElement:[g],level:1,type:"Blocks2Hs"})),x.push(this.turnsInto({icon:"iconH2",label:window.siyuan.languages.heading2,accelerator:window.siyuan.config.keymap.editor.heading.heading2.custom,protyle:e,selectsElement:[g],level:2,type:"Blocks2Hs"})),x.push(this.turnsInto({icon:"iconH3",label:window.siyuan.languages.heading3,accelerator:window.siyuan.config.keymap.editor.heading.heading3.custom,protyle:e,selectsElement:[g],level:3,type:"Blocks2Hs"})),x.push(this.turnsInto({icon:"iconH4",label:window.siyuan.languages.heading4,accelerator:window.siyuan.config.keymap.editor.heading.heading4.custom,protyle:e,selectsElement:[g],level:4,type:"Blocks2Hs"})),x.push(this.turnsInto({icon:"iconH5",label:window.siyuan.languages.heading5,accelerator:window.siyuan.config.keymap.editor.heading.heading5.custom,protyle:e,selectsElement:[g],level:5,type:"Blocks2Hs"})),x.push(this.turnsInto({icon:"iconH6",label:window.siyuan.languages.heading6,accelerator:window.siyuan.config.keymap.editor.heading.heading6.custom,protyle:e,selectsElement:[g],level:6,type:"Blocks2Hs"}))),x.length>0&&!window.siyuan.config.readonly&&window.siyuan.menus.menu.append(new l.MenuItem({icon:"iconRefresh",label:window.siyuan.languages.turnInto,type:"submenu",submenu:x}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.copy,icon:"iconCopy",type:"submenu",submenu:(0,c.copySubMenu)(a,null===(n=g.querySelector(".protyle-attr--name"))||void 0===n?void 0:n.textContent,!0,g).concat([{label:window.siyuan.languages.copy,accelerator:"⌘C",click(){(0,v.isNotEditBlock)(g)?(0,u.writeText)(e.lute.BlockDOM2StdMd((0,b.removeEmbed)(g)).trimEnd()):((0,h.focusByRange)((0,h.getEditorRange)(g)),document.execCommand("copy"))}},{label:window.siyuan.languages.copyPlainText,accelerator:window.siyuan.config.keymap.editor.general.copyPlainText.custom,click(){let e="";g.querySelectorAll('[contenteditable="true"]').forEach((t=>{const n=t.cloneNode(!0);n.querySelectorAll('[data-type="backslash"]').forEach((e=>{e.firstElementChild.remove()})),e+=n.textContent+"\n"})),(0,u.writeText)(e.trimEnd())}},{label:window.siyuan.languages.copy+" HTML",click(){(0,u.writeText)(e.lute.BlockDOM2HTML(g.outerHTML))}},{label:window.siyuan.languages.duplicate,disabled:window.siyuan.config.readonly,click(){const t=g.cloneNode(!0),n=Lute.NewNodeID();t.setAttribute("data-node-id",n),t.querySelectorAll("[data-node-id]").forEach((e=>{e.setAttribute("data-node-id",Lute.NewNodeID())})),g.after(t),(0,k.scrollCenter)(e),(0,d.transaction)(e,[{action:"insert",data:g.nextElementSibling.outerHTML,id:n,previousID:a}],[{action:"delete",id:n}]),(0,h.focusBlock)(t)}}])}).element),window.siyuan.config.readonly||(window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.cut,accelerator:"⌘X",icon:"iconCut",click:()=>{var t;(0,v.isNotEditBlock)(g)?((0,u.writeText)(e.lute.BlockDOM2StdMd((0,b.removeEmbed)(g)).trimEnd()),(0,p.removeBlock)(e,g,(0,h.getEditorRange)(g)),null===(t=e.breadcrumb)||void 0===t||t.hide()):((0,h.focusByRange)((0,h.getEditorRange)(g)),document.execCommand("cut"))}}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.move,accelerator:window.siyuan.config.keymap.general.move.custom,icon:"iconMove",click:()=>{e.toolbar.showFile(e,[g],(0,h.getEditorRange)(g))}}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.delete,icon:"iconTrashcan",accelerator:"⌫",click:()=>{var t;null===(t=e.breadcrumb)||void 0===t||t.hide(),(0,p.removeBlock)(e,g,(0,h.getEditorRange)(g))}}).element)),"NodeSuperBlock"!==C||window.siyuan.config.readonly)if("NodeCodeBlock"!==C||window.siyuan.config.readonly||g.getAttribute("data-subtype"))if("NodeCodeBlock"===C&&!window.siyuan.config.readonly&&["echarts","mindmap"].includes(g.getAttribute("data-subtype"))){window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element);const t=g.style.height;let n=g.outerHTML;window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.chart,icon:"iconCode",submenu:[{label:`${window.siyuan.languages.height}<span class="fn__space"></span>\n<input style="margin: 4px 0;width: 84px" type="number" step="1" min="148" class="b3-text-field" value="${t?parseInt(t):"420"}">`,bind:t=>{t.querySelector("input").addEventListener("change",(t=>{const i=(t.target.value||"420")+"px";g.style.height=i,g.firstElementChild.nextElementSibling.style.height=i,(0,d.updateTransaction)(e,a,g.outerHTML,n),n=g.outerHTML,t.stopPropagation();const o=echarts.getInstanceById(g.firstElementChild.nextElementSibling.getAttribute("_echarts_instance_"));o&&o.resize()}))}},{label:window.siyuan.languages.update,icon:"iconEdit",click(){e.toolbar.showRender(e,g)}}]}).element)}else if("NodeTable"!==C||window.siyuan.config.readonly)"NodeVideo"!==C&&"NodeAudio"!==C||window.siyuan.config.readonly?"NodeIFrame"!==C||window.siyuan.config.readonly?"NodeHTMLBlock"!==C||window.siyuan.config.readonly?"NodeBlockQueryEmbed"!==C||window.siyuan.config.readonly||(window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new l.MenuItem({id:"assetSubMenu",type:"submenu",icon:"iconSQL",label:window.siyuan.languages.blockEmbed,submenu:[{icon:"iconRefresh",label:`${window.siyuan.languages.refresh} SQL`,click(){g.removeAttribute("data-render"),(0,y.blockRender)(e,g)}},{icon:"iconEdit",label:`${window.siyuan.languages.update} SQL`,click(){e.toolbar.showRender(e,g)}}]}).element)):(window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new l.MenuItem({icon:"iconHTML5",label:"HTML",click(){e.toolbar.showRender(e,g)}}).element)):(window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new l.MenuItem({id:"assetSubMenu",type:"submenu",icon:"iconLanguage",label:window.siyuan.languages.assets,submenu:(0,r.iframeMenu)(e,g)}).element)):(window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new l.MenuItem({id:"assetSubMenu",type:"submenu",icon:"NodeVideo"===C?"iconVideo":"iconRecord",label:window.siyuan.languages.assets,submenu:(0,r.videoMenu)(e,g,C)}).element));else{let t=(0,h.getEditorRange)(g);const n=g.querySelector("table");n.contains(t.startContainer)||(t=(0,h.getEditorRange)(n.querySelector("th")));const i=(0,o.hasClosestByMatchTag)(t.startContainer,"TD")||(0,o.hasClosestByMatchTag)(t.startContainer,"TH");i&&(window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new l.MenuItem({type:"submenu",icon:"iconTable",label:window.siyuan.languages.table,submenu:(0,r.tableMenu)(e,g,i,t)}).element))}else{window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element);const e=g.getAttribute("linewrap"),t=g.getAttribute("ligatures"),n=g.getAttribute("linenumber");window.siyuan.menus.menu.append(new l.MenuItem({type:"submenu",icon:"iconCode",label:window.siyuan.languages.code,submenu:[{label:`<div class="fn__flex" style="margin-bottom: 4px"><span>${window.siyuan.languages.md31}</span><span class="fn__space fn__flex-1"></span>\n<input type="checkbox" class="b3-switch fn__flex-center"${"true"===e||window.siyuan.config.editor.codeLineWrap&&"false"!==e?" checked":""}></div>`,bind(e){e.addEventListener("click",(t=>{const n=e.querySelector("input");"INPUT"!==t.target.tagName&&(n.checked=!n.checked),g.setAttribute("linewrap",n.checked.toString()),g.querySelector(".hljs").removeAttribute("data-render"),(0,m.highlightRender)(g),(0,_.fetchPost)("/api/attr/setBlockAttrs",{id:a,attrs:{linewrap:n.checked.toString()}}),window.siyuan.menus.menu.remove()}))}},{label:`<div class="fn__flex" style="margin-bottom: 4px"><span>${window.siyuan.languages.md2}</span><span class="fn__space fn__flex-1"></span>\n<input type="checkbox" class="b3-switch fn__flex-center"${"true"===t||window.siyuan.config.editor.codeLigatures&&"false"!==t?" checked":""}></div>`,bind(e){e.addEventListener("click",(t=>{const n=e.querySelector("input");"INPUT"!==t.target.tagName&&(n.checked=!n.checked),g.setAttribute("ligatures",n.checked.toString()),g.querySelector(".hljs").removeAttribute("data-render"),(0,m.highlightRender)(g),(0,_.fetchPost)("/api/attr/setBlockAttrs",{id:a,attrs:{ligatures:n.checked.toString()}}),window.siyuan.menus.menu.remove()}))}},{label:`<div class="fn__flex" style="margin-bottom: 4px"><span>${window.siyuan.languages.md27}</span><span class="fn__space fn__flex-1"></span>\n<input type="checkbox" class="b3-switch fn__flex-center"${"true"===n||window.siyuan.config.editor.codeSyntaxHighlightLineNum&&"false"!==n?" checked":""}></div>`,bind(e){e.addEventListener("click",(t=>{const n=e.querySelector("input");"INPUT"!==t.target.tagName&&(n.checked=!n.checked),g.setAttribute("linenumber",n.checked.toString()),g.querySelector(".hljs").removeAttribute("data-render"),(0,m.highlightRender)(g),(0,_.fetchPost)("/api/attr/setBlockAttrs",{id:a,attrs:{linenumber:n.checked.toString()}}),window.siyuan.menus.menu.remove()}))}}]}).element)}else window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.cancel+" "+window.siyuan.languages.superBlock,click(){const t=(0,E.cancelSB)(e,g);(0,d.transaction)(e,t.doOperations,t.undoOperations),(0,h.focusBlock)(e.wysiwyg.element.querySelector(`[data-node-id="${t.previousId}"]`)),(0,f.hideElements)(["gutter"],e)}}).element);if(window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new l.MenuItem({accelerator:`${(0,u.updateHotkeyTip)(window.siyuan.config.keymap.general.enter.custom)}/${(0,u.updateHotkeyTip)("⌘Click")}`,label:window.siyuan.languages.enter,click(){(0,r.zoomOut)(e,a)}}).element),window.siyuan.menus.menu.append(new l.MenuItem({accelerator:window.siyuan.config.keymap.general.enterBack.custom,label:window.siyuan.languages.enterBack,click(){if(e.block.showAll)(0,r.zoomOut)(e,e.block.parent2ID,a);else{const t=e.path.split("/");t.length>2&&(0,A.openFileById)({id:t[t.length-2],action:[L.Constants.CB_GET_FOCUS,L.Constants.CB_GET_SCROLL]})}}}).element),!window.siyuan.config.readonly){window.siyuan.menus.menu.append(new l.MenuItem({icon:"iconBefore",label:window.siyuan.languages["insert-before"],accelerator:window.siyuan.config.keymap.editor.general.insertBefore.custom,click(){g.classList.remove("protyle-wysiwyg--select"),(0,S.countBlockWord)([]),(0,E.insertEmptyBlock)(e,"beforebegin",a)}}).element),window.siyuan.menus.menu.append(new l.MenuItem({icon:"iconAfter",label:window.siyuan.languages["insert-after"],accelerator:window.siyuan.config.keymap.editor.general.insertAfter.custom,click(){g.classList.remove("protyle-wysiwyg--select"),(0,S.countBlockWord)([]),(0,E.insertEmptyBlock)(e,"afterend",a)}}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.jumpToParentNext,accelerator:window.siyuan.config.keymap.editor.general.jumpToParentNext.custom,click(){g.classList.remove("protyle-wysiwyg--select"),(0,E.jumpToParentNext)(e,g)}}).element),window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.fold,accelerator:`${(0,u.updateHotkeyTip)(window.siyuan.config.keymap.editor.general.collapse.custom)}/${(0,u.updateHotkeyTip)("⌥Click")}`,click(){(0,r.setFold)(e,g),(0,h.focusBlock)(g)}}).element),"NodeThematicBreak"!==C&&window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.attr,accelerator:window.siyuan.config.keymap.editor.general.attr.custom+"/"+(0,u.updateHotkeyTip)("⇧Click"),click(){(0,c.openAttr)(g,e)}}).element);const t=new l.MenuItem({label:window.siyuan.languages.appearance,submenu:this.genCardStyle([g],e).concat(this.genFontStyle([g],e)).concat(this.genBGStyle([g],e))}).element;window.siyuan.menus.menu.append(t),t.lastElementChild.classList.add("b3-menu__submenu--row"),this.genAlign([g],e),this.genWidths([g],e)}window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element),["NodeThematicBreak","NodeBlockQueryEmbed","NodeIFrame","NodeHTMLBlock","NodeWidget","NodeVideo","NodeAudio"].includes(C)||""===(null===(i=(0,v.getContenteditableElement)(g))||void 0===i?void 0:i.textContent.trim())||"NodeCodeBlock"===C&&("NodeCodeBlock"!==C||g.getAttribute("data-subtype"))||(window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.wechatReminder,icon:"iconMp",click(){(0,c.openWechatNotify)(g)}}).element),window.siyuan.menus.menu.append(new l.MenuItem({type:"separator"}).element));let T=g.getAttribute("updated")||"";return T&&(T=`${window.siyuan.languages.modifiedAt} ${w(T).format("YYYY-MM-DD HH:mm:ss")}<br>`),window.siyuan.menus.menu.append(new l.MenuItem({type:"readonly",label:`<div style="margin-left: -18px;white-space: nowrap;">${T}${window.siyuan.languages.createdAt} ${w(a.substr(0,14)).format("YYYY-MM-DD HH:mm:ss")}</div>`}).element),window.siyuan.menus.menu}genClick(e,t,n){(0,d.updateBatchTransaction)(e,t,n),(0,h.focusBlock)(e[0])}genAlign(e,t){window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.layout,type:"submenu",submenu:[{label:window.siyuan.languages.alignLeft,icon:"iconAlignLeft",accelerator:window.siyuan.config.keymap.editor.general.alignLeft.custom,click:()=>{this.genClick(e,t,(e=>{e.style.textAlign="left"}))}},{label:window.siyuan.languages.alignCenter,icon:"iconAlignCenter",accelerator:window.siyuan.config.keymap.editor.general.alignCenter.custom,click:()=>{this.genClick(e,t,(e=>{e.style.textAlign="center"}))}},{label:window.siyuan.languages.alignRight,icon:"iconAlignRight",accelerator:window.siyuan.config.keymap.editor.general.alignRight.custom,click:()=>{this.genClick(e,t,(e=>{e.style.textAlign="right"}))}},{label:window.siyuan.languages.justify,icon:"iconMenu",click:()=>{this.genClick(e,t,(e=>{e.style.textAlign="justify"}))}}]}).element)}genBGStyle(e,t){const n=[];return["var(--b3-font-background1)","var(--b3-font-background2)","var(--b3-font-background3)","var(--b3-font-background4)","var(--b3-font-background5)","var(--b3-font-background6)","var(--b3-font-background7)","var(--b3-font-background8)","var(--b3-font-background9)","var(--b3-font-background10)","var(--b3-font-background11)","var(--b3-font-background12)","var(--b3-font-background13)"].forEach(((i,a)=>{n.push({label:`<div class="fn__flex" data-type="a" aria-label="${window.siyuan.languages.colorPrimary} ${a+1}">\n    <span style="background-color:${i};" class="b3-color__square fn__flex-center">A</span>\n</div>`,click:()=>{this.genClick(e,t,(e=>{e.style.backgroundColor=i}))}})})),n.push({type:"separator"}),n.push({label:`<div class="fn__flex" data-type="a" aria-label="${window.siyuan.languages.clearFontStyle}">\n    <span class="b3-color__square fn__flex-center">A</span>\n</div>`,click:()=>{this.genClick(e,t,(e=>{e.style.textShadow="",e.style.color="",e.style.webkitBackgroundClip="",e.style.backgroundImage="",e.style.webkitTextFillColor="",e.style.webkitTextStroke="",e.style.textShadow="",e.style.backgroundColor=""}))}}),n}genWidths(e,t){const n=[];["25%","33%","50%","67%","75%"].forEach((i=>{n.push({label:i,click:()=>{this.genClick(e,t,(e=>{e.style.width=i,e.style.flex="none"}))}})})),n.push({type:"separator"});let i=100;if(1===e.length){const t=e[0].style.width;t.endsWith("%")&&(i=parseInt(t))}window.siyuan.menus.menu.append(new l.MenuItem({label:window.siyuan.languages.width,submenu:n.concat([{label:`<div aria-label="${i}%" class="b3-tooltips b3-tooltips__n fn__size200">\n    <input style="box-sizing: border-box" value="${i}" class="b3-slider fn__block" max="100" min="1" step="1" type="range">\n</div>`,bind(n){const i=n.querySelector("input");i.addEventListener("input",(()=>{e.forEach((e=>{e.style.width=i.value+"%",e.style.flex="none"})),i.parentElement.setAttribute("aria-label",`${i.value}%`)}));const a=[],o=[];e.forEach((e=>{a.push({action:"update",id:e.getAttribute("data-node-id"),data:e.outerHTML})})),i.addEventListener("change",(()=>{e.forEach((e=>{o.push({action:"update",id:e.getAttribute("data-node-id"),data:e.outerHTML})})),(0,d.transaction)(t,o,a),window.siyuan.menus.menu.remove(),(0,h.focusBlock)(e[0])}))}},{type:"separator"},{label:window.siyuan.languages.clearFontStyle,icon:"iconTrashcan",click:()=>{this.genClick(e,t,(e=>{e.style.width&&(e.style.width="",e.style.flex="")}))}}])}).element)}genFontStyle(e,t){const n=[];return["var(--b3-font-color1)","var(--b3-font-color2)","var(--b3-font-color3)","var(--b3-font-color4)","var(--b3-font-color5)","var(--b3-font-color6)","var(--b3-font-color7)","var(--b3-font-color8)","var(--b3-font-color9)","var(--b3-font-color10)","var(--b3-font-color11)","var(--b3-font-color12)","var(--b3-font-color13)"].forEach(((i,a)=>{n.push({label:`<div class="fn__flex" data-type="a" aria-label="${window.siyuan.languages.colorFont} ${a+1}">\n    <span style="color:${i};" class="b3-color__square fn__flex-center">A</span>\n</div>`,click:()=>{this.genClick(e,t,(e=>{e.style.color=i}))}})})),n.push({type:"separator"}),n}genCardStyle(e,t){const n=[];return["error","warning","info","success"].forEach((i=>{n.push({label:`<div class="fn__flex" data-type="a" aria-label="${window.siyuan.languages[i+"Style"]}">\n    <span style="color: var(--b3-card-${i}-color);background-color: var(--b3-card-${i}-background);" class="b3-color__square fn__flex-center">A</span>    \n</div>`,click:()=>{this.genClick(e,t,(e=>{e.style.color=`var(--b3-card-${i}-color)`,e.style.backgroundColor=`var(--b3-card-${i}-background)`}))}})})),n.push({type:"separator"}),n.concat([{label:`<div class="fn__flex" data-type="a" aria-label="${window.siyuan.languages.hollow}">\n    <span style="-webkit-text-stroke: 0.2px var(--b3-theme-on-background);-webkit-text-fill-color : transparent;" class="b3-color__square fn__flex-center">A</span>\n</div>`,click:()=>{this.genClick(e,t,(e=>{e.style.webkitTextStroke="0.2px var(--b3-theme-on-background)",e.style.webkitTextFillColor="transparent"}))}},{label:`<div class="fn__flex" data-type="a" aria-label="${window.siyuan.languages.shadow}">\n    <span style="text-shadow: 1px 1px var(--b3-border-color), 2px 2px var(--b3-border-color), 3px 3px var(--b3-border-color), 4px 4px var(--b3-border-color)" class="b3-color__square fn__flex-center">A</span>\n</div>`,click:()=>{this.genClick(e,t,(e=>{e.style.textShadow="1px 1px var(--b3-border-color), 2px 2px var(--b3-border-color), 3px 3px var(--b3-border-color), 4px 4px var(--b3-border-color)"}))}},{type:"separator"}])}render(e,t){const n=t.parentElement.querySelector(".protyle-title__input");if(n&&"true"!==n.getAttribute("data-render"))return;const i=t.parentElement.parentElement.querySelector(".protyle-select");if(i&&!i.classList.contains("fn__none"))return;let a,r="",l=e,c=0,u=0,d=!1;for(;l;){const e=!d||d&&"1"===l.getAttribute("fold");if(!(0,o.hasClosestByAttribute)(l.parentElement,"data-type","NodeBlockQueryEmbed")){let t;if(e&&(t=l.getAttribute("data-type")),0===u){if(["NodeBlockquote","NodeList","NodeSuperBlock"].includes(t))return;const e=(0,v.getTopAloneElement)(l);a=e.querySelector(".li")||e.querySelector(".list"),e.isSameNode(l)||"NodeHeading"===t||(l=e,t=l.getAttribute("data-type"))}"NodeListItem"!==t||1!==u||e||(r=""),u+=1,e&&(r=`<button ${window.siyuan.config.readonly?"":'draggable="true"'} data-type="${t}"  data-subtype="${l.getAttribute("data-subtype")}" data-node-id="${l.getAttribute("data-node-id")}"><svg><use xlink:href="#${(0,s.getIconByType)(t,l.getAttribute("data-subtype"))}"></use></svg></button>`+r);let n="";if("NodeListItem"===t&&l.childElementCount>3||"NodeHeading"===t){const e=l.getAttribute("fold");n=`<button data-type="fold"><svg style="width:10px${e&&"1"===e?"":";transform:rotate(90deg)"}"><use xlink:href="#iconPlay"></use></svg></button>`}"NodeListItem"!==t&&"NodeList"!==t||(a=l,"NodeListItem"===t&&l.childElementCount>3&&(r=`<button ${window.siyuan.config.readonly?"":'draggable="true"'} data-type="${t}"  data-subtype="${l.getAttribute("data-subtype")}" data-node-id="${l.getAttribute("data-node-id")}"><svg><use xlink:href="#${(0,s.getIconByType)(t,l.getAttribute("data-subtype"))}"></use></svg></button>${n}`)),"NodeHeading"===t&&(r+=n),"NodeBlockquote"===t&&(c+=8),l.previousElementSibling&&l.previousElementSibling.getAttribute("data-node-id")&&(d=!0)}const t=(0,o.hasClosestBlock)(l.parentElement);if(!t)break;l=t}let p=!0;const h=this.element.querySelectorAll("button");if(h.length!==r.split("</button>").length-1?p=!1:h.forEach((e=>{const t=e.getAttribute("data-node-id");t&&-1===r.indexOf(t)&&(p=!1)})),p&&this.element.childElementCount>0)return void this.element.classList.remove("fn__none");this.element.innerHTML=r,this.element.classList.remove("fn__none"),this.element.style.width="";let f=e.getBoundingClientRect(),g=0;a?(f=a.firstElementChild.getBoundingClientRect(),c=0):"NodeBlockQueryEmbed"===l.getAttribute("data-type")?(f=l.getBoundingClientRect(),c=0):(f.height<Math.floor(1.625*window.siyuan.config.editor.fontSize)+8||f.height>Math.floor(1.625*window.siyuan.config.editor.fontSize)+8&&f.height<2*Math.floor(1.625*window.siyuan.config.editor.fontSize)+8)&&(g=(f.height-this.element.clientHeight)/2),this.element.style.top=`${Math.max(f.top,t.parentElement.getBoundingClientRect().top)+g}px`;let m=f.left-this.element.clientWidth-c;"NodeBlockQueryEmbed"===l.getAttribute("data-type")&&1===this.element.childElementCount&&(m=l.getBoundingClientRect().left-this.element.clientWidth-c),this.element.style.left=`${m}px`,m<this.element.parentElement.getBoundingClientRect().left?(this.element.style.width="24px",this.element.style.left=f.left-this.element.clientWidth-c/2+"px",r="",Array.from(this.element.children).reverse().forEach(((e,t)=>{0!==t&&(e.firstElementChild.style.height="14px"),r+=e.outerHTML})),this.element.innerHTML=r):this.element.querySelectorAll("svg").forEach((e=>{e.style.height=""}))}}},283:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Background=void 0;const i=n(3607),a=n(3274),o=n(5378),s=n(2239),r=n(734),l=n(7640),c=n(9398),u=n(4681),d=n(7954),p=n(9866);t.Background=class{constructor(e){this.transparentData="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",this.element=document.createElement("div"),this.element.className="protyle-background",this.element.innerHTML=`<div class="protyle-background__img">\n    <img class="fn__none">\n    <div class="protyle-icons">\n        <span class="protyle-icon protyle-icon--first b3-tooltips b3-tooltips__sw" style="position: relative" aria-label="${window.siyuan.languages.upload}"><input type="file" style="position: absolute;width: 22px;height: 100%;top: 0;left: 0;opacity: .001;overflow: hidden;cursor: pointer;"><svg><use xlink:href="#iconUpload"></use></svg></span>\n        <span class="protyle-icon b3-tooltips b3-tooltips__sw" data-type="link" aria-label="${window.siyuan.languages.link}"><svg><use xlink:href="#iconLink"></use></svg></span>\n        <span class="protyle-icon b3-tooltips b3-tooltips__sw" data-type="random" aria-label="${window.siyuan.languages.random}"><svg><use xlink:href="#iconRefresh"></use></svg></span>\n        <span class="protyle-icon b3-tooltips b3-tooltips__sw fn__none" data-type="position" aria-label="${window.siyuan.languages.dragPosition}"><svg><use xlink:href="#iconMove"></use></svg></span>\n        <span class="protyle-icon protyle-icon--last b3-tooltips b3-tooltips__sw" data-type="remove" aria-label="${window.siyuan.languages.remove}"><svg><use xlink:href="#iconTrashcan"></use></svg></span>\n    </div>\n    <div class="protyle-icons fn__none"><span class="protyle-icon protyle-icon--text">${window.siyuan.languages.dragPosition}</span></div>\n    <div class="protyle-icons fn__none" style="opacity: .86;">\n        <span class="protyle-icon protyle-icon--first" data-type="cancel">${window.siyuan.languages.cancel}</span>\n        <span class="protyle-icon protyle-icon--last" data-type="confirm">${window.siyuan.languages.confirm}</span>\n    </div>\n</div>\n<div class="protyle-background__tags"></div>\n<div class="protyle-background__iconw">\n    <div class="protyle-background__icon" data-menu="true" data-type="open-emoji"></div>\n    <div class="protyle-icons fn__flex-center">\n        <span class="protyle-icon protyle-icon--first b3-tooltips b3-tooltips__s" data-menu="true" data-type="tag" aria-label="${window.siyuan.languages.addTag}"><svg><use xlink:href="#iconTags"></use></svg></span>\n        <span class="protyle-icon b3-tooltips b3-tooltips__s" data-type="icon" aria-label="${window.siyuan.languages.changeIcon}"><svg><use xlink:href="#iconEmoji"></use></svg></span>\n        <span class="protyle-icon protyle-icon--last b3-tooltips b3-tooltips__s" data-type="random" aria-label="${window.siyuan.languages.titleBg}"><svg><use xlink:href="#iconImage"></use></svg></span>\n    </div>\n</div>`,this.tagsElement=this.element.querySelector(".protyle-background__tags"),this.iconElement=this.element.querySelector(".protyle-background__icon"),this.imgElement=this.element.firstElementChild.firstElementChild,(0,a.isMobile)()?this.imgElement.addEventListener("touchstart",(e=>{if(e.preventDefault(),!this.element.firstElementChild.querySelector(".protyle-icons").classList.contains("fn__none"))return;const t=e.touches[0].clientY,n=document,i=this.imgElement.naturalHeight*this.imgElement.clientWidth/this.imgElement.naturalWidth-this.imgElement.clientHeight;let a=parseFloat(this.imgElement.style.objectPosition.substring(7))||50;this.imgElement.style.objectPosition.endsWith("px")&&(a=-parseInt(this.imgElement.style.objectPosition.substring(7))/i*100),n.ontouchmove=n=>{this.imgElement.style.objectPosition=`center ${((t-n.touches[0].clientY)/i*100+a).toFixed(2)}%`,e.preventDefault()},n.ontouchend=()=>{n.ontouchmove=null,n.ontouchstart=null,n.ondragstart=null,n.onselectstart=null,n.onselect=null}})):this.imgElement.addEventListener("mousedown",(e=>{if(e.preventDefault(),!this.element.firstElementChild.querySelector(".protyle-icons").classList.contains("fn__none"))return;const t=e.clientY,n=document,i=this.imgElement.naturalHeight*this.imgElement.clientWidth/this.imgElement.naturalWidth-this.imgElement.clientHeight;let a=parseFloat(this.imgElement.style.objectPosition.substring(7))||50;this.imgElement.style.objectPosition.endsWith("px")&&(a=-parseInt(this.imgElement.style.objectPosition.substring(7))/i*100),n.onmousemove=n=>{this.imgElement.style.objectPosition=`center ${((t-n.clientY)/i*100+a).toFixed(2)}%`,e.preventDefault()},n.onmouseup=()=>{n.onmousemove=null,n.onmouseup=null,n.ondragstart=null,n.onselectstart=null,n.onselect=null}})),this.element.querySelector("input").addEventListener("change",(t=>{0!==t.target.files.length&&(0,s.uploadFiles)(e,t.target.files,t.target,(t=>{const n=JSON.parse(t),i=`background-image:url("${n.data.succMap[Object.keys(n.data.succMap)[0]]}")`;this.ial["title-img"]=i,this.render(this.ial,e.block.rootID),(0,r.fetchPost)("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":i}})}))})),this.element.addEventListener((0,d.getEventName)(),(t=>{let n=t.target;for((0,o.hideElements)(["gutter"],e);n&&!n.isEqualNode(this.element);){const i=n.getAttribute("data-type");if("position"===i){const e=this.element.firstElementChild.querySelectorAll(".protyle-icons");e[0].classList.add("fn__none"),e[1].classList.remove("fn__none"),e[2].classList.remove("fn__none"),this.imgElement.style.cursor="move",t.preventDefault(),t.stopPropagation();break}if("cancel"===i||"confirm"===i){this.imgElement.style.cursor="";const n=this.element.firstElementChild.querySelectorAll(".protyle-icons");if(n[0].classList.remove("fn__none"),n[1].classList.add("fn__none"),n[2].classList.add("fn__none"),"confirm"===i){const t=`background-image:url("${this.imgElement.getAttribute("src")}");object-position:${this.imgElement.style.objectPosition}`;this.ial["title-img"]=t,(0,r.fetchPost)("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":t}})}else this.render(this.ial,e.block.rootID);t.preventDefault(),t.stopPropagation();break}if("open-emoji"===i){(0,l.openEmojiPanel)(e.block.rootID,this.iconElement),t.preventDefault(),t.stopPropagation();break}if("random"===i){const n=["background:radial-gradient(black 3px, transparent 4px),radial-gradient(black 3px, transparent 4px),linear-gradient(#fff 4px, transparent 0),linear-gradient(45deg, transparent 74px, transparent 75px, #a4a4a4 75px, #a4a4a4 76px, transparent 77px, transparent 109px),linear-gradient(-45deg, transparent 75px, transparent 76px, #a4a4a4 76px, #a4a4a4 77px, transparent 78px, transparent 109px),#fff;background-size: 109px 109px, 109px 109px,100% 6px, 109px 109px, 109px 109px;background-position: 54px 55px, 0px 0px, 0px 0px, 0px 0px, 0px 0px;","background: linear-gradient(45deg, #dca 12%, transparent 0, transparent 88%, #dca 0),linear-gradient(135deg, transparent 37%, #a85 0, #a85 63%, transparent 0),linear-gradient(45deg, transparent 37%, #dca 0, #dca 63%, transparent 0) #753;background-size: 25px 25px;","background: linear-gradient(315deg, transparent 75%, #d45d55 0)-10px 0, linear-gradient(45deg, transparent 75%, #d45d55 0)-10px 0, linear-gradient(135deg, #a7332b 50%, transparent 0) 0 0, linear-gradient(45deg, #6a201b 50%, #561a16 0) 0 0 #561a16;background-size: 20px 20px;","background: linear-gradient(#ffffff 50%, rgba(255,255,255,0) 0) 0 0, radial-gradient(circle closest-side, #FFFFFF 53%, rgba(255,255,255,0) 0) 0 0, radial-gradient(circle closest-side, #FFFFFF 50%, rgba(255,255,255,0) 0) 55px 0 #48B;background-size: 110px 200px;background-repeat: repeat-x;","background:radial-gradient(circle farthest-side at 0% 50%,#fb1 23.5%,rgba(240,166,17,0) 0)21px 30px, radial-gradient(circle farthest-side at 0% 50%,#B71 24%,rgba(240,166,17,0) 0)19px 30px, linear-gradient(#fb1 14%,rgba(240,166,17,0) 0, rgba(240,166,17,0) 85%,#fb1 0)0 0, linear-gradient(150deg,#fb1 24%,#B71 0,#B71 26%,rgba(240,166,17,0) 0,rgba(240,166,17,0) 74%,#B71 0,#B71 76%,#fb1 0)0 0, linear-gradient(30deg,#fb1 24%,#B71 0,#B71 26%,rgba(240,166,17,0) 0,rgba(240,166,17,0) 74%,#B71 0,#B71 76%,#fb1 0)0 0, linear-gradient(90deg,#B71 2%,#fb1 0,#fb1 98%,#B71 0%)0 0 #fb1;background-size: 40px 60px;","background-color: gray;background-image: linear-gradient(transparent 50%, rgba(255,255,255,.5) 50%);background-size: 50px 50px;","background-color: gray;background-image: linear-gradient(90deg, transparent 50%, rgba(255,255,255,.5) 50%);background-size: 50px 50px;","background-color: #026873;background-image: linear-gradient(90deg, rgba(255,255,255,.07) 50%, transparent 50%),linear-gradient(90deg, rgba(255,255,255,.13) 50%, transparent 50%),linear-gradient(90deg, transparent 50%, rgba(255,255,255,.17) 50%),linear-gradient(90deg, transparent 50%, rgba(255,255,255,.19) 50%);background-size: 13px, 29px, 37px, 53px;","background-color: gray;background-image: repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,.5) 35px, rgba(255,255,255,.5) 70px);","background-color:white;background-image: linear-gradient(90deg, rgba(200,0,0,.5) 50%, transparent 50%),linear-gradient(rgba(200,0,0,.5) 50%, transparent 50%);background-size:50px 50px;","background-color:#269;background-image: linear-gradient(white 2px, transparent 2px),linear-gradient(90deg, white 2px, transparent 2px),linear-gradient(rgba(255,255,255,.3) 1px, transparent 1px),linear-gradient(90deg, rgba(255,255,255,.3) 1px, transparent 1px);background-size: 100px 100px, 100px 100px, 20px 20px, 20px 20px;background-position:-2px -2px, -2px -2px, -1px -1px, -1px -1px;","background-color: #fff;background-image:linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px),linear-gradient(#eee .1em, transparent .1em);background-size: 100% 1.2em;","background-color: hsl(34, 53%, 82%);background-image: repeating-linear-gradient(45deg, transparent 5px, hsla(197, 62%, 11%, 0.5) 5px, hsla(197, 62%, 11%, 0.5) 10px, hsla(5, 53%, 63%, 0) 10px, hsla(5, 53%, 63%, 0) 35px, hsla(5, 53%, 63%, 0.5) 35px, hsla(5, 53%, 63%, 0.5) 40px, hsla(197, 62%, 11%, 0.5) 40px, hsla(197, 62%, 11%, 0.5) 50px, hsla(197, 62%, 11%, 0) 50px, hsla(197, 62%, 11%, 0) 60px, hsla(5, 53%, 63%, 0.5) 60px, hsla(5, 53%, 63%, 0.5) 70px, hsla(35, 91%, 65%, 0.5) 70px, hsla(35, 91%, 65%, 0.5) 80px, hsla(35, 91%, 65%, 0) 80px, hsla(35, 91%, 65%, 0) 90px, hsla(5, 53%, 63%, 0.5) 90px, hsla(5, 53%, 63%, 0.5) 110px, hsla(5, 53%, 63%, 0) 110px, hsla(5, 53%, 63%, 0) 120px, hsla(197, 62%, 11%, 0.5) 120px, hsla(197, 62%, 11%, 0.5) 140px),repeating-linear-gradient(135deg, transparent 5px, hsla(197, 62%, 11%, 0.5) 5px, hsla(197, 62%, 11%, 0.5) 10px, hsla(5, 53%, 63%, 0) 10px, hsla(5, 53%, 63%, 0) 35px, hsla(5, 53%, 63%, 0.5) 35px, hsla(5, 53%, 63%, 0.5) 40px, hsla(197, 62%, 11%, 0.5) 40px, hsla(197, 62%, 11%, 0.5) 50px, hsla(197, 62%, 11%, 0) 50px, hsla(197, 62%, 11%, 0) 60px, hsla(5, 53%, 63%, 0.5) 60px, hsla(5, 53%, 63%, 0.5) 70px, hsla(35, 91%, 65%, 0.5) 70px, hsla(35, 91%, 65%, 0.5) 80px, hsla(35, 91%, 65%, 0) 80px, hsla(35, 91%, 65%, 0) 90px, hsla(5, 53%, 63%, 0.5) 90px, hsla(5, 53%, 63%, 0.5) 110px, hsla(5, 53%, 63%, 0) 110px, hsla(5, 53%, 63%, 0) 140px, hsla(197, 62%, 11%, 0.5) 140px, hsla(197, 62%, 11%, 0.5) 160px);","background-color: hsl(2, 57%, 40%);background-image: repeating-linear-gradient(transparent, transparent 50px, rgba(0,0,0,.4) 50px, rgba(0,0,0,.4) 53px, transparent 53px, transparent 63px, rgba(0,0,0,.4) 63px, rgba(0,0,0,.4) 66px, transparent 66px, transparent 116px, rgba(0,0,0,.5) 116px, rgba(0,0,0,.5) 166px, rgba(255,255,255,.2) 166px, rgba(255,255,255,.2) 169px, rgba(0,0,0,.5) 169px, rgba(0,0,0,.5) 179px, rgba(255,255,255,.2) 179px, rgba(255,255,255,.2) 182px, rgba(0,0,0,.5) 182px, rgba(0,0,0,.5) 232px, transparent 232px),repeating-linear-gradient(270deg, transparent, transparent 50px, rgba(0,0,0,.4) 50px, rgba(0,0,0,.4) 53px, transparent 53px, transparent 63px, rgba(0,0,0,.4) 63px, rgba(0,0,0,.4) 66px, transparent 66px, transparent 116px, rgba(0,0,0,.5) 116px, rgba(0,0,0,.5) 166px, rgba(255,255,255,.2) 166px, rgba(255,255,255,.2) 169px, rgba(0,0,0,.5) 169px, rgba(0,0,0,.5) 179px, rgba(255,255,255,.2) 179px, rgba(255,255,255,.2) 182px, rgba(0,0,0,.5) 182px, rgba(0,0,0,.5) 232px, transparent 232px),repeating-linear-gradient(125deg, transparent, transparent 2px, rgba(0,0,0,.2) 2px, rgba(0,0,0,.2) 3px, transparent 3px, transparent 5px, rgba(0,0,0,.2) 5px);","background-color: #eee;background-image: linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%, black),linear-gradient(-45deg, black 25%, transparent 25%, transparent 75%, black 75%, black);background-size: 60px 60px;","background-color: #eee;background-image: linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%, black),linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%, black);background-size: 60px 60px;background-position: 0 0, 30px 30px;","background:linear-gradient(-45deg, white 25%, transparent 25%, transparent 75%, black 75%, black) 0 0, linear-gradient(-45deg, black 25%, transparent 25%, transparent 75%, white 75%, white) 1em 1em, linear-gradient(45deg, black 17%, transparent 17%, transparent 25%, black 25%, black 36%, transparent 36%, transparent 64%, black 64%, black 75%, transparent 75%, transparent 83%, black 83%) 1em 1em;background-color: white;background-size: 2em 2em;","background-color:#001;background-image: radial-gradient(white 15%, transparent 16%),radial-gradient(white 15%, transparent 16%);background-size: 60px 60px;background-position: 0 0, 30px 30px;","background-color:#556;background-image: linear-gradient(30deg, #445 12%, transparent 12.5%, transparent 87%, #445 87.5%, #445),linear-gradient(150deg, #445 12%, transparent 12.5%, transparent 87%, #445 87.5%, #445),linear-gradient(30deg, #445 12%, transparent 12.5%, transparent 87%, #445 87.5%, #445),linear-gradient(150deg, #445 12%, transparent 12.5%, transparent 87%, #445 87.5%, #445),linear-gradient(60deg, #99a 25%, transparent 25.5%, transparent 75%, #99a 75%, #99a),linear-gradient(60deg, #99a 25%, transparent 25.5%, transparent 75%, #99a 75%, #99a);background-size:80px 140px;background-position: 0 0, 0 0, 40px 70px, 40px 70px, 0 0, 40px 70px;","background-color:silver;background-image:radial-gradient(circle at 100% 150%, silver 24%, white 24%, white 28%, silver 28%, silver 36%, white 36%, white 40%, transparent 40%, transparent),radial-gradient(circle at 0    150%, silver 24%, white 24%, white 28%, silver 28%, silver 36%, white 36%, white 40%, transparent 40%, transparent),radial-gradient(circle at 50%  100%, white 10%, silver 10%, silver 23%, white 23%, white 30%, silver 30%, silver 43%, white 43%, white 50%, silver 50%, silver 63%, white 63%, white 71%, transparent 71%, transparent),radial-gradient(circle at 100% 50%, white 5%, silver 5%, silver 15%, white 15%, white 20%, silver 20%, silver 29%, white 29%, white 34%, silver 34%, silver 44%, white 44%, white 49%, transparent 49%, transparent),radial-gradient(circle at 0    50%, white 5%, silver 5%, silver 15%, white 15%, white 20%, silver 20%, silver 29%, white 29%, white 34%, silver 34%, silver 44%, white 44%, white 49%, transparent 49%, transparent);background-size: 100px 50px;","background-color: silver;background-image: linear-gradient(335deg, #b00 23px, transparent 23px),linear-gradient(155deg, #d00 23px, transparent 23px),linear-gradient(335deg, #b00 23px, transparent 23px),linear-gradient(155deg, #d00 23px, transparent 23px);background-size: 58px 58px;background-position: 0px 2px, 4px 35px, 29px 31px, 34px 6px;","background-color:#def;background-image: radial-gradient(closest-side, transparent 98%, rgba(0,0,0,.3) 99%),radial-gradient(closest-side, transparent 98%, rgba(0,0,0,.3) 99%);background-size:80px 80px;background-position:0 0, 40px 40px;","background-image:radial-gradient(closest-side, transparent 0%, transparent 75%, #B6CC66 76%, #B6CC66 85%, #EDFFDB 86%, #EDFFDB 94%, #FFFFFF 95%, #FFFFFF 103%, #D9E6A7 104%, #D9E6A7 112%, #798B3C 113%, #798B3C 121%, #FFFFFF 122%, #FFFFFF 130%, #E0EAD7 131%, #E0EAD7 140%),radial-gradient(closest-side, transparent 0%, transparent 75%, #B6CC66 76%, #B6CC66 85%, #EDFFDB 86%, #EDFFDB 94%, #FFFFFF 95%, #FFFFFF 103%, #D9E6A7 104%, #D9E6A7 112%, #798B3C 113%, #798B3C 121%, #FFFFFF 122%, #FFFFFF 130%, #E0EAD7 131%, #E0EAD7 140%);background-size: 110px 110px;background-color: #C8D3A7;background-position: 0 0, 55px 55px;","background:linear-gradient(324deg, #232927 4%,   transparent 4%) -70px 43px, linear-gradient( 36deg, #232927 4%,   transparent 4%) 30px 43px, linear-gradient( 72deg, #e3d7bf 8.5%, transparent 8.5%) 30px 43px, linear-gradient(288deg, #e3d7bf 8.5%, transparent 8.5%) -70px 43px, linear-gradient(216deg, #e3d7bf 7.5%, transparent 7.5%) -70px 23px, linear-gradient(144deg, #e3d7bf 7.5%, transparent 7.5%) 30px 23px, linear-gradient(324deg, #232927 4%,   transparent 4%) -20px 93px, linear-gradient( 36deg, #232927 4%,   transparent 4%) 80px 93px, linear-gradient( 72deg, #e3d7bf 8.5%, transparent 8.5%) 80px 93px, linear-gradient(288deg, #e3d7bf 8.5%, transparent 8.5%) -20px 93px, linear-gradient(216deg, #e3d7bf 7.5%, transparent 7.5%) -20px 73px, linear-gradient(144deg, #e3d7bf 7.5%, transparent 7.5%) 80px 73px;background-color: #232927;background-size: 100px 100px;","background:radial-gradient(circle at 50% 59%, #D2CAAB 3%, #364E27 4%, #364E27 11%, rgba(54,78,39,0) 12%, rgba(54,78,39,0)) 50px 0, radial-gradient(circle at 50% 41%, #364E27 3%, #D2CAAB 4%, #D2CAAB 11%, rgba(210,202,171,0) 12%, rgba(210,202,171,0)) 50px 0, radial-gradient(circle at 50% 59%, #D2CAAB 3%, #364E27 4%, #364E27 11%, rgba(54,78,39,0) 12%, rgba(54,78,39,0)) 0 50px, radial-gradient(circle at 50% 41%, #364E27 3%, #D2CAAB 4%, #D2CAAB 11%, rgba(210,202,171,0) 12%, rgba(210,202,171,0)) 0 50px, radial-gradient(circle at 100% 50%, #D2CAAB 16%, rgba(210,202,171,0) 17%),radial-gradient(circle at 0% 50%, #364E27 16%, rgba(54,78,39,0) 17%),radial-gradient(circle at 100% 50%, #D2CAAB 16%, rgba(210,202,171,0) 17%) 50px 50px, radial-gradient(circle at 0% 50%, #364E27 16%, rgba(54,78,39,0) 17%) 50px 50px;background-color:#63773F;background-size:100px 100px;","background:radial-gradient(circle, transparent 20%, slategray 20%, slategray 80%, transparent 80%, transparent),radial-gradient(circle, transparent 20%, slategray 20%, slategray 80%, transparent 80%, transparent) 50px 50px, linear-gradient(#A8B1BB 8px, transparent 8px) 0 -4px, linear-gradient(90deg, #A8B1BB 8px, transparent 8px) -4px 0;background-color: slategray;background-size:100px 100px, 100px 100px, 50px 50px, 50px 50px;","background:radial-gradient(circle at 100% 50%, transparent 20%, rgba(255,255,255,.3) 21%, rgba(255,255,255,.3) 34%, transparent 35%, transparent),radial-gradient(circle at 0% 50%, transparent 20%, rgba(255,255,255,.3) 21%, rgba(255,255,255,.3) 34%, transparent 35%, transparent) 0 -50px;background-color: slategray;background-size:75px 100px;","background-color: #FF7D9D;background-size: 58px 58px;background-position: 0px 2px, 4px 35px, 29px 31px, 33px 6px, 0px 36px, 4px 2px, 29px 6px, 33px 30px;background-image:linear-gradient(335deg, #C90032 23px, transparent 23px),linear-gradient(155deg, #C90032 23px, transparent 23px),linear-gradient(335deg, #C90032 23px, transparent 23px),linear-gradient(155deg, #C90032 23px, transparent 23px),linear-gradient(335deg, #C90032 10px, transparent 10px),linear-gradient(155deg, #C90032 10px, transparent 10px),linear-gradient(335deg, #C90032 10px, transparent 10px),linear-gradient(155deg, #C90032 10px, transparent 10px);","background-color: #6d695c;background-image:repeating-linear-gradient(120deg, rgba(255,255,255,.1), rgba(255,255,255,.1) 1px, transparent 1px, transparent 60px),repeating-linear-gradient(60deg, rgba(255,255,255,.1), rgba(255,255,255,.1) 1px, transparent 1px, transparent 60px),linear-gradient(60deg, rgba(0,0,0,.1) 25%, transparent 25%, transparent 75%, rgba(0,0,0,.1) 75%, rgba(0,0,0,.1)),linear-gradient(120deg, rgba(0,0,0,.1) 25%, transparent 25%, transparent 75%, rgba(0,0,0,.1) 75%, rgba(0,0,0,.1));background-size: 70px 120px;","background:radial-gradient(circle closest-side at 60% 43%, #b03 26%, rgba(187,0,51,0) 27%),radial-gradient(circle closest-side at 40% 43%, #b03 26%, rgba(187,0,51,0) 27%),radial-gradient(circle closest-side at 40% 22%, #d35 45%, rgba(221,51,85,0) 46%),radial-gradient(circle closest-side at 60% 22%, #d35 45%, rgba(221,51,85,0) 46%),radial-gradient(circle closest-side at 50% 35%, #d35 30%, rgba(221,51,85,0) 31%),radial-gradient(circle closest-side at 60% 43%, #b03 26%, rgba(187,0,51,0) 27%) 50px 50px, radial-gradient(circle closest-side at 40% 43%, #b03 26%, rgba(187,0,51,0) 27%) 50px 50px, radial-gradient(circle closest-side at 40% 22%, #d35 45%, rgba(221,51,85,0) 46%) 50px 50px, radial-gradient(circle closest-side at 60% 22%, #d35 45%, rgba(221,51,85,0) 46%) 50px 50px, radial-gradient(circle closest-side at 50% 35%, #d35 30%, rgba(221,51,85,0) 31%) 50px 50px;background-color:#b03;background-size:100px 100px;","background:radial-gradient(black 15%, transparent 16%) 0 0, radial-gradient(black 15%, transparent 16%) 8px 8px, radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 0 1px, radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 8px 9px;background-color:#282828;background-size:16px 16px;","background:linear-gradient(27deg, #151515 5px, transparent 5px) 0 5px, linear-gradient(207deg, #151515 5px, transparent 5px) 10px 0px, linear-gradient(27deg, #222 5px, transparent 5px) 0px 10px, linear-gradient(207deg, #222 5px, transparent 5px) 10px 5px, linear-gradient(90deg, #1b1b1b 10px, transparent 10px),linear-gradient(#1d1d1d 25%, #1a1a1a 25%, #1a1a1a 50%, transparent 50%, transparent 75%, #242424 75%, #242424);background-color: #131313;background-size: 20px 20px;","background:radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.15) 30%, rgba(255,255,255,.3) 32%, rgba(255,255,255,0) 33%) 0 0, radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.1) 11%, rgba(255,255,255,.3) 13%, rgba(255,255,255,0) 14%) 0 0, radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.2) 17%, rgba(255,255,255,.43) 19%, rgba(255,255,255,0) 20%) 0 110px, radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.2) 11%, rgba(255,255,255,.4) 13%, rgba(255,255,255,0) 14%) -130px -170px, radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.2) 11%, rgba(255,255,255,.4) 13%, rgba(255,255,255,0) 14%) 130px 370px, radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.1) 11%, rgba(255,255,255,.2) 13%, rgba(255,255,255,0) 14%) 0 0, linear-gradient(45deg, #343702 0%, #184500 20%, #187546 30%, #006782 40%, #0b1284 50%, #760ea1 60%, #83096e 70%, #840b2a 80%, #b13e12 90%, #e27412 100%);background-size: 470px 470px, 970px 970px, 410px 410px, 610px 610px, 530px 530px, 730px 730px, 100% 100%;background-color: #840b2a;","background-color:white;background-image:radial-gradient(midnightblue 9px, transparent 10px),repeating-radial-gradient(midnightblue 0, midnightblue 4px, transparent 5px, transparent 20px, midnightblue 21px, midnightblue 25px, transparent 26px, transparent 50px);background-size: 30px 30px, 90px 90px;background-position: 0 0;","background-color:black;background-image:radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 40px),radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 30px),radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 40px),radial-gradient(rgba(255,255,255,.4), rgba(255,255,255,.1) 2px, transparent 30px);background-size: 550px 550px, 350px 350px, 250px 250px, 150px 150px;background-position: 0 0, 40px 60px, 130px 270px, 70px 100px;","background:radial-gradient(hsl(0, 100%, 27%) 4%, hsl(0, 100%, 18%) 9%, hsla(0, 100%, 20%, 0) 9%) 0 0, radial-gradient(hsl(0, 100%, 27%) 4%, hsl(0, 100%, 18%) 8%, hsla(0, 100%, 20%, 0) 10%) 50px 50px, radial-gradient(hsla(0, 100%, 30%, 0.8) 20%, hsla(0, 100%, 20%, 0)) 50px 0, radial-gradient(hsla(0, 100%, 30%, 0.8) 20%, hsla(0, 100%, 20%, 0)) 0 50px, radial-gradient(hsla(0, 100%, 20%, 1) 35%, hsla(0, 100%, 20%, 0) 60%) 50px 0, radial-gradient(hsla(0, 100%, 20%, 1) 35%, hsla(0, 100%, 20%, 0) 60%) 100px 50px, radial-gradient(hsla(0, 100%, 15%, 0.7), hsla(0, 100%, 20%, 0)) 0 0, radial-gradient(hsla(0, 100%, 15%, 0.7), hsla(0, 100%, 20%, 0)) 50px 50px, linear-gradient(45deg, hsla(0, 100%, 20%, 0) 49%, hsla(0, 100%, 0%, 1) 50%, hsla(0, 100%, 20%, 0) 70%) 0 0, linear-gradient(-45deg, hsla(0, 100%, 20%, 0) 49%, hsla(0, 100%, 0%, 1) 50%, hsla(0, 100%, 20%, 0) 70%) 0 0;background-color: #300;background-size: 100px 100px;","background:linear-gradient(135deg, #708090 21px, #d9ecff 22px, #d9ecff 24px, transparent 24px, transparent 67px, #d9ecff 67px, #d9ecff 69px, transparent 69px),linear-gradient(225deg, #708090 21px, #d9ecff 22px, #d9ecff 24px, transparent 24px, transparent 67px, #d9ecff 67px, #d9ecff 69px, transparent 69px)0 64px;background-color:#708090;background-size: 64px 128px;","background:linear-gradient(135deg, #ECEDDC 25%, transparent 25%) -50px 0, linear-gradient(225deg, #ECEDDC 25%, transparent 25%) -50px 0, linear-gradient(315deg, #ECEDDC 25%, transparent 25%),linear-gradient(45deg, #ECEDDC 25%, transparent 25%);background-size: 100px 100px;background-color: #EC173A;","background:linear-gradient(45deg, #92baac 45px, transparent 45px)64px 64px, linear-gradient(45deg, #92baac 45px, transparent 45px,transparent 91px, #e1ebbd 91px, #e1ebbd 135px, transparent 135px),linear-gradient(-45deg, #92baac 23px, transparent 23px, transparent 68px,#92baac 68px,#92baac 113px,transparent 113px,transparent 158px,#92baac 158px);background-color:#e1ebbd;background-size: 128px 128px;","background:linear-gradient(63deg, #999 23%, transparent 23%) 7px 0,linear-gradient(63deg, transparent 74%, #999 78%),linear-gradient(63deg, transparent 34%, #999 38%, #999 58%, transparent 62%),#444;background-size: 16px 48px;","background:#36c;background:linear-gradient(115deg, transparent 75%, rgba(255,255,255,.8) 75%) 0 0,linear-gradient(245deg, transparent 75%, rgba(255,255,255,.8) 75%) 0 0,linear-gradient(115deg, transparent 75%, rgba(255,255,255,.8) 75%) 7px -15px,linear-gradient(245deg, transparent 75%, rgba(255,255,255,.8) 75%) 7px -15px,#36c;background-size: 15px 30px;","background:radial-gradient(circle at 0% 50%, rgba(96, 16, 48, 0) 9px, #613 10px, rgba(96, 16, 48, 0) 11px) 0px 10px,radial-gradient(at 100% 100%,rgba(96, 16, 48, 0) 9px, #613 10px, rgba(96, 16, 48, 0) 11px),#8a3;background-size: 20px 20px;","background-image:linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%)","background-image:linear-gradient(to top, #fbc2eb 0%, #a6c1ee 100%)","background-image:linear-gradient(120deg, #a6c0fe 0%, #f68084 100%)","background-image:linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%)","background-image:linear-gradient(to right, #fa709a 0%, #fee140 100%)","background-image:linear-gradient(to top, #30cfd0 0%, #330867 100%)","background-image:linear-gradient(to top, #a8edea 0%, #fed6e3 100%)","background-image:linear-gradient(to top, #d299c2 0%, #fef9d7 100%)","background-image:linear-gradient(to top, #fddb92 0%, #d1fdff 100%)","background-image:linear-gradient(to top, #9890e3 0%, #b1f4cf 100%)","background-image:linear-gradient(to top, #96fbc4 0%, #f9f586 100%)","background-image:linear-gradient(to right, #eea2a2 0%, #bbc1bf 19%, #57c6e1 42%, #b49fda 79%, #7ac5d8 100%)","background-image:linear-gradient(to top, #9795f0 0%, #fbc8d4 100%)","background-image:linear-gradient(to top, #3f51b1 0%, #5a55ae 13%, #7b5fac 25%, #8f6aae 38%, #a86aa4 50%, #cc6b8e 62%, #f18271 75%, #f3a469 87%, #f7c978 100%)","background-image:linear-gradient(to top, #f43b47 0%, #453a94 100%)","background-image:linear-gradient(to top, #88d3ce 0%, #6e45e2 100%)","background-image:linear-gradient(to top, #d9afd9 0%, #97d9e1 100%)","background-image:linear-gradient(-20deg, #b721ff 0%, #21d4fd 100%)","background-image:linear-gradient(60deg, #abecd6 0%, #fbed96 100%)","background-image:linear-gradient(to top, #3b41c5 0%, #a981bb 49%, #ffc8a9 100%)","background-image:linear-gradient(to top, #0fd850 0%, #f9f047 100%)","background-image:linear-gradient(to top, #d5dee7 0%, #ffafbd 0%, #c9ffbf 100%)","background-image:linear-gradient(to top, #65bd60 0%, #5ac1a8 25%, #3ec6ed 50%, #b7ddb7 75%, #fef381 100%)","background-image:linear-gradient(to top, #50cc7f 0%, #f5d100 100%)","background-image:linear-gradient(to top, #df89b5 0%, #bfd9fe 100%)","background-image:linear-gradient(to top, #e14fad 0%, #f9d423 100%)","background-image:linear-gradient(to right, #ec77ab 0%, #7873f5 100%)","background-image:linear-gradient(-225deg, #2CD8D5 0%, #C5C1FF 56%, #FFBAC3 100%)","background-image:linear-gradient(-225deg, #5271C4 0%, #B19FFF 48%, #ECA1FE 100%)","background-image:linear-gradient(-225deg, #FF3CAC 0%, #562B7C 52%, #2B86C5 100%)","background-image:linear-gradient(-225deg, #69EACB 0%, #EACCF8 48%, #6654F1 100%)","background-image:linear-gradient(-225deg, #231557 0%, #44107A 29%, #FF1361 67%, #FFF800 100%)"],i=n[(0,a.getRandom)(0,n.length-1)];this.ial["title-img"]=i,this.render(this.ial,e.block.rootID),(0,r.fetchPost)("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":this.ial["title-img"]}}),t.preventDefault(),t.stopPropagation();break}if("remove"===i){delete this.ial["title-img"],this.render(this.ial,e.block.rootID),(0,r.fetchPost)("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":""}}),t.preventDefault(),t.stopPropagation();break}if("icon"===i){const n=(0,l.getRandomEmoji)();n&&(this.ial.icon=n,this.render(this.ial,e.block.rootID),(0,l.updateFileTreeEmoji)(n,e.block.rootID),(0,l.updateOutlineEmoji)(n),(0,r.fetchPost)("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{icon:n}}),e.model&&e.model.parent.setDocIcon(n)),t.preventDefault(),t.stopPropagation();break}if("tag"===i){this.openTag(e),t.preventDefault(),t.stopPropagation();break}if("link"===i){const n=new p.Dialog({title:window.siyuan.languages.link,width:(0,a.isMobile)()?"80vw":"520px",content:`<div class="b3-dialog__content">\n        <input class="b3-text-field fn__block">\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`}),i=n.element.querySelectorAll(".b3-button");i[0].addEventListener("click",(()=>{n.destroy()})),i[1].addEventListener("click",(()=>{const t=`background-image:url(${n.element.querySelector("input").value});`;this.ial["title-img"]=t,this.render(this.ial,e.block.rootID),(0,r.fetchPost)("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":this.ial["title-img"]}}),n.destroy()})),n.element.querySelector("input").focus(),t.preventDefault(),t.stopPropagation();break}if("open-search"===i){(0,u.openGlobalSearch)(`#${n.textContent}#`,!window.siyuan.ctrlIsPressed),t.preventDefault(),t.stopPropagation();break}if("remove-tag"===i){n.parentElement.remove();const i=this.getTags();(0,r.fetchPost)("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{tags:i.toString()}}),0===i.length?delete this.ial.tags:this.ial.tags=i.toString(),this.render(this.ial,e.block.rootID),t.preventDefault(),t.stopPropagation();break}n=n.parentElement}}))}render(e,t){var n;const i=e["title-img"],a=e.icon,o=e.tags;if(this.ial=e,this.element.setAttribute("data-node-id",t),o){let e="";o.split(",").forEach(((t,n)=>{e+=`<div class="item item--${n%4}" data-type="open-search">${t}<svg data-type="remove-tag"><use xlink:href="#iconClose"></use></svg></div>`})),this.tagsElement.innerHTML=e}else this.tagsElement.innerHTML="";if(a?(this.iconElement.classList.remove("fn__none"),this.iconElement.innerHTML=(0,l.unicode2Emoji)(a)):this.iconElement.classList.add("fn__none"),i)if(this.imgElement.classList.remove("fn__none"),this.imgElement.setAttribute("style",Lute.UnEscapeHTMLStr(i)),i.indexOf("url(")>-1){const e=this.imgElement.style.backgroundPosition||this.imgElement.style.objectPosition,t=null===(n=this.imgElement.style.backgroundImage)||void 0===n?void 0:n.replace(/^url\(["']?/,"").replace(/["']?\)$/,"");this.imgElement.removeAttribute("style"),this.imgElement.setAttribute("src",t),this.imgElement.style.objectPosition=e,this.element.querySelector('[data-type="position"]').classList.remove("fn__none")}else this.imgElement.setAttribute("src",this.transparentData),this.element.querySelector('[data-type="position"]').classList.add("fn__none");else this.imgElement.classList.add("fn__none");this.element.style.minHeight=i?"30vh":a?this.tagsElement.clientHeight+56+"px":o?this.tagsElement.clientHeight+"px":"0"}openTag(e){(0,r.fetchPost)("/api/search/searchTag",{k:""},(t=>{let n="";t.data.tags.forEach(((e,t)=>{n+=`<div class="b3-list-item${0===t?" b3-list-item--focus":""}">${e}</div>`})),window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.innerHTML=`<div class="fn__flex-column" style="max-height:50vh"><input style="margin: 4px 8px 8px 8px" class="b3-text-field"/>\n<div class="b3-list fn__flex-1 b3-list--background" style="position: relative">${n}</div>\n</div>`;const a=window.siyuan.menus.menu.element.querySelector(".b3-list--background"),o=window.siyuan.menus.menu.element.querySelector("input");o.addEventListener("keydown",(t=>{if(t.stopPropagation(),!t.isComposing)if((0,c.upDownHint)(a,t),"Enter"===t.key){const t=a.querySelector(".b3-list-item--focus");t?this.addTags(t.textContent,e):this.addTags(o.value,e),window.siyuan.menus.menu.remove()}else"Escape"===t.key&&window.siyuan.menus.menu.remove()})),o.addEventListener("input",(e=>{e.stopPropagation(),(0,r.fetchPost)("/api/search/searchTag",{k:o.value},(e=>{let t="",n=!1;e.data.tags.forEach((i=>{t+=`<div class="b3-list-item">${i}</div>`,i===`<mark>${e.data.k}</mark>`&&(n=!0)})),!n&&e.data.k&&(t=`<div class="b3-list-item"><mark>${e.data.k}</mark></div>`+t),a.innerHTML=t,a.firstElementChild.classList.add("b3-list-item--focus")}))})),a.addEventListener("click",(t=>{const n=t.target,a=(0,i.hasClosestByClassName)(n,"b3-list-item");a&&this.addTags(a.textContent,e)}));const s=this.iconElement.nextElementSibling.getBoundingClientRect();window.siyuan.menus.menu.popup({x:s.left,y:s.top+s.height}),o.focus()}))}getTags(){const e=[];return this.tagsElement.querySelectorAll(".item").forEach((t=>{e.push(t.textContent.trim())})),e}addTags(e,t){window.siyuan.menus.menu.remove();const n=this.getTags();n.includes(e)||(n.push(e),(0,r.fetchPost)("/api/attr/setBlockAttrs",{id:t.block.rootID,attrs:{tags:n.toString()}}),this.ial.tags=n.toString(),this.render(this.ial,t.block.rootID))}}},6679:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Title=void 0;const i=n(4640),a=n(734),o=n(8349),s=n(2640),r=n(8120),l=n(8792),c=n(3607),u=n(7422),d=n(7954),p=n(3863),h=n(5680),f=n(3371),g=n(9516),m=n(6501),y=n(1754),b=n(6520),v=n(3429),w=n(1040),_=n(2509);t.Title=class{constructor(e){this.element=document.createElement("div"),this.element.className="protyle-title",window.siyuan.config.editor.displayBookmarkIcon&&this.element.classList.add("protyle-wysiwyg--attr"),this.element.innerHTML=`<span aria-label="${window.siyuan.languages.gutterTip2}" class="protyle-title__icon" data-type="a" data-position="right"><svg><use xlink:href="#iconFile"></use></svg></span>\n<div contenteditable="true" spellcheck="false" class="protyle-title__input" data-tip="${window.siyuan.languages._kernel[16]}"></div><div class="protyle-attr"></div>`,this.editElement=this.element.querySelector(".protyle-title__input"),this.editElement.addEventListener("paste",(t=>{t.stopPropagation(),t.preventDefault();const n=(0,i.getEditorRange)(this.editElement);n.deleteContents(),n.insertNode(document.createTextNode((0,o.replaceFileName)(t.clipboardData.getData("text/plain")))),n.collapse(!1),this.rename(e)})),this.editElement.addEventListener("click",(()=>{var t;e.model&&((0,f.setPanelFocus)(e.model.element.parentElement.parentElement),(0,g.updatePanelByEditor)(e,!1)),null===(t=e.toolbar)||void 0===t||t.element.classList.add("fn__none")})),this.editElement.addEventListener("input",(t=>{t.isComposing||this.rename(e)})),this.editElement.addEventListener("compositionend",(()=>{this.rename(e)})),this.editElement.addEventListener("drop",(e=>{e.stopPropagation(),e.preventDefault()})),this.editElement.addEventListener("keydown",(t=>{if(!t.isComposing){if((0,v.commonHotkey)(e,t))return!0;if("ArrowDown"===t.key||"Enter"===t.key){const n=(0,b.getNoContainerElement)(e.wysiwyg.element.firstElementChild);n&&(0,i.focusBlock)(n,e.wysiwyg.element),t.preventDefault(),t.stopPropagation()}else(0,u.matchHotKey)(window.siyuan.config.keymap.editor.general.attr.custom,t)?((0,a.fetchPost)("/api/block/getDocInfo",{id:e.block.rootID},(t=>{(0,r.openFileAttr)(t.data.ial,e.block.rootID)})),t.preventDefault(),t.stopPropagation()):(0,u.matchHotKey)("⌘A",t)?((0,i.getEditorRange)(this.editElement).selectNodeContents(this.editElement),t.preventDefault(),t.stopPropagation()):(0,u.matchHotKey)(window.siyuan.config.keymap.editor.general.copyBlockRef.custom,t)?((0,d.writeText)(`((${e.block.rootID} '${this.editElement.textContent.replace(/'/g,"&#39;")}'))`),t.preventDefault(),t.stopPropagation()):(0,u.matchHotKey)(window.siyuan.config.keymap.editor.general.copyID.custom,t)?((0,d.writeText)(e.block.rootID),t.preventDefault(),t.stopPropagation()):(0,u.matchHotKey)(window.siyuan.config.keymap.editor.general.copyBlockEmbed.custom,t)?((0,d.writeText)(`{{select * from blocks where id='${e.block.rootID}'}}`),t.preventDefault(),t.stopPropagation()):(0,u.matchHotKey)(window.siyuan.config.keymap.editor.general.copyProtocol.custom,t)&&((0,d.writeText)(`siyuan://blocks/${e.block.rootID}`),t.preventDefault(),t.stopPropagation())}}));const t=this.element.querySelector(".protyle-title__icon");t.addEventListener("click",(()=>{if(window.siyuan.shiftIsPressed)(0,a.fetchPost)("/api/block/getDocInfo",{id:e.block.rootID},(t=>{(0,r.openFileAttr)(t.data.ial,e.block.rootID)}));else{const n=t.getBoundingClientRect();this.renderMenu(e,t,{x:n.left,y:n.top+14})}})),this.element.addEventListener("contextmenu",(n=>{var a;if(0===getSelection().rangeCount)return void this.renderMenu(e,t,{x:n.clientX,y:n.clientY});null===(a=e.toolbar)||void 0===a||a.element.classList.add("fn__none"),window.siyuan.menus.menu.remove();const o=(0,i.getEditorRange)(this.editElement);""!==o.toString()&&(window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconCopy",accelerator:"⌘C",label:window.siyuan.languages.copy,click:()=>{(0,i.focusByRange)((0,i.getEditorRange)(this.editElement)),document.execCommand("copy")}}).element),window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconCut",accelerator:"⌘X",label:window.siyuan.languages.cut,click:()=>{(0,i.focusByRange)((0,i.getEditorRange)(this.editElement)),document.execCommand("cut"),setTimeout((()=>{this.rename(e)}),l.Constants.TIMEOUT_INPUT)}}).element),window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconTrashcan",accelerator:"⌫",label:window.siyuan.languages.delete,click:()=>{const t=(0,i.getEditorRange)(this.editElement);t.extractContents(),(0,i.focusByRange)(t),setTimeout((()=>{this.rename(e)}),l.Constants.TIMEOUT_INPUT)}}).element)),window.siyuan.menus.menu.append(new s.MenuItem({label:window.siyuan.languages.paste,accelerator:"⌘V",click:()=>{(0,i.focusByRange)((0,i.getEditorRange)(this.editElement)),document.execCommand("paste"),setTimeout((()=>{this.rename(e)}),l.Constants.TIMEOUT_INPUT)}}).element),window.siyuan.menus.menu.append(new s.MenuItem({label:window.siyuan.languages.selectAll,accelerator:"⌘A",click:()=>{o.selectNodeContents(this.editElement),(0,i.focusByRange)(o)}}).element),window.siyuan.menus.menu.popup({x:n.clientX,y:n.clientY})})),this.element.querySelector(".protyle-attr").addEventListener("click",(t=>{(0,a.fetchPost)("/api/block/getDocInfo",{id:e.block.rootID},(n=>{if((0,c.hasClosestByClassName)(t.target,"protyle-attr--bookmark"))return(0,r.openFileAttr)(n.data.ial,e.block.rootID,"bookmark"),void t.stopPropagation();if((0,c.hasClosestByClassName)(t.target,"protyle-attr--name"))return(0,r.openFileAttr)(n.data.ial,e.block.rootID,"name"),void t.stopPropagation();if((0,c.hasClosestByClassName)(t.target,"protyle-attr--alias"))return(0,r.openFileAttr)(n.data.ial,e.block.rootID,"alias"),void t.stopPropagation();return(0,c.hasClosestByClassName)(t.target,"protyle-attr--memo")?((0,r.openFileAttr)(n.data.ial,e.block.rootID,"memo"),void t.stopPropagation()):void 0}))}))}rename(e){if(clearTimeout(this.timeout),!(0,o.validateName)(this.editElement.textContent))return!1;this.timeout=window.setTimeout((()=>{const t=(0,o.replaceFileName)(this.editElement.textContent);(0,a.fetchPost)("/api/filetree/renameDoc",{notebook:e.notebookId,path:e.path,title:t}),this.setTitle(t)}),l.Constants.TIMEOUT_INPUT)}renderMenu(e,t,n){(0,a.fetchPost)("/api/block/getDocInfo",{id:e.block.rootID},(t=>{window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new s.MenuItem({label:window.siyuan.languages.copy,icon:"iconCopy",type:"submenu",submenu:(0,r.copySubMenu)(e.block.rootID,"")}).element),window.siyuan.config.readonly||(window.siyuan.menus.menu.append((0,r.movePathToMenu)(e.notebookId,e.path)),window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconTrashcan",label:window.siyuan.languages.delete,click:()=>{(0,_.deleteFile)(e.notebookId,e.path,(0,p.escapeHtml)(this.editElement.textContent))}}).element)),window.siyuan.config.readonly||(window.siyuan.menus.menu.append(new s.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new s.MenuItem({label:window.siyuan.languages.attr,accelerator:window.siyuan.config.keymap.editor.general.attr.custom+"/"+(0,d.updateHotkeyTip)("⇧Click"),click(){(0,r.openFileAttr)(t.data.ial,e.block.rootID)}}).element)),window.siyuan.menus.menu.append(new s.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconAlignCenter",label:window.siyuan.languages.outline,accelerator:window.siyuan.config.keymap.editor.general.outline.custom,click:()=>{(0,m.openOutline)(e)}}).element),window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconLink",label:window.siyuan.languages.backlinks,accelerator:window.siyuan.config.keymap.editor.general.backlinks.custom,click:()=>{(0,m.openBacklink)(e)}}).element),window.siyuan.menus.menu.append(new s.MenuItem({icon:"iconGraph",label:window.siyuan.languages.graphView,accelerator:window.siyuan.config.keymap.editor.general.graphView.custom,click:()=>{(0,m.openGraph)(e)}}).element),window.siyuan.menus.menu.append(new s.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new s.MenuItem({label:window.siyuan.languages.wechatReminder,icon:"iconMp",click(){(0,r.openFileWechatNotify)(e)}}).element),window.siyuan.menus.menu.append(new s.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new s.MenuItem({type:"readonly",label:`${window.siyuan.languages.modifiedAt} ${h(t.data.ial.updated).format("YYYY-MM-DD HH:mm:ss")}<br>\n${window.siyuan.languages.createdAt} ${h(t.data.ial.id.substr(0,14)).format("YYYY-MM-DD HH:mm:ss")}`}).element),window.siyuan.menus.menu.popup(n)}))}setTitle(e){(0,w.code160to32)(e)!==(0,w.code160to32)(this.editElement.textContent)&&(this.editElement.textContent="Untitled"===e?"":e)}render(e,t,n=!1){if("true"===this.editElement.getAttribute("data-render")&&!n)return!1;(0,y.setTitle)(t.data.ial.title),e.background.render(t.data.ial,e.block.rootID),e.wysiwyg.renderCustom(t.data.ial),this.editElement.setAttribute("data-render","true"),this.setTitle(t.data.ial.title);let a="";if(t.data.ial.bookmark&&(a+=`<div class="protyle-attr--bookmark">${Lute.EscapeHTMLStr(t.data.ial.bookmark)}</div>`),t.data.ial.name&&(a+=`<div class="protyle-attr--name"><svg><use xlink:href="#iconN"></use></svg>${Lute.EscapeHTMLStr(t.data.ial.name)}</div>`),t.data.ial.alias&&(a+=`<div class="protyle-attr--alias"><svg><use xlink:href="#iconA"></use></svg>${Lute.EscapeHTMLStr(t.data.ial.alias)}</div>`),t.data.ial.memo&&(a+=`<div class="protyle-attr--memo b3-tooltips b3-tooltips__sw" aria-label="${Lute.EscapeHTMLStr(t.data.ial.memo)}"><svg><use xlink:href="#iconM"></use></svg></div>`),this.element.querySelector(".protyle-attr").innerHTML=a,0!==t.data.refCount&&this.element.querySelector(".protyle-attr").insertAdjacentHTML("beforeend",`<div class="protyle-attr--refcount popover__block" data-defids='${JSON.stringify([e.block.rootID])}' data-id='${JSON.stringify(t.data.refIDs)}'>${t.data.refCount}</div>`),(new Date).getTime()-h(t.data.id.split("-")[0]).toDate().getTime()<2e3){const e=this.editElement.ownerDocument.createRange();e.selectNodeContents(this.editElement),(0,i.focusByRange)(e)}}}},3505:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hintMoveBlock=t.hintRenderAssets=t.hintRenderWidget=t.hintRenderTemplate=t.hintEmbed=t.hintRef=t.hintTag=t.hintSlash=void 0;const i=n(734),a=n(7276),o=n(1308),s=n(7954),r=n(7822),l=n(8792),c=n(6057),u=n(1248),d=n(4640),p=n(3607),h=n(6520),f=n(8349),g=n(6840),m=n(8813),y=n(9173),b=n(4921),v=n(3863),w=n(407);t.hintSlash=(e,t)=>{const n=[{filter:["模版","moban","mb","template"],value:l.Constants.ZWSP,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic ft__error"><use xlink:href="#iconMarkdown"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.template}</span></div>`},{filter:["资源","assets","zy","ziyuan"],value:l.Constants.ZWSP+2,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconImage"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.assets}</span></div>`},{filter:["引用块","yinyong","yy","block reference"],value:"((",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconGraph"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.blockRef}</span><span class="b3-list-item__meta">((</span></div>`},{filter:["嵌入块","qianrukuai","qrk","embed block"],value:"{{",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconSQL"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.blockEmbed}</span><span class="b3-list-item__meta">{{</span></div>`},{filter:["文档","子文档","wendang","wd","ziwendang","zwd","xjwd"],value:l.Constants.ZWSP+4,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.newFile}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.general.newFile.custom)}</span></div>`},{value:"",html:"separator"},{filter:["yijibiaoti","一级标题","yjbt","h1","heading"],value:"# "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH1"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading1}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.heading.heading1.custom)}</span></div>`},{filter:["erjibiaoti","二级标题","ejbt","h2","heading"],value:"## "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH2"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading2}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.heading.heading2.custom)}</span></div>`},{filter:["sanjibiaoti","三级标题","sjbt","h3","heading"],value:"### "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH3"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading3}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.heading.heading3.custom)}</span></div>`},{filter:["sijibiaoti","四级标题","sjbt","h4","heading"],value:"#### "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH4"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading4}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.heading.heading4.custom)}</span></div>`},{filter:["wujibiaoti","五级标题","wjbt","h5","heading"],value:"##### "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH5"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading5}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.heading.heading5.custom)}</span></div>`},{filter:["liujibiaoti","六级标题","ljbt","h6","heading"],value:"###### "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH6"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading6}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.heading.heading6.custom)}</span></div>`},{filter:["无序列表","wuxuliebiao","wxlb","unordered list"],value:"* "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconList"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.list}</span><span class="b3-menu__accelerator">*&nbsp;</span></div>`},{filter:["有序列表","youxuliebiao","yxlb","ordered list"],value:"1. "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconOrderedList"></use></svg><span class="b3-list-item__text">${window.siyuan.languages["ordered-list"]}</span><span class="b3-menu__accelerator">1.&nbsp;</span></div>`},{filter:["任务列表","renwuliebiao","rwlb","task list","todo list"],value:"* [ ] "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconCheck"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.check}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.check.custom)}</span></div>`},{filter:["引述","yinshu","ys","bq","blockquote"],value:"> "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconQuote"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.quote}</span><span class="b3-menu__accelerator">&gt;</span></div>`},{filter:["代码块","daimakuai","dmk","code block"],value:"```",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconCode"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.code}</span><span class="b3-menu__accelerator">\`\`\`Enter</span></div>`},{filter:["表格","biaoge","bg","table"],value:`| col1${Lute.Caret} | col2 | col3 |\n| --- | --- | --- |\n|  |  |  |\n|  |  |  |`,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconTable"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.table}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.table.custom)}</span></div>`},{filter:["分割线","fengexian","fgx","divider"],value:"---",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconLine"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.line}</span><span class="b3-menu__accelerator">---</span></div>`},{filter:["数学公式块","shuxuegongshikuai","sxgsk","math block"],value:"$$",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconMath"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.math}</span><span class="b3-list-item__meta">$$</span></div>`},{filter:["html"],value:"<div>",html:'<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconHTML5"></use></svg><span class="b3-list-item__text">HTML</span></div>'},{value:"",html:"separator"},{filter:["表情","biaoqing","bq","emoji"],value:"emoji",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconEmoji"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.emoji}</span><span class="b3-menu__accelerator">:</span></div>`},{filter:["链接","lianjie","lj","link","a"],value:"a",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconLink"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.link}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.link.custom)}</span></div>`},{filter:["粗体","cuti","ct","bold","strong"],value:"strong",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconBold"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.bold}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.bold.custom)}</span></div>`},{filter:["斜体","xieti","xt","italic","em"],value:"em",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconItalic"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.italic}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.italic.custom)}</span></div>`},{filter:["下划线","xiahuaxian","xhx","underline"],value:"u",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconUnderline"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.underline}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.underline.custom)}</span></div>`},{filter:["删除线","shanchuxian","scx","strike"],value:"s",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconStrike"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.strike}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.strike.custom)}</span></div>`},{filter:["标记","biaoji","bj","mark"],value:"mark",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconMark"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.mark}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.mark.custom)}</span></div>`},{filter:["上标","shangbiao","sb","superscript"],value:"sup",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconSup"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.sup}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.sup.custom)}</span></div>`},{filter:["下标","xiaobiao","xb","subscript"],value:"sub",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconSub"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.sub}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.sub.custom)}</span></div>`},{filter:["标签","biaoqian","bq","tag"],value:"tag",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconTags"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.tag}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.tag.custom)}</span></div>`},{filter:["行内代码","hangneidaima","hndm","inline code"],value:"code",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconInlineCode"></use></svg><span class="b3-list-item__text">${window.siyuan.languages["inline-code"]}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert["inline-code"].custom)}</span></div>`},{filter:["行内数学公式","hangneishuxuegongshi","hnsxgs","inline math"],value:"inline-math",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconMath"></use></svg><span class="b3-list-item__text">${window.siyuan.languages["inline-math"]}</span><span class="b3-menu__accelerator">${(0,s.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert["inline-math"].custom)}</span></div>`},{value:"",html:"separator"},{filter:["插入图片或文件","upload","上传","crtphwj","sc"],value:l.Constants.ZWSP+3,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconDownload"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.insertAsset}</span>\n<input class="b3-form__upload" type="file" ${t.options.upload.accept?'multiple="'+t.options.upload.accept+'"':""}></div>`},{filter:["iframe","嵌入网址","qianruwangzhan","qrwz"],value:'<iframe src="" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconLanguage"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.insertIframeURL}</span></div>`},{filter:["输入图片链接","input image url","shurutupianlianjie","srtptp"],value:"![]()",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconImage"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.insertImgURL}</span></div>`},{filter:["输入视频链接","shurushipinlianjie","srsplj","input video url"],value:'<video controls="controls" src=""></video>',html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconVideo"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.insertVideoURL}</span></div>`},{filter:["输入音频链接","shuruyinpinlianjie","sryplj","input audio url"],value:'<audio controls="controls" src=""></audio>',html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconRecord"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.insertAudioURL}</span></div>`},{value:"",html:"separator"},{filter:["五线谱","wuxianpu","wxp","staff"],value:"```abc\n```",html:`<div class="b3-list-item__first"><span class="b3-list-item__text">ABC</span><span class="b3-list-item__meta">${window.siyuan.languages.staff}</span></div>`},{filter:["图表","tubiao","tb","chart"],value:"```echarts\n```",html:`<div class="b3-list-item__first"><span class="b3-list-item__text">Chart</span><span class="b3-list-item__meta">${window.siyuan.languages.chart}</span></div>`},{filter:["流程图","liuchengtu","lct","flow chart"],value:"```flowchart\n```",html:'<div class="b3-list-item__first"><span class="b3-list-item__text">FlowChart</span><span class="b3-list-item__meta">Flow Chart</span></div>'},{filter:["状态图","zhuangtaitu","ztt","graph viz"],value:"```graphviz\n```",html:'<div class="b3-list-item__first"><span class="b3-list-item__text">Graphviz</span><span class="b3-list-item__meta">Graph</span></div>'},{filter:["流程图","时序图","甘特图","liuchengtu","shixutu","gantetu","lct","sxt","gtt","mermaid"],value:"```mermaid\n```",html:'<div class="b3-list-item__first"><span class="b3-list-item__text">Mermaid</span><span class="b3-list-item__meta">Mermaid</span></div>'},{filter:["脑图","naotu","nt","mind map"],value:"```mindmap\n```",html:`<div class="b3-list-item__first"><span class="b3-list-item__text">Mind map</span><span class="b3-list-item__meta">${window.siyuan.languages.mindmap}</span></div>`},{filter:["统一建模语言","tongyijianmoyuyan","tyjmyy","plant uml"],value:"```plantuml\n```",html:'<div class="b3-list-item__first"><span class="b3-list-item__text">PlantUML</span><span class="b3-list-item__meta">UML</span></div>'},{value:"",html:"separator"},{filter:["信息样式","xinxiyangshi","xxys","info style"],value:`style${l.Constants.ZWSP}color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);`,html:`<div class="b3-list-item__first"><div style="color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);" class="b3-color__square">A</div><span class="b3-list-item__text">${window.siyuan.languages.infoStyle}</span></div>`},{filter:["成功样式","chenggongyangshi","cgys","success style"],value:`style${l.Constants.ZWSP}color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);`,html:`<div class="b3-list-item__first"><div style="color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);" class="b3-color__square">A</div><span class="b3-list-item__text">${window.siyuan.languages.successStyle}</span></div>`},{filter:["警告样式","jinggaoyangshi","jgys","warning style"],value:`style${l.Constants.ZWSP}color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);`,html:`<div class="b3-list-item__first"><div style="color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);" class="b3-color__square">A</div><span class="b3-list-item__text">${window.siyuan.languages.warningStyle}</span></div>`},{filter:["错误样式","cuowuyangshi","cwys","error style"],value:`style${l.Constants.ZWSP}color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);`,html:`<div class="b3-list-item__first"><div style="color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);" class="b3-color__square">A</div><span class="b3-list-item__text">${window.siyuan.languages.errorStyle}</span></div>`},{filter:["移除样式","yichuyangshi","ycys","remove style"],value:`style${l.Constants.ZWSP}`,html:`<div class="b3-list-item__first"><div class="b3-color__square">A</div><span class="b3-list-item__text">${window.siyuan.languages.clearFontStyle}</span></div>`}];return n.splice(1,0,{filter:["挂件","widget","gj","guajian"],value:l.Constants.ZWSP+1,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconBoth"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.widget}</span></div>`}),""===e?n:n.filter((t=>{if(!t.filter)return!1;return!!t.filter.find((t=>{if(t.indexOf(e.toLowerCase())>-1)return!0}))}))};t.hintTag=(e,t)=>(t.hint.genLoading(t),(0,i.fetchPost)("/api/search/searchTag",{k:e},(e=>{const n=[];let i=!1;e.data.tags.forEach((t=>{const a=t.replace(/<mark>/g,"").replace(/<\/mark>/g,"");n.push({value:`#${a}#`,html:t}),a===e.data.k&&(i=!0)})),e.data.k&&!i&&n.splice(0,0,{value:`#${e.data.k}#`,html:`<mark>${(0,v.escapeHtml)(e.data.k)}</mark>`}),t.hint.genHTML(n,t,!0)})),[]);t.hintRef=(e,t,n=!1)=>{const a=(0,p.hasClosestBlock)((0,d.getEditorRange)(t.wysiwyg.element).startContainer);return t.hint.genLoading(t),(0,i.fetchPost)("/api/search/searchRefBlock",{k:e,id:a?a.getAttribute("data-node-id"):t.block.parentID,beforeLen:Math.floor((Math.max(t.element.clientWidth/2,320)-58)/28.8),rootID:t.block.rootID},(i=>{const a=[];if(i.data.newDoc){const e=Lute.UnEscapeHTMLStr((0,f.replaceFileName)(i.data.k));a.push({value:n?`((newFile "${e}"${l.Constants.ZWSP}'${e}${Lute.Caret}'))`:`((newFile '${e}${Lute.Caret}'))`,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg>\n<span class="b3-list-item__text">${window.siyuan.languages.newFile} <mark>${i.data.k}</mark></span></div>`})}i.data.blocks.forEach((t=>{const i=(0,o.getIconByType)(t.type);let s="";t.name&&(s+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconN"></use></svg>${t.name}</span><span class="fn__space"></span>`),t.alias&&(s+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconA"></use></svg>${t.alias}</span><span class="fn__space"></span>`),t.memo&&(s+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconM"></use></svg>${t.memo}</span>`),s&&(s=`<div class="fn__flex b3-list-item__meta b3-list-item__showall">${s}</div>`);let r=`<span data-type="block-ref" data-id="${t.id}" data-subtype="d">${t.name||t.refText}</span>`;n&&(r=`<span data-type="block-ref" data-id="${t.id}" data-subtype="s">${e}</span>`),a.push({value:r,html:`${s}<div class="b3-list-item__first">\n    <svg class="b3-list-item__graphic popover__block" data-id="${t.id}"><use xlink:href="#${i}"></use></svg>\n    <span class="b3-list-item__text">${t.content}</span>\n</div>\n<div class="b3-list-item__meta b3-list-item__showall" style="margin-bottom: 4px">${t.hPath}</div>`})})),n&&(t.hint.splitChar="((",t.hint.lastIndex=-1),0===a.length&&a.push({value:"",html:window.siyuan.languages.emptyContent}),t.hint.genHTML(a,t,!0,n)})),[]};t.hintEmbed=(e,t)=>{if(e.endsWith("}}")||e.endsWith("」」"))return[];t.hint.genLoading(t);const n=(0,p.hasClosestBlock)((0,d.getEditorRange)(t.wysiwyg.element).startContainer);return(0,i.fetchPost)("/api/search/searchRefBlock",{k:e,beforeLen:Math.floor((Math.max(t.element.clientWidth/2,320)-58)/28.8),id:n?n.getAttribute("data-node-id"):t.block.parentID,rootID:t.block.rootID},(e=>{const n=[];e.data.blocks.forEach((e=>{const t=(0,o.getIconByType)(e.type);let i="";e.name&&(i+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconN"></use></svg>${e.name}</span><span class="fn__space"></span>`),e.alias&&(i+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconA"></use></svg>${e.alias}</span><span class="fn__space"></span>`),e.memo&&(i+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconM"></use></svg>${e.memo}</span>`),i&&(i=`<div class="fn__flex b3-list-item__meta b3-list-item__showall">${i}</div>`),n.push({value:`{{select * from blocks where id='${e.id}'}}`,html:`${i}<div class="b3-list-item__first">\n    <svg class="b3-list-item__graphic popover__block" data-id="${e.id}"><use xlink:href="#${t}"></use></svg>\n    <span class="b3-list-item__text">${e.content}</span>\n</div>\n<div class="b3-list-item__meta b3-list-item__showall" style="margin-bottom: 4px">${e.hPath}</div>`})})),0===n.length&&n.push({value:"",html:window.siyuan.languages.emptyContent}),t.hint.genHTML(n,t,!0)})),[]};t.hintRenderTemplate=(e,t,n)=>{(0,i.fetchPost)("/api/template/render",{id:t.block.parentID,path:e},(e=>{(0,d.focusByRange)(t.toolbar.range);const i=(0,h.getContenteditableElement)(n);i&&""===i.textContent.trim()?(0,a.insertHTML)(e.data.content,t,!0):(0,a.insertHTML)(e.data.content,t),t.wysiwyg.element.querySelectorAll('[status="temp"]').forEach((e=>{e.remove()})),(0,r.blockRender)(t,t.wysiwyg.element),(0,c.processRender)(t.wysiwyg.element),(0,u.highlightRender)(t.wysiwyg.element),t.toolbar.subElement.classList.add("fn__none")}))};t.hintRenderWidget=(e,t)=>{(0,d.focusByRange)(t.toolbar.range),(0,a.insertHTML)(t.lute.SpinBlockDOM(`<iframe src="/widgets/${e}" data-subtype="widget" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>`),t,!0),t.toolbar.subElement.classList.add("fn__none")};t.hintRenderAssets=(e,t)=>{(0,d.focusByRange)(t.toolbar.range);const n=(0,m.pathPosix)().extname(e).toLowerCase(),i=e.startsWith("assets/")?(0,m.getAssetName)(e):e;let o="";l.Constants.SIYUAN_ASSETS_AUDIO.includes(n)?o+=`<audio controls="controls" src="${e}"></audio>`:l.Constants.SIYUAN_ASSETS_IMAGE.includes(n)?o+=`![${i}](${e})`:l.Constants.SIYUAN_ASSETS_VIDEO.includes(n)?o+=`<video controls="controls" src="${e}"></video>`:o+=`[${e.startsWith("assets/")?i+n:e}](${e})`,(0,a.insertHTML)(t.lute.SpinBlockDOM(o),t),t.toolbar.subElement.classList.add("fn__none")};t.hintMoveBlock=(e,t,n)=>{const i=[];let a;const o=t[0].parentElement;let s;if(t.forEach(((n,o)=>{o===t.length-1&&(a=(0,h.getTopAloneElement)(n),s=a.nextElementSibling||a.previousElementSibling,a.isSameNode(n)&&(a=void 0)),i.push({action:"append",id:n.getAttribute("data-node-id"),parentID:(0,m.getDisplayName)(e,!0,!0)}),n.remove()})),a)i.push({action:"delete",id:a.getAttribute("data-node-id")}),a.remove();else if(o.classList.contains("list")&&"o"===o.getAttribute("data-subtype")&&o.childElementCount>1)(0,b.updateListOrder)(o,1),Array.from(o.children).forEach((e=>{e.classList.contains("protyle-attr")||i.push({action:"update",id:e.getAttribute("data-node-id"),data:e.outerHTML})}));else if(n.block.showAll&&o.classList.contains("protyle-wysiwyg")&&0===o.childElementCount)setTimeout((()=>{(0,w.zoomOut)(n,n.block.parent2ID,n.block.parent2ID)}),2*l.Constants.TIMEOUT_INPUT+100);else if(o.classList.contains("protyle-wysiwyg")&&""===o.innerHTML&&!(0,p.hasClosestByClassName)(o,"block__edit",!0)&&n.block.id===n.block.rootID){const e=Lute.NewNodeID(),t=(0,y.genEmptyElement)(!1,!1,e);i.splice(0,0,{action:"insert",id:e,data:t.outerHTML,parentID:n.block.parentID}),o.innerHTML=t.outerHTML,(0,d.focusBlock)(t)}else s&&(0,d.focusBlock)(s);(0,g.transaction)(n,i),n.toolbar.subElement.classList.add("fn__none")}},9093:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Hint=void 0;const i=n(8792),a=n(3607),o=n(4640),s=n(3505),r=n(4779),l=n(9398),c=n(6224),u=n(6520),d=n(6840),p=n(9173),h=n(7276),f=n(1248),g=n(407),m=n(5378),y=n(734),b=n(8813),v=n(7640),w=n(3863),_=n(7822),E=n(2239),k=n(9516),C=n(1308),D=n(6057);t.Hint=class{constructor(e){this.enableSlash=!0,this.enableEmoji=!1,this.splitChar="",this.lastIndex=-1,this.element=document.createElement("div"),this.element.setAttribute("data-close","false"),this.element.setAttribute("style",`z-index: 201;overflow:auto;max-height:402px;width:${Math.max(e.element.clientWidth/2,320)}px;box-sizing: border-box;`),this.element.className="b3-menu b3-list b3-list--background fn__none",this.element.addEventListener("click",(t=>{var n;const i=t.target;if("INPUT"===i.tagName)return void t.stopPropagation();const s=(0,a.hasClosestByMatchTag)(i,"BUTTON");if(s&&!s.classList.contains("emojis__item"))return s.parentElement.classList.contains("b3-list")?this.fill(decodeURIComponent(s.getAttribute("data-value")),e):(setTimeout((()=>{this.fill(decodeURIComponent(s.getAttribute("data-value")),e)}),148),(0,o.focusByRange)(e.toolbar.range)),t.preventDefault(),void t.stopPropagation();const r=this.element.querySelector(".emojis__panel"),l=(0,a.hasClosestByClassName)(i,"emojis__type");if(l){const e=r.querySelector(`[data-type="${l.getAttribute("data-type")}"]`);if(e){const t=e.nextElementSibling.getAttribute("data-index");if(t){let n="";window.siyuan.emojis[parseInt(t)].items.forEach((e=>{n+=`<button data-unicode="${e.unicode}" class="emojis__item" aria-label="${"zh_CN"===window.siyuan.config.lang?e.description_zh_cn:e.description}">\n${(0,v.unicode2Emoji)(e.unicode,!0)}</button>`})),e.nextElementSibling.innerHTML=n,e.nextElementSibling.removeAttribute("data-index")}r.scrollTo({top:e.offsetTop})}return}const c=(0,a.hasClosestByClassName)(i,"emojis__item");if(c){const t=c.getAttribute("data-unicode");if(this.element.querySelectorAll(".emojis__title").length>2){const i=getSelection().getRangeAt(0);let a;3!==i.endContainer.nodeType&&(null===(n=i.endContainer.childNodes[i.endOffset-1])||void 0===n||n.remove()),(0,v.addEmoji)(t),a=t.indexOf(".")>-1?`:${t.split(".")[0]}: `:(0,v.unicode2Emoji)(t,!0)+" ",(0,h.insertHTML)(e.lute.SpinBlockDOM(a),e),this.element.classList.add("fn__none")}else this.fill(t,e)}}))}render(e){if(!window.getSelection().focusNode)return this.element.classList.add("fn__none"),void clearTimeout(this.timeId);const t=getSelection().getRangeAt(0),n=(0,o.getSelectionOffset)(t.startContainer,e.wysiwyg.element).start,i=t.startContainer.textContent.substring(0,n)||"",r=this.getKey(i,e.options.hint.extend);return void 0===r||":"!==this.splitChar&&(e.toolbar.getCurrentType(t).length>0||(0,a.hasClosestByAttribute)(t.startContainer,"data-type","NodeCodeBlock"))?(this.element.classList.add("fn__none"),void clearTimeout(this.timeId)):":"===this.splitChar?(clearTimeout(this.timeId),void(r?this.genEmojiHTML(e,r):this.element.classList.add("fn__none"))):"/"===this.splitChar||"、"===this.splitChar?(clearTimeout(this.timeId),void(this.enableSlash&&this.genHTML((0,s.hintSlash)(r,e),e))):void e.options.hint.extend.forEach((t=>{t.key===this.splitChar&&(clearTimeout(this.timeId),this.timeId=window.setTimeout((()=>{this.genHTML(t.hint(r,e),e)}),e.options.hint.delay))}))}genLoading(e){if(this.element.classList.contains("fn__none")){this.element.innerHTML='<div class="fn__loading" style="height: 128px;position: initial"><img width="64px" src="/stage/loading-pure.svg"></div>',this.element.classList.remove("fn__none");const t=(0,o.getSelectionPosition)(e.wysiwyg.element);(0,c.setPosition)(this.element,t.left,t.top+26,30)}else this.element.insertAdjacentHTML("beforeend",'<div class="fn__loading"><img width="64px" src="/stage/loading-pure.svg"></div>')}genHTML(e,t,n=!1,i=!1){if(0===e.length)return void(this.element.querySelector(".fn__loading")&&!n||this.element.classList.add("fn__none"));let s="";i?(s='<input style="margin: 0 4px 4px 4px" class="b3-text-field"><div style="flex: 1;overflow:auto;">',this.element.style.display="flex",this.element.style.flexDirection="column"):this.element.style.display="";let r=!1;e.forEach(((t,n)=>{let i="";0===n?t.value.startsWith("((newFile ")&&t.value.endsWith(`${Lute.Caret}'))`)&&e.length>1?i="":(i=" b3-list-item--focus",r=!0):1!==n||r||(i=" b3-list-item--focus"),"separator"===t.html?s+='<div class="b3-menu__separator"></div>':s+=`<button class="b3-list-item b3-list-item--two fn__block${i}" data-value="${encodeURIComponent(t.value)}">${t.html}</button>`})),i&&(s+="</div>"),this.element.innerHTML=s,this.element.classList.remove("fn__none"),e[0].filter?this.element.classList.add("hint--menu"):this.element.classList.remove("hint--menu"),this.element.style.width=Math.max(t.element.clientWidth/2,320)+"px";const u=(0,o.getSelectionPosition)(t.wysiwyg.element);(0,c.setPosition)(this.element,u.left,u.top+26,30),this.element.scrollTop=0;const d=this.element.querySelector('input[type="file"]');if(d&&d.addEventListener("change",(e=>{if(0===e.target.files.length)return;const n=(0,o.getEditorRange)(t.wysiwyg.element);this.lastIndex>-1&&n.setStart(n.startContainer,this.lastIndex),n.deleteContents(),(0,E.uploadFiles)(t,e.target.files,e.target),(0,m.hideElements)(["hint","toolbar"],t)})),i){const e=this.element.querySelector("input.b3-text-field"),n=this.element.querySelector("mark").textContent;e.value=n,e.select(),e.addEventListener("keydown",(e=>{e.stopPropagation(),e.isComposing||((0,l.upDownHint)(this.element.lastElementChild,e),"Enter"===e.key?(setTimeout((()=>{this.fill(decodeURIComponent(this.element.querySelector(".b3-list-item--focus").getAttribute("data-value")),t)}),148),(0,o.focusByRange)(t.toolbar.range),e.preventDefault()):"Escape"===e.key&&(this.element.classList.add("fn__none"),(0,o.focusByRange)(t.toolbar.range)))}));const i=(0,a.hasClosestBlock)(t.toolbar.range.startContainer);e.addEventListener("input",(a=>{a.isComposing||(a.stopPropagation(),this.genSearchHTML(t,e,i,n))})),e.addEventListener("compositionend",(a=>{a.stopPropagation(),this.genSearchHTML(t,e,i,n)}))}}genSearchHTML(e,t,n,a){this.element.lastElementChild.innerHTML='<div class="ft__center"><img style="height:32px;width:32px;" src="/stage/loading-pure.svg"></div>',(0,y.fetchPost)("/api/search/searchRefBlock",{k:t.value,id:n?n.getAttribute("data-node-id"):e.block.parentID,beforeLen:Math.floor((Math.max(e.element.clientWidth/2,320)-58)/28.8),rootID:e.block.rootID},(e=>{let t="";if(e.data.newDoc){const n=`((newFile "${a}"${i.Constants.ZWSP}'${e.data.k}${Lute.Caret}'))`;t+=`<button class="b3-list-item b3-list-item--two fn__block${0===e.data.blocks.length?" b3-list-item--focus":""}" data-value="${encodeURIComponent(n)}"><div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg>\n<span class="b3-list-item__text">${window.siyuan.languages.newFile} <mark>${e.data.k}</mark></span></div></button>`}e.data.blocks.forEach(((e,n)=>{const i=(0,C.getIconByType)(e.type);let o="";e.name&&(o+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconN"></use></svg>${e.name}</span><span class="fn__space"></span>`),e.alias&&(o+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconA"></use></svg>${e.alias}</span><span class="fn__space"></span>`),e.memo&&(o+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconM"></use></svg>${e.memo}</span>`),o&&(o=`<div class="fn__flex b3-list-item__meta b3-list-item__showall">${o}</div>`);const s=`<span data-type="block-ref" data-id="${e.id}" data-subtype="s">${a}</span>`;t+=`<button class="b3-list-item b3-list-item--two fn__block${0===n?" b3-list-item--focus":""}" data-value="${encodeURIComponent(s)}">${o}<div class="b3-list-item__first">\n    <svg class="b3-list-item__graphic popover__block" data-id="${e.id}"><use xlink:href="#${i}"></use></svg>\n    <span class="b3-list-item__text">${e.content}</span>\n</div>\n<div class="b3-list-item__meta b3-list-item__showall" style="margin-bottom: 4px">${e.hPath}</div></button>`})),""===t&&(t=`<button class="b3-list-item b3-list-item--two fn__block" data-value="">${window.siyuan.languages.emptyContent}</button>`),this.element.lastElementChild.innerHTML=t}))}genEmojiHTML(e,t=""){if(t&&!this.enableEmoji)return;const n=this.element.querySelector(".emojis__panel");n?(n.innerHTML=(0,v.filterEmoji)(t,256,!0),t?n.nextElementSibling.classList.add("fn__none"):n.nextElementSibling.classList.remove("fn__none")):(this.element.innerHTML=`<div class="emojis" style="height: auto;">\n<div class="emojis__panel">${(0,v.filterEmoji)(t,256,!0)}</div>\n<div class="fn__flex${t?" fn__none":""}">\n    <div data-type="0" class="emojis__type" aria-label="${window.siyuan.languages.recentEmoji}">${(0,v.unicode2Emoji)("2b50",!0)}</div>\n    <div data-type="1" class="emojis__type" aria-label="${window.siyuan.emojis[0]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,v.unicode2Emoji)("1f527",!0)}</div>\n    <div data-type="2" class="emojis__type" aria-label="${window.siyuan.emojis[1]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,v.unicode2Emoji)("1f60d",!0)}</div>\n    <div data-type="3" class="emojis__type" aria-label="${window.siyuan.emojis[2]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,v.unicode2Emoji)("1f433",!0)}</div>\n    <div data-type="4" class="emojis__type" aria-label="${window.siyuan.emojis[3]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,v.unicode2Emoji)("1f96a",!0)}</div>\n    <div data-type="5" class="emojis__type" aria-label="${window.siyuan.emojis[4]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,v.unicode2Emoji)("1f3a8",!0)}</div>\n    <div data-type="6" class="emojis__type" aria-label="${window.siyuan.emojis[5]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,v.unicode2Emoji)("1f3dd",!0)}</div>\n    <div data-type="7" class="emojis__type" aria-label="${window.siyuan.emojis[6]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,v.unicode2Emoji)("1f52e",!0)}</div>\n    <div data-type="8" class="emojis__type" aria-label="${window.siyuan.emojis[7]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,v.unicode2Emoji)("267e",!0)}</div>\n    <div data-type="9" class="emojis__type" aria-label="${window.siyuan.emojis[8]["zh_CN"===window.siyuan.config.lang?"title_zh_cn":"title"]}">${(0,v.unicode2Emoji)("1f6a9",!0)}</div>\n</div>\n</div>`,(0,v.lazyLoadEmoji)(this.element,!0));const i=this.element.querySelector(".emojis__item");if(i){i.classList.add("emojis__item--current"),this.element.classList.remove("fn__none"),this.element.style.width=Math.max(e.element.clientWidth/2,320)+"px";const t=(0,o.getSelectionPosition)(e.wysiwyg.element);(0,c.setPosition)(this.element,t.left,t.top+26,30),this.element.querySelector(".emojis__panel").scrollTop=0}else this.element.classList.add("fn__none")}fill(e,t){(0,m.hideElements)(["hint","toolbar"],t);const n=(0,o.getEditorRange)(t.wysiwyg.element);let l=(0,a.hasClosestBlock)(n.startContainer);if(!l)return;let c="";l&&(c=l.getAttribute("data-node-id"));let E=l.outerHTML;const C=i.Constants.BLOCK_HINT_CLOSE_KEYS[this.splitChar];if(i.Constants.BLOCK_HINT_KEYS.includes(this.splitChar)&&C&&3===n.startContainer.nodeType&&n.startContainer.wholeText.indexOf(C)>-1){let e=0,t=n.startContainer;for(;t&&e<2;){const i=t.textContent.indexOf(C),a=t.textContent.indexOf(this.splitChar);if(i>-1&&(i<a||a<0)){e=2,n.setEnd(t,i+2);break}const o=t.textContent.indexOf(C.substr(1));if(o>-1&&(e+=1),2===e){n.setEnd(t,o+1);break}t=t.nextSibling}}if(this.lastIndex>-1&&n.setStart(n.startContainer,this.lastIndex),i.Constants.BLOCK_HINT_KEYS.includes(this.splitChar)&&e.startsWith("((newFile ")&&e.endsWith(`${Lute.Caret}'))`)){(0,o.focusByRange)(n);const a=e.substring(11,e.length-4).split(`"${i.Constants.ZWSP}'`),s=1===a.length?a[0]:a[1];(0,r.getSavePath)(t.path,t.notebookId,(e=>{(0,y.fetchPost)("/api/filetree/createDocWithMd",{notebook:t.notebookId,path:(0,b.pathPosix)().join(e,s),markdown:""},(e=>{let n=`<span data-type="block-ref" data-id="${e.data}" data-subtype="d">${(0,w.escapeHtml)(s)}</span>`;2===a.length&&(n=`<span data-type="block-ref" data-id="${e.data}" data-subtype="s">${(0,w.escapeHtml)(a[0])}</span>`),(0,h.insertHTML)((0,p.genEmptyBlock)(!1,!1,n),t)}))}))}else{if(i.Constants.BLOCK_HINT_KEYS.includes(this.splitChar)){if(""===e){const e=(0,u.getContenteditableElement)(l);return void(""===e.textContent&&(e.innerHTML="<wbr>",(0,o.focusByWbr)(e,n)))}n.insertNode(document.createElement("wbr")),E=l.outerHTML,n.deleteContents();let i=document.createElement("div");return i.innerHTML=e.replace(/<mark>/g,"").replace(/<\/mark>/g,""),i=i.firstChild,n.insertNode(i),n.setStartAfter(i),n.collapse(!0),(0,d.updateTransaction)(t,c,l.outerHTML,E),void(0,o.focusByWbr)(l,n)}if(":"===this.splitChar){let n;(0,v.addEmoji)(e),n=e.indexOf(".")>-1?`:${e.split(".")[0]}: `:(0,v.unicode2Emoji)(e,!0)+" ",(0,h.insertHTML)(t.lute.SpinBlockDOM(n),t)}else{if(["「「","{{"].includes(this.splitChar)||"#"===this.splitChar||":"===this.splitChar){if(""===e){const e=(0,u.getContenteditableElement)(l);return void(""===e.textContent&&(e.innerHTML="<wbr>",(0,o.focusByWbr)(e,n)))}return(0,h.insertHTML)(t.lute.SpinBlockDOM(e),t),void(0,_.blockRender)(t,t.wysiwyg.element)}if("/"===this.splitChar||"、"===this.splitChar){if("(("===e||"{{"===e){"(("===e?(0,s.hintRef)("",t):(0,s.hintEmbed)("",t),this.splitChar=e,this.lastIndex=0,n.deleteContents();const i=document.createTextNode(e);return n.insertNode(i),n.setEnd(i,e.length),void n.collapse(!1)}if(e===i.Constants.ZWSP)return n.deleteContents(),this.fixImageCursor(n),t.toolbar.showTpl(t,l,n),void(0,d.updateTransaction)(t,c,l.outerHTML,E);if(e===i.Constants.ZWSP+1)return n.deleteContents(),this.fixImageCursor(n),t.toolbar.showWidget(t,l,n),void(0,d.updateTransaction)(t,c,l.outerHTML,E);if(e===i.Constants.ZWSP+2)return n.deleteContents(),this.fixImageCursor(n),t.toolbar.showAssets(t,l,n),void(0,d.updateTransaction)(t,c,l.outerHTML,E);if(e===i.Constants.ZWSP+3)return void n.deleteContents();if(e===i.Constants.ZWSP+4){const e=Lute.NewNodeID();return void(0,y.fetchPost)("/api/filetree/createDoc",{notebook:t.notebookId,path:(0,b.pathPosix)().join((0,b.getDisplayName)(t.path,!1,!0),e+".sy"),title:"Untitled",md:""},(()=>{(0,h.insertHTML)((0,p.genEmptyBlock)(!1,!1,`<span data-type="block-ref" data-id="${e}" data-subtype="d">Untitled</span>`),t),(0,k.openFileById)({id:e,action:[i.Constants.CB_GET_HL,i.Constants.CB_GET_CONTEXT]})}))}if(i.Constants.INLINE_TYPE.includes(e))return n.deleteContents(),(0,o.focusByRange)(n),t.toolbar.range=n,void t.toolbar.setInlineMark(t,e,"range");if("emoji"===e)return n.deleteContents(),n.insertNode(document.createTextNode(":")),n.collapse(!1),this.enableEmoji=!0,void this.genEmojiHTML(t);if(e.indexOf("style")>-1)return n.deleteContents(),this.fixImageCursor(n),l.setAttribute("style",e.split(i.Constants.ZWSP)[1]||""),void(0,d.updateTransaction)(t,c,l.outerHTML,E);{n.deleteContents(),"![]()"!==e&&this.fixImageCursor(n);let a=e;"```"===e&&(a=e+(localStorage.getItem(i.Constants.LOCAL_CODELANG)||"")+Lute.Caret+"\n```");const s=(0,u.getContenteditableElement)(l);if("![]()"===e){let i="";n.insertNode(document.createElement("wbr")),n.insertNode(document.createTextNode(e)),i=t.lute.SpinBlockDOM(l.outerHTML),l.outerHTML=i,l=t.wysiwyg.element.querySelector(`[data-node-id="${c}"]`),(0,o.focusByWbr)(l,n),(0,d.updateTransaction)(t,c,l.outerHTML,E);let a=n.startContainer.childNodes[n.startOffset-1]||n.startContainer;a&&3!==a.nodeType&&a.classList.contains("img")||(a=l.querySelector(".img"));const s=a.getBoundingClientRect();return void(0,g.imgMenu)(t,n,a,{clientX:s.left,clientY:s.top})}if(""===s.textContent&&"NodeParagraph"===l.getAttribute("data-type")){let n="";"<div>"===e?n=`<div data-node-id="${c}" data-type="NodeHTMLBlock" class="render-node" data-subtype="block"><div class="protyle-icons"><span class="protyle-icon protyle-icon--first protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span><span class="protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span></div><div><protyle-html data-content=""></protyle-html><span style="position: absolute">${i.Constants.ZWSP}</span></div><div class="protyle-attr" contenteditable="false"></div></div>`:(s.textContent=a,n=t.lute.SpinBlockDOM(l.outerHTML)),l.outerHTML=n,l=t.wysiwyg.element.querySelector(`[data-node-id="${c}"]`),(0,d.updateTransaction)(t,c,n,E)}else{let n=t.lute.SpinBlockDOM(a);"<div>"===e&&(n=`<div data-node-id="${Lute.NewNodeID()}" data-type="NodeHTMLBlock" class="render-node" data-subtype="block"><div class="protyle-icons"><span class="protyle-icon protyle-icon--first protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span><span class="protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span></div><div><protyle-html data-content=""></protyle-html><span style="position: absolute">${i.Constants.ZWSP}</span></div><div class="protyle-attr" contenteditable="false"></div></div>`),l.insertAdjacentHTML("afterend",n);const o=n.substr(n.indexOf('data-node-id="')+14,22);(0,d.transaction)(t,[{data:l.outerHTML,id:c,action:"update"},{data:n,id:o,previousID:c,action:"insert"}],[{id:o,action:"delete"},{data:E,id:c,action:"update"}]),l=t.wysiwyg.element.querySelector(`[data-node-id="${o}"]`)}if("<div>"===e||"$$"===e||e.indexOf("```")>-1&&e.length>3)t.toolbar.showRender(t,l),(0,D.processRender)(l);else if(e.startsWith("```"))(0,f.highlightRender)(l);else if(e.startsWith("<iframe")||e.startsWith("<video")||e.startsWith("<audio")){t.gutter.renderMenu(t,l);const e=l.getBoundingClientRect();window.siyuan.menus.menu.popup({x:e.left,y:e.top},!0);const n=window.siyuan.menus.menu.element.querySelector('[data-id="assetSubMenu"]');n.classList.add("b3-menu__item--show"),window.siyuan.menus.menu.showSubMenu(n.querySelector(".b3-menu__submenu")),window.siyuan.menus.menu.element.querySelectorAll("input")[0].focus()}else"---"===e?(0,o.focusBlock)(l):(0,o.focusByWbr)(l,n)}}}}}select(e,t){var n,a,o;const s=this.element.firstElementChild.classList.contains("emojis");if(0===this.element.querySelectorAll("button").length&&!s)return!1;if("Enter"===e.key){if(s){const e=this.element.querySelector(".emojis__item--current");if(!e)return!1;const i=e.getAttribute("data-unicode");if(this.element.querySelectorAll(".emojis__title").length>2){const e=getSelection().getRangeAt(0);let a;3!==e.endContainer.nodeType&&(null===(n=e.endContainer.childNodes[e.endOffset-1])||void 0===n||n.remove()),(0,v.addEmoji)(i),a=i.indexOf(".")>-1?`:${i.split(".")[0]}: `:(0,v.unicode2Emoji)(i,!0)+" ",(0,h.insertHTML)(t.lute.SpinBlockDOM(a),t),this.element.classList.add("fn__none")}else this.fill(i,t)}else{const e=decodeURIComponent(this.element.querySelector(".b3-list-item--focus").getAttribute("data-value"));e===i.Constants.ZWSP+3?this.element.querySelector(".b3-list-item--focus input").click():this.fill(e,t)}return e.preventDefault(),e.stopPropagation(),!0}if(s){const t=this.element.querySelector(".emojis__item--current");if(!t)return!1;let n;if("ArrowLeft"===e.key||"ArrowUp"===e.key?t.previousElementSibling?(t.classList.remove("emojis__item--current"),n=t.previousElementSibling):(null===(a=t.parentElement.previousElementSibling)||void 0===a?void 0:a.previousElementSibling)&&(t.classList.remove("emojis__item--current"),n=t.parentElement.previousElementSibling.previousElementSibling.lastElementChild):"ArrowRight"!==e.key&&"ArrowDown"!==e.key||(t.nextElementSibling?(t.classList.remove("emojis__item--current"),n=t.nextElementSibling):(null===(o=t.parentElement.nextElementSibling)||void 0===o?void 0:o.nextElementSibling)&&(t.classList.remove("emojis__item--current"),n=t.parentElement.nextElementSibling.nextElementSibling.firstElementChild)),n){n.classList.add("emojis__item--current");const e=4,t=this.element.querySelector(".emojis__panel");n.offsetTop-e<t.scrollTop?t.scrollTop=n.offsetTop-e:n.offsetTop-e-t.clientHeight+n.clientHeight>t.scrollTop&&(t.scrollTop=n.offsetTop-e-t.clientHeight+n.clientHeight)}return e.preventDefault(),e.stopPropagation(),!0}return("ArrowDown"===e.key||"ArrowUp"===e.key)&&((0,l.upDownHint)(this.element,e),e.preventDefault(),e.stopPropagation(),!0)}fixImageCursor(e){const t=(0,u.hasPreviousSibling)(e.startContainer);t&&3!==t.nodeType&&t.classList.contains("img")&&((0,u.hasNextSibling)(t)||(e.insertNode(document.createTextNode(i.Constants.ZWSP)),e.collapse(!1)))}getKey(e,t){if(this.lastIndex=-1,this.splitChar="",t.forEach((t=>{const n=e.lastIndexOf(t.key);this.lastIndex<n&&(!i.Constants.BLOCK_HINT_KEYS.includes(this.splitChar)||":"!==t.key&&"#"!==t.key&&"/"!==t.key&&"、"!==t.key)&&("#"!==this.splitChar||"/"!==t.key&&"、"!==t.key)&&(this.splitChar=t.key,this.lastIndex=n)})),-1===this.lastIndex)return;":"!==this.splitChar||!/\d/.test(e.substr(this.lastIndex-1,1))&&"::"!==e.substr(this.lastIndex-1,2)||(this.enableEmoji=!1);const n=e.split(this.splitChar),a=n[n.length-1];return n.length>1&&a.trim()===a&&a.length<i.Constants.SIZE_TITLE?"【【"===this.splitChar&&e.endsWith("【【】")?"":a:void 0}}},2009:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(8792),a=n(9093),o=n(4278),s=n(2211),r=n(1384),l=n(525),c=n(2239),u=n(4912),d=n(5174),p=n(4526),h=n(7924),f=n(8303),g=n(386),m=n(8367),y=n(4745),b=n(3889),v=n(6840),w=n(734),_=n(6679),E=n(9516),k=n(3371),C=n(283),D=n(8813),x=n(7010),S=n(5961);t.default=class{constructor(e,t){var n;this.version=i.Constants.SIYUAN_VERSION;const o=new u.Options(t).merge();this.protyle={transactionTime:(new Date).getTime(),id:(0,f.genUUID)(),disabled:!1,updated:!1,element:e,options:o,block:{}},this.protyle.hint=new a.Hint(this.protyle),o.render.breadcrumb&&(this.protyle.breadcrumb=new b.Breadcrumb(this.protyle)),o.render.title&&(this.protyle.title=new _.Title(this.protyle)),o.render.background&&(this.protyle.background=new C.Background(this.protyle)),this.protyle.element.innerHTML="",this.protyle.element.classList.add("protyle"),o.render.breadcrumb&&this.protyle.element.appendChild(this.protyle.breadcrumb.element.parentElement),this.protyle.undo=new l.Undo,this.protyle.wysiwyg=new g.WYSIWYG(this.protyle),this.protyle.toolbar=new m.Toolbar(this.protyle),this.protyle.scroll=new p.Scroll(this.protyle),this.protyle.options.render.gutter&&(this.protyle.gutter=new y.Gutter(this.protyle)),(o.upload.url||o.upload.handler)&&(this.protyle.upload=new c.Upload),this.init(),t.action.includes(i.Constants.CB_GET_HISTORY)||(this.protyle.ws=new h.Model({id:this.protyle.id,type:"protyle",msgCallback:e=>{switch(e.cmd){case"transactions":e.data[0].doOperations.forEach((e=>{(0,v.onTransaction)(this.protyle,e,!1)}));break;case"heading2doc":case"li2doc":this.protyle.block.rootID===e.data.srcRootBlockID&&(this.protyle.block.showAll&&"heading2doc"===e.cmd?(0,w.fetchPost)("/api/filetree/getDoc",{id:this.protyle.block.rootID,size:i.Constants.SIZE_GET},(e=>{(0,x.onGet)(e,this.protyle)})):(0,S.reloadProtyle)(this.protyle),"heading2doc"===e.cmd&&(0,E.updatePanelByEditor)(this.protyle,!1,!1,!0));break;case"rename":this.protyle.path===e.data.path&&(this.protyle.model&&this.protyle.model.parent.updateTitle(e.data.title),this.protyle.background&&(this.protyle.background.ial.title=e.data.title)),this.protyle.options.render.title&&this.protyle.block.parentID===e.data.id&&(getSelection().rangeCount>0&&this.protyle.element.contains(getSelection().getRangeAt(0).startContainer)||this.protyle.title.setTitle(e.data.title)),this.protyle.wysiwyg.element.querySelectorAll(`[data-type="~block-ref"][data-id="${e.data.id}"]`).forEach((t=>{"d"===t.getAttribute("data-subtype")&&(t.textContent=e.data.title)}));break;case"moveDoc":e.data.fromNotebook===this.protyle.notebookId&&this.protyle.path===e.data.fromPath&&(this.protyle.path=e.data.newPath,this.protyle.notebookId=e.data.toNotebook);break;case"unmount":this.protyle.model&&this.protyle.notebookId===e.data.box&&this.protyle.model.parent.parent.removeTab(this.protyle.model.parent.id,!1,!1);break;case"remove":!this.protyle.model||this.protyle.notebookId!==e.data.box||e.data.path&&0!==this.protyle.path.indexOf((0,D.getDisplayName)(e.data.path,!1,!0))||this.protyle.model.parent.parent.removeTab(this.protyle.model.parent.id,!1,!1)}}}),(0,w.fetchPost)("/api/filetree/getDoc",{id:t.blockId,k:t.key||"",mode:t.action&&t.action.includes(i.Constants.CB_GET_CONTEXT)?3:0,size:(null===(n=t.action)||void 0===n?void 0:n.includes(i.Constants.CB_GET_ALL))?i.Constants.SIZE_GET_MAX:i.Constants.SIZE_GET},(e=>{var n;(0,x.onGet)(e,this.protyle,t.action,t.scrollAttr),this.protyle.model&&((null===(n=t.action)||void 0===n?void 0:n.includes(i.Constants.CB_GET_FOCUS))&&(0,k.setPanelFocus)(this.protyle.model.element.parentElement.parentElement),(0,E.updatePanelByEditor)(this.protyle,!1)),this.protyle.wysiwyg.element.addEventListener("focusin",(()=>{if(this.protyle&&this.protyle.model){let e=!0;if(this.protyle.model.element.parentElement.parentElement.classList.contains("layout__wnd--active")&&this.protyle.model.headElement.classList.contains("item--focus")&&(e=!1),!e)return;(0,k.setPanelFocus)(this.protyle.model.element.parentElement.parentElement),(0,E.updatePanelByEditor)(this.protyle,!1)}else document.querySelectorAll(".block__icons--active").forEach((e=>{e.classList.remove("block__icons--active")})),document.querySelectorAll(".layout__wnd--active").forEach((e=>{e.classList.remove("layout__wnd--active")}))})),o.after&&o.after(this)})),(0,r.setPadding)(this.protyle))}init(){this.protyle.lute=(0,o.setLute)({emojiSite:this.protyle.options.hint.emojiPath,emojis:this.protyle.options.hint.emoji,headingAnchor:!1,listStyle:this.protyle.options.preview.markdown.listStyle,paragraphBeginningSpace:this.protyle.options.preview.markdown.paragraphBeginningSpace,sanitize:this.protyle.options.preview.markdown.sanitize}),this.protyle.preview=new s.Preview(this.protyle),(0,r.initUI)(this.protyle)}focus(){this.protyle.wysiwyg.element.focus()}isUploading(){return this.protyle.upload.isUploading}clearStack(){this.protyle.undo.clear()}destroy(){(0,d.destroy)(this.protyle)}}},4384:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.abcRender=void 0;const i=n(6555),a=n(8792);t.abcRender=(e,t=a.Constants.PROTYLE_CDN)=>{let n=[];n="abc"===e.getAttribute("data-subtype")?[e]:Array.from(e.querySelectorAll('[data-subtype="abc"]')),0!==n.length&&n.length>0&&(0,i.addScript)(`${t}/js/abcjs/abcjs-basic-min.js?v=0.0.0`,"protyleAbcjsScript").then((()=>{n.forEach((e=>{if("true"===e.getAttribute("data-render"))return;e.firstElementChild.classList.contains("protyle-icons")||e.insertAdjacentHTML("afterbegin",'<div class="protyle-icons"><span class="protyle-icon protyle-icon--first protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span><span class="protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span></div>'),e.childElementCount<4&&e.lastElementChild.insertAdjacentHTML("beforebegin",`<span style="position: absolute">${a.Constants.ZWSP}</span>`);const t=e.firstElementChild.nextElementSibling;ABCJS.renderAbc(t,Lute.UnEscapeHTMLStr(e.getAttribute("data-content")),{responsive:"resize"}),t.setAttribute("contenteditable","false"),e.setAttribute("data-render","true")}))}))}},7822:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blockRender=void 0;const i=n(3607),a=n(734),o=n(6057),s=n(1248),r=n(8792);t.blockRender=(e,n)=>{let l=[];l="NodeBlockQueryEmbed"===n.getAttribute("data-type")?[n]:Array.from(n.querySelectorAll('[data-type="NodeBlockQueryEmbed"]')),0!==l.length&&l.forEach((n=>{if("true"===n.getAttribute("data-render"))return;n.innerHTML=`<div class="protyle-icons${(0,i.hasClosestByAttribute)(n.parentElement,"data-type","NodeBlockQueryEmbed")?" fn__none":""}">\n    <span class="protyle-icon protyle-action__reload protyle-icon--first"><svg class="fn__rotate"><use xlink:href="#iconRefresh"></use></svg></span>\n    <span class="protyle-icon protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span>\n    <span class="protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span>\n</div>${n.lastElementChild.outerHTML}`;const l=Lute.UnEscapeHTMLStr(n.getAttribute("data-content"));(0,a.fetchPost)("/api/search/searchEmbedBlock",{stmt:l,headingMode:"1"===n.getAttribute("custom-heading-mode")?1:0,excludeIDs:[n.getAttribute("data-node-id"),e.block.rootID]},(a=>{const l=n.querySelector(".fn__rotate");l&&l.classList.remove("fn__rotate");let c="";a.data.blocks.forEach((e=>{c+=`<div class="protyle-wysiwyg__embed" data-id="${e.id}">${e.content}</div>`})),n.setAttribute("data-render","true"),a.data.blocks.length>0?n.lastElementChild.insertAdjacentHTML("beforebegin",c+`<div style="position: absolute;">${r.Constants.ZWSP}</div>`):n.lastElementChild.insertAdjacentHTML("beforebegin",`<div class="ft__smaller ft__secondary b3-form__space--small" contenteditable="false">${window.siyuan.languages.refExpired}</div>\n<div style="position: absolute;">${r.Constants.ZWSP}</div>`),(0,o.processRender)(n),(0,s.highlightRender)(n);let u=0,d=n;for(;u<4&&d;)d=(0,i.hasClosestByAttribute)(d.parentElement,"data-type","NodeBlockQueryEmbed"),u++;u<4&&n.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach((n=>{(0,t.blockRender)(e,n)}))}))}))}},1716:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chartRender=void 0;const i=n(6555),a=n(8792),o=n(3607);t.chartRender=(e,t=a.Constants.PROTYLE_CDN)=>{let n=[];n="echarts"===e.getAttribute("data-subtype")?[e]:Array.from(e.querySelectorAll('[data-subtype="echarts"]')),0!==n.length&&n.length>0&&(0,i.addScript)(`${t}/js/echarts/echarts.min.js?v=5.3.2`,"protyleEchartsScript").then((()=>{(0,i.addScript)(`${t}/js/echarts/echarts-gl.min.js?v=2.0.9`,"protyleEchartsGLScript").then((()=>{let e;if(0===n[0].firstElementChild.clientWidth){const t=(0,o.hasClosestByClassName)(n[0],"layout-tab-container",!0);t&&Array.from(t.children).find((t=>{if(t.classList.contains("protyle")&&!t.classList.contains("fn__none"))return e=t.querySelector(".protyle-wysiwyg").firstElementChild.clientWidth,!0}))}n.forEach((t=>{if("true"===t.getAttribute("data-render"))return;t.firstElementChild.classList.contains("protyle-icons")||t.insertAdjacentHTML("afterbegin",'<div class="protyle-icons"><span class="protyle-icon protyle-icon--first protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span><span class="protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span></div>');const n=t.firstElementChild.nextElementSibling;try{n.style.height=t.style.height;const i=JSON.parse(Lute.UnEscapeHTMLStr(t.getAttribute("data-content")));echarts.init(n,1===window.siyuan.config.appearance.mode?"dark":void 0,{width:e}).setOption(i),t.setAttribute("data-render","true"),n.classList.remove("ft__error"),n.textContent.endsWith(a.Constants.ZWSP)||n.firstElementChild.insertAdjacentText("beforeend",a.Constants.ZWSP)}catch(e){echarts.dispose(n),n.classList.add("ft__error"),n.innerHTML=`echarts render error: <br>${e}`}}))}))}))}},2813:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flowchartRender=void 0;const i=n(6555),a=n(8792),o=n(3607);t.flowchartRender=(e,t=a.Constants.PROTYLE_CDN)=>{let n=[];n="flowchart"===e.getAttribute("data-subtype")?[e]:Array.from(e.querySelectorAll('[data-subtype="flowchart"]')),0!==n.length&&(0,i.addScript)(`${t}/js/flowchart.js/flowchart.min.js?v=0.0.0`,"protyleFlowchartScript").then((()=>{if(0===n[0].firstElementChild.clientWidth){const e=(0,o.hasClosestByClassName)(n[0],"protyle",!0);if(!e)return;const t=new MutationObserver((()=>{s(n),t.disconnect()}));t.observe(e,{attributeFilter:["class"]})}else s(n)}))};const s=e=>{e.forEach((e=>{if("true"===e.getAttribute("data-render"))return;e.firstElementChild.classList.contains("protyle-icons")||e.insertAdjacentHTML("afterbegin",'<div class="protyle-icons"><span class="protyle-icon protyle-icon--first protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span><span class="protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span></div>'),e.childElementCount<4&&e.lastElementChild.insertAdjacentHTML("beforebegin",`<span style="position: absolute">${a.Constants.ZWSP}</span>`);const t=e.firstElementChild.nextElementSibling,n=flowchart.parse(Lute.UnEscapeHTMLStr(e.getAttribute("data-content")));t.innerHTML="";try{n.drawSVG(t)}catch(e){t.classList.add("ft__error"),t.innerHTML=`Flow Chart render error: <br>${e}`}t.setAttribute("contenteditable","false"),e.setAttribute("data-render","true")}))}},955:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.graphvizRender=void 0;const i=n(6555),a=n(8792);t.graphvizRender=(e,t=a.Constants.PROTYLE_CDN)=>{let n=[];n="graphviz"===e.getAttribute("data-subtype")?[e]:Array.from(e.querySelectorAll('[data-subtype="graphviz"]')),0!==n.length&&(0,i.addScript)(`${t}/js/graphviz/viz.js?v=0.0.0`,"protyleGraphVizScript").then((()=>{n.forEach((e=>{if("true"===e.getAttribute("data-render"))return;e.firstElementChild.classList.contains("protyle-icons")||e.insertAdjacentHTML("afterbegin",'<div class="protyle-icons"><span class="protyle-icon protyle-icon--first protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span><span class="protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span></div>');const t=e.firstElementChild.nextElementSibling;try{const n=new Blob([`importScripts('${document.getElementById("protyleGraphVizScript").src.replace("viz.js","full.render.js")}');`],{type:"application/javascript"}),i=(window.URL||window.webkitURL).createObjectURL(n),o=new Worker(i);new Viz({worker:o}).renderSVGElement(Lute.UnEscapeHTMLStr(e.getAttribute("data-content"))).then((n=>{t.innerHTML=n.outerHTML,t.classList.remove("ft__error"),t.setAttribute("contenteditable","false"),e.textContent.endsWith(a.Constants.ZWSP)||e.insertAdjacentHTML("beforeend",`<span style="position: absolute">${a.Constants.ZWSP}</span>`)})).catch((e=>{t.innerHTML=`graphviz render error: <br>${e}`,t.classList.add("ft__error")}))}catch(e){console.error("Graphviz error",e)}e.setAttribute("data-render","true")}))}))}},1248:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lineNumberRender=t.highlightRender=void 0;const i=n(6555),a=n(2374),o=n(8792),s=n(4640);t.highlightRender=(e,n=o.Constants.PROTYLE_CDN)=>{let r,l=!1;e.classList.contains("code-block")?r=e.querySelectorAll('[spellcheck="false"]'):e.classList.contains("item__readme")?(r=e.querySelectorAll("pre code"),r.forEach((e=>{e.parentElement.setAttribute("lineNumber","false")}))):e.classList.contains("b3-typography")?(r=e.querySelectorAll(".code-block code"),l=!0):r=e.querySelectorAll('.code-block [spellcheck="false"]'),0!==r.length&&((0,a.setCodeTheme)(n),(0,i.addScript)(`${n}/js/highlight.js/highlight.min.js?v=11.5.0`,"protyleHljsScript").then((()=>{(0,i.addScript)(`${n}/js/highlight.js/third-languages.js?v=1.0.0`,"protyleHljsThirdScript").then((()=>{r.forEach((e=>{var n;if("true"===e.getAttribute("data-render"))return;const i=e.querySelector("wbr");let a,o=0;if(i){let e=i.previousSibling;for(;e;){for(o+=e.textContent.length;!e.previousSibling&&"DIV"!==e.parentElement.tagName;)e=e.parentElement;e=e.previousSibling}i.remove()}a=l?e.parentElement.getAttribute("data-language"):e.previousElementSibling?e.previousElementSibling.firstElementChild.textContent:e.className.replace("language-",""),hljs.getLanguage(a)||(a="plaintext"),e.classList.add("hljs"),e.innerHTML=hljs.highlight(e.textContent+(e.textContent.endsWith("\n")?"":"\n"),{language:a,ignoreIllegals:!0}).value,e.setAttribute("data-render","true");const r=e.parentElement.getAttribute("linewrap"),c=e.parentElement.getAttribute("ligatures"),u=e.parentElement.getAttribute("linenumber");"true"===r||"false"!==r&&window.siyuan.config.editor.codeLineWrap?(e.style.setProperty("white-space","pre-wrap"),e.style.setProperty("word-break","break-all")):(e.style.setProperty("white-space","pre"),e.style.setProperty("word-break","initial")),"true"===c||"false"!==c&&window.siyuan.config.editor.codeLigatures?e.style.fontVariantLigatures="normal":e.style.fontVariantLigatures="none";const d=e.parentElement.querySelector(".protyle-action__language");!l&&("true"===u||"false"!==u&&window.siyuan.config.editor.codeSyntaxHighlightLineNum)?(e.classList.add("protyle-linenumber"),setTimeout((()=>{(0,t.lineNumberRender)(e)}),20),d&&(d.style.marginLeft="3.6em")):(null===(n=e.nextElementSibling)||void 0===n?void 0:n.classList.contains("protyle-linenumber__rows"))&&(e.classList.remove("protyle-linenumber"),e.nextElementSibling.remove(),d&&(d.style.marginLeft="")),i&&getSelection().rangeCount>0&&(0,s.focusByOffset)(e,o,o)}))}))})))};t.lineNumberRender=e=>{var t;if("false"===e.parentElement.getAttribute("lineNumber"))return;if(e.nextElementSibling&&e.nextElementSibling.clientHeight===e.clientHeight)return;e.classList.add("protyle-linenumber");const n=document.createElement("div");n.className="hljs protyle-linenumber",n.setAttribute("style",`padding-top:0 !important;padding-bottom:0 !important;min-height:auto !important;white-space:${e.style.whiteSpace};word-break:${e.style.wordBreak};font-variant-ligatures:${e.style.fontVariantLigatures};`),n.setAttribute("contenteditable","true"),e.insertAdjacentElement("afterend",n);let i="";const a=e.textContent.split(/\r\n|\r|\n|\u2028|\u2029/g);""===a[a.length-1]&&a.length>1&&a.pop();const o="break-all"===e.style.wordBreak;a.map((e=>{let t="";if(o){n.textContent=e||"\n";t=` style="height:${n.getBoundingClientRect().height}px;"`}i+=`<span${t}></span>`})),n.remove(),(null===(t=e.nextElementSibling)||void 0===t?void 0:t.classList.contains("protyle-linenumber__rows"))?e.nextElementSibling.innerHTML=i:e.insertAdjacentHTML("afterend",`<span contenteditable="false" class="protyle-linenumber__rows">${i}</span>`)}},8527:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mathRender=void 0;const i=n(6555),a=n(6649),o=n(8792),s=n(6520),r=n(3607);t.mathRender=(e,t=o.Constants.PROTYLE_CDN,n=!1)=>{let l=[];l="math"===e.getAttribute("data-subtype")?[e]:Array.from(e.querySelectorAll('[data-subtype="math"]')),0!==l.length&&((0,a.addStyle)(`${t}/js/katex/katex.min.css?v=0.16.0`,"protyleKatexStyle"),(0,i.addScript)(`${t}/js/katex/katex.min.js?v=0.16.0`,"protyleKatexScript").then((()=>{(0,i.addScript)(`${t}/js/katex/mhchem.min.js?v=0.16.0`,"protyleKatexMhchemScript").then((()=>{l.forEach((e=>{var t;if("true"===e.getAttribute("data-render"))return;e.setAttribute("data-render","true");let i=e;"DIV"===e.tagName&&(i=e.firstElementChild);let a={};try{a=JSON.parse(window.siyuan.config.editor.katexMacros||"{}")}catch(e){console.warn("KaTex macros is not JSON",e)}try{i.innerHTML=katex.renderToString(Lute.UnEscapeHTMLStr(e.getAttribute("data-content")),{displayMode:"DIV"===e.tagName,output:"html",macros:a}),i.classList.remove("ft__error");const l=(0,r.hasClosestBlock)(e);if("DIV"===e.tagName){i.firstElementChild.setAttribute("contenteditable","false"),i.childElementCount<2&&i.insertAdjacentHTML("beforeend",`<span style="position: absolute">${o.Constants.ZWSP}</span>`);const e=i.querySelectorAll(".base");e.length>0&&e[e.length-1].insertAdjacentHTML("afterend","<span class='fn__flex-1'></span>");const t=i.querySelector(".katex-html > .newline");t&&(t.parentElement.style.display="block")}else{l&&e.getBoundingClientRect().width>l.clientWidth?(e.style.maxWidth="100%",e.style.overflowX="auto",e.style.overflowY="hidden",e.style.display="inline-block"):(e.style.maxWidth="",e.style.overflowX="",e.style.overflowY="",e.style.display="");const n=(0,s.hasNextSibling)(e);n?n&&"\n"!==n.textContent&&e.insertAdjacentHTML("beforeend","&#xFEFF;"):"TH"!==e.parentElement.tagName&&"TD"!==e.parentElement.tagName?e.insertAdjacentText("afterend","\n"):e.insertAdjacentText("afterend",o.Constants.ZWSP),(null===(t=e.previousSibling)||void 0===t?void 0:t.textContent.endsWith("\n"))?e.insertAdjacentText("beforebegin",o.Constants.ZWSP):!(0,s.hasPreviousSibling)(e)&&["TH","TD"].includes(e.parentElement.tagName)&&e.insertAdjacentText("afterbegin",o.Constants.ZWSP)}n&&setTimeout((()=>{if("DIV"===e.tagName){const t=e.querySelector(".katex-display");t.clientWidth<t.scrollWidth&&t.firstElementChild.setAttribute("style",`font-size:${100*t.clientWidth/t.scrollWidth}%`)}else l&&e.offsetWidth>l.clientWidth&&e.firstElementChild.setAttribute("style",`font-size:${100*l.clientWidth/e.offsetWidth}%`)}))}catch(e){i.innerHTML=e.message,i.classList.add("ft__error")}}))}))})))}},2924:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaRender=void 0;t.mediaRender=e=>{e&&e.querySelectorAll("a").forEach((e=>{const t=e.getAttribute("href");t&&(t.match(/^.+.(mp4|m4v|ogg|ogv|webm)$/)?((e,t)=>{e.insertAdjacentHTML("afterend",`<video controls="controls" src="${t}"></video>`),e.remove()})(e,t):t.match(/^.+.(mp3|wav|flac)$/)?((e,t)=>{e.insertAdjacentHTML("afterend",`<audio controls="controls" src="${t}"></audio>`),e.remove()})(e,t):((e,t)=>{const n=t.match(/\/\/(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([\w|-]{11})(?:(?:[\?&]t=)(\S+))?/),i=t.match(/\/\/v\.youku\.com\/v_show\/id_(\w+)=*\.html/),a=t.match(/\/\/v\.qq\.com\/x\/cover\/.*\/([^\/]+)\.html\??.*/),o=t.match(/(?:www\.|\/\/)coub\.com\/view\/(\w+)/),s=t.match(/(?:www\.|\/\/)facebook\.com\/([^\/]+)\/videos\/([0-9]+)/),r=t.match(/.+dailymotion.com\/(video|hub)\/(\w+)\?/),l=t.match(/(?:www\.|\/\/)bilibili\.com\/video\/(\w+)/),c=t.match(/(?:www\.|\/\/)ted\.com\/talks\/(\w+)/),u=t.match(/(?:www\.|\/\/)asciinema\.org\/a\/(\w+)/);n&&11===n[1].length?(e.insertAdjacentHTML("afterend",`<iframe src="https://www.youtube.com/embed/${n[1]+(n[2]?"?start="+n[2]:"")}"></iframe>`),e.remove()):i&&i[1]?(e.insertAdjacentHTML("afterend",`<iframe src="https://player.youku.com/embed/${i[1]}"></iframe>`),e.remove()):a&&a[1]?(e.insertAdjacentHTML("afterend",`<iframe src="https://v.qq.com/txp/iframe/player.html?vid=${a[1]}"></iframe>`),e.remove()):o&&o[1]?(e.insertAdjacentHTML("afterend",`<iframe src="https://coub.com/embed/${o[1]}?muted=false&autostart=false&originalSize=true&startWithHD=true"></iframe>`),e.remove()):s&&s[0]?(e.insertAdjacentHTML("afterend",`<iframe src="https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(s[0])}"></iframe>`),e.remove()):r&&r[2]?(e.insertAdjacentHTML("afterend",`<iframe src="https://www.dailymotion.com/embed/video/${r[2]}"></iframe>`),e.remove()):l&&l[1]?(e.insertAdjacentHTML("afterend",`<iframe src="https://player.bilibili.com/player.html?bvid=${l[1]}"></iframe>`),e.remove()):c&&c[1]?(e.insertAdjacentHTML("afterend",`<iframe src="https://embed.ted.com/talks/${c[1]}"></iframe>`),e.remove()):u&&u[1]&&(e.insertAdjacentHTML("afterend",`<iframe style="height: 462px;width: 737px;min-width: auto;" src="https://asciinema.org/a/${u[1]}/embed?"></iframe>`),e.remove())})(e,t))}))}},2962:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mermaidRender=void 0;const i=n(6555),a=n(8792),o=n(3607);t.mermaidRender=(e,t=a.Constants.PROTYLE_CDN)=>{let n=[];n="mermaid"===e.getAttribute("data-subtype")?[e]:Array.from(e.querySelectorAll('[data-subtype="mermaid"]')),0!==n.length&&(0,i.addScript)(`${t}/js/mermaid/mermaid.min.js?v=9.1.1`,"protyleMermaidScript").then((()=>{const e={securityLevel:"loose",altFontFamily:"sans-serif",fontFamily:"sans-serif",startOnLoad:!1,flowchart:{htmlLabels:!0,useMaxWidth:!0},sequence:{useMaxWidth:!0,diagramMarginX:8,diagramMarginY:8,boxMargin:8},gantt:{leftPadding:75,rightPadding:20}};if(1===window.siyuan.config.appearance.mode&&(e.theme="dark",e.themeVariables={background:"#333",primaryColor:"#1f2020",secondaryColor:"hsl(180, 1.5873015873%, 28.3529411765%)",tertiaryColor:"hsl(20, 1.5873015873%, 12.3529411765%)",primaryBorderColor:"hsl(180, 0%, 2.3529411765%)",secondaryBorderColor:"hsl(180, 0%, 18.3529411765%)",tertiaryBorderColor:"hsl(20, 0%, 2.3529411765%)",primaryTextColor:"#e0dfdf",secondaryTextColor:"rgb(183.8476190475, 181.5523809523, 181.5523809523)",tertiaryTextColor:"rgb(222.9999999999, 223.6666666666, 223.9999999999)",lineColor:"lightgrey",textColor:"#ccc",mainBkg:"#1f2020",secondBkg:"hsl(180, 1.5873015873%, 28.3529411765%)",mainContrastColor:"lightgrey",darkTextColor:"hsl(28.5714285714, 17.3553719008%, 86.2745098039%)",border1:"#81B1DB",border2:"rgba(255, 255, 255, 0.25)",arrowheadColor:"lightgrey",fontFamily:'"trebuchet ms", verdana, arial',fontSize:"16px",labelBackground:"#181818",nodeBkg:"#1f2020",nodeBorder:"#81B1DB",clusterBkg:"hsl(180, 1.5873015873%, 28.3529411765%)",clusterBorder:"rgba(255, 255, 255, 0.25)",defaultLinkColor:"lightgrey",titleColor:"#F9FFFE",edgeLabelBackground:"hsl(0, 0%, 34.4117647059%)",actorBorder:"#81B1DB",actorBkg:"#1f2020",actorTextColor:"lightgrey",actorLineColor:"lightgrey",signalColor:"lightgrey",signalTextColor:"lightgrey",labelBoxBkgColor:"#1f2020",labelBoxBorderColor:"#81B1DB",labelTextColor:"lightgrey",loopTextColor:"lightgrey",noteBorderColor:"rgba(255, 255, 255, 0.25)",noteBkgColor:"#fff5ad",noteTextColor:"#1f2020",activationBorderColor:"#81B1DB",activationBkgColor:"hsl(180, 1.5873015873%, 28.3529411765%)",sequenceNumberColor:"black",sectionBkgColor:"hsl(52.9411764706, 28.813559322%, 58.431372549%)",altSectionBkgColor:"#333",sectionBkgColor2:"#EAE8D9",taskBorderColor:"#ffffff",taskBkgColor:"hsl(180, 1.5873015873%, 35.3529411765%)",taskTextColor:"hsl(28.5714285714, 17.3553719008%, 86.2745098039%)",taskTextLightColor:"lightgrey",taskTextOutsideColor:"lightgrey",taskTextClickableColor:"#003163",activeTaskBorderColor:"#ffffff",activeTaskBkgColor:"#81B1DB",gridColor:"lightgrey",doneTaskBkgColor:"lightgrey",doneTaskBorderColor:"grey",critBorderColor:"#E83737",critBkgColor:"#E83737",taskTextDarkColor:"hsl(28.5714285714, 17.3553719008%, 86.2745098039%)",todayLineColor:"#DB5757",labelColor:"#ccc",errorBkgColor:"#a44141",errorTextColor:"#ddd",altBackground:"hsl(0, 0%, 40%)",fillType0:"#1f2020",fillType1:"hsl(180, 1.5873015873%, 28.3529411765%)",fillType2:"hsl(244, 1.5873015873%, 12.3529411765%)",fillType3:"hsl(244, 1.5873015873%, 28.3529411765%)",fillType4:"hsl(116, 1.5873015873%, 12.3529411765%)",fillType5:"hsl(116, 1.5873015873%, 28.3529411765%)",fillType6:"hsl(308, 1.5873015873%, 12.3529411765%)",fillType7:"hsl(308, 1.5873015873%, 28.3529411765%)",classText:"#e0dfdf"}),mermaid.initialize(e),0===n[0].firstElementChild.clientWidth){const e=(0,o.hasClosestByClassName)(n[0],"protyle",!0);if(!e)return;const t=new MutationObserver((()=>{s(n),t.disconnect()}));t.observe(e,{attributeFilter:["class"]})}else s(n)}))};const s=e=>{e.forEach((e=>{if("true"===e.getAttribute("data-render"))return;e.firstElementChild.classList.contains("protyle-icons")||e.insertAdjacentHTML("afterbegin",'<div class="protyle-icons"><span class="protyle-icon protyle-icon--first protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span><span class="protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span></div>');const t=e.firstElementChild.nextElementSibling;t.removeAttribute("data-processed"),t.textContent=Lute.UnEscapeHTMLStr(e.getAttribute("data-content")),mermaid.init(void 0,t),e.setAttribute("data-render","true"),t.setAttribute("contenteditable","false"),e.textContent.endsWith(a.Constants.ZWSP)||e.insertAdjacentHTML("beforeend",`<span style="position: absolute">${a.Constants.ZWSP}</span>`)}))}},8294:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mindmapRender=void 0;const i=n(6555),a=n(8792),o=n(3607);t.mindmapRender=(e,t=a.Constants.PROTYLE_CDN)=>{let n=[];n="mindmap"===e.getAttribute("data-subtype")?[e]:Array.from(e.querySelectorAll('[data-subtype="mindmap"]')),0!==n.length&&(0,i.addScript)(`${t}/js/echarts/echarts.min.js?v=0.0.0`,"protyleEchartsScript").then((()=>{let e;if(0===n[0].firstElementChild.clientWidth){const t=(0,o.hasClosestByClassName)(n[0],"layout-tab-container",!0);t&&Array.from(t.children).find((t=>{if(t.classList.contains("protyle")&&!t.classList.contains("fn__none")&&t.querySelector(".protyle-wysiwyg").firstElementChild)return e=t.querySelector(".protyle-wysiwyg").firstElementChild.clientWidth,!0}))}n.forEach((t=>{if("true"===t.getAttribute("data-render"))return;t.firstElementChild.classList.contains("protyle-icons")||t.insertAdjacentHTML("afterbegin",'<div class="protyle-icons"><span class="protyle-icon protyle-icon--first protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span><span class="protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span></div>');const n=t.firstElementChild.nextElementSibling;try{n.style.height=t.style.height,echarts.init(n,1===window.siyuan.config.appearance.mode?"dark":void 0,{width:e}).setOption({series:[{data:[JSON.parse(Lute.EChartsMindmapStr(Lute.UnEscapeHTMLStr(t.getAttribute("data-content"))))],initialTreeDepth:-1,itemStyle:{borderWidth:0,color:"#4285f4"},label:{backgroundColor:"#f6f8fa",borderColor:"#d1d5da",borderRadius:5,borderWidth:.5,color:"#586069",lineHeight:20,offset:[-5,0],padding:[0,5],position:"insideRight"},lineStyle:{color:"#d1d5da",width:1},roam:!0,symbol:(e,t)=>{var n;return(null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.children)?"circle":"path://"},type:"tree"}],tooltip:{trigger:"item",triggerOn:"mousemove"},backgroundColor:"transparent"}),t.setAttribute("data-render","true"),n.textContent.endsWith(a.Constants.ZWSP)||n.firstElementChild.insertAdjacentText("beforeend",a.Constants.ZWSP),n.classList.remove("ft__error")}catch(e){n.classList.add("ft__error"),n.innerHTML=`Mindmap render error: <br>${e}`}}))}))}},708:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.plantumlRender=void 0;const i=n(6555),a=n(8792);t.plantumlRender=(e,t=a.Constants.PROTYLE_CDN)=>{let n=[];n="plantuml"===e.getAttribute("data-subtype")?[e]:Array.from(e.querySelectorAll('[data-subtype="plantuml"]')),0!==n.length&&(0,i.addScript)(`${t}/js/plantuml/plantuml-encoder.min.js?v=0.0.0`,"protylePlantumlScript").then((()=>{n.forEach((e=>{if("true"===e.getAttribute("data-render"))return;e.firstElementChild.classList.contains("protyle-icons")||e.insertAdjacentHTML("afterbegin",'<div class="protyle-icons"><span class="protyle-icon protyle-icon--first protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span><span class="protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span></div>');const t=e.firstElementChild.nextElementSibling;try{t.innerHTML=`<img src=${window.siyuan.config.editor.plantUMLServePath}${plantumlEncoder.encode(Lute.UnEscapeHTMLStr(e.getAttribute("data-content")))}">`,t.classList.remove("ft__error"),e.setAttribute("data-render","true")}catch(e){t.classList.add("ft__error"),t.innerHTML=`plantuml render error: <br>${e}`}}))}))}},4278:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLute=void 0;t.setLute=e=>{const t=Lute.New();if(t.SetProtyleMarkNetImg(window.siyuan.config.editor.displayNetImgMark),t.SetFileAnnotationRef(!0),t.SetTextMark(!0),t.SetHeadingID(!1),t.SetYamlFrontMatter(!1),t.PutEmojis(e.emojis),t.SetEmojiSite(e.emojiSite),t.SetHeadingAnchor(e.headingAnchor),t.SetInlineMathAllowDigitAfterOpenMarker(!0),t.SetToC(!1),t.SetIndentCodeBlock(!1),t.SetParagraphBeginningSpace(!0),t.SetSetext(!1),t.SetFootnotes(!1),t.SetLinkRef(!1),t.SetSanitize(e.sanitize),t.SetChineseParagraphBeginningSpace(e.paragraphBeginningSpace),t.SetRenderListStyle(e.listStyle),t.SetImgPathAllowSpace(!0),t.SetKramdownIAL(!0),t.SetTag(!0),t.SetSuperBlock(!0),t.SetGitConflict(!0),t.SetMark(!0),t.SetSup(!0),t.SetSub(!0),t.SetProtyleWYSIWYG(!0),e.lazyLoadImage&&t.SetImageLazyLoading(e.lazyLoadImage),t.SetBlockRef(!0),window.siyuan.emojis[0].items.length>0){const n={};window.siyuan.emojis[0].items.forEach((t=>{n[t.keywords]=e.emojiSite+"/"+t.unicode})),t.PutEmojis(n)}return t}},9207:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.speechRender=void 0;const i=n(4640);t.speechRender=(e,t)=>{if("undefined"==typeof speechSynthesis||"undefined"==typeof SpeechSynthesisUtterance)return;const n='<svg><use xlink:href="#iconPlay"></use></svg>',a='<svg><use xlink:href="#iconPause"></use></svg>';let o=document.querySelector(".protyle-speech");if(!o){o=document.createElement("div"),o.className="protyle-speech",document.body.insertAdjacentElement("beforeend",o);const e=()=>{let e,n;return speechSynthesis.getVoices().forEach((i=>{i.lang===t.replace("_","-")&&(e=i),i.default&&(n=i)})),e||(e=n),e};void 0!==speechSynthesis.onvoiceschanged&&(speechSynthesis.onvoiceschanged=e);const s=e();o.onclick=()=>{if("protyle-speech"===o.className){const e=new SpeechSynthesisUtterance(o.getAttribute("data-text"));e.voice=s,e.onend=()=>{o.className="protyle-speech",speechSynthesis.cancel(),o.innerHTML=n},speechSynthesis.speak(e),o.className="protyle-speech protyle-speech--current",o.innerHTML=a}else speechSynthesis.speaking&&(speechSynthesis.paused?(speechSynthesis.resume(),o.innerHTML=a):(speechSynthesis.pause(),o.innerHTML=n));(0,i.focusByRange)(window.protyleSpeechRange)},document.body.addEventListener("click",(()=>{""===getSelection().toString().trim()&&"block"===o.style.display&&(o.className="protyle-speech",speechSynthesis.cancel(),o.style.display="none")}))}e.addEventListener("mouseup",(e=>{const t=getSelection().toString().trim();if(speechSynthesis.cancel(),""===getSelection().toString().trim())return void("block"===o.style.display&&(o.className="protyle-speech",o.style.display="none"));window.protyleSpeechRange=getSelection().getRangeAt(0).cloneRange();const i=getSelection().getRangeAt(0).getBoundingClientRect();o.innerHTML=n,o.style.display="block",o.style.top=i.top+i.height+document.querySelector("html").scrollTop-20+"px",o.style.left=e.screenX+2+"px",o.setAttribute("data-text",t)}))}},6914:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.previewImage=void 0;const i=n(8792),a=n(6555),o=n(734);t.previewImage=(e,t)=>{(0,a.addScript)(`${i.Constants.PROTYLE_CDN}/js/viewerjs/viewer.js?v=1.10.4`,"protyleViewerScript").then((()=>{(0,o.fetchPost)("/api/asset/getDocImageAssets",{id:t},(t=>{const n=document.createElement("ul");let i="",a=-1;t.data.forEach(((t,n)=>{t&&(i+=`<li><img src="${t}"></li>`,-1===a&&(e.endsWith(encodeURI(t))||e.endsWith(t))&&(a=n))})),n.innerHTML=i;const o=new Viewer(n,{button:!1,initialViewIndex:a,transition:!1,hidden:function(){o.destroy()},toolbar:{zoomIn:!0,zoomOut:!0,oneToOne:!0,reset:!0,prev:!0,play:!0,next:!0,rotateLeft:!0,rotateRight:!0,flipHorizontal:!0,flipVertical:!0,close:function(){o.destroy()}}});o.show()}))}))}},2211:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Preview=void 0;const i=n(7954),a=n(3607),o=n(4640),s=n(1890),r=n(8813),l=n(6914),c=n(8776),u=n(8792),d=n(3274),p=n(9516),h=n(734),f=n(6057),g=n(1248),m=n(9207),y=n(2924);t.Preview=class{constructor(e){this.element=document.createElement("div"),this.element.className="protyle-preview fn__none";const t=document.createElement("div");t.className="b3-typography",e.options.classes.preview&&t.classList.add(e.options.classes.preview),t.style.padding=e.wysiwyg.element.style.padding,t.addEventListener("click",(n=>{if("A"===n.target.tagName){const e=n.target.getAttribute("href");return e.startsWith("#")?(t.querySelector(e).scrollIntoView(),n.stopPropagation(),void n.preventDefault()):(0,d.isMobile)()?((0,i.openByMobile)(e),n.stopPropagation(),void n.preventDefault()):(n.stopPropagation(),n.preventDefault(),void((0,r.isLocalPath)(e)?u.Constants.SIYUAN_ASSETS_EXTS.includes((0,r.pathPosix)().extname(e.split("?page")[0]))&&(0,p.openAsset)(e.split("?page")[0],parseInt((0,d.getSearch)("page",e))):window.open(e)))}"IMG"===n.target.tagName&&(0,l.previewImage)(n.target.src,e.block.rootID)}));const n=e.options.preview.actions,o=document.createElement("div");o.className="protyle-preview__action";const s=[];for(let e=0;e<n.length;e++){const t=n[e];if("object"!=typeof t)switch(t){case"desktop":s.push('<button type="button" class="protyle-preview__action--current" data-type="desktop">Desktop</button>');break;case"tablet":s.push('<button type="button" data-type="tablet">Tablet</button>');break;case"mobile":s.push('<button type="button" data-type="mobile">Mobile/Wechat</button>');break;case"mp-wechat":s.push('<button type="button" data-type="mp-wechat" class="b3-tooltips b3-tooltips__w" aria-label="复制到公众号"><svg><use xlink:href="#iconMp"></use></svg></button>');break;case"zhihu":s.push('<button type="button" data-type="zhihu" class="b3-tooltips b3-tooltips__w" aria-label="复制到知乎"><svg><use xlink:href="#iconZhihu"></use></svg></button>');break;case"yuque":s.push('<button type="button" data-type="yuque" class="b3-tooltips b3-tooltips__w" aria-label="复制到语雀"><svg><use xlink:href="#iconYuque"></use></svg></button>')}else s.push(`<button type="button" data-type="${t.key}" class="${t.className}">${t.text}</button>`)}o.innerHTML=s.join(""),this.element.appendChild(o),this.element.appendChild(t),o.addEventListener((0,i.getEventName)(),(i=>{const s=(0,a.hasClosestByTag)(i.target,"BUTTON");if(!s)return;const r=s.getAttribute("data-type"),l=n.find((e=>(null==e?void 0:e.key)===r));l?l.click(r):"mp-wechat"!==r&&"zhihu"!==r&&"yuque"!==r?("desktop"===r?(t.style.width="",t.style.padding=e.wysiwyg.element.style.padding):"tablet"===r?(t.style.width="1024px",t.style.padding="8px 16px"):(t.style.width="360px",t.style.padding="8px"),this.render(e),o.querySelectorAll("button").forEach((e=>{e.classList.remove("protyle-preview__action--current")})),s.classList.add("protyle-preview__action--current")):this.copyToX(this.element.lastElementChild.cloneNode(!0),e,r)})),this.previewElement=t}render(e){"none"!==this.element.style.display&&(this.mdTimeoutId=window.setTimeout((()=>{(0,h.fetchPost)("/api/export/preview",{id:e.block.parentID||e.options.blockId},(t=>{e.preview.previewElement.innerHTML=t.data.html,(0,f.processRender)(e.preview.previewElement),(0,g.highlightRender)(e.preview.previewElement),(0,m.speechRender)(e.preview.previewElement,e.options.lang),(0,y.mediaRender)(e.preview.previewElement)}))}),e.options.preview.delay))}link2online(e){(0,c.needSubscribe)("")||e.querySelectorAll("[href],[src]").forEach((e=>{const t=e.getAttribute("href")||e.getAttribute("src");if(t&&t.startsWith("assets/")){const n=u.Constants.ASSETS_ADDRESS+window.siyuan.user.userId+"/"+t;e.getAttribute("href")?e.setAttribute("href",n):e.setAttribute("src",n)}}))}copyToX(e,t,n){if("mp-wechat"===n)this.link2online(e),e.querySelectorAll(".katex-html .base").forEach((e=>{e.style.display="initial"})),e.querySelectorAll("mjx-container > svg").forEach((e=>{e.setAttribute("width",8*parseInt(e.getAttribute("width"))+"px")}));else if("zhihu"===n)this.link2online(e),e.querySelectorAll('[data-subtype="math"]').forEach((e=>{e.outerHTML=`<img class="Formula-image" data-eeimg="true" src="//www.zhihu.com/equation?tex=" alt="${e.getAttribute("data-content")}\\" style="display: block; margin: 0 auto; max-width: 100%;">`})),e.querySelectorAll("blockquote").forEach((e=>{const t=[];this.processZHBlockquote(e,t),t.reverse().forEach((t=>{e.insertAdjacentElement("afterend",t)})),e.remove()})),this.processZHTable(e);else if("yuque"===n)return void(0,h.fetchPost)("/api/lute/copyStdMarkdown",{id:t.block.rootID},(e=>{(0,i.writeText)(e.data),(0,s.showMessage)("已复制，可到语雀进行粘贴")}));e.style.backgroundColor="#fff",e.querySelectorAll("code").forEach((e=>{e.style.backgroundImage="none"})),this.element.append(e);const a=getSelection().getRangeAt(0).cloneRange(),r=e.ownerDocument.createRange();r.selectNodeContents(e),(0,o.focusByRange)(r),document.execCommand("copy"),this.element.lastElementChild.remove(),(0,o.focusByRange)(a),n&&(0,s.showMessage)(`已复制，可到${"zhihu"===n?"知乎":"微信公众号平台"}进行粘贴`)}processZHBlockquote(e,t){Array.from(e.children).forEach((e=>{if("BLOCKQUOTE"===e.tagName)this.processZHBlockquote(e,t);else if("P"!==e.tagName||e.querySelector("img"))t.push(e);else{const n=t[t.length-1];(!n||n&&"BLOCKQUOTE"!==n.tagName)&&t.push(document.createElement("blockquote")),t[t.length-1].append(e)}}))}processZHTable(e){e.querySelectorAll("table").forEach((e=>{const t=e.querySelector("thead");e.querySelector("tbody").insertAdjacentElement("afterbegin",t.firstElementChild),t.remove()}))}}},1829:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scrollEvent=void 0;const i=n(8792),a=n(5378),o=n(734),s=n(7010),r=n(1890),l=n(7954),c=n(3274);t.scrollEvent=(e,t)=>{let n=t.getBoundingClientRect();t.addEventListener("scroll",(()=>{var u;if(!e.toolbar.element.classList.contains("fn__none")){const a=e.toolbar.element.getAttribute("data-inity").split(i.Constants.ZWSP),o=parseInt(a[0])+(parseInt(a[1])-t.scrollTop);0===n.width&&(n=t.getBoundingClientRect());const s=29;o<n.top-s||o>n.bottom-s?e.toolbar.element.style.display="none":(e.toolbar.element.style.top=o+"px",e.toolbar.element.style.display="")}e.element.classList.contains("block__edit")||(0,c.isMobile)()||e.contentElement.setAttribute("data-scrolltop",t.scrollTop.toString()),window.siyuan.dragElement||(0,a.hideElements)(["gutter"],e),e.selectElement.classList.contains("fn__none")||(0,r.showMessage)(window.siyuan.languages.crossPageUse.replace("${}",(0,l.updateHotkeyTip)("⇧Click")),9e3);const d=null===(u=e.breadcrumb)||void 0===u?void 0:u.element.parentElement.querySelector('[data-type="context"]');d&&!d.classList.contains("ft__primary")||e.wysiwyg.element.getAttribute("data-top")||e.block.showAll||e.scroll.lastScrollTop===t.scrollTop||-1===e.scroll.lastScrollTop||(e.scroll.lastScrollTop-t.scrollTop>0?t.scrollTop<t.clientHeight&&"true"!==e.wysiwyg.element.firstElementChild.getAttribute("data-eof")&&(e.contentElement.style.overflow="hidden",e.wysiwyg.element.setAttribute("data-top",t.scrollTop.toString()),(0,o.fetchPost)("/api/filetree/getDoc",{id:e.wysiwyg.element.firstElementChild.getAttribute("data-node-id"),mode:1,k:e.options.key||"",size:i.Constants.SIZE_GET},(t=>{e.contentElement.style.overflow="",(0,s.onGet)(t,e,[i.Constants.CB_GET_BEFORE,i.Constants.CB_GET_UNCHANGEID])}))):t.scrollTop>t.scrollHeight-1.8*t.clientHeight&&e.wysiwyg.element.lastElementChild&&"true"!==e.wysiwyg.element.lastElementChild.getAttribute("data-eof")&&(e.wysiwyg.element.setAttribute("data-top",t.scrollTop.toString()),(0,o.fetchPost)("/api/filetree/getDoc",{id:e.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),mode:2,k:e.options.key||"",size:i.Constants.SIZE_GET},(t=>{(0,s.onGet)(t,e,[i.Constants.CB_GET_APPEND,i.Constants.CB_GET_UNCHANGEID])}))),e.scroll.lastScrollTop=Math.max(t.scrollTop,0))}),{capture:!1,passive:!0,once:!1})}},4526:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Scroll=void 0;const i=n(8792),a=n(7010),o=n(734);t.Scroll=class{constructor(e){const t=document.createElement("div");t.innerHTML="<input class='b3-slider' type='range' max='1' min='1' step='1' value='1' />",t.className="fn__none protyle-scroll b3-tooltips b3-tooltips__s",t.setAttribute("aria-label","Blocks 1/1"),this.element=t,this.keepLazyLoad=!1,e.options.render.scroll||this.element.classList.add("fn__none"),this.lastScrollTop=0,this.inputElement=t.firstElementChild,this.inputElement.addEventListener("input",(()=>{this.element.setAttribute("aria-label",`Blocks ${this.inputElement.value}/${e.block.blockCount}`)})),this.inputElement.addEventListener("change",(()=>{this.setIndex(e)})),this.inputElement.addEventListener("touchend",(()=>{this.setIndex(e)})),this.inputElement.addEventListener("click",(()=>{this.setIndex(e)}))}setIndex(e){!e.wysiwyg.element.getAttribute("data-top")&&e.model&&(e.wysiwyg.element.setAttribute("data-top",e.wysiwyg.element.scrollTop.toString()),(0,o.fetchPost)("/api/filetree/getDoc",{index:parseInt(this.inputElement.value),id:e.block.parentID,mode:0,size:i.Constants.SIZE_GET},(t=>{(0,a.onGet)(t,e,[i.Constants.CB_GET_FOCUSFIRST,i.Constants.CB_GET_UNCHANGEID])})))}update(e){"number"==typeof e.block.blockCount&&(this.inputElement.setAttribute("max",e.block.blockCount.toString()),this.element.setAttribute("aria-label",`Blocks ${this.inputElement.value}/${e.block.blockCount}`)),e.block.showAll?this.element.classList.add("fn__none"):e.block.childBlockCount>i.Constants.SIZE_GET?this.element.classList.remove("fn__none"):this.element.classList.add("fn__none")}}},7870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.preventScroll=void 0;t.preventScroll=(e,t=0,n=1e3)=>{e.scroll.lastScrollTop=-1,setTimeout((()=>{e.scroll.lastScrollTop=t}),n)}},3914:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.restoreScroll=t.saveScroll=void 0;const i=n(3607),a=n(4640),o=n(734),s=n(407),r=n(7870),l=n(9039),c=n(6057),u=n(1248),d=n(7822),p=n(7010);t.saveScroll=(e,t=!1)=>{if(!e.wysiwyg.element.firstElementChild)return;const n={startId:e.wysiwyg.element.firstElementChild.getAttribute("data-node-id"),endId:e.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),scrollTop:e.contentElement.scrollTop||parseInt(e.contentElement.getAttribute("data-scrolltop"))||0};let s;if(getSelection().rangeCount>0&&(s=getSelection().getRangeAt(0)),s&&e.wysiwyg.element.contains(s.startContainer)||(s=e.toolbar.range),s&&e.wysiwyg.element.contains(s.startContainer)){const e=(0,i.hasClosestBlock)(s.startContainer);if(e){const t=(0,a.getSelectionOffset)(e,void 0,s);n.focusId=e.getAttribute("data-node-id"),n.focusStart=t.start,n.focusEnd=t.end}}if(e.block.showAll&&(n.zoomInId=e.block.id),t)return n;const r=JSON.stringify(n);(0,o.fetchPost)("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{scroll:r}},(()=>{e.wysiwyg.element.setAttribute("scroll",r)}))};t.restoreScroll=(e,t)=>{if((0,r.preventScroll)(e),e.wysiwyg.element.firstElementChild.getAttribute("data-node-id")===t.startId&&e.wysiwyg.element.lastElementChild.getAttribute("data-node-id")===t.endId){if(setTimeout((()=>{e.contentElement.scrollTop=t.scrollTop}),256),t.focusId){const n=(0,a.focusByOffset)(e.wysiwyg.element.querySelector(`[data-node-id="${t.focusId}"]`),t.focusStart,t.focusEnd);(0,l.pushBack)(e,n||void 0)}}else t.zoomInId&&e.block.id!==t.zoomInId?(0,o.fetchPost)("/api/block/checkBlockExist",{id:t.zoomInId},(n=>{n.data&&(0,s.zoomOut)(e,t.zoomInId,void 0,!0,(()=>{e.contentElement.scrollTop=t.scrollTop,t.focusId&&(0,a.focusByOffset)(e.wysiwyg.element.querySelector(`[data-node-id="${t.focusId}"]`),t.focusStart,t.focusEnd)}))})):e.scroll.element.classList.contains("fn__none")?t.scrollTop&&(e.contentElement.scrollTop=t.scrollTop):(0,o.fetchPost)("/api/filetree/getDoc",{id:e.block.id,startID:t.startId,endID:t.endId},(n=>{if(e.block.showAll=!1,e.wysiwyg.element.innerHTML=n.data.content,(0,c.processRender)(e.wysiwyg.element),(0,u.highlightRender)(e.wysiwyg.element),(0,d.blockRender)(e,e.wysiwyg.element),e.disabled?(0,p.disabledProtyle)(e):(0,p.enableProtyle)(e),e.contentElement.scrollTop=t.scrollTop,t.focusId){const n=(0,a.focusByOffset)(e.wysiwyg.element.querySelector(`[data-node-id="${t.focusId}"]`),t.focusStart,t.focusEnd);(0,l.pushBack)(e,n||void 0)}}))}},7134:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlockRef=void 0;const i=n(7903),a=n(3505),o=n(4640);class s extends i.ToolbarItem{constructor(e,t){super(e,t),this.element.addEventListener("click",(t=>{(0,o.fixTableRange)(e.toolbar.range),(0,a.hintRef)(e.toolbar.range.toString(),e,!0),e.toolbar.element.classList.add("fn__none"),t.stopPropagation()}))}}t.BlockRef=s},7803:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Divider=void 0;t.Divider=class{constructor(){this.element=document.createElement("div"),this.element.className="protyle-toolbar__divider"}}},3174:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasSameTextStyle=t.setFontStyle=t.fontEvent=t.fontMenu=t.Font=void 0;const i=n(7954),a=n(7903),o=n(6224),s=n(4640),r=n(8792);class l extends a.ToolbarItem{constructor(e,n){super(e,n),this.element.addEventListener((0,i.getEventName)(),(()=>{e.toolbar.element.classList.add("fn__none"),e.toolbar.subElement.innerHTML="",e.toolbar.subElement.style.width="",e.toolbar.subElement.style.padding="",e.toolbar.subElement.append((0,t.fontMenu)(e)),e.toolbar.subElement.classList.remove("fn__none");const n=(0,s.getSelectionPosition)(e.wysiwyg.element,e.toolbar.range);(0,o.setPosition)(e.toolbar.subElement,n.left,n.top+18,26)}))}}t.Font=l;t.fontMenu=e=>{let n="";["var(--b3-font-color1)","var(--b3-font-color2)","var(--b3-font-color3)","var(--b3-font-color4)","var(--b3-font-color5)","var(--b3-font-color6)","var(--b3-font-color7)","var(--b3-font-color8)","var(--b3-font-color9)","var(--b3-font-color10)","var(--b3-font-color11)","var(--b3-font-color12)","var(--b3-font-color13)"].forEach((e=>{n+=`<button class="b3-color__square" data-type="color" style="background-color:${e}"></button>`}));let a="";["var(--b3-font-background1)","var(--b3-font-background2)","var(--b3-font-background3)","var(--b3-font-background4)","var(--b3-font-background5)","var(--b3-font-background6)","var(--b3-font-background7)","var(--b3-font-background8)","var(--b3-font-background9)","var(--b3-font-background10)","var(--b3-font-background11)","var(--b3-font-background12)","var(--b3-font-background13)"].forEach((e=>{a+=`<button class="b3-color__square" data-type="backgroundColor" style="background-color:${e}"></button>`}));const o=document.createElement("div");o.classList.add("protyle-font");let s="";const l=JSON.parse(localStorage.getItem(r.Constants.LOCAL_FONTSTYLES)||"[]");return l.length>0&&(s=`<div style="margin-bottom: 2px" class="fn__flex">\n    ${window.siyuan.languages.lastUsed}<span class="fn__space"></span>\n    <small class="ft__on-surface fn__flex-center">${(0,i.updateHotkeyTip)(window.siyuan.config.keymap.editor.insert.lastUsed.custom)}</small>\n</div><div class="fn__flex" style="align-items: center">`,l.forEach((e=>{const t=e.split(r.Constants.ZWSP);switch(t[0]){case"remove":s+=`<button style="margin-right: 4px" data-type="remove" class="b3-button--outline b3-button b3-button--small">${window.siyuan.languages.clearFontStyle}</button>`;break;case"color":s+=`<button class="b3-color__square" data-type="color" style="background-color:${t[1]}"></button>`;break;case"backgroundColor":s+=`<button class="b3-color__square" data-type="backgroundColor" style="background-color:${t[1]}"></button>`;break;case"style2":s+=`<button data-type="style2" class="protyle-font__style" style="-webkit-text-stroke: 0.2px var(--b3-theme-on-background);-webkit-text-fill-color : transparent;">${window.siyuan.languages.hollow}</button>`;break;case"style4":s+=`<button data-type="style4" class="protyle-font__style" style="text-shadow: 1px 1px var(--b3-border-color), 2px 2px var(--b3-border-color), 3px 3px var(--b3-border-color), 4px 4px var(--b3-border-color)">${window.siyuan.languages.shadow}</button>`}})),s+="</div>"),o.innerHTML=`${s}<div style="margin: 4px 0 2px">${window.siyuan.languages.colorFont}</div>\n<div class="fn__flex">\n    ${n}\n</div>\n<div style="margin: 4px 0 2px">${window.siyuan.languages["--b3-theme-background"]}</div>\n<div class="fn__flex">\n    ${a}\n</div>\n<div style="margin: 4px 0 2px">${window.siyuan.languages.fontStyle}</div>\n<div class="fn__flex">\n    <button data-type="style2" class="protyle-font__style" style="-webkit-text-stroke: 0.2px var(--b3-theme-on-background);-webkit-text-fill-color : transparent;">${window.siyuan.languages.hollow}</button>\n    <button data-type="style4" class="protyle-font__style" style="text-shadow: 1px 1px var(--b3-border-color), 2px 2px var(--b3-border-color), 3px 3px var(--b3-border-color), 4px 4px var(--b3-border-color)">${window.siyuan.languages.shadow}</button>\n    <span class="fn__space fn__flex-1"></span>\n    <button data-type="remove" class="b3-button--outline b3-button b3-button--small">\n        ${window.siyuan.languages.clearFontStyle}\n    </button>\n</div>`,o.addEventListener((0,i.getEventName)(),(function(n){let i=n.target;for(;i&&!i.isEqualNode(o);){if("BUTTON"===i.tagName){(0,t.fontEvent)(e,i.getAttribute("data-type"),i.style.backgroundColor);break}i=i.parentElement}})),o};t.fontEvent=(e,t,n)=>{let i=JSON.parse(localStorage.getItem(r.Constants.LOCAL_FONTSTYLES)||"[]");if(t)i.splice(0,0,`${t}${r.Constants.ZWSP}${n}`),i=[...new Set(i)],i.length>8&&i.splice(7,1),localStorage.setItem(r.Constants.LOCAL_FONTSTYLES,JSON.stringify(i));else if(0===i.length)t="color",n="var(--b3-font-color1)";else{const e=i[0].split(r.Constants.ZWSP);t=e[0],n=e[1]}e.toolbar.setInlineMark(e,"text","range",{type:t,color:n})};t.setFontStyle=(e,t)=>{if(t)switch(t.type){case"color":e.style.color=t.color;break;case"backgroundColor":e.style.backgroundColor=t.color;break;case"style2":e.style.webkitTextStroke="0.2px var(--b3-theme-on-background)",e.style.webkitTextFillColor="transparent";break;case"style4":e.style.textShadow="1px 1px var(--b3-border-color), 2px 2px var(--b3-border-color), 3px 3px var(--b3-border-color), 4px 4px var(--b3-border-color)"}};t.hasSameTextStyle=(e,t,n)=>{if(!n)return!0;let i="",a="",o="",s="",r="";return 3!==e.nodeType&&(i=e.style.color,a=e.style.webkitTextFillColor,o=e.style.webkitTextStroke,s=e.style.textShadow,r=e.style.backgroundColor),"color"===n.type?n.color===t.style.color&&a===t.style.webkitTextFillColor&&o===t.style.webkitTextStroke&&s===t.style.textShadow&&r===t.style.backgroundColor:"backgroundColor"===n.type?i===t.style.color&&a===t.style.webkitTextFillColor&&o===t.style.webkitTextStroke&&s===t.style.textShadow&&n.color===t.style.backgroundColor:"style2"===n.type?i===t.style.color&&"transparent"===t.style.webkitTextFillColor&&"0.2px var(--b3-theme-on-background)"===t.style.webkitTextStroke&&s===t.style.textShadow&&r===t.style.backgroundColor:"style4"===n.type?i===t.style.color&&a===t.style.webkitTextFillColor&&o===t.style.webkitTextStroke&&"1px 1px var(--b3-border-color), 2px 2px var(--b3-border-color), 3px 3px var(--b3-border-color), 4px 4px var(--b3-border-color)"===t.style.textShadow&&r===t.style.backgroundColor:void 0}},8139:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.InlineMath=void 0;const a=n(7903),o=n(5680),s=n(6840),r=n(3607),l=n(6520),c=n(8527),u=n(4640);class d extends a.ToolbarItem{constructor(e,t){super(e,t),this.element.addEventListener("click",(t=>i(this,void 0,void 0,(function*(){e.toolbar.element.classList.add("fn__none"),t.stopPropagation();const n=e.toolbar.range,i=(0,r.hasClosestBlock)(n.startContainer);if(!i)return;(0,u.fixTableRange)(n),["DIV","TD","TH","TR"].includes(n.startContainer.parentElement.tagName)||0!==n.startOffset||(0,l.hasPreviousSibling)(n.startContainer)||n.setStartBefore(n.startContainer.parentElement),["DIV","TD","TH","TR"].includes(n.endContainer.parentElement.tagName)||n.endOffset!==n.endContainer.textContent.length||(0,l.hasNextSibling)(n.endContainer)||n.setEndAfter(n.endContainer.parentElement);const a=document.createElement("wbr");n.insertNode(a);const d=i.outerHTML,p=document.createElement("span"),h=n.toString();p.className="render-node",p.setAttribute("contenteditable","false"),p.setAttribute("data-type","inline-math"),p.setAttribute("data-subtype","math"),p.setAttribute("data-content",h.trim()),n.extractContents(),n.insertNode(p),(0,c.mathRender)(p),""===h.trim()&&e.toolbar.showRender(e,p),i.setAttribute("updated",o().format("YYYYMMDDHHmmss")),(0,s.updateTransaction)(e,i.getAttribute("data-node-id"),i.outerHTML,d),a.remove()}))))}}t.InlineMath=d},2986:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.InlineMemo=void 0;const a=n(7903),o=n(5680),s=n(6840),r=n(3607),l=n(6520),c=n(4640),u=n(3274);class d extends a.ToolbarItem{constructor(e,t){super(e,t),this.element.addEventListener("click",(t=>i(this,void 0,void 0,(function*(){e.toolbar.element.classList.add("fn__none"),t.stopPropagation();const n=e.toolbar.range,i=(0,r.hasClosestBlock)(n.startContainer);if(!i)return;const a=(0,r.hasClosestByAttribute)(n.startContainer,"data-type","inline-memo");if(a)return void e.toolbar.showRender(e,a);if(""===n.toString())return;(0,c.fixTableRange)(n),["DIV","TD","TH","TR"].includes(n.startContainer.parentElement.tagName)||0!==n.startOffset||(0,l.hasPreviousSibling)(n.startContainer)||n.setStartBefore(n.startContainer.parentElement),["DIV","TD","TH","TR"].includes(n.endContainer.parentElement.tagName)||n.endOffset!==n.endContainer.textContent.length||(0,l.hasNextSibling)(n.endContainer)||n.setEndAfter(n.endContainer.parentElement);const d=document.createElement("wbr");n.insertNode(d);const p=i.outerHTML,h=[];n.extractContents().childNodes.forEach((e=>{if(3===e.nodeType){const t=document.createElement("span");t.setAttribute("data-type","inline-memo"),t.textContent=e.textContent,h.push(t)}else{let t=(e.getAttribute("data-type")||"").split(" ");t.push("inline-memo"),t=[...new Set(t)],"BR"!==e.tagName&&"WBR"!==e.tagName?(e.setAttribute("data-type",t.join(" ")),h.push(e)):"WBR"!==e.tagName&&h.push(e)}}));for(let e=0;e<h.length;e++){const t=h[e],i=h[e+1];3!==t.nodeType&&i&&3!==i.nodeType&&(0,u.isArrayEqual)(i.getAttribute("data-type").split(" "),t.getAttribute("data-type").split(" "))&&t.style.color===i.style.color&&t.style.webkitTextFillColor===i.style.webkitTextFillColor&&t.style.webkitTextStroke===i.style.webkitTextStroke&&t.style.textShadow===i.style.textShadow&&t.style.backgroundColor===i.style.backgroundColor?(i.innerHTML=t.innerHTML+i.innerHTML,h.splice(e,1),e--):(n.insertNode(h[e]),n.collapse(!1))}n.setStart(h[0].firstChild,0),e.toolbar.showRender(e,h[0],h),i.setAttribute("updated",o().format("YYYYMMDDHHmmss")),(0,s.updateTransaction)(e,i.getAttribute("data-node-id"),i.outerHTML,p),d.remove()}))))}}t.InlineMemo=d},2292:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.removeLink=t.Link=void 0;const a=n(7903),o=n(407),s=n(8792),r=n(5680),l=n(6840),c=n(3607),u=n(6520),d=n(4640);class p extends a.ToolbarItem{constructor(e,t){super(e,t),this.element.addEventListener("click",(t=>i(this,void 0,void 0,(function*(){e.toolbar.element.classList.add("fn__none"),t.stopPropagation();const n=e.toolbar.range,i=(0,c.hasClosestBlock)(n.startContainer);if(!i)return;const a=(0,c.hasClosestByAttribute)(n.startContainer,"data-type","a");if(a)return void(0,o.linkMenu)(e,a);(0,d.fixTableRange)(n),["DIV","TD","TH","TR"].includes(n.startContainer.parentElement.tagName)||0!==n.startOffset||(0,u.hasPreviousSibling)(n.startContainer)||n.setStartBefore(n.startContainer.parentElement),["DIV","TD","TH","TR"].includes(n.endContainer.parentElement.tagName)||n.endOffset!==n.endContainer.textContent.length||(0,u.hasNextSibling)(n.endContainer)||n.setEndAfter(n.endContainer.parentElement);const p=document.createElement("wbr");n.insertNode(p);const h=i.outerHTML,f=document.createElement("span");f.setAttribute("data-type","a"),f.setAttribute("data-href","");const g=n.toString();f.textContent=g,n.extractContents(),n.insertNode(f);let m=!0,y=!1;try{const t=yield navigator.clipboard.readText();e.lute.IsValidLinkDest(g.trim())?(f.setAttribute("data-href",g.trim()),m=!1):e.lute.IsValidLinkDest(t)&&(f.setAttribute("data-href",t),""!==f.textContent.replace(s.Constants.ZWSP,"")&&(m=!1),y=!0)}catch(e){console.log(e)}m&&(0,o.linkMenu)(e,f,y),i.setAttribute("updated",r().format("YYYYMMDDHHmmss")),(0,l.updateTransaction)(e,i.getAttribute("data-node-id"),i.outerHTML,h),n.setStartAfter(f),n.collapse(!0),p.remove()}))))}}t.Link=p;t.removeLink=(e,t)=>{const n=e.getAttribute("data-type").split(" ");if(1===n.length){const n=e.parentElement;e.outerHTML=e.innerHTML+"<wbr>",(0,d.focusByWbr)(n,t)}else n.find(((e,t)=>{if("a"===e)return n.splice(t,1),!0})),e.setAttribute("data-type",n.join(" ")),e.removeAttribute("data-href"),t.selectNodeContents(e),t.collapse(!1),(0,d.focusByRange)(t)}},7903:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarItem=void 0;const i=n(7954),a=n(7954);t.ToolbarItem=class{constructor(e,t){this.element=document.createElement("button");const n=t.hotkey?` ${(0,a.updateHotkeyTip)(t.hotkey)}`:"",o=t.tip||window.siyuan.languages[t.lang];this.element.classList.add("protyle-toolbar__item","b3-tooltips",`b3-tooltips__${t.tipPosition}`),this.element.setAttribute("data-type",t.name),this.element.setAttribute("aria-label",o+n),this.element.innerHTML=`<svg><use xlink:href="#${t.icon}"></use></svg>`,["text","a","block-ref","inline-math","inline-memo"].includes(t.name)||this.element.addEventListener((0,i.getEventName)(),(n=>{n.preventDefault(),e.toolbar.setInlineMark(e,t.name,"toolbar")}))}}},8367:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Toolbar=void 0;const i=n(7803),a=n(3174),o=n(7903),s=n(4640),r=n(3607),l=n(2292),c=n(6224),u=n(6840),d=n(8792),p=n(7954),h=n(9398),f=n(1248),g=n(6520),m=n(6057),y=n(7134),b=n(3505),v=n(7822),w=n(734),_=n(3274),E=n(5680),k=n(9173),C=n(7422),D=n(7640),x=n(3863),S=n(5378),A=n(4382),L=n(525),T=n(7618),B=n(1890),P=n(8139),I=n(2986);t.Toolbar=class{constructor(e){const t=e.options,n=document.createElement("div");n.className="protyle-toolbar fn__none",this.element=n,this.subElement=document.createElement("div"),this.subElement.className="protyle-util fn__none",this.toolbarHeight=29,t.toolbar.forEach((t=>{const n=this.genItem(e,t);this.element.appendChild(n)}))}render(e,t,n){this.range=t;const i=(0,r.hasClosestBlock)(t.startContainer);if(!i||e.disabled)return void this.element.classList.add("fn__none");let a=!0,o=!0;if(Array.from(t.cloneContents().childNodes).find((e=>{if(1!==e.nodeType){if(e.textContent.length>0)return o=!1,!0}else if(!e.classList.contains("img"))return a=!1,!0})),a&&o)return void this.element.classList.add("fn__none");const l=(0,r.hasClosestBlock)(t.startContainer),u=(0,r.hasClosestBlock)(t.endContainer);if(l&&u&&!l.isSameNode(u)&&(n?"ArrowLeft"===n.key?this.range=(0,s.setLastNodeRange)((0,g.getContenteditableElement)(l),t,!1):this.range=(0,s.setFirstNodeRange)((0,g.getContenteditableElement)(u),t):this.range=(0,s.setLastNodeRange)((0,g.getContenteditableElement)(i),t,!1),(0,s.focusByRange)(this.range),""===this.range.toString()))return void this.element.classList.add("fn__none");if("NodeCodeBlock"===i.getAttribute("data-type"))return void this.element.classList.add("fn__none");const p=(0,s.getSelectionPosition)(i,t);this.element.classList.remove("fn__none");const h=p.top-this.toolbarHeight-4;this.element.setAttribute("data-inity",h+d.Constants.ZWSP+e.contentElement.scrollTop.toString()),(0,c.setPosition)(this.element,p.left-52,h),this.element.querySelectorAll(".protyle-toolbar__item--current").forEach((e=>{e.classList.remove("protyle-toolbar__item--current")}));this.getCurrentType().forEach((e=>{["a","block-ref","text","file-annotation-ref","inline-math","inline-memo",""].includes(e)||this.element.querySelector(`[data-type="${e}"]`).classList.add("protyle-toolbar__item--current")}))}getCurrentType(e=this.range){var t,n;let i=[],a=e.startContainer;if(3===a.nodeType?a=a.parentElement:a.childElementCount>0&&3!==(null===(t=a.childNodes[e.startOffset])||void 0===t?void 0:t.nodeType)&&(a=a.childNodes[e.startOffset]),!a||3===a.nodeType)return[];["DIV","TD","TH","TR"].includes(a.tagName)||(i=(a.getAttribute("data-type")||"").split(" "));let o=e.endContainer;return 3===o.nodeType?o=o.parentElement:o.childElementCount>0&&3!==(null===(n=o.childNodes[e.endOffset])||void 0===n?void 0:n.nodeType)&&(o=o.childNodes[e.endOffset]),o&&3!==o.nodeType?(["DIV","TD","TH","TR"].includes(o.tagName)||a.isSameNode(o)||(i=i.concat((o.getAttribute("data-type")||"").split(" "))),e.cloneContents().childNodes.forEach((e=>{3!==e.nodeType&&(i=i.concat((e.getAttribute("data-type")||"").split(" ")))})),i=[...new Set(i)],i.find(((e,t)=>{if(""===e)return i.splice(t,1),!0})),i):[]}genItem(e,t){let n;switch(t.name){case"strong":case"em":case"s":case"code":case"mark":case"tag":case"u":case"sup":case"sub":case"kbd":n=new o.ToolbarItem(e,t);break;case"block-ref":n=new y.BlockRef(e,t);break;case"inline-math":n=new P.InlineMath(e,t);break;case"inline-memo":n=new I.InlineMemo(e,t);break;case"|":n=new i.Divider;break;case"text":n=new a.Font(e,t);break;case"a":n=new l.Link(e,t)}if(n)return n.element}mergeNode(e){for(let t=0;t<e.length;t++)3!==e[t].nodeType&&"WBR"===e[t].tagName&&(e[t].remove(),t--);for(let t=0;t<e.length;t++)3===e[t].nodeType&&(""===e[t].textContent?(e[t].remove(),t--):e[t+1]&&3===e[t+1].nodeType&&(e[t].textContent=e[t].textContent+e[t+1].textContent,e[t+1].remove(),t--))}setInlineMark(e,t,n,i){var o;if(["a","block-ref","inline-math","inline-memo"].includes(t))return void e.toolbar.element.querySelector(`[data-type="${t}"]`).dispatchEvent(new CustomEvent("block-ref"===t?(0,p.getEventName)():"click"));const l=(0,r.hasClosestBlock)(this.range.startContainer);if(!l)return;const c=this.getCurrentType(this.range),h=this.range.toString();let f,m,y,b;(0,s.fixTableRange)(this.range);const v=(0,g.hasPreviousSibling)(this.range.startContainer);["DIV","TD","TH","TR"].includes(this.range.startContainer.parentElement.tagName)?v&&3!==v.nodeType&&0===this.range.startOffset&&(f=v):0!==this.range.startOffset||v?f=this.range.startContainer.parentElement:(f=this.range.startContainer.parentElement.previousSibling,this.range.setStartBefore(this.range.startContainer.parentElement));const w=(0,g.hasNextSibling)(this.range.endContainer);["DIV","TD","TH","TR"].includes(this.range.endContainer.parentElement.tagName)?w&&3!==w.nodeType&&this.range.endOffset===this.range.endContainer.textContent.length&&(m=w):this.range.endOffset!==this.range.endContainer.textContent.length||w?m=this.range.endContainer.parentElement:(m=this.range.endContainer.parentElement.nextSibling,this.range.setEndAfter(this.range.endContainer.parentElement)),this.range.insertNode(document.createElement("wbr"));const k=l.outerHTML,C=this.range.extractContents();if(this.mergeNode(C.childNodes),f&&m&&f.isSameNode(m)&&3===(null===(o=C.firstChild)||void 0===o?void 0:o.nodeType)){const e=f.attributes;C.childNodes.forEach((t=>{const n=document.createElement("span");for(let t=0;t<e.length;t++)n.setAttribute(e[t].name,e[t].value);n.innerHTML=t.textContent,t.replaceWith(n)}))}const D="toolbar"===n?this.element.querySelector(`[data-type="${t}"]`):void 0,x=[];if((null==D?void 0:D.classList.contains("protyle-toolbar__item--current"))||"range"===n&&c.length>0&&c.includes(t)&&(!i||"remove"===i.type)){if(D&&D.classList.remove("protyle-toolbar__item--current"),0===C.childNodes.length)if(c.find(((e,n)=>{if(t===e)return c.splice(n,1),!0})),0===c.length)x.push(document.createTextNode(d.Constants.ZWSP));else{const e=document.createElement("span");e.setAttribute("data-type",c.join(" ")),e.textContent=d.Constants.ZWSP,x.push(e)}C.childNodes.forEach(((e,n)=>{if(3!==e.nodeType&&"BR"!==e.tagName){const o=e.getAttribute("data-type").split(" ");o.find(((e,n)=>{if(t===e)return o.splice(n,1),!0})),0===o.length?(""===e.textContent&&(e.textContent=d.Constants.ZWSP),x.push(document.createTextNode(e.textContent))):(i&&"remove"===i.type&&(e.style.color="",e.style.webkitTextFillColor="",e.style.webkitTextStroke="",e.style.textShadow="",e.style.backgroundColor=""),0===n&&f&&3!==f.nodeType&&(0,_.isArrayEqual)(o,f.getAttribute("data-type").split(" "))&&(0,a.hasSameTextStyle)(e,f,i)?(y=f.textContent.length,f.innerHTML=f.innerHTML+e.innerHTML):n===C.childNodes.length-1&&m&&3!==m.nodeType&&(0,_.isArrayEqual)(o,m.getAttribute("data-type").split(" "))&&(0,a.hasSameTextStyle)(e,m,i)?(b=e.textContent.length,m.innerHTML=e.innerHTML+m.innerHTML):(""===e.textContent&&(e.textContent=d.Constants.ZWSP),e.setAttribute("data-type",o.join(" ")),x.push(e)))}else""===e.textContent&&(e.textContent=d.Constants.ZWSP),x.push(e)}))}else if(this.element.classList.contains("fn__none")||"text"===t||this.element.querySelector(`[data-type="${t}"]`).classList.add("protyle-toolbar__item--current"),""===h){const e=document.createElement("span");c.push(t),e.setAttribute("data-type",[...new Set(c)].join(" ")),e.textContent=d.Constants.ZWSP,x.push(e)}else C.childNodes.forEach(((e,n)=>{if(3===e.nodeType)if(0===n&&f&&3!==f.nodeType&&t===f.getAttribute("data-type")&&(0,a.hasSameTextStyle)(e,f,i))y=f.textContent.length,f.innerHTML=f.innerHTML+e.textContent;else if(n===C.childNodes.length-1&&m&&3!==m.nodeType&&t===m.getAttribute("data-type")&&(0,a.hasSameTextStyle)(e,m,i))b=e.textContent.length,m.innerHTML=e.textContent+m.innerHTML;else{const n=document.createElement("span");n.setAttribute("data-type",t),n.textContent=e.textContent,(0,a.setFontStyle)(n,i),x.push(n)}else{let o=(e.getAttribute("data-type")||"").split(" ");o.push(t),"sub"===t&&o.includes("sup")?o.find(((e,t)=>{if("sup"===e)return o.splice(t,1),this.element.classList.contains("fn__none")||this.element.querySelector('[data-type="sup"]').classList.remove("protyle-toolbar__item--current"),!0})):"sup"===t&&o.includes("sub")&&o.find(((e,t)=>{if("sub"===e)return o.splice(t,1),this.element.classList.contains("fn__none")||this.element.querySelector('[data-type="sub"]').classList.remove("protyle-toolbar__item--current"),!0})),o=[...new Set(o)],0===n&&f&&3!==f.nodeType&&(0,_.isArrayEqual)(o,f.getAttribute("data-type").split(" "))&&(0,a.hasSameTextStyle)(e,f,i)?(y=f.textContent.length,f.innerHTML=f.innerHTML+e.innerHTML):n===C.childNodes.length-1&&m&&3!==m.nodeType&&(0,_.isArrayEqual)(o,m.getAttribute("data-type").split(" "))&&(0,a.hasSameTextStyle)(e,m,i)?(b=e.textContent.length,m.innerHTML=e.innerHTML+m.innerHTML):"BR"!==e.tagName?(e.setAttribute("data-type",o.join(" ")),(0,a.setFontStyle)(e,i),x.push(e)):x.push(e)}}));if(3!==this.range.startContainer.nodeType&&"SPAN"===this.range.startContainer.tagName&&this.range.startContainer.isSameNode(this.range.endContainer)){const e=this.range.startContainer,t=document.createElement("span"),n=e.attributes;for(let e=0;e<n.length;e++)t.setAttribute(n[e].name,n[e].value);this.range.setEnd(e.lastChild,e.lastChild.textContent.length),t.append(this.range.extractContents()),e.after(t),this.range.setStartBefore(t),this.range.collapse(!0)}for(let e=0;e<x.length;e++){const t=x[e],n=x[e+1];3!==t.nodeType&&n&&3!==n.nodeType&&(0,_.isArrayEqual)(n.getAttribute("data-type").split(" "),t.getAttribute("data-type").split(" "))&&t.style.color===n.style.color&&t.style.webkitTextFillColor===n.style.webkitTextFillColor&&t.style.webkitTextStroke===n.style.webkitTextStroke&&t.style.textShadow===n.style.textShadow&&t.style.backgroundColor===n.style.backgroundColor?(n.innerHTML=t.innerHTML+n.innerHTML,x.splice(e,1),e--):(this.range.insertNode(x[e]),this.range.collapse(!1))}if(f&&this.mergeNode(f.childNodes),m&&this.mergeNode(m.childNodes),y?this.range.setStart(f.firstChild,y):x.length>0?x[0].firstChild?this.range.setStart(x[0].firstChild,0):3===x[0].nodeType?this.range.setStart(x[0],0):this.range.setStartBefore(x[0]):m&&this.range.setStart(m.firstChild,0),b)this.range.setEnd(m.lastChild,b);else if(x.length>0){const e=x[x.length-1];e.lastChild?this.range.setEnd(e.lastChild,e.lastChild.textContent.length):3===e.nodeType?(this.range.setEnd(e,e.textContent.length),e.textContent===d.Constants.ZWSP&&this.range.collapse(!1)):this.range.setEndAfter(e)}else f&&this.range.setEnd(f.firstChild,f.firstChild.textContent.length);l.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,u.updateTransaction)(e,l.getAttribute("data-node-id"),l.outerHTML,k);const S=l.querySelector("wbr");S&&S.remove()}showFileAnnotationRef(e,t){const n=(0,r.hasClosestBlock)(t);if(!n)return;const i=n.getAttribute("data-node-id");let a=n.outerHTML;this.subElement.style.width=(0,_.isMobile)()?"80vw":Math.min(480,window.innerWidth)+"px",this.subElement.style.padding="",this.subElement.innerHTML=`<div class="b3-form__space--small">\n<label class="fn__flex">\n    <span class="ft__on-surface fn__flex-center" style="width: 64px">ID</span>\n    <div class="fn__space"></div>\n    <input data-type="id" value="${t.getAttribute("data-id")||""}" class="b3-text-field fn__block" readonly />\n</label>\n<div class="fn__hr"></div>\n<label class="fn__flex">\n    <span class="ft__on-surface fn__flex-center" style="width: 64px">${window.siyuan.languages.anchor}</span>\n    <div class="fn__space"></div>\n    <input data-type="anchor" class="b3-text-field fn__block" placeholder="${window.siyuan.languages.anchor}" />\n</label>\n<div class="fn__hr"></div>\n<div class="fn__hr"></div>\n<div class="fn__flex"><span class="fn__flex-1"></span>\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.remove}</button>\n</div></div>`,this.subElement.querySelector(".b3-button--cancel").addEventListener((0,p.getEventName)(),(()=>{t.insertAdjacentHTML("afterend","<wbr>");const a=n.outerHTML;t.outerHTML=t.textContent,n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,u.updateTransaction)(e,i,n.outerHTML,a),this.subElement.classList.add("fn__none"),(0,s.focusByWbr)(n,this.range)}));const o=this.subElement.querySelector('[data-type="anchor"]');o.value=t.textContent,o.addEventListener("change",(o=>{t.after(document.createElement("wbr")),n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,u.updateTransaction)(e,i,n.outerHTML,a),a=n.outerHTML,n.querySelector("wbr").remove(),o.stopPropagation()})),o.addEventListener("input",(e=>{const n=e.target;n.value?t.innerHTML=Lute.EscapeHTMLStr(n.value):t.innerHTML="*",e.stopPropagation()})),o.addEventListener("keydown",(e=>{e.stopPropagation(),e.isComposing||"Enter"!==e.key&&"Escape"!==e.key||(this.subElement.classList.add("fn__none"),this.range.setStart(t.firstChild,0),this.range.setEnd(t.lastChild,t.lastChild.textContent.length),(0,s.focusByRange)(this.range),e.preventDefault(),e.stopPropagation())})),this.subElement.classList.remove("fn__none");const l=t.getBoundingClientRect();(0,c.setPosition)(this.subElement,l.left,l.bottom,l.height+4),this.element.classList.add("fn__none"),o.select()}showRender(e,t,n){var i;const a=(0,r.hasClosestBlock)(t);if(!a)return;const o=a.getAttribute("data-node-id"),l=t.getAttribute("data-type");let p=e.lute.SpinBlockDOM(a.outerHTML),h="HTML",f="";const g=l&&l.split(" ").includes("inline-memo");switch(t.getAttribute("data-subtype")){case"abc":h=window.siyuan.languages.staff;break;case"echarts":h=window.siyuan.languages.chart;break;case"flowchart":h="Flow Chart";break;case"graphviz":h="Graphviz";break;case"mermaid":h="Mermaid";break;case"mindmap":f="- foo\n  - bar\n- baz",h=window.siyuan.languages.mindmap;break;case"plantuml":h="UML";break;case"math":h="NodeMathBlock"===l?window.siyuan.languages.math:window.siyuan.languages["inline-math"]}"NodeBlockQueryEmbed"===l?h=window.siyuan.languages.blockEmbed:g&&(h=window.siyuan.languages.memo);const y=null===(i=this.subElement.querySelector('[data-type="pin"]'))||void 0===i?void 0:i.classList.contains("block__icon--active"),b={};if(y){const e=this.subElement.querySelector(".b3-text-field");b.styleH=e.style.height,b.styleW=e.style.width}else this.subElement.style.width=(0,_.isMobile)()?"100vw":"",this.subElement.style.padding="0";this.subElement.innerHTML=`<div ${y&&"true"===this.subElement.firstElementChild.getAttribute("data-drag")?'data-drag="true"':""} class="block__popover--move"><div class="block__icons block__icons--border fn__flex">\n    ${h}\n    <span class="fn__flex-1"></span>\n    <label aria-label="${window.siyuan.languages.hideHeadingBelowBlocks}" style="overflow:inherit;" class="b3-tooltips b3-tooltips__nw${"NodeBlockQueryEmbed"!==l?" fn__none":""}">\n        <input type="checkbox" class="b3-switch">\n        <span class="fn__space"></span>\n    </label>\n    <button data-type="refresh" class="block__icon b3-tooltips b3-tooltips__nw${y&&!this.subElement.querySelector('[data-type="refresh"]').classList.contains("block__icon--active")?"":" block__icon--active"}${"NodeBlockQueryEmbed"===l?" fn__none":""}" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href="#iconRefresh"></use></svg></button>\n    <span class="fn__space"></span>\n    <button data-type="before" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages["insert-before"]}"><svg><use xlink:href="#iconBefore"></use></svg></button>\n    <span class="fn__space"></span>\n    <button data-type="after" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages["insert-after"]}"><svg><use xlink:href="#iconAfter"></use></svg></button>\n    <span class="fn__space"></span>\n    <button data-type="copy" class="block__icon b3-tooltips b3-tooltips__nw${(0,_.isBrowser)()||g?" fn__none":""}" aria-label="${window.siyuan.languages.copy} PNG"><svg><use xlink:href="#iconCopy"></use></svg></button>\n    <span class="fn__space"></span>\n    <button data-type="pin" class="block__icon b3-tooltips b3-tooltips__nw${y?" block__icon--active":""}" aria-label="${window.siyuan.languages.pin}"><svg><use xlink:href="#iconPin"></use></svg></button>\n    <span class="fn__space"></span>\n    <button data-type="close" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.close}"><svg style="width: 10px"><use xlink:href="#iconClose"></use></svg></button>\n</div>\n<textarea spellcheck="false" class="b3-text-field b3-text-field--text fn__block" placeholder="${f}" style="width:${(0,_.isMobile)()?"100vw":Math.max(480,.7*t.clientWidth)+"px"};max-height:50vh"></textarea></div>`;const D=()=>{A.style.height=A.scrollHeight+"px",(0,_.isMobile)()?(0,c.setPosition)(this.subElement,0,0):"true"!==this.subElement.firstElementChild.getAttribute("data-drag")?this.subElement.clientHeight<=window.innerHeight-T.bottom||this.subElement.clientHeight<=T.top?"inline-math"===l||g?(0,c.setPosition)(this.subElement,T.left,T.bottom,T.height):(0,c.setPosition)(this.subElement,T.left+(T.width-this.subElement.clientWidth)/2,T.bottom,T.height):(0,c.setPosition)(this.subElement,T.right,T.bottom):A.getBoundingClientRect().bottom>window.innerHeight&&(this.subElement.style.top=window.innerHeight-this.subElement.clientHeight+"px")},x=this.subElement.querySelector(".block__icons");x.addEventListener("click",(t=>{const n=t.target,i=(0,r.hasClosestByClassName)(n,"b3-tooltips");if(i)switch(t.stopPropagation(),i.getAttribute("data-type")){case"close":this.subElement.classList.add("fn__none"),this.subElement.querySelector('[data-type="pin"]').classList.remove("block__icon--active");break;case"pin":i.classList.contains("block__icon--active")?(i.classList.remove("block__icon--active"),i.setAttribute("aria-label",window.siyuan.languages.pin)):(i.classList.add("block__icon--active"),i.setAttribute("aria-label",window.siyuan.languages.unpin));break;case"refresh":i.classList.toggle("block__icon--active");break;case"before":(0,k.insertEmptyBlock)(e,"beforebegin",o),(0,S.hideElements)(["util"],e);break;case"after":(0,k.insertEmptyBlock)(e,"afterend",o),(0,S.hideElements)(["util"],e)}else if(2===t.detail){const e=x.querySelector('[data-type="pin"]');e.classList.contains("block__icon--active")?(e.classList.remove("block__icon--active"),e.setAttribute("aria-label",window.siyuan.languages.pin)):(e.classList.add("block__icon--active"),e.setAttribute("aria-label",window.siyuan.languages.unpin)),t.preventDefault(),t.stopPropagation()}})),x.addEventListener("mousedown",(e=>{if((0,r.hasClosestByClassName)(e.target,"block__icon"))return;const t=document;this.subElement.style.userSelect="none";const n=e.clientX-parseInt(this.subElement.style.left),i=e.clientY-parseInt(this.subElement.style.top);t.onmousemove=e=>{let t=e.clientX-n,a=e.clientY-i;t>window.innerWidth-this.subElement.clientWidth&&(t=window.innerWidth-this.subElement.clientWidth),a>window.innerHeight-this.subElement.clientHeight&&(a=window.innerHeight-this.subElement.clientHeight),this.subElement.style.left=Math.max(t,0)+"px",this.subElement.style.top=Math.max(a,d.Constants.SIZE_TOOLBAR_HEIGHT)+"px",this.subElement.firstElementChild.setAttribute("data-drag","true")},t.onmouseup=()=>{this.subElement.style.userSelect="auto",t.onmousemove=null,t.onmouseup=null,t.ondragstart=null,t.onselectstart=null,t.onselect=null}}));const A=this.subElement.querySelector(".b3-text-field");if("NodeHTMLBlock"===l)A.value=Lute.UnEscapeHTMLStr(t.querySelector("protyle-html").getAttribute("data-content")||"");else if(g)A.value=Lute.UnEscapeHTMLStr(t.getAttribute("data-inline-memo-content")||"");else{const n=this.subElement.querySelector(".b3-switch");"1"===a.getAttribute("custom-heading-mode")&&(n.checked=!0),n.addEventListener("change",(()=>{(0,S.hideElements)(["util"],e),a.setAttribute("custom-heading-mode",n.checked?"1":"0"),(0,w.fetchPost)("/api/attr/setBlockAttrs",{id:o,attrs:{"custom-heading-mode":n.checked?"1":"0"}}),t.removeAttribute("data-render"),(0,v.blockRender)(e,t)})),A.value=Lute.UnEscapeHTMLStr(t.getAttribute("data-content")||"")}A.addEventListener("input",(e=>{if(!t.parentElement)return;if(A.clientHeight!==A.scrollHeight&&D(),!this.subElement.querySelector('[data-type="refresh"]').classList.contains("block__icon--active"))return;const n=e.target;"NodeHTMLBlock"===l?t.querySelector("protyle-html").setAttribute("data-content",Lute.EscapeHTMLStr(n.value)):g?t.setAttribute("data-inline-memo-content",Lute.EscapeHTMLStr(n.value)):(t.setAttribute("data-content",Lute.EscapeHTMLStr(n.value)),t.removeAttribute("data-render")),["NodeBlockQueryEmbed","NodeHTMLBlock"].includes(l)||(0,m.processRender)(t),e.stopPropagation()})),A.addEventListener("change",(i=>{if(!t.parentElement)return;const r=i.target;if(this.subElement.querySelector('[data-type="refresh"]').classList.contains("block__icon--active")||("NodeHTMLBlock"===l?t.querySelector("protyle-html").setAttribute("data-content",Lute.EscapeHTMLStr(r.value)):(t.setAttribute("data-content",Lute.EscapeHTMLStr(r.value)),t.removeAttribute("data-render")),["NodeBlockQueryEmbed","NodeHTMLBlock"].includes(l)||(0,m.processRender)(t)),g){let e;e=n||[t],e.forEach(((t,n)=>{if(r.value)t.setAttribute("data-inline-memo-content",Lute.EscapeHTMLStr(r.value));else{const i=t.getAttribute("data-type").split(" ");1===i.length&&"inline-memo"===i[0]?(t.outerHTML=t.innerHTML+(n===e.length-1?"<wbr>":""),(0,s.focusByWbr)(a,this.range)):(i.find(((e,t)=>{if("inline-memo"===e)return i.splice(t,1),!0})),t.setAttribute("data-type",i.join(" ")),t.removeAttribute("data-inline-memo-content"))}}))}else"NodeBlockQueryEmbed"===l&&(0,v.blockRender)(e,t);this.range&&(0,s.focusByRange)(this.range),"inline-math"===l&&t.setAttribute("data-content",t.getAttribute("data-content").replace(/\n/g,"")),a.setAttribute("updated",E().format("YYYYMMDDHHmmss"));const c=e.lute.SpinBlockDOM(a.outerHTML);if("NodeHTMLBlock"===l){const e=document.createElement("template");e.innerHTML=c,e.content.childElementCount>1&&(0,B.showMessage)(window.siyuan.languages.htmlBlockTip)}(0,u.updateTransaction)(e,o,c,p),p=c,g&&!r.value&&this.subElement.classList.add("fn__none"),i.stopPropagation()})),A.addEventListener("keydown",(e=>{if(e.stopPropagation(),(0,C.matchHotKey)(window.siyuan.config.keymap.editor.insert["inline-math"].custom,e))e.preventDefault();else if(!e.isComposing)if("Escape"===e.key||(0,C.matchHotKey)("⌘↩",e))this.subElement.classList.add("fn__none"),this.subElement.querySelector('[data-type="pin"]').classList.remove("block__icon--active"),"SPAN"===t.tagName?"inline-memo"!==l||A.value?(0,s.focusByRange)(this.range):(t.outerHTML=t.innerHTML+"<wbr>",(0,s.focusByWbr)(a,this.range)):(0,s.focusSideBlock)(t);else if("Tab"===e.key)document.execCommand("insertText",!1,"\t"),e.preventDefault();else if((0,L.electronUndo)(e))return})),this.subElement.classList.remove("fn__none");const T=t.getBoundingClientRect();this.element.classList.add("fn__none"),y?(A.style.width=b.styleW,A.style.height=b.styleH):D(),A.select()}showCodeLanguage(e,t){const n=(0,r.hasClosestBlock)(t);if(!n)return;this.range=(0,s.getEditorRange)(n);const i=n.getAttribute("data-node-id");let a=n.outerHTML,o="";d.Constants.CODE_LANGUAGES.forEach(((e,t)=>{o+=`<div class="b3-list-item${0===t?" b3-list-item--focus":""}">${e}</div>`})),this.subElement.style.width="",this.subElement.style.padding="",this.subElement.innerHTML=`<div class="fn__flex-column" style="max-height:50vh"><input placeholder="${window.siyuan.languages.search}" style="margin: 4px 8px 8px 8px" class="b3-text-field"/>\n<div class="b3-list fn__flex-1 b3-list--background" style="position: relative">${o}</div>\n</div>`;const l=this.subElement.querySelector("input");l.addEventListener("keydown",(o=>{if(o.stopPropagation(),!o.isComposing){if((0,h.upDownHint)(this.subElement.lastElementChild.lastElementChild,o),"Enter"===o.key){t.textContent=this.subElement.querySelector(".b3-list-item--focus").textContent,localStorage.setItem(d.Constants.LOCAL_CODELANG,t.textContent);const s=(0,g.getContenteditableElement)(n),r=n.getAttribute("linenumber");"true"===r||"false"!==r&&window.siyuan.config.editor.codeSyntaxHighlightLineNum?s.classList.add("protyle-linenumber"):s.classList.remove("protyle-linenumber"),s.textContent=s.textContent,s.removeAttribute("data-render"),(0,f.highlightRender)(n),n.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,u.updateTransaction)(e,i,n.outerHTML,a),a=n.outerHTML,o.preventDefault(),o.stopPropagation()}"Escape"!==o.key&&"Enter"!==o.key||(this.subElement.classList.add("fn__none"),(0,s.focusByRange)(this.range))}})),l.addEventListener("input",(e=>{const t=[];d.Constants.CODE_LANGUAGES.forEach((e=>{e.indexOf(l.value.toLowerCase())>-1&&t.push(e)}));let n="";t.sort(((e,t)=>e.startsWith(l.value.toLowerCase())&&t.startsWith(l.value.toLowerCase())?e.length<t.length?-1:e.length===t.length?0:1:e.startsWith(l.value.toLowerCase())?-1:t.startsWith(l.value.toLowerCase())?1:0)).forEach((e=>{n+=`<div class="b3-list-item">${e.replace(l.value.toLowerCase(),"<b>"+l.value.toLowerCase()+"</b>")}</div>`})),this.subElement.firstElementChild.lastElementChild.innerHTML=n,n&&this.subElement.firstElementChild.lastElementChild.firstElementChild.classList.add("b3-list-item--focus"),e.stopPropagation()})),this.subElement.lastElementChild.lastElementChild.addEventListener("click",(n=>{const o=n.target,l=(0,r.hasClosestByClassName)(o,"b3-list-item");if(!l)return;t.textContent=l.textContent,localStorage.setItem(d.Constants.LOCAL_CODELANG,t.textContent);const c=(0,r.hasClosestBlock)(t);if(c){const t=(0,g.getContenteditableElement)(c),n=c.getAttribute("linenumber");"true"===n||"false"!==n&&window.siyuan.config.editor.codeSyntaxHighlightLineNum?t.classList.add("protyle-linenumber"):t.classList.remove("protyle-linenumber"),t.textContent=t.textContent,t.removeAttribute("data-render"),(0,f.highlightRender)(c),c.setAttribute("updated",E().format("YYYYMMDDHHmmss")),(0,u.updateTransaction)(e,i,c.outerHTML,a),a=c.outerHTML,this.subElement.classList.add("fn__none"),(0,s.focusByRange)(this.range)}})),this.subElement.classList.remove("fn__none");const p=t.getBoundingClientRect();(0,c.setPosition)(this.subElement,p.left,p.bottom,p.height),this.element.classList.add("fn__none"),l.select()}showTpl(e,t,n){this.range=n,(0,w.fetchPost)("/api/search/searchTemplate",{k:""},(i=>{let a="";i.data.blocks.forEach(((e,t)=>{a+=`<div data-value="${e.path}" class="b3-list-item${0===t?" b3-list-item--focus":""}">${e.content}</div>`})),""===a&&(a=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`),this.subElement.style.width="",this.subElement.style.padding="",this.subElement.innerHTML=`<div style="max-height:50vh" class="fn__flex">\n<div class="fn__flex-column" style="min-width: 260px;max-width: 100vw">\n    <input style="margin: 4px 8px 8px 8px" class="b3-text-field"/>\n    <div class="b3-list fn__flex-1 b3-list--background" style="position: relative">${a}</div>\n</div>\n<div style="width: 520px;${(0,_.isMobile)()?"display:none":""};overflow: auto;"></div>\n</div>`;const o=this.subElement.querySelector(".b3-list"),l=this.subElement.firstElementChild.lastElementChild;(0,T.previewTemplate)(o.firstElementChild.getAttribute("data-value"),l,e.block.parentID),o.addEventListener("mouseover",(t=>{const n=t.target,i=(0,r.hasClosestByClassName)(n,"b3-list-item");i&&(0,T.previewTemplate)(i.getAttribute("data-value"),l,e.block.parentID)}));const u=this.subElement.querySelector("input");u.addEventListener("keydown",(n=>{if(n.stopPropagation(),n.isComposing)return;const i=!this.subElement.querySelector(".b3-list-item");if(!i){const t=(0,h.upDownHint)(o,n);t&&(0,T.previewTemplate)(t.getAttribute("data-value"),l,e.block.parentID)}"Enter"===n.key?(i?(0,s.focusByRange)(this.range):(0,b.hintRenderTemplate)(decodeURIComponent(this.subElement.querySelector(".b3-list-item--focus").getAttribute("data-value")),e,t),this.subElement.classList.add("fn__none"),n.preventDefault()):"Escape"===n.key&&(this.subElement.classList.add("fn__none"),(0,s.focusByRange)(this.range))})),u.addEventListener("input",(t=>{t.stopPropagation(),(0,w.fetchPost)("/api/search/searchTemplate",{k:u.value},(t=>{var n;let i="";t.data.blocks.forEach(((e,t)=>{i+=`<div data-value="${e.path}" class="b3-list-item${0===t?" b3-list-item--focus":""}">${e.content}</div>`})),o.innerHTML=i||`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`,(0,T.previewTemplate)(null===(n=t.data.blocks[0])||void 0===n?void 0:n.path,l,e.block.parentID)}))})),this.subElement.lastElementChild.addEventListener("click",(n=>{const i=n.target;if(i.classList.contains("b3-list--empty"))return this.subElement.classList.add("fn__none"),void(0,s.focusByRange)(this.range);const a=(0,r.hasClosestByClassName)(i,"b3-list-item");a&&(0,b.hintRenderTemplate)(decodeURIComponent(a.getAttribute("data-value")),e,t)}));const p=(0,s.getSelectionPosition)(t,n);this.subElement.classList.remove("fn__none"),(0,c.setPosition)(this.subElement,p.left,p.top+18,d.Constants.SIZE_TOOLBAR_HEIGHT),this.element.classList.add("fn__none"),u.select()}))}showWidget(e,t,n){this.range=n,(0,w.fetchPost)("/api/search/searchWidget",{k:""},(i=>{let a="";i.data.blocks.forEach(((e,t)=>{a+=`<div class="b3-list-item${0===t?" b3-list-item--focus":""}">${e.content}</div>`})),this.subElement.style.width="",this.subElement.style.padding="",this.subElement.innerHTML=`<div class="fn__flex-column" style="max-height:50vh"><input style="margin: 4px 8px 8px 8px" class="b3-text-field"/>\n<div class="b3-list fn__flex-1 b3-list--background" style="position: relative">${a}</div>\n</div>`;const o=this.subElement.querySelector("input");o.addEventListener("keydown",(t=>{t.stopPropagation(),t.isComposing||((0,h.upDownHint)(this.subElement.lastElementChild.lastElementChild,t),"Enter"===t.key?((0,b.hintRenderWidget)(this.subElement.querySelector(".b3-list-item--focus").textContent,e),this.subElement.classList.add("fn__none"),t.preventDefault()):"Escape"===t.key&&(this.subElement.classList.add("fn__none"),(0,s.focusByRange)(this.range)))})),o.addEventListener("input",(e=>{e.stopPropagation(),(0,w.fetchPost)("/api/search/searchWidget",{k:o.value},(e=>{let t="";e.data.blocks.forEach(((e,n)=>{t+=`<div data-value="${e.path}" class="b3-list-item${0===n?" b3-list-item--focus":""}">${e.content}</div>`})),this.subElement.firstElementChild.lastElementChild.innerHTML=t}))})),this.subElement.lastElementChild.addEventListener("click",(t=>{const n=t.target,i=(0,r.hasClosestByClassName)(n,"b3-list-item");i&&(0,b.hintRenderWidget)(i.textContent,e)}));const l=(0,s.getSelectionPosition)(t,n);this.subElement.classList.remove("fn__none"),(0,c.setPosition)(this.subElement,l.left,l.top+18,d.Constants.SIZE_TOOLBAR_HEIGHT),this.element.classList.add("fn__none"),o.select()}))}showAssets(e,t,n){this.range=n,(0,w.fetchPost)("/api/search/searchAsset",{k:""},(i=>{let a="";i.data.forEach(((e,t)=>{a+=`<div data-value="${e.path}" class="b3-list-item${0===t?" b3-list-item--focus":""}">${e.hName}</div>`})),""===a&&(a=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`),this.subElement.style.width="",this.subElement.style.padding="",this.subElement.innerHTML=`<div style="max-height:50vh" class="fn__flex">\n<div class="fn__flex-column" style="min-width: 260px;max-width: 100vw">\n    <input style="margin: 4px 8px 8px 8px" class="b3-text-field"/>\n    <div class="b3-list fn__flex-1 b3-list--background" style="position: relative">${a}</div>\n</div>\n<div style="width: 260px;display: ${(0,_.isMobile)()?"none":"flex"};padding: 8px;overflow: auto;justify-content: center;align-items: center;"></div>\n</div>`;const o=this.subElement.querySelector(".b3-list");o.addEventListener("mouseover",(e=>{const t=e.target,n=(0,r.hasClosestByClassName)(t,"b3-list-item");n&&(l.innerHTML=(0,A.renderAssetsPreview)(n.getAttribute("data-value")))}));const l=this.subElement.firstElementChild.lastElementChild;l.innerHTML=(0,A.renderAssetsPreview)(o.firstElementChild.getAttribute("data-value"));const u=this.subElement.querySelector("input");u.addEventListener("keydown",(t=>{if(t.stopPropagation(),t.isComposing)return;const n=!this.subElement.querySelector(".b3-list-item");if(!n){const e=(0,h.upDownHint)(o,t);e&&(l.innerHTML=(0,A.renderAssetsPreview)(e.getAttribute("data-value")))}"Enter"===t.key?(n?(0,s.focusByRange)(this.range):(0,b.hintRenderAssets)(this.subElement.querySelector(".b3-list-item--focus").getAttribute("data-value"),e),this.subElement.classList.add("fn__none"),t.preventDefault()):"Escape"===t.key&&(this.subElement.classList.add("fn__none"),(0,s.focusByRange)(this.range))})),u.addEventListener("input",(e=>{e.stopPropagation(),(0,w.fetchPost)("/api/search/searchAsset",{k:u.value},(e=>{let t="";e.data.forEach(((e,n)=>{t+=`<div data-value="${e.path}" class="b3-list-item${0===n?" b3-list-item--focus":""}">${e.hName}</div>`})),o.innerHTML=t||`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`,l.innerHTML=(0,A.renderAssetsPreview)(o.firstElementChild.getAttribute("data-value"))}))})),this.subElement.lastElementChild.addEventListener("click",(t=>{const n=t.target;if(n.classList.contains("b3-list--empty"))return this.subElement.classList.add("fn__none"),void(0,s.focusByRange)(this.range);const i=(0,r.hasClosestByClassName)(n,"b3-list-item");i&&(0,b.hintRenderAssets)(i.getAttribute("data-value"),e)}));const p=(0,s.getSelectionPosition)(t,n);this.subElement.classList.remove("fn__none"),(0,c.setPosition)(this.subElement,p.left,p.top+18,d.Constants.SIZE_TOOLBAR_HEIGHT),this.element.classList.add("fn__none"),u.select()}))}showFile(e,t,n){this.range=n,(0,w.fetchPost)("/api/filetree/searchDocs",{k:""},(i=>{let a="";i.data.forEach((e=>{"/"!==e.path&&(a+=`<div class="b3-list-item${""===a?" b3-list-item--focus":""}" data-path="${e.path}" data-box="${e.box}">\n    ${e.boxIcon?'<span class="b3-list-item__icon">'+(0,D.unicode2Emoji)(e.boxIcon)+"</span>":""}\n    <span class="b3-list-item__text">${(0,x.escapeHtml)(e.hPath)}</span>\n</div>`)})),this.subElement.style.width="",this.subElement.style.padding="",this.subElement.innerHTML=`<div class="fn__flex-column" style="max-height:50vh"><input style="margin: 4px 8px 8px 8px" class="b3-text-field"/>\n<div class="b3-list fn__flex-1 b3-list--background" style="position: relative">${a}</div>\n</div>`;const o=this.subElement.querySelector("input");o.addEventListener("keydown",(n=>{n.stopPropagation(),n.isComposing||((0,h.upDownHint)(this.subElement.lastElementChild.lastElementChild,n),"Enter"===n.key?((0,b.hintMoveBlock)(this.subElement.querySelector(".b3-list-item--focus").getAttribute("data-path"),t,e),n.preventDefault()):"Escape"===n.key&&(this.subElement.classList.add("fn__none"),(0,s.focusByRange)(this.range)))})),o.addEventListener("input",(e=>{e.stopPropagation(),(0,w.fetchPost)("/api/filetree/searchDocs",{k:o.value},(e=>{let t="";e.data.forEach((e=>{"/"!==e.path&&(t+=`<div class="b3-list-item${""===t?" b3-list-item--focus":""}" data-path="${e.path}" data-box="${e.box}">\n    ${e.boxIcon?'<span class="b3-list-item__icon">'+(0,D.unicode2Emoji)(e.boxIcon)+"</span>":""}\n    <span class="b3-list-item__text">${(0,x.escapeHtml)(e.hPath)}</span>\n</div>`)})),this.subElement.firstElementChild.lastElementChild.innerHTML=t}))})),this.subElement.lastElementChild.addEventListener("click",(n=>{const i=n.target,a=(0,r.hasClosestByClassName)(i,"b3-list-item");a&&(0,b.hintMoveBlock)(a.getAttribute("data-path"),t,e)}));const l=(0,s.getSelectionPosition)(t[0],n);this.subElement.classList.remove("fn__none"),(0,c.setPosition)(this.subElement,l.left,l.top+18,d.Constants.SIZE_TOOLBAR_HEIGHT),this.element.classList.add("fn__none"),o.select()}))}}},7618:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.previewTemplate=void 0;const i=n(734);t.previewTemplate=(e,t,n)=>{e?(0,i.fetchPost)("/api/template/render",{id:n,path:e},(e=>{t.innerHTML=`<div class="protyle-wysiwyg" style="padding: 8px">${e.data.content.replace(/contenteditable="true"/g,"")}</div>`})):t.innerHTML=""}},5378:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hideElements=void 0;t.hideElements=(e,t)=>{if(t){if(e.includes("hint")&&(clearTimeout(t.hint.timeId),t.hint.element.classList.add("fn__none")),t.gutter&&e.includes("gutter")&&(t.gutter.element.classList.add("fn__none"),t.gutter.element.innerHTML="",t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--hl").forEach((e=>{e.classList.remove("protyle-wysiwyg--hl")}))),t.toolbar&&e.includes("toolbar")&&(t.toolbar.element.classList.add("fn__none"),t.toolbar.element.style.display=""),t.toolbar&&e.includes("util")){const e=t.toolbar.subElement.querySelector('[data-type="pin"]');(!e||e&&!e.classList.contains("block__icon--active"))&&t.toolbar.subElement.classList.add("fn__none")}e.includes("select")&&t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach((e=>{e.classList.remove("protyle-wysiwyg--select")}))}else if(e.includes("dialog"))for(let e=0;e<window.siyuan.dialogs.length;e++)window.siyuan.dialogs[e].destroy(),e--}},1384:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setPadding=t.removeLoading=t.addLoading=t.initUI=void 0;const i=n(2319),a=n(1248),o=n(1829),s=n(3274),r=n(8792);t.initUI=e=>{e.contentElement=document.createElement("div"),e.contentElement.className="protyle-content",window.siyuan.config.editor.fullWidth?e.contentElement.setAttribute("data-fullwidth","true"):e.contentElement.removeAttribute("data-fullwidth"),e.options.render.background&&e.contentElement.appendChild(e.background.element),e.options.render.title&&e.contentElement.appendChild(e.title.element),e.contentElement.appendChild(e.wysiwyg.element),e.options.action.includes(r.Constants.CB_GET_HISTORY)||(0,o.scrollEvent)(e,e.contentElement),e.element.append(e.contentElement),e.element.appendChild(e.preview.element),e.upload&&e.element.appendChild(e.upload.element),e.scroll&&e.element.appendChild(e.scroll.element),e.gutter&&e.element.appendChild(e.gutter.element),e.element.appendChild(e.hint.element),e.selectElement=document.createElement("div"),e.selectElement.className="protyle-select fn__none",e.element.appendChild(e.selectElement),e.element.appendChild(e.toolbar.element),e.element.appendChild(e.toolbar.subElement),(0,t.addLoading)(e),(0,i.setEditMode)(e,e.options.mode),document.execCommand("DefaultParagraphSeparator",!1,"p")};t.addLoading=e=>{e.element.insertAdjacentHTML("beforeend",'<div style="background-color: var(--b3-theme-background)" class="fn__loading wysiwygLoading"><img width="48px" src="/stage/loading-pure.svg"></div>')};t.removeLoading=e=>{const t=e.element.querySelector(".wysiwygLoading");t&&t.remove()};t.setPadding=e=>{if(e.options.action.includes(r.Constants.CB_GET_HISTORY))return;let t=16,n=24;if(!(0,s.isMobile)()){const i=(e.element.clientWidth-r.Constants.SIZE_EDITOR_WIDTH)/2;!window.siyuan.config.editor.fullWidth&&i>96?(t=i,n=i):e.element.clientWidth>r.Constants.SIZE_EDITOR_WIDTH&&(t=96,n=96)}e.options.render.background&&e.options.render.title?(e.background.element.lastElementChild.setAttribute("style",`left:${t}px`),e.title.element.style.margin=`16px ${t}px 0 ${n}px`):e.options.render.background&&!e.options.render.title?e.background.element.lastElementChild.setAttribute("style",`left:${t}px`):!e.options.render.background&&e.options.render.title&&(e.title.element.style.margin=`16px ${t}px 0 ${n}px`);let i="16px";if(e.options.typewriterMode&&(i=(0,s.isMobile)()?window.innerHeight/5+"px":e.element.clientHeight/2+"px"),e.wysiwyg.element.style.padding=`16px ${t}px ${i} ${n}px`,(0,s.isMobile)()||(window.siyuan.config.editor.fullWidth?(e.wysiwyg.element.style.width="",e.options.render.title&&(e.title.element.style.width="")):(e.wysiwyg.element.style.width=e.element.clientWidth-10+"px",e.options.render.title&&(e.title.element.style.width=e.element.clientWidth-t-n-10+"px"))),window.siyuan.config.editor.codeSyntaxHighlightLineNum&&setTimeout((()=>{e.wysiwyg.element.querySelectorAll('.code-block [contenteditable="true"]').forEach((e=>{(0,a.lineNumberRender)(e)}))}),300),window.siyuan.config.editor.displayBookmarkIcon){const i=document.getElementById("editorAttr");i&&(i.innerHTML=`.protyle-wysiwyg--attr .b3-tooltips:after { max-width: ${e.wysiwyg.element.clientWidth-t-n}px; }`)}}},2374:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCodeTheme=void 0;const i=n(8792),a=n(6649);t.setCodeTheme=(e=i.Constants.PROTYLE_CDN)=>{const t=document.getElementById("protyleHljsStyle");let n;0===window.siyuan.config.appearance.mode?(n=window.siyuan.config.appearance.codeBlockThemeLight,i.Constants.SIYUAN_CONFIG_APPEARANCE_LIGHT_CODE.includes(n)||(n="default")):(n=window.siyuan.config.appearance.codeBlockThemeDark,i.Constants.SIYUAN_CONFIG_APPEARANCE_DARK_CODE.includes(n)||(n="github-dark"));const o=`${e}/js/highlight.js/styles/${n}.min.css?v=11.5.0`;t?t.href.includes(o)||(t.remove(),(0,a.addStyle)(o,"protyleHljsStyle")):(0,a.addStyle)(o,"protyleHljsStyle")}},525:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.electronUndo=t.Undo=void 0;const i=n(6840),a=n(7870),o=n(8792),s=n(5378),r=n(8592);t.Undo=class{constructor(){this.hasUndo=!1,this.redoStack=[],this.undoStack=[]}undo(e){if(e.disabled)return;if(0===this.undoStack.length)return;const t=this.undoStack.pop();this.render(e,t,!1),this.hasUndo=!0,this.redoStack.push(t)}redo(e){if(e.disabled)return;if(0===this.redoStack.length)return;const t=this.redoStack.pop();this.render(e,t,!0),this.undoStack.push(t)}render(e,t,n){(0,s.hideElements)(["hint"],e),e.wysiwyg.lastHTMLs={},n?(t.doOperations.forEach((t=>{(0,i.onTransaction)(e,t,!0)})),(0,i.transaction)(e,t.doOperations)):(t.undoOperations.forEach((t=>{(0,i.onTransaction)(e,t,!0)})),(0,i.transaction)(e,t.undoOperations)),(0,a.preventScroll)(e),(0,r.scrollCenter)(e)}replace(e){this.undoStack.length>0&&(this.undoStack[this.undoStack.length-1].doOperations=e)}add(e,t){this.undoStack.push({undoOperations:t,doOperations:e}),this.undoStack.length>o.Constants.SIZE_UNDO&&this.undoStack.shift(),this.hasUndo&&(this.redoStack=[],this.hasUndo=!1)}clear(){this.undoStack=[],this.redoStack=[]}};t.electronUndo=e=>!1},2239:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFiles=t.uploadLocalFiles=t.Upload=void 0;const i=n(7276),a=n(1890),o=n(8792),s=n(5174),r=n(734),l=n(4640),c=n(8813);t.Upload=class{constructor(){this.isUploading=!1,this.element=document.createElement("div"),this.element.className="protyle-upload"}};const u=(e,t)=>{const n=JSON.parse(e);let s="";1===n.code&&(s=`${n.msg}`),n.data.errFiles&&n.data.errFiles.length>0&&(s=`<ul><li>${s}</li>`,n.data.errFiles.forEach((e=>{const n=e.lastIndexOf("."),i=-1===n?e:t.options.upload.filename(e.substr(0,n))+e.substr(n);s+=`<li>${i} ${window.siyuan.languages.uploadError}</li>`})),s+="</ul>"),s&&(0,a.showMessage)(s);let r="";const u=Object.keys(n.data.succMap);u.forEach(((e,i)=>{const a=n.data.succMap[e],s=(0,c.pathPosix)().extname(e).toLowerCase(),l=t.options.upload.filename(e);o.Constants.SIYUAN_ASSETS_AUDIO.includes(s)?r+=`<audio controls="controls" src="${a}"></audio>`:o.Constants.SIYUAN_ASSETS_IMAGE.includes(s)?r+=`![${l.substring(0,l.length-s.length)}](${a})`:o.Constants.SIYUAN_ASSETS_VIDEO.includes(s)?r+=`<video controls="controls" src="${a}"></video>`:r+=`[${l}](${a})`,u.length-1!==i&&(r+="\n")}));const d=(0,l.getEditorRange)(t.wysiwyg.element);!r.startsWith("<")&&""===d.toString()&&3===d.startContainer.nodeType&&t.toolbar.getCurrentType(d).length>0&&(d.setEndAfter(d.startContainer.parentElement),d.collapse(!1)),(0,i.insertHTML)(t.lute.SpinBlockDOM(r),t)};t.uploadLocalFiles=(e,t)=>{const n=(0,a.showMessage)(window.siyuan.languages.uploading,0);(0,r.fetchPost)("/api/asset/insertLocalAssets",{assetPaths:e,id:t.block.rootID},(e=>{(0,a.hideMessage)(n),u(JSON.stringify(e),t)}))};t.uploadFiles=(e,t,n,i)=>{let o=[];for(let e=0;e<t.length;e++){let n=t[e];n instanceof DataTransferItem&&(n=n.getAsFile()),0===n.size&&""===n.type&&-1===n.name.indexOf(".")?document.execCommand("insertHTML",!1,`[${n.name}](file://${n.path})`):o.push(n)}if(e.options.upload.handler){const t=e.options.upload.handler(o);return"string"==typeof t?void(0,a.showMessage)(t):void 0}if(!e.options.upload.url||!e.upload)return n&&(n.value=""),void(0,a.showMessage)("please config: options.upload.url");if(e.options.upload.file&&(o=e.options.upload.file(o)),e.options.upload.validate){const t=e.options.upload.validate(o);if("string"==typeof t)return void(0,a.showMessage)(t)}const r=e.wysiwyg.element,l=((e,t)=>{const n=[];let i,o="",s="";for(let i=t.length,a=0;a<i;a++){const i=t[a];let r=!0;i.name||(o+=`<li>${window.siyuan.languages.nameEmpty}</li>`,r=!1),i.size>e.options.upload.max&&(o+=`<li>${i.name} ${window.siyuan.languages.over} ${e.options.upload.max/1024/1024}M</li>`,r=!1);const l=i.name.lastIndexOf("."),c=-1===l?"":i.name.substr(l),u=-1===l?i.name:e.options.upload.filename(i.name.substr(0,l))+c;e.options.upload.accept&&(e.options.upload.accept.split(",").some((e=>{const t=e.trim();if(0===t.indexOf(".")){if(c.toLowerCase()===t.toLowerCase())return!0}else if(i.type.split("/")[0]===t.split("/")[0])return!0;return!1}))||(o+=`<li>${i.name} ${window.siyuan.languages.fileTypeError}</li>`,r=!1)),r&&(n.push(i),s+=`<li>${u} ${window.siyuan.languages.uploading}</li>`)}return""===o&&""===s||(i=(0,a.showMessage)(`<ul>${o}${s}</ul>`)),{files:n,msgId:i}})(e,o);if(0===l.files.length)return void(n&&(n.value=""));const c=new FormData,d=e.options.upload.extraData;for(const e of Object.keys(d))c.append(e,d[e]);for(let t=0,n=l.files.length;t<n;t++)c.append(e.options.upload.fieldName,l.files[t]);c.append("id",e.block.rootID);const p=new XMLHttpRequest;p.open("POST",e.options.upload.url),e.options.upload.token&&p.setRequestHeader("X-Upload-Token",e.options.upload.token),e.options.upload.withCredentials&&(p.withCredentials=!0),e.upload.isUploading=!0,p.onreadystatechange=()=>{if(p.readyState===XMLHttpRequest.DONE){if(e.upload.isUploading=!1,!document.body.contains(e.element))return void(0,s.destroy)(e);if(200===p.status)if((0,a.hideMessage)(l.msgId),e.options.upload.success)e.options.upload.success(r,p.responseText);else if(i)i(p.responseText);else{let n=p.responseText;e.options.upload.format&&(n=e.options.upload.format(t,p.responseText)),u(n,e)}else 0===p.status?(0,a.showMessage)(window.siyuan.languages.fileTypeError):e.options.upload.error?e.options.upload.error(p.responseText):(0,a.showMessage)(p.responseText);n&&(n.value=""),e.upload.element.style.display="none"}},p.upload.onprogress=t=>{if(!t.lengthComputable)return;const n=t.loaded/t.total*100;e.upload.element.style.display="block";e.upload.element.style.width=n+"%"},p.send(c)}},4912:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Options=void 0;const i=n(8792),a=n(8291),o=n(3505),s=n(3274);t.Options=class{constructor(e){this.defaultOptions={mode:"wysiwyg",blockId:"",render:{background:!1,title:!1,gutter:!0,scroll:!1,breadcrumb:!0,breadcrumbDocName:!1,breadcrumbContext:!1},after:void 0,classes:{preview:""},debugger:"development"===i.Constants.NODE_ENV,hint:{delay:200,emoji:{"+1":"👍","-1":"👎",confused:"😕",eyes:"👀️",heart:"❤️",rocket:"🚀️",smile:"😄",tada:"🎉️"},emojiPath:"/emojis",extend:[{key:"((",hint:o.hintRef},{key:"【【",hint:o.hintRef},{key:"（（",hint:o.hintRef},{key:"[[",hint:o.hintRef},{key:"{{",hint:o.hintEmbed},{key:"「「",hint:o.hintEmbed},{key:"#",hint:o.hintTag},{key:"/",hint:o.hintSlash},{key:"、",hint:o.hintSlash},{key:":"}]},lang:window.siyuan.config.appearance.lang,preview:{actions:["desktop","tablet","mobile","mp-wechat","zhihu","yuque"],delay:1e3,markdown:{paragraphBeginningSpace:window.siyuan.config.export.paragraphBeginningSpace,listStyle:!1,sanitize:!0},mode:"both"},toolbar:(0,s.isMobile)()?["block-ref","a","|","strong","em","u","s","mark","|","tag","code","inline-math","|","inline-memo","text"]:["block-ref","a","|","strong","em","u","s","mark","|","sup","sub","kbd","|","tag","code","inline-math","|","inline-memo","text"],typewriterMode:!1,upload:{max:4294967296,url:i.Constants.UPLOAD_ADDRESS,extraData:{},fieldName:"file[]",filename:e=>e.replace(/[\\/:*?"'<>|]/g,""),linkToImgUrl:"",withCredentials:!1}},this.options=e}merge(){var e;return this.options&&(this.options.toolbar?this.options.toolbar=this.mergeToolbar(this.options.toolbar):this.options.toolbar=this.mergeToolbar(this.defaultOptions.toolbar),(null===(e=this.options.hint)||void 0===e?void 0:e.emoji)&&(this.defaultOptions.hint.emoji=this.options.hint.emoji)),(0,a.merge)(this.defaultOptions,this.options)}mergeToolbar(e){const t=[{name:"block-ref",hotkey:window.siyuan.config.keymap.editor.insert.blockRef.custom,lang:"blockRef",icon:"iconGraph",tipPosition:"ne"},{name:"a",hotkey:window.siyuan.config.keymap.editor.insert.link.custom,lang:"link",icon:"iconLink",tipPosition:"n"},{name:"strong",lang:"bold",hotkey:window.siyuan.config.keymap.editor.insert.bold.custom,icon:"iconBold",tipPosition:"n"},{name:"em",lang:"italic",hotkey:window.siyuan.config.keymap.editor.insert.italic.custom,icon:"iconItalic",tipPosition:"n"},{name:"u",lang:"underline",hotkey:window.siyuan.config.keymap.editor.insert.underline.custom,icon:"iconUnderline",tipPosition:"n"},{name:"s",lang:"strike",hotkey:window.siyuan.config.keymap.editor.insert.strike.custom,icon:"iconStrike",tipPosition:"n"},{name:"mark",lang:"mark",hotkey:window.siyuan.config.keymap.editor.insert.mark.custom,icon:"iconMark",tipPosition:"n"},{name:"sup",lang:"sup",hotkey:window.siyuan.config.keymap.editor.insert.sup.custom,icon:"iconSup",tipPosition:"n"},{name:"sub",lang:"sub",hotkey:window.siyuan.config.keymap.editor.insert.sub.custom,icon:"iconSub",tipPosition:"n"},{name:"kbd",lang:"kbd",hotkey:window.siyuan.config.keymap.editor.insert.kbd.custom,icon:"iconKeymap",tipPosition:"n"},{name:"tag",lang:"tag",hotkey:window.siyuan.config.keymap.editor.insert.tag.custom,icon:"iconTags",tipPosition:"n"},{name:"code",lang:"inline-code",hotkey:window.siyuan.config.keymap.editor.insert["inline-code"].custom,icon:"iconInlineCode",tipPosition:"n"},{name:"inline-math",lang:"inline-math",hotkey:window.siyuan.config.keymap.editor.insert["inline-math"].custom,icon:"iconMath",tipPosition:"n"},{name:"inline-memo",lang:"memo",hotkey:window.siyuan.config.keymap.editor.insert.memo.custom,icon:"iconM",tipPosition:"n"},{name:"text",lang:"font",hotkey:window.siyuan.config.keymap.editor.insert.font.custom,icon:"iconFont",tipPosition:"n"},{name:"|"}],n=[];return e.forEach((e=>{let i=e;t.find((t=>"string"==typeof e&&t.name===e?(i=t,!0):"object"==typeof e&&t.name===e.name?(i=Object.assign({},t,e),!0):void 0)),n.push(i)})),n}}},8604:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecordMedia=void 0;t.RecordMedia=class{constructor(e){let t;if(this.SAMPLE_RATE=44100,this.isRecording=!1,this.readyFlag=!1,this.leftChannel=[],this.rightChannel=[],this.recordingLength=0,"undefined"!=typeof AudioContext)t=new AudioContext;else{if(!webkitAudioContext)return;t=new webkitAudioContext}this.DEFAULT_SAMPLE_RATE=t.sampleRate;const n=t.createGain();t.createMediaStreamSource(e).connect(n),this.recorder=t.createScriptProcessor(2048,2,1),this.recorder.onaudioprocess=null,n.connect(this.recorder),this.recorder.connect(t.destination),this.readyFlag=!0}cloneChannelData(e,t){this.leftChannel.push(new Float32Array(e)),this.rightChannel.push(new Float32Array(t)),this.recordingLength+=2048}startRecordingNewWavFile(){this.readyFlag&&(this.isRecording=!0,this.leftChannel.length=this.rightChannel.length=0,this.recordingLength=0)}stopRecording(){this.isRecording=!1}buildWavFileBlob(){const e=this.mergeBuffers(this.leftChannel),t=this.mergeBuffers(this.rightChannel);let n=new Float32Array(e.length);for(let i=0;i<e.length;++i)n[i]=.5*(e[i]+t[i]);this.DEFAULT_SAMPLE_RATE>this.SAMPLE_RATE&&(n=this.downSampleBuffer(n,this.SAMPLE_RATE));const i=44+2*n.length,a=new ArrayBuffer(i),o=new DataView(a);this.writeUTFBytes(o,0,"RIFF"),o.setUint32(4,i,!0),this.writeUTFBytes(o,8,"WAVE"),this.writeUTFBytes(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,1,!0),o.setUint32(24,this.SAMPLE_RATE,!0),o.setUint32(28,2*this.SAMPLE_RATE,!0),o.setUint16(32,2,!0),o.setUint16(34,16,!0);const s=2*n.length;this.writeUTFBytes(o,36,"data"),o.setUint32(40,s,!0);const r=n.length;let l=44;for(let e=0;e<r;e++)o.setInt16(l,32767*n[e],!0),l+=2;return new Blob([o],{type:"audio/wav"})}downSampleBuffer(e,t){if(t===this.DEFAULT_SAMPLE_RATE)return e;if(t>this.DEFAULT_SAMPLE_RATE)return e;const n=this.DEFAULT_SAMPLE_RATE/t,i=Math.round(e.length/n),a=new Float32Array(i);let o=0,s=0;for(;o<a.length;){const t=Math.round((o+1)*n);let i=0,r=0;for(let n=s;n<t&&n<e.length;n++)i+=e[n],r++;a[o]=i/r,o++,s=t}return a}mergeBuffers(e){const t=new Float32Array(this.recordingLength);let n=0;const i=e.length;for(let a=0;a<i;++a){const i=e[a];t.set(i,n),n+=i.length}return t}writeUTFBytes(e,t,n){const i=n.length;for(let a=0;a<i;a++)e.setUint8(t+a,n.charCodeAt(a))}}},6555:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addScript=t.addScriptSync=void 0;t.addScriptSync=(e,t)=>{if(document.getElementById(t))return!1;const n=new XMLHttpRequest;n.open("GET",e,!1),n.setRequestHeader("Accept","text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01"),n.send("");const i=document.createElement("script");i.type="text/javascript",i.text=n.responseText,i.id=t,document.head.appendChild(i)};t.addScript=(e,t)=>new Promise((n=>{if(document.getElementById(t))return n(!1),!1;const i=document.createElement("script");i.src=e,i.async=!0,document.head.appendChild(i),i.onload=()=>{if(document.getElementById(t))return i.remove(),n(!1),!1;i.id=t,n(!0)}}))},6649:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addStyle=void 0;t.addStyle=(e,t)=>{if(!document.getElementById(t)){const n=document.createElement("link");n.id=t,n.rel="stylesheet",n.type="text/css",n.href=e,document.getElementsByTagName("head")[0].appendChild(n)}}},1040:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.code160to32=void 0;t.code160to32=e=>e.replace(/\u00a0/g," ")},7954:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.hotKey2Electron=t.updateHotkeyTip=t.isMac=t.isCtrl=t.getEventName=t.writeText=t.openByMobile=void 0;t.openByMobile=e=>{e&&("ios"===window.siyuan.config.system.container?window.location.href=e:"android"===window.siyuan.config.system.container&&window.JSAndroid?window.JSAndroid.openExternal(e):window.open(e))};t.writeText=e=>n(void 0,void 0,void 0,(function*(){var t,n;try{if("android"===window.siyuan.config.system.container&&window.JSAndroid)return void window.JSAndroid.writeClipboard(e);if("ios"===window.siyuan.config.system.container&&(null===(t=window.webkit)||void 0===t?void 0:t.messageHandlers))return void window.webkit.messageHandlers.setClipboard.postMessage(e);navigator.clipboard.writeText(e)}catch(t){if("ios"===window.siyuan.config.system.container&&(null===(n=window.webkit)||void 0===n?void 0:n.messageHandlers))window.webkit.messageHandlers.setClipboard.postMessage(e);else if("android"===window.siyuan.config.system.container&&window.JSAndroid)window.JSAndroid.writeClipboard(e);else{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}}));t.getEventName=()=>navigator.userAgent.indexOf("iPhone")>-1?"touchstart":"click";t.isCtrl=e=>(0,t.isMac)()?!(!e.metaKey||e.ctrlKey):!(e.metaKey||!e.ctrlKey);t.isMac=()=>navigator.platform.toUpperCase().indexOf("MAC")>-1;t.updateHotkeyTip=e=>{if(/Mac/.test(navigator.platform)||"iPhone"===navigator.platform)return e;const t=new Map(Object.entries({"⌘":"Ctrl","⇧":"Shift","⌥":"Alt","⇥":"Tab","⌫":"Backspace","⌦":"Delete","↩":"Enter"})),n=new Map(Object.entries({";":":","=":"+","-":"_",".":">"})),i=[];e.indexOf("⌘")>-1&&i.push(t.get("⌘")),e.indexOf("⇧")>-1&&i.push(t.get("⇧")),e.indexOf("⌥")>-1&&i.push(t.get("⌥"));const a=e.replace(/⌘|⇧|⌥/g,"");return"⌘⇧⌥".indexOf(a)<0&&i.push(t.get(a)||e.indexOf("⇧")>-1&&n.get(a)||a),i.join("+")};t.hotKey2Electron=e=>{let t="";return e.indexOf("⌘")>-1&&(t+="CommandOrControl+"),e.indexOf("⇧")>-1&&(t+="Shift+"),e.indexOf("⌥")>-1&&(t+="Alt+"),t+e.substr(e.length-1)}},5174:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=void 0;t.destroy=e=>{if(e){e.element.classList.remove("protyle"),e.element.removeAttribute("style"),e.wysiwyg&&(e.wysiwyg.lastHTMLs={}),e.undo&&e.undo.clear();try{e.ws.send("closews",{})}catch(t){setTimeout((()=>{e.ws.send("closews",{})}),10240)}}}},847:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.dropEvent=void 0;const a=n(4640),o=n(3607),s=n(8792),r=n(4705),l=n(9173),c=n(6840),u=n(6520),d=n(4921),p=n(5378),h=n(8527),f=n(734),g=n(7010),m=n(3371),y=n(2892),b=n(9516),v=n(2005),w=n(7876),_=n(7822),E=n(6057),k=n(1248),C=n(2239),D=n(7276),x=(e,t,n,i,r)=>{var p,h,f,g,y,b,v;const _=e.element.contains(t[0]);let E;"NodeListItem"===t[0].getAttribute("data-type")&&"NodeListItem"!==n.getAttribute("data-type")&&(E=document.createElement("div"),E.setAttribute("data-node-id",Lute.NewNodeID()),E.setAttribute("data-type","NodeList"),E.setAttribute("data-subtype",t[0].getAttribute("data-subtype")),E.className="list",E.insertAdjacentHTML("beforeend",`<div class="protyle-attr" contenteditable="false">${s.Constants.ZWSP}</div>`));const k=[{action:"move",id:n.getAttribute("data-node-id"),previousID:null===(p=n.previousElementSibling)||void 0===p?void 0:p.getAttribute("data-node-id"),parentID:(null===(h=n.parentElement)||void 0===h?void 0:h.getAttribute("data-node-id"))||e.block.parentID}];let C,D=t[0].parentElement;const x=(0,l.genSBElement)(r);n.parentElement.replaceChild(x,n);const S=[{action:"insert",data:x.outerHTML,id:x.getAttribute("data-node-id"),previousID:null===(f=x.previousElementSibling)||void 0===f?void 0:f.getAttribute("data-node-id"),parentID:x.parentElement.getAttribute("data-node-id")||e.block.parentID}];if(E?(x.insertAdjacentElement("afterbegin",n),S.push({action:"move",id:n.getAttribute("data-node-id"),parentID:x.getAttribute("data-node-id")}),i?(n.insertAdjacentElement("afterend",E),S.push({action:"insert",data:E.outerHTML,id:E.getAttribute("data-node-id"),previousID:n.getAttribute("data-node-id")})):(n.insertAdjacentElement("beforebegin",E),S.push({action:"insert",data:E.outerHTML,id:E.getAttribute("data-node-id"),previousID:null===(g=E.previousElementSibling)||void 0===g?void 0:g.getAttribute("data-node-id"),parentID:(null===(y=E.parentElement)||void 0===y?void 0:y.getAttribute("data-node-id"))||e.block.parentID})),t.reverse().forEach(((n,i)=>{var a;if(i===t.length-1&&(C=(0,u.getTopAloneElement)(n),C.isSameNode(n)&&(C=void 0)),k.push({action:"move",id:n.getAttribute("data-node-id"),previousID:null===(a=n.previousElementSibling)||void 0===a?void 0:a.getAttribute("data-node-id"),parentID:n.parentElement.getAttribute("data-node-id")||e.block.rootID}),!_){const t=e.wysiwyg.element.querySelector(`[data-node-id="${n.getAttribute("data-node-id")}"]`);t&&t.remove()}E.insertAdjacentElement("afterbegin",n),S.push({action:"move",id:n.getAttribute("data-node-id"),parentID:E.getAttribute("data-node-id")})})),k.reverse(),k.push({action:"delete",id:E.getAttribute("data-node-id")})):(i||(x.insertAdjacentElement("afterbegin",n),S.push({action:"move",id:n.getAttribute("data-node-id"),parentID:x.getAttribute("data-node-id")})),t.reverse().forEach(((n,i)=>{var a;if(i===t.length-1&&(C=(0,u.getTopAloneElement)(n),C.isSameNode(n)&&(C=void 0)),k.push({action:"move",id:n.getAttribute("data-node-id"),previousID:null===(a=n.previousElementSibling)||void 0===a?void 0:a.getAttribute("data-node-id"),parentID:n.parentElement.getAttribute("data-node-id")||e.block.rootID}),!_){const t=e.wysiwyg.element.querySelector(`[data-node-id="${n.getAttribute("data-node-id")}"]`);t&&t.remove()}x.insertAdjacentElement("afterbegin",n),S.push({action:"move",id:n.getAttribute("data-node-id"),parentID:x.getAttribute("data-node-id")})})),k.reverse(),i&&(x.insertAdjacentElement("afterbegin",n),S.push({action:"move",id:n.getAttribute("data-node-id"),parentID:x.getAttribute("data-node-id")}))),k.push({action:"delete",id:x.getAttribute("data-node-id")}),D&&D.classList.contains("list")&&"o"===D.getAttribute("data-subtype")&&!D.isSameNode(t[0].parentElement)&&D.childElementCount>1&&(Array.from(D.children).forEach((e=>{e.classList.contains("protyle-attr")||k.splice(0,0,{action:"update",id:e.getAttribute("data-node-id"),data:e.outerHTML})})),(0,d.updateListOrder)(D,1),Array.from(D.children).forEach((e=>{e.classList.contains("protyle-attr")||S.push({action:"update",id:e.getAttribute("data-node-id"),data:e.outerHTML})}))),C){if(S.push({action:"delete",id:C.getAttribute("data-node-id")}),k.splice(0,0,{action:"insert",data:C.outerHTML,id:C.getAttribute("data-node-id"),previousID:null===(b=C.previousElementSibling)||void 0===b?void 0:b.getAttribute("data-node-id"),parentID:(null===(v=C.parentElement)||void 0===v?void 0:v.getAttribute("data-node-id"))||e.block.parentID}),!_){const t=e.wysiwyg.element.querySelector(`[data-node-id="${C.getAttribute("data-node-id")}"]`);t&&t.remove()}D=C.parentElement,C.remove()}if(D&&D.classList.contains("sb")&&2===D.childElementCount){const t=(0,l.cancelSB)(e,D);S.push(t.doOperations[0],t.doOperations[1]),k.splice(0,0,t.undoOperations[0],t.undoOperations[1])}else if(D&&D.classList.contains("protyle-wysiwyg")&&""===D.innerHTML){const e=(0,o.hasClosestByClassName)(D,"protyle",!0);if(e&&!e.classList.contains("block__edit")){const t=(0,m.getInstanceById)(e.getAttribute("data-id"));if(t&&t.model instanceof w.Editor&&t.model.editor.protyle.block.id===t.model.editor.protyle.block.rootID){const e=Lute.NewNodeID();S.splice(0,0,{action:"insert",id:e,data:(0,l.genEmptyElement)(!1,!1,e).outerHTML,parentID:t.model.editor.protyle.block.parentID}),k.splice(0,0,{action:"delete",id:e})}}}_?(0,c.transaction)(e,S,k):(0,c.transaction)(e,S),(0,a.focusBlock)(t[0])},S=(e,t,n,i)=>{var r,p,h,f;const g=e.element.contains(t[0]),y=[],b=[];let v,_;"NodeListItem"===t[0].getAttribute("data-type")&&"NodeListItem"!==n.getAttribute("data-type")&&(v=document.createElement("div"),v.setAttribute("data-node-id",Lute.NewNodeID()),v.setAttribute("data-type","NodeList"),v.setAttribute("data-subtype",t[0].getAttribute("data-subtype")),v.className="list",v.insertAdjacentHTML("beforeend",`<div class="protyle-attr" contenteditable="false">${s.Constants.ZWSP}</div>`));let E=t[0].parentElement;if(i?v?(n.insertAdjacentElement("afterend",v),y.push({action:"insert",data:v.outerHTML,id:v.getAttribute("data-node-id"),previousID:n.getAttribute("data-node-id")}),t.reverse().forEach(((n,i)=>{var a;if(i===t.length-1&&(_=(0,u.getTopAloneElement)(n),_.isSameNode(n)&&(_=void 0)),b.push({action:"move",id:n.getAttribute("data-node-id"),previousID:null===(a=n.previousElementSibling)||void 0===a?void 0:a.getAttribute("data-node-id"),parentID:n.parentElement.getAttribute("data-node-id")||e.block.rootID}),!g){const t=e.wysiwyg.element.querySelector(`[data-node-id="${n.getAttribute("data-node-id")}"]`);t&&t.remove()}v.insertAdjacentElement("afterbegin",n),y.push({action:"move",id:n.getAttribute("data-node-id"),parentID:v.getAttribute("data-node-id")})})),b.reverse(),b.push({action:"delete",id:v.getAttribute("data-node-id")})):(t.reverse().forEach(((i,a)=>{var o;if(a===t.length-1&&(_=(0,u.getTopAloneElement)(i),_.isSameNode(i)&&(_=void 0)),b.push({action:"move",id:i.getAttribute("data-node-id"),previousID:null===(o=i.previousElementSibling)||void 0===o?void 0:o.getAttribute("data-node-id"),parentID:i.parentElement.getAttribute("data-node-id")||e.block.rootID}),!g){const t=e.wysiwyg.element.querySelector(`[data-node-id="${i.getAttribute("data-node-id")}"]`);t&&t.remove()}n.insertAdjacentElement("afterend",i),y.push({action:"move",id:i.getAttribute("data-node-id"),previousID:n.getAttribute("data-node-id")})})),b.reverse()):v?(n.insertAdjacentElement("beforebegin",v),y.push({action:"insert",data:v.outerHTML,id:v.getAttribute("data-node-id"),previousID:null===(r=v.previousElementSibling)||void 0===r?void 0:r.getAttribute("data-node-id"),parentID:(null===(p=v.parentElement)||void 0===p?void 0:p.getAttribute("data-node-id"))||e.block.parentID}),t.reverse().forEach(((n,i)=>{var a;if(i===t.length-1&&(_=(0,u.getTopAloneElement)(n),_.isSameNode(n)&&(_=void 0)),b.push({action:"move",id:n.getAttribute("data-node-id"),previousID:null===(a=n.previousElementSibling)||void 0===a?void 0:a.getAttribute("data-node-id"),parentID:n.parentElement.getAttribute("data-node-id")||e.block.rootID}),!g){const t=e.wysiwyg.element.querySelector(`[data-node-id="${n.getAttribute("data-node-id")}"]`);t&&t.remove()}v.insertAdjacentElement("afterbegin",n),y.push({action:"move",id:n.getAttribute("data-node-id"),parentID:v.getAttribute("data-node-id")})})),b.reverse(),b.push({action:"delete",id:v.getAttribute("data-node-id")})):(t.forEach(((i,a)=>{var o,s,r;if(a===t.length-1&&(_=(0,u.getTopAloneElement)(i),_.isSameNode(i)&&(_=void 0)),b.push({action:"move",id:i.getAttribute("data-node-id"),previousID:null===(o=i.previousElementSibling)||void 0===o?void 0:o.getAttribute("data-node-id"),parentID:i.parentElement.getAttribute("data-node-id")||e.block.rootID}),!g){const t=e.wysiwyg.element.querySelector(`[data-node-id="${i.getAttribute("data-node-id")}"]`);t&&t.remove()}n.insertAdjacentElement("beforebegin",i),y.push({action:"move",id:i.getAttribute("data-node-id"),previousID:null===(s=i.previousElementSibling)||void 0===s?void 0:s.getAttribute("data-node-id"),parentID:(null===(r=i.parentElement)||void 0===r?void 0:r.getAttribute("data-node-id"))||e.block.parentID})})),b.reverse()),"NodeListItem"===n.getAttribute("data-type")&&"o"===n.getAttribute("data-subtype")&&(Array.from(n.parentElement.children).forEach((e=>{e.classList.contains("protyle-attr")||b.splice(0,0,{action:"update",id:e.getAttribute("data-node-id"),data:e.outerHTML})})),(0,d.updateListOrder)(n.parentElement,1),Array.from(n.parentElement.children).forEach((e=>{e.classList.contains("protyle-attr")||y.push({action:"update",id:e.getAttribute("data-node-id"),data:e.outerHTML})}))),E&&E.classList.contains("list")&&"o"===E.getAttribute("data-subtype")&&!E.isSameNode(t[0].parentElement)&&E.childElementCount>1&&(Array.from(E.children).forEach((e=>{e.classList.contains("protyle-attr")||(E.contains(n)?b.splice(0,0,{action:"update",id:e.getAttribute("data-node-id"),data:e.outerHTML}):b.splice(n.parentElement.childElementCount-1,0,{action:"update",id:e.getAttribute("data-node-id"),data:e.outerHTML}))})),(0,d.updateListOrder)(E,1),Array.from(E.children).forEach((e=>{e.classList.contains("protyle-attr")||y.push({action:"update",id:e.getAttribute("data-node-id"),data:e.outerHTML})}))),_&&(y.push({action:"delete",id:_.getAttribute("data-node-id")}),b.splice(0,0,{action:"insert",data:_.outerHTML,id:_.getAttribute("data-node-id"),previousID:null===(h=_.previousElementSibling)||void 0===h?void 0:h.getAttribute("data-node-id"),parentID:(null===(f=_.parentElement)||void 0===f?void 0:f.getAttribute("data-node-id"))||e.block.parentID}),E=_.parentElement,_.remove(),!g)){const t=e.wysiwyg.element.querySelector(`[data-node-id="${_.getAttribute("data-node-id")}"]`);t&&t.remove()}if(E&&E.classList.contains("sb")&&2===E.childElementCount){const t=(0,l.cancelSB)(e,E);y.push(t.doOperations[0],t.doOperations[1]),b.splice(0,0,t.undoOperations[0],t.undoOperations[1])}else if(E&&E.classList.contains("protyle-wysiwyg")&&0===E.childElementCount){const e=(0,o.hasClosestByClassName)(E,"protyle",!0);if(e&&!e.classList.contains("block__edit")){const t=(0,m.getInstanceById)(e.getAttribute("data-id"));if(t&&t.model instanceof w.Editor&&t.model.editor.protyle.block.id===t.model.editor.protyle.block.rootID){const e=Lute.NewNodeID();y.splice(0,0,{action:"insert",id:e,data:(0,l.genEmptyElement)(!1,!1,e).outerHTML,parentID:t.model.editor.protyle.block.parentID}),b.splice(0,0,{action:"delete",id:e})}}}g?(0,c.transaction)(e,y,b):(0,c.transaction)(e,y),(0,a.focusBlock)(t[0])};t.dropEvent=(e,t)=>{let n;t.addEventListener("dragstart",(t=>{const n=t.target;if("IMG"===n.tagName)return window.siyuan.dragElement=void 0,void t.preventDefault();n.classList&&n.classList.contains("protyle-action")?(0,o.hasClosestByClassName)(n,"protyle-wysiwyg__embed")?(window.siyuan.dragElement=void 0,t.preventDefault()):window.siyuan.dragElement=n.parentElement:(t.dataTransfer.setData(s.Constants.SIYUAN_DROP_EDITOR,s.Constants.SIYUAN_DROP_EDITOR),e.element.style.userSelect="auto",document.onmousemove=null,document.onmouseup=null)})),t.addEventListener("drop",(n=>i(void 0,void 0,void 0,(function*(){var i;if(n.dataTransfer.getData(s.Constants.SIYUAN_DROP_EDITOR)){if(0===getSelection().rangeCount)return;const t=(0,o.hasClosestBlock)(n.target),i=(0,o.hasClosestBlock)(getSelection().getRangeAt(0).startContainer);if(!t||!i)return;(0,p.hideElements)(["toolbar"],e);const s=t.isSameNode(i),r=[{action:"update",data:t.outerHTML,id:t.getAttribute("data-node-id")}];return s||r.push({action:"update",data:i.outerHTML,id:i.getAttribute("data-node-id")}),void setTimeout((()=>{const n=getSelection().getRangeAt(0);n.insertNode(document.createElement("wbr"));const o=e.lute.SpinBlockDOM(t.outerHTML);t.outerHTML=o;const l=[{action:"update",data:o,id:t.getAttribute("data-node-id")}];if(!s){const t=e.lute.SpinBlockDOM(i.outerHTML);i.outerHTML=t,l.push({action:"update",data:t,id:i.getAttribute("data-node-id")})}(0,c.transaction)(e,l,r),(0,h.mathRender)(e.wysiwyg.element),t.classList.contains("code-block")?(0,k.highlightRender)(e.wysiwyg.element):(0,a.focusByWbr)(e.wysiwyg.element,n),e.selectElement.classList.add("fn__none")}))}const l=t.querySelector(".dragover__bottom")||t.querySelector(".dragover__top")||t.querySelector(".dragover__left")||t.querySelector(".dragover__right"),u="backlink"===(null===(i=window.siyuan.dragElement)||void 0===i?void 0:i.getAttribute("data-treetype"));if(window.siyuan.dragElement&&(n.altKey||n.shiftKey)&&u){(0,a.focusByRange)(document.caretRangeFromPoint(n.clientX,n.clientY));const t=window.siyuan.dragElement.getAttribute("data-node-id");n.altKey?(0,f.fetchPost)("/api/block/getRefText",{id:t},(n=>{(0,D.insertHTML)(`((${t} '${n.data}'))`,e)})):((0,D.insertHTML)(e.lute.SpinBlockDOM(`{{select * from blocks where id='${t}'}}`),e),(0,_.blockRender)(e,e.wysiwyg.element))}else if(window.siyuan.dragElement&&l&&(window.siyuan.dragElement.parentElement.classList.contains("protyle-gutters")||u||"NodeListItem"===window.siyuan.dragElement.getAttribute("data-type"))){const t=window.siyuan.dragElement.getAttribute("data-node-id");let n=[];if(u){let i=document.createElement("div");const a=yield(0,f.fetchSyncPost)("/api/block/getBlockDOM",{id:t});i.innerHTML=a.data.dom,i=i.firstElementChild,(0,E.processRender)(i),(0,k.highlightRender)(i),(0,_.blockRender)(e,i),n=[i]}else{const e=window.siyuan.dragElement.getAttribute("data-selected-ids");(e?e.split(","):[window.siyuan.dragElement.getAttribute("data-node-id")]).forEach((e=>{const t=window.siyuan.dragElement.parentElement.parentElement.querySelector(`.protyle-wysiwyg [data-node-id="${e}"]`);t&&n.push(t)}))}n.forEach((e=>{e.classList.remove("protyle-wysiwyg--select","protyle-wysiwyg--hl")}));const i=l.className.split(" ");l.classList.remove("dragover__bottom","dragover__top","dragover__left","dragover__right","protyle-wysiwyg--select"),"NodeSuperBlock"===l.parentElement.getAttribute("data-type")&&"col"===l.parentElement.getAttribute("data-sb-layout")?i.includes("dragover__left")||i.includes("dragover__right")?S(e,n,l,i.includes("dragover__right")):x(e,n,l,i.includes("dragover__bottom"),"row"):i.includes("dragover__left")||i.includes("dragover__right")?x(e,n,l,i.includes("dragover__right"),"col"):S(e,n,l,i.includes("dragover__bottom")),u&&setTimeout((()=>{(0,y.getAllModels)().backlinks.forEach((e=>{e.refresh()}))}),200)}else if(window.siyuan.dragElement&&"navigation-file"===window.siyuan.dragElement.getAttribute("data-type")&&l)(0,f.fetchPost)("/api/filetree/doc2Heading",{srcID:window.siyuan.dragElement.getAttribute("data-node-id"),after:l.classList.contains("dragover__bottom"),targetID:l.getAttribute("data-node-id")},(t=>{const n=e.contentElement.scrollTop;(0,f.fetchPost)("/api/filetree/removeDoc",{notebook:t.data.srcTreeBox,path:t.data.srcTreePath}),(0,f.fetchPost)("/api/filetree/getDoc",{id:e.block.id,size:s.Constants.SIZE_GET},(t=>{(0,g.onGet)(t,e),(0,b.updatePanelByEditor)(e,!1,!1,!0),setTimeout((()=>{e.contentElement.scrollTop=n,e.scroll.lastScrollTop=n-1}),s.Constants.TIMEOUT_BLOCKLOAD)}))})),l.classList.remove("dragover__bottom","dragover__top");else if(!window.siyuan.dragElement&&("Files"===n.dataTransfer.types[0]||n.dataTransfer.types.includes("text/html")))if((0,a.focusByRange)(document.caretRangeFromPoint(n.clientX,n.clientY)),"Files"===n.dataTransfer.types[0]){const t=[];let i=!0;for(let e=0;e<n.dataTransfer.files.length;e++)t.push(n.dataTransfer.files[e].path),""===n.dataTransfer.files[e].type&&(i=!1);if(i)if(n.altKey){let n="";t.forEach((e=>{n+=`[${v.basename(e).replace(/\]/g,"\\]").replace(/\[/g,"\\[")}](file://${e.replace(/\\/g,"\\\\").replace(/\)/g,"\\)").replace(/\(/g,"\\(")})\n`})),(0,D.insertHTML)(e.lute.SpinBlockDOM(n),e)}else(0,C.uploadLocalFiles)(t,e);else(0,C.uploadLocalFiles)(t,e)}else(0,r.paste)(e,n);window.siyuan.dragElement&&(window.siyuan.dragElement.style.opacity="",window.siyuan.dragElement=void 0)})))),t.addEventListener("dragover",(t=>{if(t.dataTransfer.types.includes("Files")&&t.target.classList.contains("protyle-wysiwyg"))return void t.preventDefault();if(!window.siyuan.dragElement)return;if((t.shiftKey||t.altKey)&&"backlink"===window.siyuan.dragElement.getAttribute("data-treetype")){const e=(0,o.hasClosestBlock)(t.target);return e&&e.classList.remove("dragover__top","protyle-wysiwyg--select","dragover__bottom","dragover__left","dragover__right"),void t.preventDefault()}t.preventDefault();const i=(0,o.hasClosestBlock)(t.target);if(i){if(i&&n&&i.isSameNode(n)){const e=i.getBoundingClientRect();return i.classList.remove("dragover__top","dragover__bottom","dragover__left","dragover__right"),"NodeListItem"===i.getAttribute("data-type")||"navigation-file"===window.siyuan.dragElement.getAttribute("data-type")?void(t.clientY>e.top+e.height/2?i.classList.add("dragover__bottom","protyle-wysiwyg--select"):i.classList.add("dragover__top","protyle-wysiwyg--select")):void(t.clientX<e.left+32&&t.clientX>e.left?i.classList.add("dragover__left","protyle-wysiwyg--select"):t.clientX>e.right-32&&t.clientX<e.right?i.classList.add("dragover__right","protyle-wysiwyg--select"):t.clientY>e.top+e.height/2?i.classList.add("dragover__bottom","protyle-wysiwyg--select"):i.classList.add("dragover__top","protyle-wysiwyg--select"))}if("navigation-file"!==window.siyuan.dragElement.getAttribute("data-type")||window.siyuan.dragElement.getAttribute("data-node-id")===e.block.rootID){if(window.siyuan.dragElement.parentElement.classList.contains("protyle-gutters")||"NodeListItem"===window.siyuan.dragElement.getAttribute("data-type")||"backlink"===window.siyuan.dragElement.getAttribute("data-treetype")){const e=window.siyuan.dragElement.getAttribute("data-selected-ids");if((e?e.split(","):[window.siyuan.dragElement.getAttribute("data-node-id")]).find((e=>{if(e&&(0,o.hasClosestByAttribute)(i,"data-node-id",e))return!0})))return;if((0,o.hasClosestByAttribute)(i.parentElement,"data-type","NodeBlockQueryEmbed"))return;if("NodeListItem"===window.siyuan.dragElement.getAttribute("data-type")&&window.siyuan.dragElement.getAttribute("data-subtype")!==i.getAttribute("data-subtype")&&window.siyuan.dragElement.getAttribute("data-type")===i.getAttribute("data-type"))return;if("NodeListItem"!==window.siyuan.dragElement.getAttribute("data-type")&&"NodeListItem"===i.getAttribute("data-type"))return;n=i}}else n=i}})),t.addEventListener("dragleave",(e=>{var t;const n=(0,o.hasClosestBlock)(e.target);n&&(-1===((null===(t=window.siyuan.dragElement)||void 0===t?void 0:t.getAttribute("data-selected-ids"))||"").indexOf(n.getAttribute("data-node-id"))&&n.classList.remove("protyle-wysiwyg--select"),n.classList.remove("dragover__top","dragover__bottom","dragover__left","dragover__right"))}))}},3607:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasClosestByClassName=t.hasClosestByMatchTag=t.hasClosestBlock=t.hasClosestByAttribute=t.hasTopClosestByAttribute=t.hasTopClosestByTag=t.hasTopClosestByClassName=t.hasClosestByTag=void 0;t.hasClosestByTag=(e,t)=>{if(!e)return!1;3===e.nodeType&&(e=e.parentElement);let n=e,i=!1;for(;n&&!i&&!n.classList.contains("b3-typography");)0===n.nodeName.indexOf(t)?i=!0:n=n.parentElement;return i&&n};t.hasTopClosestByClassName=(e,n,i=!1)=>{let a=(0,t.hasClosestByClassName)(e,n,i),o=!1,s=!1;for(;a&&(i?"BODY"!==a.tagName:!a.classList.contains("protyle-wysiwyg"))&&!s;)o=(0,t.hasClosestByClassName)(a.parentElement,n,i),o?a=o:s=!0;return a||!1};t.hasTopClosestByTag=(e,n)=>{let i=(0,t.hasClosestByTag)(e,n),a=!1,o=!1;for(;i&&!i.classList.contains("protyle-wysiwyg")&&!o;)a=(0,t.hasClosestByTag)(i.parentElement,n),a?i=a:o=!0;return i||!1};t.hasTopClosestByAttribute=(e,n,i,a=!1)=>{let o=(0,t.hasClosestByAttribute)(e,n,i,a),s=!1,r=!1;for(;o&&!o.classList.contains("protyle-wysiwyg")&&!r;)s=(0,t.hasClosestByAttribute)(o.parentElement,n,i,a),s?o=s:r=!0;return o||!1};t.hasClosestByAttribute=(e,t,n,i=!1)=>{var a;if(!e)return!1;3===e.nodeType&&(e=e.parentElement);let o=e,s=!1;for(;o&&!s&&(i?"BODY"!==o.tagName:!o.classList.contains("protyle-wysiwyg"));)"string"==typeof n&&(null===(a=o.getAttribute(t))||void 0===a?void 0:a.split(" ").includes(n))||"string"!=typeof n&&o.hasAttribute(t)?s=!0:o=o.parentElement;return s&&o};t.hasClosestBlock=e=>{var n;const i=(0,t.hasClosestByAttribute)(e,"data-node-id",null);return!(!i||"BUTTON"===i.tagName||!(null===(n=i.getAttribute("data-type"))||void 0===n?void 0:n.startsWith("Node")))&&i};t.hasClosestByMatchTag=(e,t)=>{if(!e)return!1;3===e.nodeType&&(e=e.parentElement);let n=e,i=!1;for(;n&&!i&&!n.classList.contains("protyle-wysiwyg");)n.nodeName===t?i=!0:n=n.parentElement;return i&&n};t.hasClosestByClassName=(e,t,n=!1)=>{if(!e)return!1;3===e.nodeType&&(e=e.parentElement);let i=e,a=!1;for(;i&&!a&&(n?"BODY"!==i.tagName:!i.classList.contains("protyle-wysiwyg"));)i.classList.contains(t)?a=!0:i=i.parentElement;return a&&i}},6919:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeFoldHeading=void 0;t.removeFoldHeading=e=>{var t;const n=parseInt(e.getAttribute("data-subtype").substr(1));let i=e.nextElementSibling;for(;i;)if(i.classList.contains("sb")){let e=i.firstElementChild;for(;e&&e.classList.contains("sb");)e=e.firstElementChild;if(!("NodeHeading"===e.getAttribute("data-type")&&parseInt(e.getAttribute("data-subtype").substr(1))>n||"NodeHeading"!==e.getAttribute("data-type")))break;{const e=i;i=i.nextElementSibling,e.remove()}}else{const e=parseInt(null===(t=i.getAttribute("data-subtype"))||void 0===t?void 0:t.substr(1));if(i.classList.contains("protyle-attr")||!(isNaN(e)||e>n))break;{const e=i;i=i.nextElementSibling,e.remove()}}}},7422:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.matchHotKey=void 0;const i=n(7954);t.matchHotKey=(e,t)=>{if(""===e)return!1;if(-1===e.indexOf("⇧")&&-1===e.indexOf("⌘")&&-1===e.indexOf("⌥")&&-1===e.indexOf("⌃"))return"⇥"===e&&(e="Tab"),!(t.ctrlKey||(0,i.isCtrl)(t)||t.altKey||t.shiftKey||t.code!==e);const n=e.split("");if((e.endsWith("↑")||e.endsWith("↓")||e.endsWith("→")||e.endsWith("←")||e.endsWith("↩")||e.endsWith("⇥")||e.indexOf("F")>-1)&&n.forEach(((e,t)=>{"↑"===e?n[t]="ArrowUp":"↓"===e?n[t]="ArrowDown":"←"===e?n[t]="ArrowLeft":"→"===e?n[t]="ArrowRight":"⇥"===e?n[t]="Tab":"↩"===e?n[t]="Enter":"F"===e&&(n[t]="F"+n.splice(t+1,1),n[t+1]&&(n[t+1]+=n.splice(t+1,1)))})),e.startsWith("⇧")&&2===n.length)return!(t.ctrlKey||(0,i.isCtrl)(t)||t.altKey||!t.shiftKey||t.key!==n[1]);if(e.startsWith("⌥")){let a=3===n.length?n[2]:n[1];4===n.length&&(a=n[3]);const o=(/^[0-9]$/.test(a)?t.code==="Digit"+a||t.code==="Numpad"+a:t.code==="Key"+a)||t.code===a||"Period"===t.code&&"."===a||"BracketLeft"===t.code&&"["===a||"BracketRight"===t.code&&"]"===a;return!((3===n.length?!(0,i.isCtrl)(t):(0,i.isCtrl)(t))||!t.altKey||t.shiftKey||!o)||(!!(e.startsWith("⌥⇧⌘")&&4===n.length&&t.altKey&&t.shiftKey&&(0,i.isCtrl)(t)&&o)||!!(e.startsWith("⌥⇧")&&3===n.length&&t.altKey&&t.shiftKey&&!(0,i.isCtrl)(t)&&o))}const a=n.length>2&&"⇧"===n[0];let o,s=a?n[2]:n[1];return a&&("-"===s?(s="_",o=189):"="===s?(s="+",o=187):"."===s&&(s=">",o=190)),!(!(0,i.isCtrl)(t)||t.key.toLowerCase()!==s.toLowerCase()&&t.keyCode!==o||t.altKey||!(!a&&!t.shiftKey||a&&t.shiftKey))}},7276:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.insertHTML=void 0;const i=n(3607),a=n(5680),o=n(6075),s=n(6840),r=n(6520),l=n(4640),c=n(8527),u=n(8792);t.insertHTML=(e,t,n=!1,d=!0)=>{var p,h;if(""===e)return;const f=(0,l.getEditorRange)(t.wysiwyg.element);(0,l.fixTableRange)(f),(0,i.hasClosestByAttribute)(f.startContainer,"data-type","NodeTable")&&!n&&(e=t.lute.BlockDOM2InlineBlockDOM(e));let g=(0,i.hasClosestBlock)(f.startContainer);if(g||(g=t.toolbar.range?(0,i.hasClosestBlock)(t.toolbar.range.startContainer):t.wysiwyg.element.firstElementChild),!g)return;let m=g.getAttribute("data-node-id");f.insertNode(document.createElement("wbr"));let y=g.outerHTML;const b=[],v=[];if(""!==f.toString()){const e=(0,i.hasClosestByAttribute)(f.commonAncestorContainer,"data-type","inline-math");e?e.remove():3===f.startContainer.nodeType&&(null===(p=f.startContainer.parentElement.getAttribute("data-type"))||void 0===p?void 0:p.indexOf("block-ref"))>-1?(f.startContainer.parentElement.remove(),f.deleteContents()):f.deleteContents(),f.insertNode(document.createElement("wbr")),b.push({action:"update",id:m,data:y}),v.push({action:"update",id:m,data:g.outerHTML})}const w=document.createElement("template");w.innerHTML=e;const _=(0,r.getContenteditableElement)(g);let E=!1;if(!n&&(3===w.content.firstChild.nodeType||3!==w.content.firstChild.nodeType&&(w.content.firstElementChild.classList.contains("p")&&1===w.content.childElementCount||"DIV"!==w.content.firstElementChild.tagName))){3!==w.content.firstChild.nodeType&&w.content.firstElementChild.classList.contains("p")&&(w.innerHTML=w.content.firstElementChild.firstElementChild.innerHTML.trim());const e=3===f.startContainer.nodeType?f.startContainer.parentElement:f.startContainer;if(d&&"SPAN"===e.tagName&&e.isSameNode(3===f.endContainer.nodeType?f.endContainer.parentElement:f.endContainer)){const t=document.createElement("span"),n=e.attributes;for(let e=0;e<n.length;e++)t.setAttribute(n[e].name,n[e].value);f.setEnd(e.lastChild,e.lastChild.textContent.length),t.append(f.extractContents()),e.after(t),f.setStartBefore(t),f.collapse(!0)}f.insertNode(w.content.cloneNode(!0)),f.collapse(!1),g.setAttribute("updated",a().format("YYYYMMDDHHmmss"));const n=_?_.innerHTML.trimStart():"";if(_&&(n.startsWith("```")||n.startsWith("~~~")||n.startsWith("···")||n.indexOf("\n```")>-1||n.indexOf("\n~~~")>-1||n.indexOf("\n···")>-1))if(-1===n.indexOf("\n")&&n.replace(/·|~/g,"`").replace(/^`{3,}/g,"").indexOf("`")>-1);else{let e=_.innerHTML.replace(/^(~|·|`){3,}/g,"```").replace(/\n(~|·|`){3,}/g,"\n```").trim();e.endsWith("\n```")||(e+="\n```");const t=e.indexOf("```")+3;e=e.substring(0,t)+(window.localStorage["local-codelang"]||"")+e.substring(t),_.innerHTML=e}const r=t.lute.SpinBlockDOM((0,o.removeEmbed)(g)),u=g.firstElementChild.scrollLeft;if(g.outerHTML=r,E=!0,w.innerHTML=r,Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${m}"]`)).find((e=>{if(!(0,i.hasClosestByAttribute)(e,"data-type","NodeBlockQueryEmbed"))return g=e,!0})),1===w.content.childElementCount)return g.classList.contains("table")&&u>0&&(g.firstElementChild.scrollLeft=u),(0,c.mathRender)(g),(0,s.updateTransaction)(t,m,g.outerHTML,y),void(0,l.focusByWbr)(t.wysiwyg.element,f)}const k=(0,i.hasClosestByClassName)(g,"li");if("NodeListItem"===(null===(h=w.content.children[0])||void 0===h?void 0:h.getAttribute("data-type")))if(k)g=k,m=g.getAttribute("data-node-id"),y=g.outerHTML;else{const t=w.content.children[0].getAttribute("data-subtype");w.innerHTML=`<div${"o"===t?' data-marker="1."':""} data-subtype="${t}" data-node-id="${Lute.NewNodeID()}" data-type="NodeList" class="list">${e}<div class="protyle-attr" contenteditable="false">${u.Constants.ZWSP}</div></div>`}let C;Array.from(w.content.children).reverse().forEach((e=>{const t=e.getAttribute("data-node-id");t===m?(v.push({action:"update",data:e.outerHTML,id:t}),b.push({action:"update",id:t,data:y})):(v.push({action:"insert",data:e.outerHTML,id:t,previousID:m}),b.push({action:"delete",id:t})),E||g.after(e),C||(C=e)})),_&&""===_.textContent&&(v.find(((e,t)=>{if(e.id===m)return v.splice(t,1),!0})),v.push({action:"delete",id:m}),b.find(((e,t)=>{if(e.id===m&&"update"===e.action)return b.splice(t,1),!0})),b.push({action:"insert",data:y,id:m,previousID:g.previousElementSibling?g.previousElementSibling.getAttribute("data-node-id"):"",parentID:g.parentElement.getAttribute("data-node-id")||t.block.parentID}),g.remove()),C&&(0,l.focusBlock)(C,void 0,!1);const D=t.wysiwyg.element.querySelector("wbr");D&&D.remove(),(0,s.transaction)(t,v,b)}},2518:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=void 0;t.log=(e,t,n,i)=>{i&&console.log(`${e} - ${n}: ${t}`)}},8291:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.merge=void 0;t.merge=(...e)=>{const n={},i=e=>{for(const i in e)e.hasOwnProperty(i)&&("[object Object]"===Object.prototype.toString.call(e[i])?n[i]=(0,t.merge)(n[i],e[i]):n[i]=e[i])};for(let t=0;t<e.length;t++)i(e[t]);return n}},7010:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enableProtyle=t.disabledProtyle=t.onGet=void 0;const i=n(1754),a=n(8792),o=n(5378),s=n(9173),r=n(6840),l=n(734),c=n(6057),u=n(1248),d=n(7822),p=n(8592),h=n(9039),f=n(4640),g=n(3607),m=n(7870),y=n(3914),b=n(1384);t.onGet=(e,t,n=[],c,u=!1)=>{if(t.wysiwyg.element.removeAttribute("data-top"),1===e.code)return void(t.model?t.model.parent.parent.removeTab(t.model.parent.id,!1,!1):t.element.innerHTML=`<div class="ft__smaller ft__secondary b3-form__space--small" contenteditable="false">${window.siyuan.languages.refExpired}</div>`);if(3===e.code)return;if(t.notebookId=e.data.box,t.path=e.data.path,2===e.code)return t.block.rootID=e.data,void(0,i.lockFile)(e.data);if(e.data.eof&&(n.includes(a.Constants.CB_GET_BEFORE)?t.wysiwyg.element.firstElementChild.setAttribute("data-eof","true"):t.wysiwyg.element.lastElementChild.setAttribute("data-eof","true"),4!==e.data.mode))return;(0,o.hideElements)(["gutter"],t);let d=e.data.content;if(""===d&&!n){const n=(0,s.genEmptyElement)(!1,!1);d=n.outerHTML,(0,r.transaction)(t,[{action:"insert",id:n.getAttribute("data-node-id"),data:d,parentID:e.data.parentID}])}if(t.block.parentID=e.data.parentID,t.block.parent2ID=e.data.parent2ID,t.block.rootID=e.data.rootID,t.block.showAll=!1,t.block.mode=e.data.mode,t.block.blockCount=e.data.blockCount,t.block.childBlockCount=e.data.childBlockCount,t.block.action=n,n.includes(a.Constants.CB_GET_UNCHANGEID)||(t.block.id=e.data.id,t.scroll.lastScrollTop=0,t.contentElement.scrollTop=0,t.wysiwyg.element.setAttribute("data-doc-type",e.data.type)),n.includes(a.Constants.CB_GET_APPEND)||n.includes(a.Constants.CB_GET_BEFORE)||n.includes(a.Constants.CB_GET_HTML))return v({content:d,action:n,unScroll:!1},t),void(0,b.removeLoading)(t);(0,l.fetchPost)("/api/block/getDocInfo",{id:t.block.rootID},(e=>{t.options.render.title?t.title.render(t,e,u):t.options.render.background&&(t.background.render(e.data.ial,t.block.rootID),t.wysiwyg.renderCustom(e.data.ial));let i=c;if(!i&&n.includes(a.Constants.CB_GET_SCROLL)&&e.data.ial.scroll)try{i=JSON.parse(e.data.ial.scroll.replace(/&quot;/g,'"'))}catch(e){i=void 0}v({content:d,action:n,unScroll:!(!i||!i.focusId)},t),i&&"preview"!==t.options.mode&&(0,y.restoreScroll)(t,i),(0,b.removeLoading)(t)}))};const v=(e,n)=>{if(n.contentElement.classList.contains("fn__none"))return;n.block.showAll=e.action.includes(a.Constants.CB_GET_ALL);const i=8*n.contentElement.clientHeight;if(e.action.includes(a.Constants.CB_GET_APPEND)){if(!n.wysiwyg.element.querySelector(".protyle-wysiwyg--select")&&!n.scroll.keepLazyLoad&&n.contentElement.scrollHeight>i){let e=n.wysiwyg.element.firstElementChild;const t=[];for(;n.wysiwyg.element.childElementCount>2&&t&&!n.wysiwyg.element.lastElementChild.isSameNode(e)&&n.contentElement.scrollHeight-e.offsetTop>i;)t.push(e),e=e.nextElementSibling;const a=e.getBoundingClientRect().top;t.forEach((e=>{e.remove()})),n.contentElement.scrollTop=n.contentElement.scrollTop+(e.getBoundingClientRect().top-a),n.scroll.lastScrollTop=n.contentElement.scrollTop,(0,o.hideElements)(["toolbar"],n)}n.wysiwyg.element.insertAdjacentHTML("beforeend",e.content)}else if(e.action.includes(a.Constants.CB_GET_BEFORE)){const t=n.wysiwyg.element.firstElementChild,a=t.getBoundingClientRect().top;if(n.wysiwyg.element.insertAdjacentHTML("afterbegin",e.content),n.contentElement.scrollTop=n.contentElement.scrollTop+(t.getBoundingClientRect().top-a),n.scroll.lastScrollTop=n.contentElement.scrollTop,!n.wysiwyg.element.querySelector(".protyle-wysiwyg--select")&&!n.scroll.keepLazyLoad){for(;n.wysiwyg.element.childElementCount>2&&n.contentElement.scrollHeight>i&&n.wysiwyg.element.lastElementChild.getBoundingClientRect().top>window.innerHeight;)n.wysiwyg.element.lastElementChild.remove();(0,o.hideElements)(["toolbar"],n)}}else n.wysiwyg.element.innerHTML=e.content;if((0,c.processRender)(n.wysiwyg.element),(0,u.highlightRender)(n.wysiwyg.element),(0,d.blockRender)(n,n.wysiwyg.element),e.action.includes(a.Constants.CB_GET_HISTORY))(0,t.disabledProtyle)(n);else{if(n.options.render.scroll&&n.scroll.update(n),e.action.includes(a.Constants.CB_GET_HL)&&!e.unScroll){(0,m.preventScroll)(n);const t=(0,p.highlightById)(n,n.block.id,!0);t&&!e.action.includes(a.Constants.CB_GET_UNUNDO)&&(0,h.pushBack)(n,void 0,t)}else if(e.action.includes(a.Constants.CB_GET_FOCUS)&&!e.unScroll){let t;Array.from(n.wysiwyg.element.querySelectorAll(`[data-node-id="${n.block.id}"]`)).find((e=>{if(!(0,g.hasClosestByAttribute)(e,"data-type","block-render",!0))return t=e,!0})),4===n.block.mode&&((0,m.preventScroll)(n),t=n.wysiwyg.element.lastElementChild),t&&!n.wysiwyg.element.firstElementChild.isSameNode(t)?((0,f.focusBlock)(t),e.action.includes(a.Constants.CB_GET_UNUNDO)||(0,h.pushBack)(n,void 0,t),t.scrollIntoView(),setTimeout((()=>{t.scrollIntoView()}),a.Constants.TIMEOUT_BLOCKLOAD)):((0,f.focusBlock)(n.wysiwyg.element.firstElementChild),e.action.includes(a.Constants.CB_GET_UNUNDO)||(0,h.pushBack)(n,void 0,n.wysiwyg.element.firstElementChild))}else if(e.action.includes(a.Constants.CB_GET_FOCUSFIRST)&&!e.unScroll){const t=n.wysiwyg.element.offsetTop-16;(0,m.preventScroll)(n,t,256),n.contentElement.scrollTop=t,(0,f.focusBlock)(n.wysiwyg.element.firstElementChild),e.action.includes(a.Constants.CB_GET_UNUNDO)||(0,h.pushBack)(n,void 0,n.wysiwyg.element.firstElementChild)}n.disabled?(0,t.disabledProtyle)(n):(0,t.enableProtyle)(n),e.action.includes(a.Constants.CB_GET_SETID)&&(n.block.id=n.block.rootID,n.wysiwyg.element.setAttribute("data-doc-type","NodeDocument")),n.options.defId&&(n.wysiwyg.element.querySelectorAll(`[data-id="${n.options.defId}"]`).forEach((e=>{e.classList.add("def--mark")})),n.options.defId=void 0),n.element.classList.contains("block__edit")&&(n.element.nextElementSibling||n.element.previousElementSibling)&&(n.element.style.minHeight=Math.min(30+n.wysiwyg.element.clientHeight,window.innerHeight/3)+"px"),!n.scroll.element.classList.contains("fn__none")&&"true"!==n.wysiwyg.element.lastElementChild.getAttribute("data-eof")&&n.contentElement.scrollHeight>0&&!e.action.includes(a.Constants.CB_GET_FOCUSFIRST)&&n.contentElement.scrollHeight<=n.contentElement.clientHeight&&(0,l.fetchPost)("/api/filetree/getDoc",{id:n.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),mode:2,k:n.options.key||"",size:a.Constants.SIZE_GET},(e=>{(0,t.onGet)(e,n,[a.Constants.CB_GET_APPEND,a.Constants.CB_GET_UNCHANGEID])})),e.action.includes(a.Constants.CB_GET_APPEND)||e.action.includes(a.Constants.CB_GET_BEFORE)||n.options.render.breadcrumb&&n.breadcrumb.render(n)}};t.disabledProtyle=e=>{(0,o.hideElements)(["gutter","toolbar","select","hint","util"],e),e.disabled=!0,e.wysiwyg.element.setAttribute("contenteditable","false"),e.wysiwyg.element.querySelectorAll('[contenteditable="true"][spellcheck="false"]').forEach((e=>{e.setAttribute("contenteditable","false")}))};t.enableProtyle=e=>{e.disabled=!1,navigator&&navigator.maxTouchPoints>1&&["MacIntel","iPhone"].includes(navigator.platform)||e.wysiwyg.element.setAttribute("contenteditable","true"),e.wysiwyg.element.querySelectorAll('[contenteditable="false"][spellcheck="false"]').forEach((e=>{(0,g.hasClosestByClassName)(e,"protyle-wysiwyg__embed")||e.setAttribute("contenteditable","true")}))}},4705:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.paste=t.pasteText=t.pasteAsPlainText=void 0;const a=n(8792),o=n(2239),s=n(6057),r=n(7954),l=n(3607),c=n(4640),u=n(7822),d=n(5680),p=n(1248),h=n(6840),f=n(734),g=n(3274),m=n(7276),y=n(8592),b=n(6520),v=(e,t)=>{let n=!0;e.options.hint.extend.find((e=>{if(e.key===t)return n=!1,!0})),n&&e.hint.render(e)};t.pasteAsPlainText=e=>i(void 0,void 0,void 0,(function*(){}));t.pasteText=(e,t,n)=>{const i=(0,c.getEditorRange)(e.wysiwyg.element),a=n.getAttribute("data-node-id");if("NodeCodeBlock"===n.getAttribute("data-type")){i.insertNode(document.createElement("wbr"));const o=n.outerHTML;return i.deleteContents(),i.insertNode(document.createTextNode(t.replace(/\r\n|\r|\u2028|\u2029/g,"\n"))),i.collapse(!1),i.insertNode(document.createElement("wbr")),n.outerHTML=e.lute.SpinBlockDOM(n.outerHTML),n=e.wysiwyg.element.querySelector(`[data-node-id="${a}"]`),(0,p.highlightRender)(n),n.setAttribute("updated",d().format("YYYYMMDDHHmmss")),void(0,h.updateTransaction)(e,a,n.outerHTML,o)}""!==i.toString()&&((0,g.isDynamicRef)(t)?t=t.replace(/'.+'\)\)$/,` "${i.toString()}"))`):(0,g.isFileAnnotation)(t)?t=t.replace(/".+">>$/,`"${i.toString()}">>`):e.lute.IsValidLinkDest(t)&&(t=`[${i.toString()}](${t})`)),(0,m.insertHTML)(e.lute.Md2BlockDOM(t),e),(0,u.blockRender)(e,e.wysiwyg.element),(0,s.processRender)(e.wysiwyg.element),(0,p.highlightRender)(e.wysiwyg.element),v(e,t),(0,y.scrollCenter)(e)};t.paste=(e,t)=>i(void 0,void 0,void 0,(function*(){let n,i,w;if(t.stopPropagation(),t.preventDefault(),"clipboardData"in t?(n=t.clipboardData.getData("text/html"),i=t.clipboardData.getData("text/plain"),w=t.clipboardData.files):(n=t.dataTransfer.getData("text/html"),i=t.dataTransfer.getData("text/plain"),"Files"===t.dataTransfer.types[0]&&(w=t.dataTransfer.items)),!n&&!i&&"clipboardData"in t)if("darwin"===window.siyuan.config.system.os);else{const t=yield(0,f.fetchSyncPost)("/api/clipboard/readFilePaths",{});if(t.data.length>0)return(0,o.uploadLocalFiles)(t.data,e),void(0,r.writeText)("")}if(n.replace(/&amp;/g,"&").replace(/<(|\/)(html|body|meta)[^>]*?>/gi,"").trim()!==`<a href="${i}">${i}</a>`&&n.replace(/&amp;/g,"&").replace(/<(|\/)(html|body|meta)[^>]*?>/gi,"").trim()!==`\x3c!--StartFragment--\x3e<a href="${i}">${i}</a>\x3c!--EndFragment--\x3e`||(n=""),!n.endsWith(a.Constants.ZWSP)&&!n.startsWith(a.Constants.ZWSP)){const e=(new DOMParser).parseFromString(n,"text/html");e.body&&e.body.innerHTML&&(n=e.body.innerHTML),n.startsWith("\n\x3c!--StartFragment--\x3e")&&n.endsWith("\x3c!--EndFragment--\x3e\n\n")&&(n=e.body.innerHTML.trim().replace("\x3c!--StartFragment--\x3e","").replace("\x3c!--EndFragment--\x3e",""))}n=Lute.Sanitize(n);const _=(0,l.hasClosestBlock)(t.target);if(!_)return void(w&&w.length>0&&(0,o.uploadFiles)(e,w));e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select, .protyle-wysiwyg--hl").forEach((e=>{e.classList.remove("protyle-wysiwyg--select","protyle-wysiwyg--hl")}));const E=(0,s.processPasteCode)(n,i),k=(0,c.getEditorRange)(e.wysiwyg.element),C=_.getAttribute("data-node-id");if("NodeCodeBlock"===_.getAttribute("data-type")){k.insertNode(document.createElement("wbr"));const t=_.outerHTML;return k.deleteContents(),k.insertNode(document.createTextNode(i.replace(/\r\n|\r|\u2028|\u2029/g,"\n"))),k.collapse(!1),k.insertNode(document.createElement("wbr")),(0,b.getContenteditableElement)(_).removeAttribute("data-render"),(0,p.highlightRender)(_),_.setAttribute("updated",d().format("YYYYMMDDHHmmss")),(0,h.updateTransaction)(e,C,_.outerHTML,t),void setTimeout((()=>{(0,y.scrollCenter)(e,_)}),a.Constants.TIMEOUT_BLOCKLOAD)}if(E)if(E.startsWith('<div data-type="NodeCodeBlock" class="code-block" data-node-id="'))(0,m.insertHTML)(E,e,!0),(0,p.highlightRender)(e.wysiwyg.element);else{const t=document.createElement("wbr");k.insertNode(t);const n=_.outerHTML;t.remove(),k.deleteContents();const i=document.createElement("code");i.textContent=E,k.insertNode(document.createElement("wbr")),k.insertNode(i),(0,h.updateTransaction)(e,_.getAttribute("data-node-id"),_.outerHTML,n),(0,c.focusByWbr)(e.wysiwyg.element,k)}else{let t=!1;if(n.startsWith(a.Constants.ZWSP)||n.endsWith(a.Constants.ZWSP)?t=!0:""!==n.replace("\x3c!--StartFragment--\x3e\x3c!--EndFragment--\x3e","").trim()&&(n=n.replace("\x3c!--StartFragment--\x3e","").replace("\x3c!--EndFragment--\x3e","").trim(),t=!(w&&1===w.length&&n.indexOf("<img")>-1)),t){const t=document.createElement("div");if(n.startsWith(a.Constants.ZWSP)){t.innerHTML=n.substr(1).replace('<meta charset="utf-8">',"");let i=!1;t.querySelectorAll("[data-node-id]").forEach((e=>{e.classList.remove("protyle-wysiwyg--select","protyle-wysiwyg--hl"),i=!0})),_.classList.contains("table")&&(i=!1),(0,m.insertHTML)(t.innerHTML,e,i);const a=e.lute.BlockDOM2StdMd(t.innerHTML);(0,r.writeText)(a),v(e,a)}else{if(!n.endsWith(a.Constants.ZWSP))return t.innerHTML=n,t.querySelectorAll("[style]").forEach((e=>{e.removeAttribute("style")})),t.querySelectorAll("a").forEach((e=>{""===e.innerHTML.trim()&&e.remove()})),void(0,f.fetchPost)("/api/lute/html2BlockDOM",{dom:t.innerHTML},(t=>{(0,m.insertHTML)(t.data,e),e.wysiwyg.element.querySelectorAll('[data-type~="block-ref"]').forEach((e=>{""===e.textContent&&(0,f.fetchPost)("/api/block/getRefText",{id:e.getAttribute("data-id")},(t=>{e.innerHTML=t.data}))})),(0,u.blockRender)(e,e.wysiwyg.element),(0,s.processRender)(e.wysiwyg.element),(0,p.highlightRender)(e.wysiwyg.element),v(e,t.data),(0,y.scrollCenter)(e)}));{t.innerHTML=n.substr(0,n.length-1).replace('<meta charset="utf-8">',""),t.querySelectorAll("[data-node-id]").forEach((e=>{const t=Lute.NewNodeID();e.setAttribute("data-node-id",t),e.classList.remove("protyle-wysiwyg--select","protyle-wysiwyg--hl"),e.getAttribute("updated")&&e.setAttribute("updated",t.split("-")[0])})),t.querySelectorAll('[spellcheck="false"][contenteditable="false"]').forEach((e=>{e.setAttribute("contenteditable","true")}));const i=t.innerHTML;(0,m.insertHTML)(i,e),v(e,i)}}}else if(w&&w.length>0)(0,o.uploadFiles)(e,w);else if(""!==i.trim()&&w&&0===w.length){""!==k.toString()&&((0,g.isDynamicRef)(i)?i=i.replace(/'.*'\)\)$/,` "${Lute.EscapeHTMLStr(k.toString())}"))`):(0,g.isFileAnnotation)(i)?i=i.replace(/".+">>$/,`"${Lute.EscapeHTMLStr(k.toString())}">>`):e.lute.IsValidLinkDest(i)&&(i=`[${k.toString()}](${i})`));const t=e.lute.Md2BlockDOM(i);(0,m.insertHTML)(t,e),v(e,t)}(0,u.blockRender)(e,e.wysiwyg.element),(0,s.processRender)(e.wysiwyg.element),(0,p.highlightRender)(e.wysiwyg.element)}(0,y.scrollCenter)(e)}))},6057:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processRender=t.processPasteCode=void 0;const i=n(4384),a=n(1716),o=n(955),s=n(8527),r=n(2962),l=n(8294),c=n(2813),u=n(708),d=n(8792);t.processPasteCode=(e,t)=>{const n=document.createElement("div");n.innerHTML=e;let i=!1;1===n.childElementCount&&n.lastElementChild.style.fontFamily.indexOf("monospace")>-1&&(i=!0);const a=n.querySelectorAll("pre");if(1===n.childElementCount&&1===a.length&&"protyle-sv"!==a[0].className&&(i=!0),0===e.indexOf('\n<p class="p1">')&&(i=!0),1===n.childElementCount&&"TABLE"===n.firstElementChild.tagName&&n.querySelector(".line-number")&&n.querySelector(".line-content")&&(i=!0),i){const n=t||e;return/\n/.test(n)||1===a.length?`<div data-type="NodeCodeBlock" class="code-block" data-node-id="${Lute.NewNodeID()}"><div class="protyle-action"><span class="protyle-action--first protyle-action__language" contenteditable="false">${localStorage.getItem(d.Constants.LOCAL_CODELANG)||""}</span><span class="fn__flex-1"></span><span class="protyle-icon protyle-icon--first protyle-action__copy"><svg><use xlink:href="#iconCopy"></use></svg></span><span class="protyle-icon protyle-icon--last protyle-action__menu"><svg><use xlink:href="#iconMore"></use></svg></span></div><div contenteditable="true" spellcheck="false">${n.replace(/&/g,"&amp;").replace(/</g,"&lt;")}<wbr></div><div class="protyle-attr" contenteditable="false">${d.Constants.ZWSP}</div></div>`:n}return!1};t.processRender=e=>{const t=e.getAttribute("data-subtype");if(!["abc","plantuml","mermaid","flowchart","echarts","mindmap","graphviz","math"].includes(t))return(0,i.abcRender)(e),(0,u.plantumlRender)(e),(0,r.mermaidRender)(e),(0,c.flowchartRender)(e),(0,a.chartRender)(e),(0,l.mindmapRender)(e),(0,o.graphvizRender)(e),void(0,s.mathRender)(e);"abc"===t?(0,i.abcRender)(e):"plantuml"===t?(0,u.plantumlRender)(e):"mermaid"===t?(0,r.mermaidRender)(e):"flowchart"===t?(0,c.flowchartRender)(e):"echarts"===t?(0,a.chartRender)(e):"mindmap"===t?(0,l.mindmapRender)(e):"graphviz"===t?(0,o.graphvizRender)(e):"math"===t&&(0,s.mathRender)(e)}},5961:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reloadProtyle=void 0;const i=n(1384),a=n(734),o=n(8792),s=n(7010),r=n(3914);t.reloadProtyle=e=>{window.siyuan.config.editor.displayBookmarkIcon?e.wysiwyg.element.classList.add("protyle-wysiwyg--attr"):e.wysiwyg.element.classList.remove("protyle-wysiwyg--attr"),e.lute.SetProtyleMarkNetImg(window.siyuan.config.editor.displayNetImgMark),(0,i.addLoading)(e),(0,a.fetchPost)("/api/filetree/getDoc",{id:e.block.showAll?e.block.id:e.block.rootID,mode:0,size:e.block.showAll?o.Constants.SIZE_GET_MAX:o.Constants.SIZE_GET},(t=>{(0,s.onGet)(t,e,e.block.showAll?[o.Constants.CB_GET_ALL,o.Constants.CB_GET_FOCUS]:[o.Constants.CB_GET_FOCUS],(0,r.saveScroll)(e,!0),!0)}))}},4640:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.focusSideBlock=t.focusBlock=t.focusByRange=t.focusByWbr=t.focusByOffset=t.setFirstNodeRange=t.setLastNodeRange=t.getSelectionOffset=t.getSelectionPosition=t.getEditorRange=t.selectAll=t.fixTableRange=void 0;const i=n(6520),a=n(3607),o=n(7731);t.fixTableRange=e=>{const t=(0,a.hasClosestByAttribute)(e.startContainer,"data-type","NodeTable");if(""!==e.toString()&&t&&3!==e.commonAncestorContainer.nodeType){const n=e.commonAncestorContainer.tagName;if("TH"!==n&&"TD"!==n){const n=(0,a.hasClosestByMatchTag)(e.startContainer,"TD")||(0,a.hasClosestByMatchTag)(e.startContainer,"TH"),i=(0,a.hasClosestByMatchTag)(e.endContainer,"TD")||(0,a.hasClosestByMatchTag)(e.endContainer,"TH");if(n||i){if(n&&!n.contains(e.endContainer)){const t=e.cloneRange();e.setEnd(n.lastChild,n.lastChild.textContent.length),""===e.toString()&&i&&(e.setStart(i.firstChild,0),e.setEnd(t.endContainer,t.endOffset))}}else{const n=t.querySelector("th")||t.querySelector("td");e.setStart(n.firstChild,0),e.setEnd(n.lastChild,n.lastChild.textContent.length)}}}};t.selectAll=(e,n,s)=>{const r=(0,i.getContenteditableElement)(n);if(r){let i;if("TABLE"===r.tagName){const r=(0,a.hasClosestByMatchTag)(s.startContainer,"TD")||(0,a.hasClosestByMatchTag)(s.startContainer,"TH");if(r&&(i=(0,t.getSelectionOffset)(r,n,s),0!==i.start||i.end!==r.textContent.length))return s.setStart(r.firstChild,0),s.setEndAfter(r.lastChild),e.toolbar.render(e,s),(0,o.countSelectWord)(s),!0}else if(i=(0,t.getSelectionOffset)(r,n,s),0!==i.start||i.end!==r.textContent.length){let t=r.firstChild;for(;t;)if(3===t.nodeType){if(""!==t.textContent){s.setStart(t,0);break}t=t.nextSibling}else{if(t.classList.contains("render-node")||t.classList.contains("img")){s.setStartBefore(t);break}t=t.firstChild}let n=r.lastChild;for(;n;)if(3===n.nodeType){if(""!==n.textContent){s.setEnd(n,n.textContent.length);break}n=n.previousSibling}else{if(n.classList.contains("render-node")||n.classList.contains("img")||"BR"===n.tagName){s.setEndAfter(n);break}n=n.lastChild}return e.toolbar.render(e,s),(0,o.countSelectWord)(s),!0}}s.collapse(!0);const l=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(e.wysiwyg.element.childElementCount===l.length&&l[0].parentElement.isSameNode(e.wysiwyg.element))return!0;l.forEach((e=>{e.classList.remove("protyle-wysiwyg--select")}));const c=[];Array.from(e.wysiwyg.element.children).forEach((e=>{e.classList.add("protyle-wysiwyg--select"),c.push(e.getAttribute("data-node-id"))})),(0,o.countBlockWord)(c)};t.getEditorRange=e=>{let t,n;return getSelection().rangeCount>0&&(t=getSelection().getRangeAt(0),e.isSameNode(t.startContainer)||e.contains(t.startContainer))||(e.focus({preventScroll:!0}),e.classList.contains("table")?n=e.querySelector("th")||e.querySelector("td"):(n=(0,i.getContenteditableElement)(e),n?"TABLE"===n.tagName&&(n=n.querySelector("th")||e.querySelector("td")):n=e),t=n.ownerDocument.createRange(),t.setStart(n||e,0),t.collapse(!0)),t};t.getSelectionPosition=(e,n)=>{if(n||(n=(0,t.getEditorRange)(e)),!e.contains(n.startContainer))return{left:0,top:0};let i;if(0===n.getClientRects().length)if(3===n.startContainer.nodeType){const e=n.startContainer.parentElement;if(!(e&&e.getClientRects().length>0))return{left:0,top:0};i=e.getClientRects()[0]}else{const e=n.startContainer.children;if(e[n.startOffset]&&e[n.startOffset].getClientRects().length>0)i=e[n.startOffset].getClientRects()[0];else if(n.startContainer.childNodes.length>0){const e=n.cloneRange();n.selectNode(n.startContainer.childNodes[Math.max(0,n.startOffset-1)]),i=n.getClientRects()[0],n.setEnd(e.endContainer,e.endOffset),n.setStart(e.startContainer,e.startOffset)}else i=n.startContainer.getClientRects()[0];if(!i){let e=n.startContainer.childNodes[n.startOffset];for(e||(e=n.startContainer.childNodes[n.startOffset-1]);!e.getClientRects||e.getClientRects&&0===e.getClientRects().length;)e=e.parentElement;i=e.getClientRects()[0]}}else i=n.getBoundingClientRect();return{left:i.left,top:i.top}};function s(e,t,n,i){if(!t)return!1;if(n(t))return!0;for(let e=0,i=t.childNodes.length;e<i;e++)if(s(t,t.childNodes[e],n,!0))return!0;if(!i){let i=t;for(;i&&i!==e;){let t=i.nextSibling;for(;t;){if(s(e,t,n,!0))return!0;t=t.nextSibling}i=i.parentNode}}return!1}t.getSelectionOffset=(e,t,n)=>{const i={end:0,start:0};if(!n){if(0===getSelection().rangeCount)return i;n=window.getSelection().getRangeAt(0)}if(t&&!((e,t)=>{if(!t){if(0===getSelection().rangeCount)return!1;t=getSelection().getRangeAt(0)}const n=t.commonAncestorContainer;return e.isEqualNode(n)||e.contains(n)})(t,n))return i;const a=n.cloneRange();return e.childNodes[0]&&e.childNodes[0].childNodes[0]?a.setStart(e.childNodes[0].childNodes[0],0):a.selectNodeContents(e),a.setEnd(n.startContainer,n.startOffset),i.start=a.toString().length,i.end=i.start+n.toString().length,i};t.setLastNodeRange=(e,t,n=!0)=>{if(!e)return t;let i=e.lastChild;for(;i&&3!==i.nodeType;)i=i.lastChild;return i?(n?t.setStart(i,i.textContent.length):t.setEnd(i,i.textContent.length),t):(t.selectNodeContents(e),t)};t.setFirstNodeRange=(e,t)=>{if(!e)return t;let n=e.firstChild;for(;n&&3!==n.nodeType;)n=n.firstChild;return n?(t.setStart(n,0),t):(t.selectNodeContents(e),t)};t.focusByOffset=(e,n,a)=>{if(!e)return!1;const o=(0,i.getContenteditableElement)(e);if(o)e=o;else if((0,i.isNotEditBlock)(e))return(0,t.focusBlock)(e);let r,l;s(e,e.firstChild,(e=>{if(e.nodeType===Node.TEXT_NODE){const t=e.data.length;return n<=t?(r=e,!0):(n-=t,a-=t,!1)}})),r&&s(e,r,(e=>{if(e.nodeType===Node.TEXT_NODE){const t=e.data.length;return a<=t?(l=e,!0):(a-=t,!1)}}));const c=document.createRange();return r?n<r.data.length?c.setStart(r,n):c.setStartAfter(r):0===n?c.setStart(e,0):(0,t.setLastNodeRange)((0,i.getContenteditableElement)(e),c),l?a<l.data.length?c.setEnd(l,a):c.setEndAfter(l):0===a?c.setEnd(e,0):(0,t.setLastNodeRange)((0,i.getContenteditableElement)(e),c,!1),(0,t.focusByRange)(c),c};t.focusByWbr=(e,n)=>{var a;const o=e.querySelectorAll("wbr");if(0===o.length)return;o.forEach(((e,t)=>{0!==t&&e.remove()}));const s=o[0];if(s.previousElementSibling){const e=(0,i.hasPreviousSibling)(s);e&&s.previousElementSibling.isSameNode(e)?3===(null===(a=s.previousElementSibling.lastChild)||void 0===a?void 0:a.nodeType)?n.setStart(s.previousElementSibling.lastChild,s.previousElementSibling.lastChild.textContent.length):3!==e.nodeType&&e.classList.contains("img")?n.setStartAfter(e):n.setStartBefore(s):n.setStart(s.previousSibling,s.previousSibling.textContent.length)}else s.previousSibling?n.setStart(s.previousSibling,s.previousSibling.textContent.length):s.nextSibling?3===s.nextSibling.nodeType?n.setStart(s.nextSibling,0):n.setStartAfter(s):n.setStart(s.parentElement,0);n.collapse(!0),s.remove(),(0,t.focusByRange)(n)};t.focusByRange=e=>{if(!e)return;const t=window.getSelection();t.removeAllRanges(),t.addRange(e)};t.focusBlock=(e,n,a=!0)=>{var o,s,r;if(!e)return!1;if(e.classList.contains("render-node")||e.classList.contains("iframe")||e.classList.contains("hr")){const n=document.createRange(),i=e.getAttribute("data-type");let a=!1;return"NodeThematicBreak"===i?(n.selectNodeContents(e.firstElementChild),a=!0):"NodeBlockQueryEmbed"===i?((null===(o=e.lastElementChild.previousElementSibling)||void 0===o?void 0:o.firstChild)?(n.selectNodeContents(e.lastElementChild.previousElementSibling.firstChild),n.collapse(!0)):(n.selectNodeContents(e),n.collapse(!0)),a=!0):["NodeMathBlock","NodeHTMLBlock"].includes(i)?((null===(r=null===(s=e.lastElementChild.previousElementSibling)||void 0===s?void 0:s.lastElementChild)||void 0===r?void 0:r.firstChild)?(n.selectNodeContents(e.lastElementChild.previousElementSibling.lastElementChild.firstChild),n.collapse(!0)):e.lastElementChild.previousElementSibling&&(n.selectNodeContents(e.lastElementChild.previousElementSibling),n.collapse(!0)),a=!0):"NodeIFrame"===i||"NodeWidget"===i?(n.setStart(e,0),a=!0):"NodeVideo"===i?(n.setStart(e.firstElementChild,0),a=!0):"NodeAudio"===i?(n.setStart(e.firstElementChild.lastChild,0),a=!0):"NodeCodeBlock"===i&&(n.selectNodeContents(e),n.collapse(!0),a=!0),a?((0,t.focusByRange)(n),n):((0,t.focusSideBlock)(e),!1)}let l;if(a?l=(0,i.getContenteditableElement)(e):Array.from(e.querySelectorAll('[contenteditable="true"]')).reverse().find((e=>{if(e.getBoundingClientRect().width>0)return l=e,!0})),l){if("TABLE"===l.tagName)if(a)l=l.querySelector("th, td");else{const e=l.querySelectorAll("th, td");l=e[e.length-1]}const e=(0,t.getEditorRange)(l);return e.selectNodeContents(l),e.collapse(a),(0,t.focusByRange)(e),e}return n&&n.focus(),!1};t.focusSideBlock=e=>{if(e.getAttribute("data-node-id")){let n,a;return e.nextElementSibling&&!e.nextElementSibling.classList.contains("protyle-attr")?(a=!0,n=(0,i.getNextBlock)(e)):e.previousElementSibling&&(a=!1,n=(0,i.getPreviousBlock)(e)),n||(n=e),void(0,t.focusBlock)(n,void 0,a)}const n=(0,t.getEditorRange)(e);e.nextSibling?(n.selectNodeContents(e.nextSibling),n.collapse(!0)):e.previousSibling&&(n.selectNodeContents(e.previousSibling),n.collapse(!1)),(0,t.focusByRange)(n)}},2319:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setEditMode=void 0;const i=n(1384),a=n(5378);t.setEditMode=(e,t)=>{var n,o,s,r;if("preview"===t){if(!e.preview.element.classList.contains("fn__none"))return;e.preview.element.classList.remove("fn__none"),e.contentElement.classList.add("fn__none"),null===(n=e.scroll)||void 0===n||n.element.classList.add("fn__none"),e.options.render.breadcrumb&&(null===(o=e.breadcrumb)||void 0===o||o.element.classList.add("fn__none")),e.preview.render(e)}else if("wysiwyg"===t){if((0,i.setPadding)(e),!e.contentElement.classList.contains("fn__none"))return;e.preview.element.classList.add("fn__none"),e.contentElement.classList.remove("fn__none"),e.options.render.scroll&&(null===(s=e.scroll)||void 0===s||s.element.classList.remove("fn__none")),e.options.render.breadcrumb&&(null===(r=e.breadcrumb)||void 0===r||r.element.classList.remove("fn__none"))}(0,a.hideElements)(["gutter","toolbar","select","hint","util"],e)}},2287:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fixTable=t.moveColumnToRight=t.moveColumnToLeft=t.moveRowToDown=t.moveRowToUp=t.deleteColumn=t.deleteRow=t.insertColumn=t.insertRowAbove=t.insertRow=t.setTableAlign=t.getColIndex=void 0;const i=n(6840),a=n(4640),o=n(3607),s=n(7422),r=n(7954),l=n(8592);t.getColIndex=e=>{let t=e.previousElementSibling,n=0;for(;t;)n++,t=t.previousElementSibling;return n};const c=(e,t,n=!0)=>{let i=e.previousElementSibling;return i||(i=e.parentElement.previousElementSibling?e.parentElement.previousElementSibling.lastElementChild:"TBODY"===e.parentElement.parentElement.tagName&&e.parentElement.parentElement.previousElementSibling?e.parentElement.parentElement.previousElementSibling.lastElementChild.lastElementChild:null),i&&(t.selectNodeContents(i),n||t.collapse(!1),(0,a.focusByRange)(t)),i};t.setTableAlign=(e,t,n,a,o)=>{o.insertNode(document.createElement("wbr"));const s=n.outerHTML,r=n.querySelector("table"),l=r.rows[0].cells.length,c=r.rows.length,u=[];for(let e=0;e<c;e++){for(let n=0;n<l;n++)r.rows[e].cells[n].isSameNode(t[u.length])&&u.push(n);if(u.length>0)break}for(let e=0;e<c;e++)u.forEach((t=>{r.rows[e].cells[t].setAttribute("align",a)}));(0,i.updateTransaction)(e,n.getAttribute("data-node-id"),n.outerHTML,s),n.querySelector("wbr").remove()};t.insertRow=(e,t,n,a)=>{t.insertNode(document.createElement("wbr"));const o=a.outerHTML;let s="";for(let e=0;e<n.parentElement.childElementCount;e++)s+=`<td align="${n.parentElement.children[e].getAttribute("align")||""}"> </td>`;if("TH"===n.tagName){const e=a.querySelector("tbody");e?e.insertAdjacentHTML("afterbegin",`<tr>${s}</tr>`):n.parentElement.parentElement.insertAdjacentHTML("afterend",`<tbody><tr>${s}</tr></tbody>`)}else n.parentElement.insertAdjacentHTML("afterend",`<tr>${s}</tr>`);(0,i.updateTransaction)(e,a.getAttribute("data-node-id"),a.outerHTML,o),a.querySelector("wbr").remove()};t.insertRowAbove=(e,t,n,o)=>{t.insertNode(document.createElement("wbr"));const s=o.outerHTML;let r="",l=!1;for(let e=0;e<n.parentElement.childElementCount;e++){const t=n.parentElement.children[e];"fn__none"===t.className&&(l=!0),"TH"===n.tagName?r+=`<th class="${t.className}" colspan="${t.colSpan}"  align="${t.getAttribute("align")}"> </th>`:r+=`<td class="${t.className}" colspan="${t.colSpan}" align="${t.getAttribute("align")}"> </td>`}if(l){let e=n.parentElement.previousElementSibling,t=1;for(;e;)t++,Array.from(e.children).forEach((e=>{e.rowSpan>=t&&e.rowSpan>1&&(e.rowSpan=e.rowSpan+1)})),e=e.previousElementSibling}"THEAD"!==n.parentElement.parentElement.tagName||n.parentElement.previousElementSibling?n.parentElement.insertAdjacentHTML("beforebegin",`<tr>${r}</tr>`):(n.parentElement.parentElement.insertAdjacentHTML("beforebegin",`<thead><tr>${r}</tr></thead>`),n.parentElement.parentElement.nextElementSibling.insertAdjacentHTML("afterbegin",n.parentElement.parentElement.innerHTML),n.parentElement.parentElement.remove()),(0,i.updateTransaction)(e,o.getAttribute("data-node-id"),o.outerHTML,s),(0,a.focusByWbr)(e.wysiwyg.element,t)};t.insertColumn=(e,n,a,o,s)=>{s.insertNode(document.createElement("wbr"));const r=n.outerHTML,l=(0,t.getColIndex)(a),c=n.querySelector("table");for(let e=0;e<c.rows.length;e++)0===e?c.rows[e].cells[l].insertAdjacentHTML(o,"<th></th>"):c.rows[e].cells[l].insertAdjacentHTML(o,"<td></td>");c.querySelectorAll("col")[l].insertAdjacentHTML(o,"<col>"),(0,i.updateTransaction)(e,n.getAttribute("data-node-id"),n.outerHTML,r),n.querySelector("wbr").remove()};t.deleteRow=(e,t,n,o)=>{if("THEAD"!==n.parentElement.parentElement.tagName){t.insertNode(document.createElement("wbr"));const s=o.outerHTML,r=n.parentElement.parentElement;n.parentElement.previousElementSibling?t.selectNodeContents(n.parentElement.previousElementSibling.lastElementChild):t.selectNodeContents(r.previousElementSibling.lastElementChild.lastElementChild),1===r.childElementCount?r.remove():n.parentElement.remove(),t.collapse(!1),t.insertNode(document.createElement("wbr")),(0,i.updateTransaction)(e,o.getAttribute("data-node-id"),o.outerHTML,s),(0,a.focusByWbr)(o,t)}};t.deleteColumn=(e,n,o,s)=>{var r;n.insertNode(document.createElement("wbr"));const l=o.outerHTML,c=(0,t.getColIndex)(s);(s.previousElementSibling||s.nextElementSibling)&&(n.selectNodeContents(s.previousElementSibling||s.nextElementSibling),n.collapse(!0),n.insertNode(document.createElement("wbr")));const u=o.querySelector("table");for(let e=0;e<u.rows.length;e++){const t=u.rows[e].cells;if(1===t.length){u.remove();break}t[c].remove()}null===(r=o.querySelectorAll("col")[c])||void 0===r||r.remove(),(0,i.updateTransaction)(e,o.getAttribute("data-node-id"),o.outerHTML,l),(0,a.focusByWbr)(o,n)};t.moveRowToUp=(e,t,n,o)=>{const s=n.parentElement;if("THEAD"===s.parentElement.tagName)return;t.insertNode(document.createElement("wbr"));const r=o.outerHTML;if(s.previousElementSibling)s.after(s.previousElementSibling);else{const e=s.parentElement.previousElementSibling.firstElementChild;e.querySelectorAll("th").forEach((e=>{const t=document.createElement("td");t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)})),s.querySelectorAll("td").forEach((e=>{const t=document.createElement("th");t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)})),s.after(e),s.parentElement.previousElementSibling.append(s)}(0,i.updateTransaction)(e,o.getAttribute("data-node-id"),o.outerHTML,r),(0,a.focusByWbr)(o,t)};t.moveRowToDown=(e,t,n,o)=>{const s=n.parentElement;if("TBODY"===s.parentElement.tagName&&!s.nextElementSibling||"THEAD"===s.parentElement.tagName&&!s.parentElement.nextElementSibling)return;t.insertNode(document.createElement("wbr"));const r=o.outerHTML;if(s.nextElementSibling)s.before(s.nextElementSibling);else{const e=s.parentElement.nextElementSibling.firstElementChild;e.querySelectorAll("td").forEach((e=>{const t=document.createElement("th");t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)})),s.querySelectorAll("th").forEach((e=>{const t=document.createElement("td");t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)})),s.after(e),s.parentElement.nextElementSibling.insertAdjacentElement("afterbegin",s)}(0,i.updateTransaction)(e,o.getAttribute("data-node-id"),o.outerHTML,r),(0,a.focusByWbr)(o,t)};t.moveColumnToLeft=(e,t,n,o)=>{if(!n.previousElementSibling)return;t.insertNode(document.createElement("wbr"));const s=o.outerHTML;let r=0;Array.from(n.parentElement.children).find(((e,t)=>{if(n.isSameNode(e))return r=t,!0})),o.querySelectorAll("tr").forEach((e=>{e.cells[r].after(e.cells[r-1])}));const l=o.querySelectorAll("col");l[r].after(l[r-1]),(0,i.updateTransaction)(e,o.getAttribute("data-node-id"),o.outerHTML,s),(0,a.focusByWbr)(o,t)};t.moveColumnToRight=(e,t,n,o)=>{if(!n.nextElementSibling)return;t.insertNode(document.createElement("wbr"));const s=o.outerHTML;let r=0;Array.from(n.parentElement.children).find(((e,t)=>{if(n.isSameNode(e))return r=t,!0})),o.querySelectorAll("tr").forEach((e=>{e.cells[r].before(e.cells[r+1])}));const l=o.querySelectorAll("col");l[r].before(l[r+1]),(0,i.updateTransaction)(e,o.getAttribute("data-node-id"),o.outerHTML,s),(0,a.focusByWbr)(o,t)};t.fixTable=(e,n,i)=>{var u,d,p;const h=(0,o.hasClosestByMatchTag)(i.startContainer,"TD")||(0,o.hasClosestByMatchTag)(i.startContainer,"TH"),f=(0,o.hasClosestBlock)(i.startContainer);if(!h||!f)return!1;if(f.classList.contains("protyle-wysiwyg--select"))return!1;if("Tab"===n.key&&!n.ctrlKey){if(n.shiftKey)return c(h,i),n.preventDefault(),!0;let a=h.nextElementSibling;return a||(a=h.parentElement.nextElementSibling?h.parentElement.nextElementSibling.firstElementChild:"THEAD"===h.parentElement.parentElement.tagName&&h.parentElement.parentElement.nextElementSibling?h.parentElement.parentElement.nextElementSibling.firstElementChild.firstElementChild:null),a?i.selectNodeContents(a):((0,t.insertRow)(e,i,h,f),i.selectNodeContents(f.querySelector("tbody").lastElementChild.firstElementChild)),n.preventDefault(),!0}if("ArrowUp"===n.key&&!(0,r.isCtrl)(n)&&!n.shiftKey&&!n.altKey){const a=i.startContainer;let o;for(o=3===a.nodeType||"TH"!==a.tagName&&"TD"!==a.tagName?a.previousElementSibling:null===(u=a.childNodes[Math.max(0,i.startOffset-1)])||void 0===u?void 0:u.previousElementSibling;o;){if("BR"===o.tagName)return!1;o=o.previousElementSibling}const s=h.parentElement;let r=s.previousElementSibling;return r||(r=s.parentElement.previousElementSibling.lastElementChild),r&&"COL"!==(null==r?void 0:r.tagName)?(i.selectNodeContents(r.cells[(0,t.getColIndex)(h)]),i.collapse(!1),(0,l.scrollCenter)(e),n.preventDefault(),!0):!1}if("ArrowDown"===n.key&&!(0,r.isCtrl)(n)&&!n.shiftKey&&!n.altKey){const a=i.endContainer;let o;for(o=3===a.nodeType||"TH"!==a.tagName&&"TD"!==a.tagName?a.nextElementSibling:null===(d=a.childNodes[Math.max(0,i.endOffset-1)])||void 0===d?void 0:d.nextElementSibling;o;){if("BR"===o.tagName)return!1;o=o.nextElementSibling}const s=h.parentElement;if(!s.nextElementSibling&&"TBODY"===s.parentElement.tagName||"THEAD"===s.parentElement.tagName&&!s.parentElement.nextElementSibling)return!1;let r=s.nextElementSibling;return r||(r=s.parentElement.nextElementSibling.firstChild),r?(i.selectNodeContents(r.cells[(0,t.getColIndex)(h)]),i.collapse(!0),(0,l.scrollCenter)(e),n.preventDefault(),!0):!1}if(!(0,r.isCtrl)(n)&&!n.shiftKey&&!n.altKey&&"Backspace"===n.key&&0===(0,a.getSelectionOffset)(h,e.wysiwyg.element,i).start&&""===i.toString()&&(0===i.startOffset||1===i.startOffset&&1===h.querySelectorAll("br").length)){return!c(h,i,!1)&&f.previousElementSibling&&(0,a.focusBlock)(f.previousElementSibling,void 0,!1),(0,l.scrollCenter)(e),n.preventDefault(),!0}if((0,s.matchHotKey)(window.siyuan.config.keymap.editor.general.alignLeft.custom,n))return(0,t.setTableAlign)(e,[h],f,"left",i),n.preventDefault(),!0;if((0,s.matchHotKey)(window.siyuan.config.keymap.editor.general.alignCenter.custom,n))return(0,t.setTableAlign)(e,[h],f,"center",i),n.preventDefault(),!0;if((0,s.matchHotKey)(window.siyuan.config.keymap.editor.general.alignRight.custom,n))return(0,t.setTableAlign)(e,[h],f,"right",i),n.preventDefault(),!0;const g=f.querySelector("table"),m=h.parentElement.querySelector(".fn__none");let y=!1,b=!1;Array.from(h.parentElement.children).forEach((e=>{e.colSpan>1&&(y=!0),e.rowSpan>1&&(b=!0)}));let v=!1,w=!1,_=!1,E=h.parentElement.previousElementSibling;E||"TBODY"!==h.parentElement.parentElement.tagName||(E=g.querySelector("thead").lastElementChild),E&&(v=E.querySelector(".fn__none"),Array.from(E.children).forEach((e=>{e.colSpan>1&&(w=!0),e.rowSpan>1&&(_=!0)})));let k=!1,C=!1,D=!1,x=h.parentElement.nextElementSibling;x||"THEAD"!==h.parentElement.parentElement.tagName||(x=null===(p=g.querySelector("tbody"))||void 0===p?void 0:p.firstElementChild),x&&(k=x.querySelector(".fn__none"),Array.from(x.children).forEach((e=>{e.colSpan>1&&(C=!0),e.rowSpan>1&&(D=!0)})));const S=(0,t.getColIndex)(h);let A=!0;Array.from(g.rows).find((e=>{const t=e.cells[S];if(t.classList.contains("fn__none")||t.colSpan>1||t.rowSpan>1)return A=!1,!0}));let L=!0;Array.from(g.rows).find((e=>{const t=e.cells[S+1];if(t&&(t.classList.contains("fn__none")||t.colSpan>1||t.rowSpan>1))return L=!1,!0}));let T=!0;return Array.from(g.rows).find((e=>{const t=e.cells[S-1];if(t&&(t.classList.contains("fn__none")||t.colSpan>1||t.rowSpan>1))return T=!1,!0})),(0,s.matchHotKey)(window.siyuan.config.keymap.editor.table.moveToUp.custom,n)?((!m||m&&!b&&y)&&(!v||v&&!_&&w)&&(0,t.moveRowToUp)(e,i,h,f),n.preventDefault(),!0):(0,s.matchHotKey)(window.siyuan.config.keymap.editor.table.moveToDown.custom,n)?((!m||m&&!b&&y)&&(!k||k&&!D&&C)&&(0,t.moveRowToDown)(e,i,h,f),n.preventDefault(),!0):(0,s.matchHotKey)(window.siyuan.config.keymap.editor.table.moveToLeft.custom,n)?(A&&T&&(0,t.moveColumnToLeft)(e,i,h,f),n.preventDefault(),!0):(0,s.matchHotKey)(window.siyuan.config.keymap.editor.table.moveToRight.custom,n)?(A&&L&&(0,t.moveColumnToRight)(e,i,h,f),n.preventDefault(),!0):(0,s.matchHotKey)(window.siyuan.config.keymap.editor.table.insertRowAbove.custom,n)?((0,t.insertRowAbove)(e,i,h,f),n.preventDefault(),n.stopPropagation(),!0):(0,s.matchHotKey)(window.siyuan.config.keymap.editor.table.insertRowBelow.custom,n)?((!k||k&&!D&&C)&&(0,t.insertRow)(e,i,h,f),n.preventDefault(),!0):(0,s.matchHotKey)(window.siyuan.config.keymap.editor.table.insertColumnLeft.custom,n)?((A||T)&&(0,t.insertColumn)(e,f,h,"beforebegin",i),n.preventDefault(),!0):(0,s.matchHotKey)(window.siyuan.config.keymap.editor.table.insertColumnRight.custom,n)?((A||L)&&(0,t.insertColumn)(e,f,h,"afterend",i),n.preventDefault(),!0):(0,s.matchHotKey)(window.siyuan.config.keymap.editor.table["delete-row"].custom,n)?((!m&&!b||m&&!b&&y)&&(0,t.deleteRow)(e,i,h,f),n.preventDefault(),!0):(0,s.matchHotKey)(window.siyuan.config.keymap.editor.table["delete-column"].custom,n)?(A&&(0,t.deleteColumn)(e,i,f,h),n.preventDefault(),!0):void 0}},3429:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commonHotkey=void 0;const i=n(7422),a=n(734),o=n(7954),s=n(4640),r=n(4293),l=n(1384),c=n(6501),u=n(5961);t.commonHotkey=(e,t)=>{const n=t.target;if((0,i.matchHotKey)(window.siyuan.config.keymap.editor.general.copyHPath.custom,t))return(0,a.fetchPost)("/api/filetree/getHPathByID",{id:e.block.rootID},(e=>{(0,o.writeText)(e.data)})),t.preventDefault(),t.stopPropagation(),!0;if((0,i.matchHotKey)(window.siyuan.config.keymap.editor.general.refresh.custom,t))return(0,u.reloadProtyle)(e),t.preventDefault(),t.stopPropagation(),!0;if((0,i.matchHotKey)(window.siyuan.config.keymap.editor.general.fullscreen.custom,t))return(0,r.fullscreen)(e.element),(0,l.setPadding)(e),t.preventDefault(),t.stopPropagation(),!0;if((0,i.matchHotKey)(window.siyuan.config.keymap.editor.general.netImg2LocalAsset.custom,t))return(0,r.netImg2LocalAssets)(e),t.preventDefault(),void t.stopPropagation();if(e.model){if((0,i.matchHotKey)(window.siyuan.config.keymap.editor.general.backlinks.custom,t))return t.preventDefault(),t.stopPropagation(),(0,c.openBacklink)(e),!0;if((0,i.matchHotKey)(window.siyuan.config.keymap.editor.general.graphView.custom,t))return t.preventDefault(),t.stopPropagation(),(0,c.openGraph)(e),!0;if((0,i.matchHotKey)(window.siyuan.config.keymap.editor.general.outline.custom,t)){t.preventDefault(),t.stopPropagation();const i=(0,s.getSelectionOffset)(n);return(0,c.openOutline)(e),(0,s.focusByOffset)(n,i.start,i.end),!0}}}},8835:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enter=void 0;const i=n(9173),a=n(4640),o=n(6520),s=n(6840),r=n(4921),l=n(3607),c=n(1248),u=n(8792),d=n(8592);t.enter=(e,t,n)=>{var h,f;const g=(0,o.isNotEditBlock)(e);if(!g&&e.classList.contains("protyle-wysiwyg--select"))return(0,a.setLastNodeRange)((0,o.getContenteditableElement)(e),t,!1),t.collapse(!1),void e.classList.remove("protyle-wysiwyg--select");if(g){if(e.parentElement.classList.contains("li")){const i=e.parentElement.parentElement.outerHTML,o=(0,r.genListItemElement)(e.parentElement,0,!0);return e.parentElement.insertAdjacentElement("afterend",o),(0,s.updateTransaction)(n,e.parentElement.parentElement.getAttribute("data-node-id"),e.parentElement.parentElement.outerHTML,i),(0,a.focusByWbr)(o,t),p(o),void(0,d.scrollCenter)(n)}return e.classList.contains("hr")?void(0,i.insertEmptyBlock)(n,"afterend"):void(e.classList.contains("protyle-wysiwyg--select")&&e.classList.contains("render-node")?n.toolbar.showRender(n,e):(0,i.insertEmptyBlock)(n,"afterend"))}const m=(0,o.getContenteditableElement)(e);m.querySelectorAll(".img--select").forEach((e=>{e.classList.remove("img--select")}));const y=m.innerHTML.trimStart();if((y.startsWith("```")||y.startsWith("···")||y.startsWith("~~~")||y.indexOf("\n```")>-1||y.indexOf("\n~~~")>-1||y.indexOf("\n···")>-1)&&!(-1===y.indexOf("\n")&&y.replace(/·|~/g,"`").replace(/^`{3,}/g,"").indexOf("`")>-1)){const t=e.outerHTML;let i=m.innerHTML.replace(/^(~|·|`){3,}/g,"```").replace(/\n(~|·|`){3,}/g,"\n```").trim();i.endsWith("\n```")||(i+="<wbr>\n```"),m.innerHTML=i,e.outerHTML=n.lute.SpinBlockDOM(e.outerHTML);const a=(e=n.wysiwyg.element.querySelector(`[data-node-id="${e.getAttribute("data-node-id")}"]`)).querySelector(".protyle-action__language");return a?(localStorage.getItem(u.Constants.LOCAL_CODELANG)&&""===a.textContent?a.textContent=localStorage.getItem(u.Constants.LOCAL_CODELANG):localStorage.setItem(u.Constants.LOCAL_CODELANG,a.textContent),(0,c.highlightRender)(e)):n.toolbar.showRender(n,e),(0,s.updateTransaction)(n,e.getAttribute("data-node-id"),e.outerHTML,t),!0}if("NodeCodeBlock"===e.getAttribute("data-type")){const i=document.createElement("wbr");t.insertNode(i);const a=e.outerHTML;return i.remove(),t.extractContents(),m.textContent.endsWith("\n")||m.insertAdjacentText("beforeend","\n"),t.insertNode(document.createTextNode("\n")),t.collapse(!1),t.insertNode(i),m.removeAttribute("data-render"),(0,c.highlightRender)(e),(0,s.updateTransaction)(n,e.getAttribute("data-node-id"),e.outerHTML,a),!0}if("NodeTable"===e.getAttribute("data-type")&&((0,l.hasClosestByMatchTag)(t.startContainer,"TD")||(0,l.hasClosestByMatchTag)(t.startContainer,"TH"))){const i=document.createElement("wbr");t.insertNode(i);const a=e.outerHTML;i.remove();const o=(0,l.hasClosestByMatchTag)(t.startContainer,"TD")||(0,l.hasClosestByMatchTag)(t.startContainer,"TH");o&&!o.innerHTML.endsWith("<br>")&&o.insertAdjacentHTML("beforeend","<br>"),t.extractContents();if(n.toolbar.getCurrentType(t).includes("code")&&3!==t.startContainer.nodeType){const e=document.createElement("br");t.startContainer.after(e),t.setStartAfter(e)}else t.insertNode(document.createElement("br"));return t.collapse(!1),(0,d.scrollCenter)(n),(0,s.updateTransaction)(n,e.getAttribute("data-node-id"),e.outerHTML,a),!0}if(""===m.textContent&&e.nextElementSibling&&e.nextElementSibling.classList.contains("protyle-attr")&&"NodeBlockquote"===e.parentElement.getAttribute("data-type")){t.insertNode(document.createElement("wbr"));const i=(0,o.getTopEmptyElement)(e),r=e.getAttribute("data-node-id"),l=i.getAttribute("data-node-id"),c={action:"insert",id:r,data:e.outerHTML},u={action:"insert",id:l,data:i.outerHTML};return l===r?(c.previousID=e.parentElement.getAttribute("data-node-id"),u.previousID=e.previousElementSibling.getAttribute("data-node-id"),e.parentElement.after(e)):(c.previousID=i.previousElementSibling?i.previousElementSibling.getAttribute("data-node-id"):void 0,c.parentID=i.parentElement.getAttribute("data-node-id")||n.block.parentID,u.previousID=c.previousID,u.parentID=c.parentID,i.after(e),i.remove()),(0,s.transaction)(n,[{action:"delete",id:l},c],[{action:"delete",id:r},u]),(0,a.focusByWbr)(e,t),!0}const b=(0,a.getSelectionOffset)(m,n.wysiwyg.element,t);if("NodeListItem"===e.parentElement.getAttribute("data-type")&&(e.nextElementSibling.classList.contains("protyle-attr")||e.nextElementSibling.classList.contains("list")&&(null===(h=e.previousElementSibling)||void 0===h?void 0:h.classList.contains("protyle-action"))||0===b.start&&e.previousElementSibling.classList.contains("protyle-action")||"1"===e.parentElement.getAttribute("fold"))&&((e,t,n)=>{var i,l;const c=t.parentElement,h=(0,o.getContenteditableElement)(t);if(["","\n"].includes(h.textContent)&&t.previousElementSibling.classList.contains("protyle-action")&&!t.querySelector("img")){if(null===(i=c.nextElementSibling)||void 0===i?void 0:i.classList.contains("protyle-attr"))return(0,r.listOutdent)(e,[t.parentElement],n),!0;if(!c.parentElement.classList.contains("protyle-wysiwyg"))return(0,r.breakList)(e,t,n),!0}const f=(0,a.getSelectionOffset)(h,e.wysiwyg.element,n);if(""===n.toString()&&0===f.start&&!(0,o.hasPreviousSibling)(n.startContainer)){if(c.parentElement.classList.contains("protyle-wysiwyg"))return!0;const i=c.parentElement.outerHTML;let l=(0,r.genListItemElement)(c,-1,!0);if(t.previousElementSibling.classList.contains("protyle-action"))""===(0,o.getContenteditableElement)(t).textContent?c.insertAdjacentElement("afterend",l):c.insertAdjacentElement("beforebegin",l);else{if(""!==(0,o.getContenteditableElement)(t).textContent)return!1;t.remove(),l=(0,r.genListItemElement)(c,-1,!0),c.insertAdjacentElement("afterend",l)}return"o"===c.getAttribute("data-subtype")&&(0,r.updateListOrder)(c.parentElement),(0,s.updateTransaction)(e,c.parentElement.getAttribute("data-node-id"),c.parentElement.outerHTML,i),(0,a.focusByWbr)(l,n),(0,d.scrollCenter)(e),p(l),!0}const g=c.querySelector(".list");let m;if(g&&"1"!==c.getAttribute("fold")&&t.nextElementSibling.isSameNode(g)){if(f.end>=h.textContent.length){n.insertNode(document.createElement("wbr"));const i=g.outerHTML;t.querySelector("wbr").remove(),m=(0,r.genListItemElement)(g.firstElementChild,-1,!0),g.firstElementChild.before(m),"o"===g.getAttribute("data-subtype")&&(0,r.updateListOrder)(g),(0,s.updateTransaction)(e,g.getAttribute("data-node-id"),g.outerHTML,i),(0,a.focusByWbr)(c,n),(0,d.scrollCenter)(e)}else{n.insertNode(document.createElement("wbr"));const t=c.outerHTML,i=c.parentElement.outerHTML;""!==n.toString()&&(n.extractContents(),n.insertNode(document.createElement("wbr"))),n.setEndAfter(h.lastChild),m=(0,r.genListItemElement)(c,0,!1);const l=(0,o.getContenteditableElement)(m);l.appendChild(n.extractContents()),l.parentElement.after(g),c.insertAdjacentElement("afterend",m),"o"===c.getAttribute("data-subtype")&&(0,r.updateListOrder)(c.parentElement),c.parentElement.classList.contains("protyle-wysiwyg")?(0,s.transaction)(e,[{action:"update",data:c.outerHTML,id:c.getAttribute("data-node-id")},{action:"insert",id:m.getAttribute("data-node-id"),data:m.outerHTML,previousID:c.getAttribute("data-node-id")}],[{action:"delete",id:m.getAttribute("data-node-id")},{action:"update",data:t,id:c.getAttribute("data-node-id")}]):(0,s.updateTransaction)(e,c.parentElement.getAttribute("data-node-id"),c.parentElement.outerHTML,i),(0,a.focusByWbr)(m,n),(0,d.scrollCenter)(e)}return p(m),!0}""!==n.toString()&&n.toString()!==u.Constants.ZWSP||3!==n.startContainer.nodeType||n.startContainer.textContent!==u.Constants.ZWSP||0!==n.startOffset||(n.setStart(n.startContainer,1),n.collapse(!1)),n.insertNode(document.createElement("wbr"));const y=c.outerHTML,b=c.parentElement.outerHTML;""!==n.toString()&&(n.extractContents(),n.insertNode(document.createElement("wbr"))),n.setEndAfter(h.lastChild),m=(0,r.genListItemElement)(c,0,!1);const v=n.extractContents();return 3!==v.firstChild.nodeType&&""===v.firstChild.textContent&&(v.firstChild.after(document.createElement("wbr")),v.firstChild.remove()),(null===(l=null==h?void 0:h.lastElementChild)||void 0===l?void 0:l.getAttribute("data-type").indexOf("inline-math"))>-1&&!(0,o.hasNextSibling)(null==h?void 0:h.lastElementChild)&&h.insertAdjacentText("beforeend","\n"),(0,o.getContenteditableElement)(m).appendChild(v),c.insertAdjacentElement("afterend",m),"o"===c.getAttribute("data-subtype")&&(0,r.updateListOrder)(c.parentElement),c.parentElement.classList.contains("protyle-wysiwyg")?(0,s.transaction)(e,[{action:"update",id:c.getAttribute("data-node-id"),data:c.outerHTML},{action:"insert",id:m.getAttribute("data-node-id"),data:m.outerHTML,previousID:c.getAttribute("data-node-id")}],[{action:"delete",id:m.getAttribute("data-node-id")},{action:"update",id:c.getAttribute("data-node-id"),data:y}]):(0,s.updateTransaction)(e,c.parentElement.getAttribute("data-node-id"),c.parentElement.outerHTML,b),(0,a.focusByWbr)(m,n),(0,d.scrollCenter)(e),p(m),!0})(n,e,t))return!0;if(""!==m.textContent&&""===t.toString()&&0===b.start){const t=(0,i.genEmptyElement)(!1,!0),a=t.getAttribute("data-node-id");return(0,s.transaction)(n,[{action:"insert",data:t.outerHTML,id:a,previousID:e.previousElementSibling?e.previousElementSibling.getAttribute("data-node-id"):"",parentID:e.parentElement.getAttribute("data-node-id")||n.block.parentID}],[{action:"delete",id:a}]),t.querySelector("wbr").remove(),e.insertAdjacentElement("beforebegin",t),p(t),!0}""===t.toString()&&3===t.startContainer.nodeType&&t.startContainer.textContent===u.Constants.ZWSP&&0===t.startOffset&&t.setStart(t.startContainer,1),t.insertNode(document.createElement("wbr"));const v=e.outerHTML;""!==t.toString()&&(t.extractContents(),t.insertNode(document.createElement("wbr"))),m.lastChild&&t.setEndAfter(m.lastChild);const w=(0,i.genEmptyElement)(!1,!1),_=t.extractContents();3!==_.firstChild.nodeType&&""===_.firstChild.textContent&&(_.firstChild.after(document.createElement("wbr")),_.firstChild.remove()),(null===(f=null==m?void 0:m.lastElementChild)||void 0===f?void 0:f.getAttribute("data-type").indexOf("inline-math"))>-1&&!(0,o.hasNextSibling)(null==m?void 0:m.lastElementChild)&&m.insertAdjacentText("beforeend","\n"),(0,o.getContenteditableElement)(w).appendChild(_);const E=e.getAttribute("data-node-id"),k=w.getAttribute("data-node-id");return e.insertAdjacentElement("afterend",w),(0,s.transaction)(n,[{action:"update",data:e.outerHTML,id:E},{action:"insert",data:w.outerHTML,id:k,previousID:E}],[{action:"delete",id:k},{action:"update",data:v,id:E}]),e.insertAdjacentElement("afterend",w),(0,a.focusByWbr)(w,t),(0,d.scrollCenter)(n),p(w),!0};const p=e=>{const t=(0,o.getContenteditableElement)(e).childNodes;for(let e=0;e<t.length;e++)3===t[e].nodeType&&0===t[e].textContent.length&&(t[e].remove(),e--)}},6520:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasPreviousSibling=t.hasNextSibling=t.getTopAloneElement=t.getTopEmptyElement=t.isNotEditBlock=t.getContenteditableElement=t.getNoContainerElement=t.getNextBlock=t.getFirstBlock=t.getLastBlock=t.getPreviousBlock=t.getPreviousHeading=void 0;const i=n(3607);t.getPreviousHeading=e=>{let n=(0,t.getPreviousBlock)(e);for(;n&&"NodeHeading"!==n.getAttribute("data-type");)n=(0,t.getPreviousBlock)(n);return n};t.getPreviousBlock=e=>{let t=e;for(;t;){if(t.previousElementSibling&&t.previousElementSibling.getAttribute("data-node-id"))return t.previousElementSibling;const e=(0,i.hasClosestBlock)(t.parentElement);if(!e)return!1;t=e}};t.getLastBlock=e=>{let t;return Array.from(e.querySelectorAll("[data-node-id]")).reverse().find((e=>{if(!(0,i.hasClosestByAttribute)(e.parentElement,"data-type","NodeBlockQueryEmbed"))return t=e,!0})),t||e};t.getFirstBlock=e=>{let t;return Array.from(e.querySelectorAll("[data-node-id]")).find((e=>{if(!(0,i.hasClosestByAttribute)(e.parentElement,"data-type","NodeBlockQueryEmbed")&&!e.classList.contains("li"))return t=e,!0})),t||e};t.getNextBlock=e=>{let t=e;for(;t;){if(t.nextElementSibling&&!t.nextElementSibling.classList.contains("protyle-attr"))return t.nextElementSibling;const e=(0,i.hasClosestBlock)(t.parentElement);if(!e)return!1;t=e}return!1};t.getNoContainerElement=e=>{let t=e;for(;t;){if(!(t.classList.contains("list")||t.classList.contains("li")||t.classList.contains("bq")||t.classList.contains("sb")))return t;t=t.querySelector("[data-node-id]")}return!1};t.getContenteditableElement=e=>!e||"true"===e.getAttribute("contenteditable")&&!e.classList.contains("protyle-wysiwyg")?e:e.querySelector('[contenteditable="true"]');t.isNotEditBlock=e=>["NodeBlockQueryEmbed","NodeThematicBreak","NodeMathBlock","NodeHTMLBlock","NodeIFrame","NodeWidget","NodeVideo","NodeAudio"].includes(e.getAttribute("data-type"))||"NodeCodeBlock"===e.getAttribute("data-type")&&e.classList.contains("render-node");t.getTopEmptyElement=e=>{var n;let i=e;for(;i.parentElement&&!i.parentElement.classList.contains("protyle-wysiwyg");)if(i.parentElement.getAttribute("data-node-id")){if(""!==(0,t.getContenteditableElement)(i.parentElement).textContent||(null===(n=i.previousElementSibling)||void 0===n?void 0:n.getAttribute("data-node-id")))break;i=i.parentElement}else i=i.parentElement;return i};t.getTopAloneElement=e=>{if("NodeBlockquote"===e.parentElement.getAttribute("data-type")&&2===e.parentElement.childElementCount)for(;!e.parentElement.classList.contains("protyle-wysiwyg");){if("NodeBlockquote"!==e.parentElement.getAttribute("data-type")||2!==e.parentElement.childElementCount){e=(0,t.getTopAloneElement)(e);break}e=e.parentElement}else if("NodeSuperBlock"===e.parentElement.getAttribute("data-type")&&2===e.parentElement.childElementCount)for(;!e.parentElement.classList.contains("protyle-wysiwyg");){if("NodeSuperBlock"!==e.parentElement.getAttribute("data-type")||2!==e.parentElement.childElementCount){e=(0,t.getTopAloneElement)(e);break}e=e.parentElement}else if("NodeListItem"===e.parentElement.getAttribute("data-type")&&3===e.parentElement.childElementCount)for(;!e.parentElement.classList.contains("protyle-wysiwyg");)if("NodeListItem"===e.parentElement.getAttribute("data-type")&&3===e.parentElement.childElementCount)e=e.parentElement;else{if("NodeList"!==e.parentElement.getAttribute("data-type")||2!==e.parentElement.childElementCount){e=(0,t.getTopAloneElement)(e);break}e=e.parentElement}else if("NodeList"===e.parentElement.getAttribute("data-type")&&2===e.parentElement.childElementCount)for(;!e.parentElement.classList.contains("protyle-wysiwyg");)if("NodeList"===e.parentElement.getAttribute("data-type")&&2===e.parentElement.childElementCount)e=e.parentElement;else{if("NodeListItem"!==e.parentElement.getAttribute("data-type")||3!==e.parentElement.childElementCount){e=(0,t.getTopAloneElement)(e);break}e=e.parentElement}return e};t.hasNextSibling=e=>{let t=e.nextSibling;for(;t;){if(""!==t.textContent)return t;t=t.nextSibling}return!1};t.hasPreviousSibling=e=>{let t=e.previousSibling;for(;t;){if(""!==t.textContent||3!==t.nodeType)return t;t=t.previousSibling}return!1}},386:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WYSIWYG=void 0;const i=n(4705),a=n(3607),o=n(4640),s=n(8792),r=n(3274),l=n(8813),c=n(9173),u=n(6914),d=n(407),p=n(5680),h=n(847),f=n(2281),g=n(6520),m=n(6840),y=n(5378),b=n(6075),v=n(1858),w=n(4403),_=n(1248),E=n(8120),k=n(7822),C=n(2892),D=n(9039),x=n(9516),S=n(4681),A=n(3110),L=n(7954),T=n(2640),B=n(734),P=n(7010),I=n(2287),M=n(7731),F=n(1890);t.WYSIWYG=class{constructor(e){this.lastHTMLs={},this.element=document.createElement("div"),this.element.className="protyle-wysiwyg",this.element.setAttribute("spellcheck","false"),navigator&&navigator.maxTouchPoints>1&&"MacIntel"===navigator.platform?this.element.setAttribute("contenteditable","false"):this.element.setAttribute("contenteditable","true"),window.siyuan.config.editor.displayBookmarkIcon&&this.element.classList.add("protyle-wysiwyg--attr"),this.bindCommonEvent(e),e.options.action.includes(s.Constants.CB_GET_HISTORY)||(this.bindEvent(e),(0,v.keydown)(e,this.element),(0,h.dropEvent)(e,this.element))}renderCustom(e){const t=Object.keys(e);for(let e=0;e<this.element.attributes.length;e++){const n=this.element.attributes[e].nodeName;["type","class","spellcheck","contenteditable","data-doc-type","style","scroll"].includes(n)||t.includes(n)||(this.element.removeAttribute(n),e--)}t.forEach((t=>{["title-img","title","updated","icon","id","type","class","spellcheck","contenteditable","data-doc-type","style"].includes(t)||this.element.setAttribute(t,e[t])}))}escapeInline(e,t,n){if(!n.data)return;const i=n.data;e.toolbar.range=t;const a=t.startContainer.parentElement,r=e.toolbar.getCurrentType();if("SPAN"===a.tagName&&a.textContent.replace(s.Constants.ZWSP,"")!==i&&""===t.toString()&&3===t.startContainer.nodeType&&(r.includes("inline-memo")||r.includes("text")||r.includes("block-ref")||r.includes("file-annotation-ref")||r.includes("a"))&&!(0,g.hasNextSibling)(t.startContainer)&&t.startContainer.textContent.length===t.startOffset&&a.textContent.replace(s.Constants.ZWSP,"").length>=i.length){const n=(0,o.getSelectionOffset)(a,e.wysiwyg.element,t);let r=i.length;"<"!==i&&">"!==i||(r=4);const l=a.innerHTML.replace(s.Constants.ZWSP,"");if(n.start===a.textContent.length){a.innerHTML=l.substr(0,l.length-r);const e=document.createTextNode(i);a.after(e),t.selectNodeContents(e),t.collapse(!1)}else if(n.start===i.length){a.innerHTML=l.substr(r);const e=document.createTextNode(i);a.before(e),t.selectNodeContents(e),t.collapse(!1)}}}setEmptyOutline(e,t){const n=e.wysiwyg.element.querySelector(".img--select");n&&n.classList.remove("img--select");let i=t;if(!t.getAttribute("data-node-id")){const e=(0,a.hasClosestBlock)(t);if(!e)return;i=e}e.model&&(0,C.getAllModels)().outline.forEach((t=>{if(t.blockId===e.block.rootID){if("NodeHeading"===i.getAttribute("data-type"))return void t.setCurrent(i.getAttribute("data-node-id"));const e=(0,g.getPreviousHeading)(i);if(e)return void t.setCurrent(e.getAttribute("data-node-id"));t.setCurrent("")}}))}bindCommonEvent(e){this.element.addEventListener("copy",(t=>{if("PROTYLE-HTML"===t.target.tagName)return void t.stopPropagation();t.stopPropagation(),t.preventDefault();const n=(0,o.getEditorRange)(e.wysiwyg.element),i=(0,a.hasClosestBlock)(n.startContainer);if(!i)return;const r=i.querySelector(".img--select");let l=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));0!==l.length||""!==n.toString()||n.cloneContents().querySelector("img")||r||(i.classList.add("protyle-wysiwyg--select"),(0,M.countBlockWord)([i.getAttribute("data-node-id")]),l=[i]);let c="",u="";if(l.length>0)"NodeListItem"===l[0].getAttribute("data-type")&&l[0].parentElement.childElementCount-1===l.length?c=l[0].parentElement.outerHTML:l.forEach((e=>{const t=(0,g.getTopAloneElement)(e);c+=(0,b.removeEmbed)(t)}));else{const t=document.createElement("div"),i=e.toolbar.getCurrentType(n);if((i.length>0||"NodeHeading"===n.startContainer.parentElement.parentElement.getAttribute("data-type"))&&(3===n.startContainer.nodeType&&n.startContainer.parentElement.textContent===n.toString()||3!==n.startContainer.nodeType&&n.startContainer.textContent===n.toString()))"NodeHeading"===n.startContainer.parentElement.parentElement.getAttribute("data-type")?t.append(n.startContainer.parentElement.parentElement.cloneNode(!0)):["DIV","TD","TH","TR"].includes(n.startContainer.parentElement.tagName)?t.append(n.cloneContents()):t.append(n.startContainer.parentElement.cloneNode(!0)),c=t.innerHTML;else if(r)c=r.outerHTML;else if(i.length>0&&3===n.startContainer.nodeType&&"SPAN"===n.startContainer.parentElement.tagName&&n.startContainer.parentElement.isSameNode(n.endContainer.parentElement)){const e=n.startContainer.parentElement.attributes,t=document.createElement("span");for(let n=0;n<e.length;n++)t.setAttribute(e[n].name,e[n].value);t.textContent=n.toString(),c=t.outerHTML}else{t.append(n.cloneContents());const e=(0,a.hasClosestByAttribute)(n.commonAncestorContainer,"data-type","inline-math");c=e?e.outerHTML:t.innerHTML,((0,a.hasClosestByAttribute)(n.startContainer,"data-type","NodeCodeBlock")||(0,a.hasClosestByMatchTag)(n.startContainer,"CODE"))&&(u=t.textContent.replace(s.Constants.ZWSP,""))}}t.clipboardData.setData("text/plain",u||e.lute.BlockDOM2StdMd(c).trimEnd()),t.clipboardData.setData("text/html",c+s.Constants.ZWSP)})),this.element.addEventListener("mousedown",(t=>{var n;if(2===t.button||window.siyuan.ctrlIsPressed)return;window.siyuan.shiftIsPressed||(0,y.hideElements)(["select"],e);const i=t.target;if((0,a.hasClosestByClassName)(i,"protyle-action"))return;const s=document,r=e.element.getBoundingClientRect(),l=r.left+parseInt(e.wysiwyg.element.style.paddingLeft)+1,c=l+e.wysiwyg.element.firstElementChild.clientWidth-1,u=r.bottom,d=t.clientY;if(!e.disabled&&i.classList.contains("protyle-action__drag")){const n=(0,a.hasClosestBlock)(i);if(!n)return;let o=!0;["NodeIFrame","NodeWidget","NodeVideo"].includes(n.getAttribute("data-type"))?(n.classList.add("iframe--drag"),"left"!==n.style.textAlign&&"right"!==n.style.textAlign||(o=!1)):"img"===i.parentElement.parentElement.getAttribute("data-type")&&i.parentElement.parentElement.classList.add("img--drag");const r=n.getAttribute("data-node-id"),l=n.outerHTML,p=t.clientX,h=i.previousElementSibling,f=h.clientWidth,g=h.clientHeight;return s.onmousemove=e=>{"IMG"===h.tagName&&(h.parentElement.parentElement.style.width=""),e.clientX>p-f+8&&e.clientX<c&&("IMG"===h.tagName&&"block"!==h.parentElement.parentElement.style.display||!o?h.style.width=Math.max(17,f+(e.clientX-p))+"px":h.style.width=Math.max(17,f+2*(e.clientX-p))+"px"),"IMG"!==h.tagName?e.clientY>d-g+8&&e.clientY<u&&(h.style.height=g+(e.clientY-d)+"px"):h.parentElement.parentElement.style.maxWidth=parseInt(h.style.width)+10+"px"},void(s.onmouseup=()=>{s.onmousemove=null,s.onmouseup=null,s.ondragstart=null,s.onselectstart=null,s.onselect=null,i.classList.contains("protyle-action__drag")&&n&&(0,m.updateTransaction)(e,r,n.outerHTML,l),n.classList.remove("iframe--drag"),i.parentElement.parentElement.classList.remove("img--drag")})}let p;if(("TH"===i.tagName||"TD"===i.tagName||"TABLE"===(null===(n=i.firstElementChild)||void 0===n?void 0:n.tagName)||i.classList.contains("table__resize")||i.classList.contains("table__select"))&&(p=(0,a.hasClosestBlock)(i),p&&(p.querySelector("table").classList.remove("select"),p.querySelector(".table__select").removeAttribute("style"),window.siyuan.menus.menu.remove(),t.stopPropagation())),!e.disabled&&i.classList.contains("table__resize")){const n=(0,a.hasClosestBlock)(i);if(!n)return;const o=n.outerHTML;getSelection().rangeCount>0&&getSelection().getRangeAt(0).collapse(!1),n.firstElementChild.style.webkitUserModify="read-only",n.style.cursor="col-resize",i.removeAttribute("style");const r=n.getAttribute("data-node-id"),l=t.clientX,c=n.querySelectorAll("table col")[parseInt(i.getAttribute("data-col-index"))];n.querySelectorAll("table th")[parseInt(i.getAttribute("data-col-index"))].style.width="";const u=c.clientWidth,d=n.firstElementChild.clientWidth<n.firstElementChild.scrollWidth;return s.onmousemove=e=>{"center"!==n.style.textAlign||d?c.style.width=u+(e.clientX-l)+"px":c.style.width=u+2*(e.clientX-l)+"px"},void(s.onmouseup=()=>{n.firstElementChild.style.webkitUserModify="",n.style.cursor="",s.onmousemove=null,s.onmouseup=null,s.ondragstart=null,s.onselectstart=null,s.onselect=null,n&&(0,m.updateTransaction)(e,r,n.outerHTML,o)})}let h=t.clientX;t.clientX>c?h=c:t.clientX<l&&(h=l);const f=r.top+(e.options.render.breadcrumb?e.breadcrumb.element.parentElement.clientHeight:0);let b,v;s.onmousemove=t=>{const n=t.target;if(!e.disabled&&p&&p.contains(n)&&!(0,a.hasClosestByClassName)(p,"protyle-wysiwyg__embed")){if(!("TH"!==n.tagName&&"TD"!==n.tagName||n.isSameNode(i)||v&&v.isSameNode(n))){p.firstElementChild.style.webkitUserModify="read-only";let e=i.offsetLeft+i.clientWidth-n.offsetLeft,t=n.offsetLeft;i.offsetLeft===n.offsetLeft?e=Math.max(i.clientWidth,n.clientWidth):i.offsetLeft<n.offsetLeft&&(e=n.offsetLeft+n.clientWidth-i.offsetLeft,t=i.offsetLeft);let a=i.offsetTop+i.clientHeight-n.offsetTop,o=n.offsetTop;i.offsetTop===n.offsetTop?a=Math.max(i.clientHeight,n.clientHeight):i.offsetTop<n.offsetTop&&(a=n.offsetTop+n.clientHeight-i.offsetTop,o=i.offsetTop),Array.from(p.querySelectorAll("th, td")).find((n=>{const i=n.offsetLeft<t+e&&n.offsetLeft+n.clientWidth>t+e,s=n.offsetLeft<t&&n.offsetLeft+n.clientWidth>t;n.offsetTop<o&&n.offsetTop+n.clientHeight>o?((n.offsetLeft+6>t&&n.offsetLeft+n.clientWidth-6<t+e||i||s)&&(a=o+a-n.offsetTop,o=n.offsetTop),i&&(e=n.offsetLeft+n.clientWidth-t),s&&(e=t+e-n.offsetLeft,t=n.offsetLeft)):n.offsetTop<o+a&&n.offsetTop+n.clientHeight>o+a?((n.offsetLeft+6>t&&n.offsetLeft+n.clientWidth-6<t+e||i||s)&&(a=n.clientHeight+n.offsetTop-o),i&&(e=n.offsetLeft+n.clientWidth-t),s&&(e=t+e-n.offsetLeft,t=n.offsetLeft)):s&&n.offsetTop+6>o&&n.offsetTop+n.clientHeight-6<o+a?(e=t+e-n.offsetLeft,t=n.offsetLeft):i&&n.offsetTop+6>o&&n.offsetTop+n.clientHeight-6<o+a&&(e=n.offsetLeft+n.clientWidth-t)})),p.querySelector("table").classList.add("select"),p.querySelector(".table__select").setAttribute("style",`left:${t-p.firstElementChild.scrollLeft}px;top:${o}px;height:${a}px;width:${e+1}px;`),v=n}return}e.selectElement.classList.remove("fn__none"),(0,y.hideElements)(["gutter"],e);let o=0,s=0,r=0,g=0;t.clientX<h?(s=t.clientX<l?l:t.clientX,r=h-s):t.clientX>c?(s=h,r=c-s):(s=h,r=t.clientX-h),t.clientY>d?t.clientY>u?(o=d,g=u-d):(o=d,g=t.clientY-d):(o=t.clientY<f?f:t.clientY,g=d-o),e.selectElement.setAttribute("style",`background-color: ${e.selectElement.style.backgroundColor};top:${o}px;height:${g}px;left:${s+2}px;width:${r-2}px;`);const m=document.elementFromPoint(t.clientX,t.clientY);if(b&&b.isSameNode(m)&&!b.classList.contains("protyle-wysiwyg")&&!b.classList.contains("list")&&!b.classList.contains("bq")&&!b.classList.contains("sb"))return;b=m,(0,y.hideElements)(["select"],e);let w=document.elementFromPoint(s-1,o);if(!w)return;if((w.classList.contains("protyle-wysiwyg")||w.classList.contains("list")||w.classList.contains("sb")||w.classList.contains("bq"))&&(w=document.elementFromPoint(s-1,o+16)),!w||w.classList.contains("protyle-wysiwyg"))return;const _=(0,a.hasClosestBlock)(w);if(!_)return;let E=[],k=_,C=!1;for(;k;)if(k&&!k.classList.contains("protyle-attr")){const e=k.getBoundingClientRect();if(e.height>0&&e.top<o+g&&e.left<s+r)if(C)if(k.nextElementSibling&&!k.nextElementSibling.classList.contains("protyle-attr")){const e=k.nextElementSibling.getBoundingClientRect();if(e.top<o+g&&e.left<s+r)E=[k],k=k.nextElementSibling,C=!1;else{if(!k.parentElement.classList.contains("sb"))break;k=(0,a.hasClosestBlock)(k.parentElement),C=!0}}else k=(0,a.hasClosestBlock)(k.parentElement),C=!0;else E.push(k),k=k.nextElementSibling;else if(k.parentElement.classList.contains("sb"))k=(0,a.hasClosestBlock)(k.parentElement),C=!0;else{if(0!==e.height||0!==e.width||"1"!==k.parentElement.getAttribute("fold"))break;k=k.parentElement,E=[]}}else k=(0,a.hasClosestBlock)(k.parentElement),C=!0;1!==E.length||E[0].classList.contains("list")||E[0].classList.contains("bq")||E[0].classList.contains("sb")?(E.forEach((e=>{(0,a.hasClosestByClassName)(e,"protyle-wysiwyg__embed")||e.classList.add("protyle-wysiwyg--select")})),e.selectElement.style.backgroundColor=""):e.selectElement.style.backgroundColor="transparent"},s.onmouseup=n=>{var i;if(s.onmousemove=null,s.onmouseup=null,s.ondragstart=null,s.onselectstart=null,s.onselect=null,e.selectElement.classList.add("fn__none"),e.selectElement.removeAttribute("style"),!e.disabled&&p){p.firstElementChild.style.webkitUserModify="";const t=p.querySelector(".table__select");t.getAttribute("style")&&(getSelection().rangeCount>0&&getSelection().getRangeAt(0).collapse(!1),window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new T.MenuItem({label:window.siyuan.languages.mergeCell,click:()=>{if(p){const n=[],i=[],a=p.querySelectorAll("th").length;let o=0;const s=p.firstElementChild.scrollLeft;let r=!1,l=!1;p.querySelectorAll("th, td").forEach(((e,c)=>{e.classList.contains("fn__none")?(e.previousElementSibling&&e.previousElementSibling.isSameNode(n[n.length-1])||c<o&&i.includes((c+1)%a))&&(n.push(e),r||"THEAD"!==e.parentElement.parentElement.tagName?l||"TBODY"!==e.parentElement.parentElement.tagName||(l=!0):r=!0):e.offsetLeft+6>t.offsetLeft+s&&e.offsetLeft+e.clientWidth-6<t.offsetLeft+s+t.clientWidth&&e.offsetTop+6>t.offsetTop&&e.offsetTop+e.clientHeight-6<t.offsetTop+t.clientHeight&&(n.push(e),r||"THEAD"!==e.parentElement.parentElement.tagName?l||"TBODY"!==e.parentElement.parentElement.tagName||(l=!0):r=!0,i.push((c+1)%a),o=Math.max((e.rowSpan-1)*a+c+1,o))})),p.querySelector("table").classList.remove("select"),t.removeAttribute("style");const c=p.outerHTML;let u=n[0],d=u.colSpan,h=1;for(;u.nextElementSibling&&u.nextElementSibling.isSameNode(n[h]);)u=u.nextElementSibling,u.classList.contains("fn__none")||(d+=u.colSpan),h++;let f="",g=n[0].parentElement,y=n[0].rowSpan;if(n.forEach(((e,t)=>{let i=e.innerHTML.trim();i.endsWith("<br>")&&(i=i.substr(0,i.length-4)),f+=i+(i&&t!==n.length-1?"<br>":""),0!==t&&(g.isSameNode(e.parentElement)||(e.classList.contains("fn__none")||(y+=e.rowSpan),g=e.parentElement,"THEAD"===n[0].parentElement.parentElement.tagName&&"THEAD"!==e.parentElement.parentElement.tagName&&n[0].parentElement.parentElement.insertAdjacentElement("beforeend",e.parentElement)),e.classList.add("fn__none"),e.innerHTML="")})),r&&l)for(g=g.parentElement.nextElementSibling.firstElementChild;g&&"THEAD"!==g.parentElement.tagName;){let e=0,t=0;if(Array.from(g.children).forEach((n=>{e+=n.colSpan-1,n.classList.contains("fn__none")&&t++})),e===t)break;n[0].parentElement.parentElement.insertAdjacentElement("beforeend",g),g=g.parentElement.nextElementSibling.firstElementChild}setTimeout((()=>{p&&(n[0].innerHTML=f,n[0].colSpan=d,n[0].rowSpan=y,(0,m.updateTransaction)(e,p.getAttribute("data-node-id"),p.outerHTML,c))}))}}}).element),window.siyuan.menus.menu.append(new T.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new T.MenuItem({icon:"iconAlignLeft",accelerator:window.siyuan.config.keymap.editor.general.alignLeft.custom,label:window.siyuan.languages.alignLeft,click:()=>{if(p){const n=[],i=p.firstElementChild.scrollLeft;p.querySelectorAll("th, td").forEach((e=>{!e.classList.contains("fn__none")&&e.offsetLeft+6>t.offsetLeft+i&&e.offsetLeft+e.clientWidth-6<t.offsetLeft+i+t.clientWidth&&e.offsetTop+6>t.offsetTop&&e.offsetTop+e.clientHeight-6<t.offsetTop+t.clientHeight&&(0===n.length||n.length>0&&e.offsetTop===n[0].offsetTop)&&n.push(e)})),p.querySelector("table").classList.remove("select"),t.removeAttribute("style"),(0,I.setTableAlign)(e,n,p,"left",(0,o.getEditorRange)(p))}}}).element),window.siyuan.menus.menu.append(new T.MenuItem({icon:"iconAlignCenter",accelerator:window.siyuan.config.keymap.editor.general.alignCenter.custom,label:window.siyuan.languages.alignCenter,click:()=>{if(p){const n=[],i=p.firstElementChild.scrollLeft;p.querySelectorAll("th, td").forEach((e=>{!e.classList.contains("fn__none")&&e.offsetLeft+6>t.offsetLeft+i&&e.offsetLeft+e.clientWidth-6<t.offsetLeft+i+t.clientWidth&&e.offsetTop+6>t.offsetTop&&e.offsetTop+e.clientHeight-6<t.offsetTop+t.clientHeight&&(0===n.length||n.length>0&&e.offsetTop===n[0].offsetTop)&&n.push(e)})),p.querySelector("table").classList.remove("select"),t.removeAttribute("style"),(0,I.setTableAlign)(e,n,p,"center",(0,o.getEditorRange)(p))}}}).element),window.siyuan.menus.menu.append(new T.MenuItem({icon:"iconAlignRight",accelerator:window.siyuan.config.keymap.editor.general.alignRight.custom,label:window.siyuan.languages.alignRight,click:()=>{if(p){const n=[],i=p.firstElementChild.scrollLeft;p.querySelectorAll("th, td").forEach((e=>{!e.classList.contains("fn__none")&&e.offsetLeft+6>t.offsetLeft+i&&e.offsetLeft+e.clientWidth-6<t.offsetLeft+i+t.clientWidth&&e.offsetTop+6>t.offsetTop&&e.offsetTop+e.clientHeight-6<t.offsetTop+t.clientHeight&&(0===n.length||n.length>0&&e.offsetTop===n[0].offsetTop)&&n.push(e)})),p.querySelector("table").classList.remove("select"),t.removeAttribute("style"),(0,I.setTableAlign)(e,n,p,"right",(0,o.getEditorRange)(p))}}}).element),window.siyuan.menus.menu.append(new T.MenuItem({type:"separator"}).element),window.siyuan.menus.menu.append(new T.MenuItem({label:window.siyuan.languages.remove,icon:"iconTrashcan",click(){if(p){const n=[],i=p.firstElementChild.scrollLeft;p.querySelectorAll("th, td").forEach((e=>{!e.classList.contains("fn__none")&&e.offsetLeft+6>t.offsetLeft+i&&e.offsetLeft+e.clientWidth-6<t.offsetLeft+i+t.clientWidth&&e.offsetTop+6>t.offsetTop&&e.offsetTop+e.clientHeight-6<t.offsetTop+t.clientHeight&&n.push(e)})),p.querySelector("table").classList.remove("select"),t.removeAttribute("style");const a=p.outerHTML;n.forEach((e=>{e.innerHTML=""})),(0,m.updateTransaction)(e,p.getAttribute("data-node-id"),p.outerHTML,a)}}}).element),window.siyuan.menus.menu.popup({x:n.clientX-8,y:n.clientY-16}))}const r=[],l=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(l.forEach((e=>{r.push(e.getAttribute("data-node-id"))})),(0,M.countBlockWord)(r),getSelection().rangeCount>0){const e=getSelection().getRangeAt(0);if(""===e.toString()||window.siyuan.shiftIsPressed){if(3===t.detail){let t=(0,a.hasClosestBlock)(e.startContainer);if(t)if(null===(i=t.nextElementSibling)||void 0===i?void 0:i.classList.contains("table"))(0,o.setLastNodeRange)((0,g.getContenteditableElement)(t),e,!1);else if(t.classList.contains("table")){const n=t.querySelectorAll("th, td");t=n[n.length-1],t.contains(e.startContainer)&&(0,o.setLastNodeRange)(t,e,!1)}}return}if(l.length>0)return void e.collapse(!0);const s=(0,a.hasClosestBlock)(e.startContainer);let r;3===n.detail&&3!==e.endContainer.nodeType&&"DIV"===e.endContainer.tagName&&0===e.endOffset?e.endContainer.classList.contains("protyle-attr")&&e.setEndAfter(e.endContainer.previousSibling.lastChild):r=(0,a.hasClosestBlock)(e.endContainer),s&&r&&!r.isSameNode(s)&&e.collapse(!0)}}}))}bindEvent(e){let t;this.element.addEventListener("focusout",(()=>{getSelection().rangeCount>0&&!this.element.contains(getSelection().getRangeAt(0).startContainer)?e.toolbar.range||(e.toolbar.range=this.element.ownerDocument.createRange(),e.toolbar.range.setStart((0,g.getContenteditableElement)(this.element)||this.element,0),e.toolbar.range.collapse(!0)):e.toolbar.range=(0,o.getEditorRange)(this.element)})),this.element.addEventListener("cut",(t=>{var n,i;if("PROTYLE-HTML"===t.target.tagName)return void t.stopPropagation();t.stopPropagation(),t.preventDefault(),e.options.render.breadcrumb&&e.breadcrumb.hide();const r=(0,o.getEditorRange)(e.wysiwyg.element);let l=(0,a.hasClosestBlock)(r.startContainer);if(!l)return;const u=l.querySelector(".img--select");let h=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));0!==h.length||""!==r.toString()||r.cloneContents().querySelector("img")||u||(l.classList.add("protyle-wysiwyg--select"),h=[l]);let f="";if(h.length>0){"NodeListItem"===h[0].getAttribute("data-type")&&h[0].parentElement.childElementCount-1===h.length?f=h[0].parentElement.outerHTML:(h.forEach((e=>{const t=(0,g.getTopAloneElement)(e);"NodeHeading"===e.getAttribute("data-type")&&"1"===e.getAttribute("fold")?f+=(0,b.removeEmbed)(t).replace('fold="1"',""):f+=(0,b.removeEmbed)(t)})),"NodeListItem"===h[0].getAttribute("data-type")&&(f=`<div data-subtype="${h[0].getAttribute("data-subtype")}" data-node-id="${Lute.NewNodeID()}" data-type="NodeList" class="list">${f}<div class="protyle-attr" contenteditable="false">${s.Constants.ZWSP}</div></div>`));const t=(0,g.getNextBlock)(h[h.length-1]);(0,w.removeBlock)(e,l,r),t&&(0,o.focusBlock)(t)}else{const t=l.getAttribute("data-node-id"),s=l.outerHTML,h=document.createElement("div");let y=r.startContainer;if(3===y.nodeType&&""===y.textContent){const e=(0,g.hasNextSibling)(r.startContainer);e&&(y=e)}const b=(0,a.hasClosestByAttribute)(y,"data-type","NodeHeading");let v=!1;if(b&&r.toString()===b.firstElementChild.textContent){const t=[{action:"delete",id:b.getAttribute("data-node-id")}],a=[{action:"insert",id:b.getAttribute("data-node-id"),data:b.outerHTML,previousID:null===(n=b.previousElementSibling)||void 0===n?void 0:n.getAttribute("data-node-id"),parentID:(null===(i=b.parentElement)||void 0===i?void 0:i.getAttribute("data-node-id"))||e.block.parentID}];if("1"===b.getAttribute("fold")){v=!0;const t=b.cloneNode(!0);t.removeAttribute("fold"),h.append(t),a[0].data=t.outerHTML,(0,d.setFold)(e,b,void 0,!0)}else{if(3===b.parentElement.childElementCount&&b.parentElement.classList.contains("li")||2===b.parentElement.childElementCount&&(b.parentElement.classList.contains("bq")||b.parentElement.classList.contains("sb"))||1===b.parentElement.childElementCount&&b.parentElement.classList.contains("protyle-wysiwyg")){const n=Lute.NewNodeID(),i=(0,c.genEmptyElement)(!1,!1,n);t.push({id:n,data:i.outerHTML,action:"insert",parentID:b.parentElement.getAttribute("data-node-id")||e.block.parentID}),a.push({id:n,action:"delete"}),b.before(i)}(0,o.focusSideBlock)(b),h.append(b)}(0,m.transaction)(e,t,a)}else if(""!==r.toString()&&y.isSameNode(r.endContainer)&&3===r.startContainer.nodeType&&r.endOffset===r.endContainer.textContent.length&&0===r.startOffset&&!["DIV","TD","TH","TR"].includes(r.startContainer.parentElement.tagName))h.append(r.startContainer.parentElement);else if(u)h.append(u);else if(r.cloneContents().querySelectorAll("td, th").length>0){const n=document.createElement("wbr");r.insertNode(n),r.setStartAfter(n),h.append(r.extractContents()),l.outerHTML=e.lute.SpinBlockDOM(l.outerHTML),l=e.wysiwyg.element.querySelector(`[data-node-id="${t}"]`),(0,o.focusByWbr)(l,r)}else{const e=(0,a.hasClosestByAttribute)(r.commonAncestorContainer,"data-type","inline-math");if(e)h.append(e);else{let e;h.append(r.extractContents()),e=l.classList.contains("table")?(0,a.hasClosestByMatchTag)(r.startContainer,"TD")||(0,a.hasClosestByMatchTag)(r.startContainer,"TH"):(0,g.getContenteditableElement)(l),e&&Array.from(e.children).forEach((e=>{""===e.textContent&&1===e.nodeType&&"BR"!==e.tagName&&e.remove()}))}}if(f=h.innerHTML,!l.classList.contains("table")){const e=(0,g.getContenteditableElement)(l);e&&""===e.textContent&&(e.innerHTML="")}l.setAttribute("updated",p().format("YYYYMMDDHHmmss")),"NodeCodeBlock"===l.getAttribute("data-type")&&(r.insertNode(document.createElement("wbr")),(0,g.getContenteditableElement)(l).removeAttribute("data-render"),(0,_.highlightRender)(l)),l.parentElement.parentElement&&!v&&(0,m.updateTransaction)(e,t,l.outerHTML,s)}e.hint.render(e),t.clipboardData.setData("text/plain",e.lute.BlockDOM2StdMd(f)),t.clipboardData.setData("text/html",s.Constants.ZWSP+f)})),this.element.addEventListener("contextmenu",(n=>{var i,s,l,c;n.stopPropagation(),n.preventDefault();const u=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(u.length>1)return(0,y.hideElements)(["util"],e),e.gutter.renderMenu(e,u[0]),void window.siyuan.menus.menu.popup({x:n.clientX,y:n.clientY});const p=n.target,h=(0,a.hasClosestByAttribute)(p,"data-type","NodeBlockQueryEmbed");if(h)return 0===getSelection().rangeCount&&(0,o.focusSideBlock)(h),e.gutter.renderMenu(e,h),window.siyuan.menus.menu.popup({x:n.clientX,y:n.clientY}),!1;if(e.disabled)return!1;e.toolbar.range=(0,o.getEditorRange)(e.element);const f=(p.getAttribute("data-type")||"").split(" ");if(f.includes("block-ref"))return(0,d.refMenu)(e,p),p.setAttribute("prevent-popover","true"),setTimeout((()=>{p.removeAttribute("prevent-popover")}),620),!1;if(f.includes("file-annotation-ref"))return e.toolbar.showFileAnnotationRef(e,p),!1;if(f.includes("inline-memo"))return e.toolbar.showRender(e,p),!1;if(f.includes("a"))return(0,d.linkMenu)(e,p),(null===(i=p.getAttribute("data-href"))||void 0===i?void 0:i.startsWith("siyuan://blocks"))&&(p.setAttribute("prevent-popover","true"),setTimeout((()=>{p.removeAttribute("prevent-popover")}),620)),!1;if("IMG"===p.tagName&&(0,a.hasClosestByClassName)(p,"img"))return(0,d.imgMenu)(e,e.toolbar.range,p.parentElement.parentElement,{clientX:n.clientX+4,clientY:n.clientY}),!1;const m=(0,a.hasClosestBlock)(p);if(!m)return!1;!(0,g.isNotEditBlock)(m)&&((0,r.isMobile)()||t&&m.contains(t.startContainer))?(0,r.isMobile)()&&!(null===(s=e.toolbar)||void 0===s?void 0:s.element.classList.contains("fn__none"))||((0,d.contentMenu)(e,m),window.siyuan.menus.menu.popup({x:n.clientX,y:n.clientY+13,h:26}),null===(l=e.toolbar)||void 0===l||l.element.classList.add("fn__none"),m.classList.contains("table")&&(m.querySelector("table").classList.remove("select"),m.querySelector(".table__select").removeAttribute("style"))):""===e.toolbar.range.toString()&&((0,y.hideElements)(["util"],e),e.gutter.renderMenu(e,m),window.siyuan.menus.menu.popup({x:n.clientX,y:n.clientY}),null===(c=e.toolbar)||void 0===c||c.element.classList.add("fn__none"))})),this.element.addEventListener("pointerdown",(()=>{t=getSelection().rangeCount>0?getSelection().getRangeAt(0):void 0}));let n=!1;this.element.addEventListener("mousewheel",(t=>{if(!n&&t.deltaY<0&&!e.scroll.element.classList.contains("fn__none")&&e.contentElement.clientHeight===e.contentElement.scrollHeight&&"true"!==e.wysiwyg.element.firstElementChild.getAttribute("data-eof")&&((0,B.fetchPost)("/api/filetree/getDoc",{id:e.wysiwyg.element.firstElementChild.getAttribute("data-node-id"),mode:1,k:e.options.key||"",size:s.Constants.SIZE_GET},(t=>{n=!1,(0,P.onGet)(t,e,[s.Constants.CB_GET_BEFORE,s.Constants.CB_GET_UNCHANGEID])})),n=!0),0===t.deltaX)return;const i=(0,a.hasClosestByClassName)(t.target,"table");if(i){const e=i.querySelector(".table__select");(null==e?void 0:e.style.width)&&(e.removeAttribute("style"),window.siyuan.menus.menu.remove())}}),{passive:!0});let h=!1;this.element.addEventListener("mouseover",(t=>{const n=(0,a.hasClosestByClassName)(t.target,"protyle-attr");if(n)return h=!0,void n.parentElement.classList.add("protyle-wysiwyg--hl");if(h){const t=e.wysiwyg.element.querySelector(".protyle-wysiwyg--hl");t&&t.classList.remove("protyle-wysiwyg--hl"),h=!1}if((0,a.hasClosestByClassName)(t.target,"protyle-action")||!e.options.render.gutter)return;const i=(0,a.hasClosestBlock)(t.target);if((!i||!i.classList.contains("list")&&!i.classList.contains("li"))&&i){const t=(0,a.hasClosestByAttribute)(i,"data-type","NodeBlockQueryEmbed");t?e.gutter.render(t,this.element):e.gutter.render(i,this.element)}})),this.element.addEventListener("paste",(t=>{"PROTYLE-HTML"!==t.target.tagName?(0,i.paste)(e,t):t.stopPropagation()}));let v,C=!1;this.element.addEventListener("compositionstart",(t=>{const n=(0,o.getEditorRange)(e.wysiwyg.element),i=(0,a.hasClosestBlock)(n.startContainer);i&&void 0===e.wysiwyg.lastHTMLs[i.getAttribute("data-node-id")]&&(n.insertNode(document.createElement("wbr")),e.wysiwyg.lastHTMLs[i.getAttribute("data-node-id")]=i.outerHTML,i.querySelector("wbr").remove()),C=!0,t.stopPropagation()})),this.element.addEventListener("compositionend",(t=>{t.stopPropagation(),C=!1;const n=(0,o.getEditorRange)(this.element),i=(0,a.hasClosestBlock)(n.startContainer);if((!i||"NodeHTMLBlock"!==i.getAttribute("data-type"))&&i)if(""!==t.data)this.escapeInline(e,n,t),(0,f.input)(e,i,n,!0);else{const t=i.getAttribute("data-node-id");e.wysiwyg.lastHTMLs[t]&&(0,m.updateTransaction)(e,t,i.outerHTML,e.wysiwyg.lastHTMLs[t])}})),this.element.addEventListener("input",(t=>{const n=t.target;if("VIDEO"===n.tagName||"AUDIO"===n.tagName||"historyRedo"===t.inputType)return;const i=(0,o.getEditorRange)(this.element),s=(0,a.hasClosestBlock)(i.startContainer);s&&(s&&"NodeHTMLBlock"===s.getAttribute("data-type")?t.stopPropagation():t.isComposing||C||"deleteByDrag"===t.inputType||"insertFromDrop"===t.inputType||(this.escapeInline(e,i,t),/^\d{1}$/.test(t.data)||"‘"===t.data||"“"===t.data?setTimeout((()=>{(0,f.input)(e,s,i,!0)})):(":"===t.data&&(e.hint.enableEmoji=!0),(0,f.input)(e,s,i,!0)),t.stopPropagation()))})),this.element.addEventListener("keyup",(t=>{const n=(0,o.getEditorRange)(this.element).cloneRange();if("PageUp"===t.key||"PageDown"===t.key||"Home"===t.key||"End"===t.key||-1!==t.key.indexOf("Arrow")||"Alt"===t.key||"Shift"===t.key||"CapsLock"===t.key||"Escape"===t.key||"Meta"===t.key||/^F\d{1,2}$/.test(t.key)||t.isComposing&&(!t.isComposing||""===n.toString())){if(!this.preventKeyup&&(!t.shiftKey&&!(0,L.isCtrl)(t)||t.isComposing||""===n.toString()||(e.toolbar.render(e,n,t),(0,M.countSelectWord)(n)),3!==t.eventPhase&&!t.shiftKey&&(t.key.indexOf("Arrow")>-1||"Home"===t.key||"End"===t.key||"PageUp"===t.key||"PageDown"===t.key)&&!t.isComposing)){const i=(0,a.hasClosestBlock)(n.startContainer);i&&(i.classList.contains("protyle-wysiwyg--select")||(0,M.countSelectWord)(n),this.setEmptyOutline(e,i)),t.stopPropagation()}}else{const t=(0,a.hasClosestBlock)(n.startContainer);t&&void 0===e.wysiwyg.lastHTMLs[t.getAttribute("data-node-id")]&&(n.insertNode(document.createElement("wbr")),e.wysiwyg.lastHTMLs[t.getAttribute("data-node-id")]=t.outerHTML,t.querySelector("wbr").remove())}})),this.element.addEventListener("dblclick",(t=>{"IMG"!==t.target.tagName||(0,u.previewImage)(t.target.src,e.block.rootID)})),this.element.addEventListener("click",(t=>{(0,y.hideElements)(["hint","util"],e),window.siyuan.shiftIsPressed||(v=void 0),this.setEmptyOutline(e,t.target);const n=(0,a.hasClosestByClassName)(t.target,"table");this.element.querySelectorAll(".table").forEach((e=>{n&&e.isSameNode(n)||(e.querySelector("table").classList.remove("select"),e.querySelector(".table__select").removeAttribute("style")),n&&n.isSameNode(e)&&e.querySelector(".table__select").getAttribute("style")&&t.stopPropagation()}));const i=(0,o.getEditorRange)(this.element),u=(0,a.hasClosestByAttribute)(t.target,"data-type","block-ref"),h=(0,a.hasClosestByAttribute)(t.target,"data-type","a");if(u||h&&h.getAttribute("data-href").startsWith("siyuan://blocks/")){if(t.stopPropagation(),t.preventDefault(),(0,y.hideElements)(["dialog","toolbar"],e),""!==i.toString()&&!window.siyuan.shiftIsPressed)return;let n;if(u?n=u.getAttribute("data-id"):h&&(n=h.getAttribute("data-href").substring(16,38)),(0,B.fetchPost)("/api/block/checkBlockFold",{id:n},(e=>{window.siyuan.shiftIsPressed?(0,x.openFileById)({id:n,position:"bottom",action:e.data?[s.Constants.CB_GET_FOCUS,s.Constants.CB_GET_ALL]:[s.Constants.CB_GET_FOCUS,s.Constants.CB_GET_CONTEXT],zoomIn:e.data}):window.siyuan.altIsPressed?(0,x.openFileById)({id:n,position:"right",action:e.data?[s.Constants.CB_GET_FOCUS,s.Constants.CB_GET_ALL]:[s.Constants.CB_GET_FOCUS,s.Constants.CB_GET_CONTEXT],zoomIn:e.data}):window.siyuan.ctrlIsPressed?(0,x.openFileById)({id:n,action:e.data?[s.Constants.CB_GET_FOCUS,s.Constants.CB_GET_ALL]:[s.Constants.CB_GET_HL,s.Constants.CB_GET_CONTEXT],keepCursor:!0,zoomIn:e.data}):(0,x.openFileById)({id:n,action:e.data?[s.Constants.CB_GET_FOCUS,s.Constants.CB_GET_ALL]:[s.Constants.CB_GET_FOCUS,s.Constants.CB_GET_CONTEXT],zoomIn:e.data})})),e.model){let t;u?t=(0,a.hasClosestBlock)(u):h&&(t=(0,a.hasClosestBlock)(h)),t&&(0,D.pushBack)(e,(0,o.getEditorRange)(this.element),t)}return}const f=(0,a.hasClosestByAttribute)(t.target,"data-type","file-annotation-ref");if(f&&""===i.toString()){t.stopPropagation(),t.preventDefault();const e=f.getAttribute("data-id").split("/"),n=`assets/${e[1]}`;return void(window.siyuan.ctrlIsPressed?(0,x.openBy)(n,"folder"):window.siyuan.shiftIsPressed?(0,x.openBy)(n,"app"):(0,x.openAsset)(n,e[2],"right"))}if(h&&!window.siyuan.altIsPressed){t.stopPropagation(),t.preventDefault();const e=h.getAttribute("data-href");if((0,l.isLocalPath)(e)){const t=e.split("?page")[0];if(s.Constants.SIYUAN_ASSETS_EXTS.includes((0,l.pathPosix)().extname(t))&&(!t.endsWith(".pdf")||t.endsWith(".pdf")&&!e.startsWith("file://")))if(window.siyuan.ctrlIsPressed)(0,x.openBy)(e,"folder");else if(window.siyuan.shiftIsPressed)(0,x.openBy)(e,"app");else{const n=(0,r.getSearch)("page",e);(0,x.openAsset)(t,""===n?void 0:parseInt(n),"right")}else(0,L.openByMobile)(e)}else(0,L.openByMobile)(e);return}const b=(0,a.hasClosestByAttribute)(t.target,"data-type","tag");if(b&&!window.siyuan.altIsPressed&&e.model)return(0,S.openGlobalSearch)(`#${b.textContent}#`,!window.siyuan.ctrlIsPressed),void(0,y.hideElements)(["dialog"]);const w=(0,a.hasClosestByClassName)(t.target,"protyle-wysiwyg__embed");if(w){const n=w.getAttribute("data-id");return window.siyuan.shiftIsPressed?(0,x.openFileById)({id:n,position:"bottom",action:[s.Constants.CB_GET_FOCUS,s.Constants.CB_GET_ALL],zoomIn:!0}):window.siyuan.altIsPressed?(0,x.openFileById)({id:n,position:"right",action:[s.Constants.CB_GET_FOCUS,s.Constants.CB_GET_ALL],zoomIn:!0}):window.siyuan.ctrlIsPressed?(0,x.openFileById)({id:n,action:[s.Constants.CB_GET_FOCUS,s.Constants.CB_GET_ALL],keepCursor:!0,zoomIn:!0}):e.disabled||window.siyuan.blockPanels.push(new A.BlockPanel({targetElement:w,nodeIds:[n]})),void t.stopPropagation()}const _=(0,a.hasClosestByClassName)(t.target,"protyle-attr--bookmark");if(_)return(0,E.openAttr)(_.parentElement.parentElement,e,"bookmark"),void t.stopPropagation();const C=(0,a.hasClosestByClassName)(t.target,"protyle-attr--name");if(C)return(0,E.openAttr)(C.parentElement.parentElement,e,"name"),void t.stopPropagation();const T=(0,a.hasClosestByClassName)(t.target,"protyle-attr--alias");if(T)return(0,E.openAttr)(T.parentElement.parentElement,e,"alias"),void t.stopPropagation();const P=(0,a.hasClosestByClassName)(t.target,"protyle-attr--memo");if(P)return(0,E.openAttr)(P.parentElement.parentElement,e,"memo"),void t.stopPropagation();if((0,a.hasTopClosestByClassName)(t.target,"protyle-action__copy"))return;const I=(0,a.hasClosestByClassName)(t.target,"protyle-action__edit");if(I&&!e.disabled)return e.toolbar.showRender(e,I.parentElement.parentElement),t.stopPropagation(),void t.preventDefault();const N=(0,a.hasClosestByClassName)(t.target,"protyle-action__menu");if(N&&!e.disabled){e.gutter.renderMenu(e,N.parentElement.parentElement);const n=N.getBoundingClientRect();return window.siyuan.menus.menu.popup({x:n.left,y:n.top},!0),t.stopPropagation(),void t.preventDefault()}const $=(0,a.hasClosestByClassName)(t.target,"protyle-action__reload");if($){const n=(0,a.hasClosestByAttribute)($,"data-type","NodeBlockQueryEmbed");return n&&(n.removeAttribute("data-render"),(0,k.blockRender)(e,n)),t.stopPropagation(),void t.preventDefault()}const O=(0,a.hasClosestByClassName)(t.target,"protyle-action__language");if(O&&!e.disabled)return e.toolbar.showCodeLanguage(e,O),t.stopPropagation(),void t.preventDefault();const H=(0,a.hasClosestByAttribute)(t.target,"data-subtype","math");if(!window.siyuan.shiftIsPressed&&!window.siyuan.ctrlIsPressed&&H&&!e.disabled)return e.toolbar.showRender(e,H),void t.stopPropagation();const R=(0,a.hasClosestByClassName)(t.target,"protyle-action");if(R){if("img"!==R.parentElement.parentElement.getAttribute("data-type")||e.disabled){if(!e.disabled&&R.parentElement.classList.contains("li"))if(window.siyuan.altIsPressed){if(R.parentElement.parentElement.classList.contains("protyle-wysiwyg"))(0,d.setFold)(e,R.parentElement);else{let t=!0;const n=R.parentElement.parentElement.outerHTML;Array.from(R.parentElement.parentElement.children).find((e=>{if(e.classList.contains("li")&&"1"!==e.getAttribute("fold")&&e.childElementCount>3)return t=!1,!0})),Array.from(R.parentElement.parentElement.children).find((e=>{e.classList.contains("li")&&(t?e.removeAttribute("fold"):e.childElementCount>3&&e.setAttribute("fold","1"))})),(0,m.updateTransaction)(e,R.parentElement.parentElement.getAttribute("data-node-id"),R.parentElement.parentElement.outerHTML,n)}(0,y.hideElements)(["gutter"],e)}else if(window.siyuan.shiftIsPressed)(0,E.openAttr)(R.parentElement,e);else if(window.siyuan.ctrlIsPressed)(0,d.zoomOut)(e,R.parentElement.getAttribute("data-node-id"));else if(R.classList.contains("protyle-action--task")){const t=R.parentElement.outerHTML;R.parentElement.classList.contains("protyle-task--done")?(R.querySelector("use").setAttribute("xlink:href","#iconUncheck"),R.parentElement.classList.remove("protyle-task--done")):(R.querySelector("use").setAttribute("xlink:href","#iconCheck"),R.parentElement.classList.add("protyle-task--done")),R.parentElement.setAttribute("updated",p().format("YYYYMMDDHHmmss")),(0,m.updateTransaction)(e,R.parentElement.getAttribute("data-node-id"),R.parentElement.outerHTML,t)}else e.gutter.renderMenu(e,R.parentElement),window.siyuan.menus.menu.popup({x:t.clientX-16,y:t.clientY-16},!0)}else(0,d.imgMenu)(e,i,R.parentElement.parentElement,{clientX:t.clientX+4,clientY:t.clientY});return void t.stopPropagation()}const q=(0,a.hasClosestByClassName)(t.target,"hr")||(0,a.hasClosestByClassName)(t.target,"iframe");if(!window.siyuan.shiftIsPressed&&!window.siyuan.ctrlIsPressed&&q)return q.classList.add("protyle-wysiwyg--select"),void t.stopPropagation();const j=(0,a.hasTopClosestByClassName)(t.target,"img");if(!window.siyuan.shiftIsPressed&&!window.siyuan.ctrlIsPressed&&j)return j.classList.add("img--select"),i.setStartAfter(j),i.collapse(!0),void(0,o.focusByRange)(i);if(t.target.contains(this.element)&&this.element.lastElementChild&&!e.disabled){const n=this.element.lastElementChild.getBoundingClientRect();if(t.y>n.bottom){const t=(0,g.getContenteditableElement)((0,g.getLastBlock)(this.element.lastElementChild));if(!t||"NodeParagraph"!==this.element.lastElementChild.getAttribute("data-type")&&"NodeListItem"!==e.wysiwyg.element.getAttribute("data-doc-type")||"NodeParagraph"===this.element.lastElementChild.getAttribute("data-type")&&""!==(0,g.getContenteditableElement)(t).textContent){const t=(0,c.genEmptyElement)(!1,!1);this.element.insertAdjacentElement("beforeend",t),(0,m.transaction)(e,[{action:"insert",data:t.outerHTML,id:t.getAttribute("data-node-id"),previousID:t.previousElementSibling.getAttribute("data-node-id"),parentID:e.block.parentID}],[{action:"delete",id:t.getAttribute("data-node-id")}]);const n=(0,g.getContenteditableElement)(t);i.selectNodeContents(n),i.collapse(!0),(0,o.focusByRange)(i)}else t&&(i.selectNodeContents(t),i.collapse(!1))}}if(setTimeout((()=>{const t=(0,o.getEditorRange)(this.element);""!==t.toString().replace(s.Constants.ZWSP,"")?e.toolbar.render(e,t):(0,y.hideElements)(["toolbar"],e),e.wysiwyg.element.querySelector(".protyle-wysiwyg--select")||(0,M.countSelectWord)(t),0===getSelection().rangeCount&&(0,o.focusByRange)(t),(0,D.pushBack)(e,t)}),(0,r.isMobile)()?520:0),e.hint.enableEmoji=!1,window.siyuan.shiftIsPressed){t.preventDefault(),t.stopPropagation();let n=(0,a.hasClosestBlock)(i.startContainer),s=(0,a.hasClosestBlock)(t.target);if(n&&s&&n.isSameNode(s)&&(n=(0,a.hasClosestBlock)(i.endContainer)),n&&s&&(!n.isSameNode(s)||v&&v.isSameNode(n))){let t=!0;i.collapse(!0),v?n=v:v=n;const r=n.getBoundingClientRect(),l=s.getBoundingClientRect();let c=r.top,u=l.top;if(c===u&&(c=r.right,u=l.right),c>u){const e=s;s=n,n=e;const i=u;u=c,c=i,t=!1}let d=[],p=n,h=!1;for(;p;)if(p&&!p.classList.contains("protyle-attr")){const e=p.getBoundingClientRect();if(r.top===l.top?e.right<=u:e.top<=u)if(h)if(p.nextElementSibling&&!p.nextElementSibling.classList.contains("protyle-attr")){const e=p.nextElementSibling.getBoundingClientRect();if(r.top===l.top?e.right<=u:e.top<=u)d=[p],p=p.nextElementSibling,h=!1;else{if(!p.parentElement.classList.contains("sb"))break;p=(0,a.hasClosestBlock)(p.parentElement),h=!0}}else p=(0,a.hasClosestBlock)(p.parentElement),h=!0;else d.push(p),p=p.nextElementSibling;else{if(!p.parentElement.classList.contains("sb"))break;p=(0,a.hasClosestBlock)(p.parentElement),h=!0}}else p=(0,a.hasClosestBlock)(p.parentElement),h=!0;if(1!==d.length||d[0].classList.contains("list")||d[0].classList.contains("bq")||d[0].classList.contains("sb")){const i=[];e.wysiwyg.element.querySelector(".protyle-wysiwyg--select")||!e.scroll||e.scroll.element.classList.contains("fn__none")||e.scroll.keepLazyLoad||!(n.getBoundingClientRect().top<2*-e.contentElement.clientHeight||s.getBoundingClientRect().bottom>2*e.contentElement.clientHeight)||(0,F.showMessage)(window.siyuan.languages.crossKeepLazyLoad),d.forEach((e=>{e.classList.add("protyle-wysiwyg--select"),i.push(e.getAttribute("data-node-id"))})),(0,M.countBlockWord)(i),t?(0,o.focusBlock)(d[d.length-1],e.wysiwyg.element,!1):(0,o.focusBlock)(d[0],e.wysiwyg.element,!1)}else v=void 0}}if(this.element.querySelector(".protyle-wysiwyg--select")&&""!==i.toString()&&(i.collapse(!1),(0,o.focusByRange)(i)),window.siyuan.ctrlIsPressed){let n=(0,a.hasClosestBlock)(t.target);if(n){n=(0,g.getTopAloneElement)(n),n.classList.contains("protyle-wysiwyg--select")?n.classList.remove("protyle-wysiwyg--select"):n.classList.add("protyle-wysiwyg--select"),n.querySelectorAll(".protyle-wysiwyg--select").forEach((e=>{e.classList.remove("protyle-wysiwyg--select")}));const t=(0,a.hasClosestByClassName)(n,"protyle-wysiwyg--select");t&&!n.isSameNode(t)&&t.classList.remove("protyle-wysiwyg--select");const i=[];e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach((e=>{i.push(e.getAttribute("data-node-id"))})),(0,M.countBlockWord)(i)}}e.options.render.breadcrumb&&e.breadcrumb.render(e)}))}}},2281:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.input=void 0;const a=n(2518),o=n(4640),s=n(8792),r=n(5680),l=n(6840),c=n(8527),u=n(1248),d=n(6520),p=n(9173),h=n(7822),f=n(5378),g=n(3607),m=n(734);t.input=(e,t,n,b=!0)=>i(void 0,void 0,void 0,(function*(){var i,v,w,_;if(!t.parentElement)return;const E=(0,d.getContenteditableElement)(t),k=t.getAttribute("data-type");if(!E)return"NodeThematicBreak"===k?t.innerHTML="<div><wbr></div>":"NodeBlockQueryEmbed"===k?t.lastElementChild.previousElementSibling.innerHTML="<wbr>"+s.Constants.ZWSP:"NodeMathBlock"===k||"NodeHTMLBlock"===k?t.lastElementChild.previousElementSibling.lastElementChild.innerHTML="<wbr>"+s.Constants.ZWSP:"NodeIFrame"===k||"NodeWidget"===k?t.innerHTML="<wbr>"+t.firstElementChild.outerHTML+t.lastElementChild.outerHTML:"NodeVideo"===k?t.firstElementChild.innerHTML="<wbr>"+s.Constants.ZWSP+t.firstElementChild.firstElementChild.outerHTML+t.firstElementChild.lastElementChild.outerHTML:"NodeAudio"===k?t.firstElementChild.innerHTML=t.firstElementChild.firstElementChild.outerHTML+"<wbr>"+s.Constants.ZWSP:"NodeCodeBlock"===k&&(n.startContainer.textContent=s.Constants.ZWSP),void(0,o.focusByWbr)(t,n);const C=document.createElement("wbr");n.insertNode(C);let D=t.getAttribute("data-node-id");if("NodeCodeBlock"!==k&&(E.innerHTML.endsWith("\n<wbr>")||E.innerHTML.endsWith("\n<wbr>\n")))return(0,l.updateTransaction)(e,D,t.outerHTML,t.outerHTML.replace("\n<wbr>","<wbr>")),void C.remove();const x=t.querySelector("br");!x||"TD"===x.parentElement.tagName||"TH"===x.parentElement.tagName||""!==x.parentElement.textContent.trim()&&"\n"!==(null===(v=null===(i=x.previousSibling)||void 0===i?void 0:i.previousSibling)||void 0===v?void 0:v.textContent)||x.remove(),t.setAttribute("updated",r().format("YYYYMMDDHHmmss")),"》<wbr>"===E.innerHTML&&(E.innerHTML="><wbr>");const S=E.innerHTML.trimStart();if((S.startsWith("````")||S.startsWith("····")||S.startsWith("~~~~"))&&-1===S.indexOf("\n"));else if((S.startsWith("```")||S.startsWith("···")||S.startsWith("~~~"))&&-1===S.indexOf("\n")&&-1===S.replace(/·|~/g,"`").replace(/^`{3,}/g,"").indexOf("`"))return(0,l.updateTransaction)(e,D,t.outerHTML,e.wysiwyg.lastHTMLs[D]),void C.remove();const A=(0,g.hasClosestByAttribute)(n.startContainer,"data-type","block-ref");if(A&&"d"===A.getAttribute("data-subtype")){(yield(0,m.fetchSyncPost)("/api/block/getRefText",{id:A.getAttribute("data-id")})).data!==A.innerHTML&&A.setAttribute("data-subtype","s")}let L=t.outerHTML,T="",B=!1;if("---"!==E.textContent||t.classList.contains("code-block"))if(!t.classList.contains("code-block")&&["[]","[ ]","[x]","[X]","【】","【 】","【x】","【X】"].includes(E.textContent)){const e=E.textContent.indexOf("x")>-1||E.textContent.indexOf("X")>-1;t.parentElement.classList.contains("li")&&3===t.parentElement.childElementCount?2===t.parentElement.parentElement.childElementCount&&(L=`<div data-subtype="t" data-node-id="${t.parentElement.parentElement.getAttribute("data-node-id")}" data-type="NodeList" class="list"><div data-marker="*" data-subtype="t" data-node-id="${t.parentElement.getAttribute("data-node-id")}" data-type="NodeListItem" class="li${e?" protyle-task--done":""}"><div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#icon${e?"C":"Unc"}heck"></use></svg></div><div data-node-id="${D}" data-type="NodeParagraph" class="p"><div contenteditable="true" spellcheck="false"><wbr></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div>`,D=t.parentElement.parentElement.getAttribute("data-node-id"),T=(t=t.parentElement.parentElement).outerHTML):(L=`<div data-subtype="t" data-node-id="${D}" data-type="NodeList" class="list"><div data-marker="*" data-subtype="t" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li${e?" protyle-task--done":""}"><div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#icon${e?"C":"Unc"}heck"></use></svg></div><div data-node-id="${Lute.NewNodeID()}" data-type="NodeParagraph" class="p"><div contenteditable="true" spellcheck="false"><wbr></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div>`,T=t.outerHTML)}else{if(S.startsWith("```")||S.startsWith("~~~")||S.startsWith("···")||S.indexOf("\n```")>-1||S.indexOf("\n~~~")>-1||S.indexOf("\n···")>-1)if(-1===S.indexOf("\n")&&S.replace(/·|~/g,"`").replace(/^`{3,}/g,"").indexOf("`")>-1);else{let e=E.innerHTML.replace(/^(~|·|`){3,}/g,"```").replace(/\n(~|·|`){3,}/g,"\n```").trim();e.endsWith("\n```")||(e=e.replace("<wbr>","")+"<wbr>\n```"),E.innerHTML=e,L=t.outerHTML}L=e.lute.SpinBlockDOM(L)}else{L=`<div data-node-id="${D}" data-type="NodeThematicBreak" class="hr"><div></div></div>`;const e=(0,d.getNextBlock)(E);e?(0,d.isNotEditBlock)(e)?B=!0:(0,o.focusBlock)(e):L+=(0,p.genEmptyBlock)(!1,!0)}e.toolbar.subElement.classList.add("fn__none");const P=document.createElement("template");if(P.innerHTML=L,!b||(null===(w=(0,d.getContenteditableElement)(P.content.firstElementChild))||void 0===w?void 0:w.innerHTML)===(0,d.getContenteditableElement)(t).innerHTML&&(1!==P.content.childElementCount||"<wbr>"!==(null===(_=(0,d.getContenteditableElement)(P.content.firstElementChild))||void 0===_?void 0:_.innerHTML))||1===P.content.childElementCount&&P.content.firstElementChild.classList.contains("code-block")&&t.classList.contains("code-block"))"NodeCodeBlock"===t.getAttribute("data-type")?(E.removeAttribute("data-render"),(0,u.highlightRender)(t)):((0,o.focusByWbr)(e.wysiwyg.element,n),e.hint.render(e));else{let i;(0,a.log)("SpinBlockDOM",t.outerHTML,"argument",e.options.debugger),(0,a.log)("SpinBlockDOM",L,"result",e.options.debugger),t.classList.contains("table")&&(i=(0,d.getContenteditableElement)(t).scrollLeft),/<span data-type="backslash"><span>\\<\/span>.<\/span><wbr>/.test(L)?t.outerHTML=L:t.outerHTML=L.replace("</span><wbr>","</span>"+s.Constants.ZWSP+"<wbr>"),t=e.wysiwyg.element.querySelector(`[data-node-id="${D}"]`),Array.from(P.content.children).forEach(((a,r)=>{const l=a.getAttribute("data-node-id");let p;p=l===D?t:e.wysiwyg.element.querySelector(`[data-node-id="${l}"]`);const g=p.getAttribute("data-type");if("NodeCodeBlock"===g){const t=p.querySelector(".protyle-action__language");t?(localStorage.getItem(s.Constants.LOCAL_CODELANG)&&""===t.textContent&&(t.textContent=localStorage.getItem(s.Constants.LOCAL_CODELANG)),(0,u.highlightRender)(p)):1===P.content.childElementCount&&e.toolbar.showRender(e,p)}else["NodeMathBlock","NodeHTMLBlock"].includes(g)?("NodeMathBlock"===g&&(0,c.mathRender)(p),e.toolbar.showRender(e,p)):"NodeBlockQueryEmbed"===g?((0,h.blockRender)(e,p),e.toolbar.showRender(e,p),(0,f.hideElements)(["hint"],e)):"NodeThematicBreak"===g&&B?(0,o.focusBlock)(t):((0,c.mathRender)(p),r===P.content.childElementCount-1&&((0,o.focusByWbr)(e.wysiwyg.element,n),e.hint.render(e),i>0&&((0,d.getContenteditableElement)(p).scrollLeft=i)))}))}(0,f.hideElements)(["gutter"],e),y(L,e,D,k,T)}));const y=(e,t,n,i,a)=>{const o=document.createElement("template");o.innerHTML=e;const s=[],r=[];Array.from(o.content.children).forEach(((e,i)=>{var o;"false"===e.getAttribute("spellcheck")&&"false"===e.getAttribute("contenteditable")&&e.setAttribute("contenteditable","true");const l=e.getAttribute("data-node-id");if(l===n)s.push({id:n,data:e.outerHTML,action:"update"}),r.push({id:n,data:t.wysiwyg.lastHTMLs[n]||a,action:"update"});else{let n;0===i&&(n=t.wysiwyg.element.querySelector(`[data-node-id="${l}"]`)),s.push({action:"insert",data:e.outerHTML,id:l,previousID:0===i?null===(o=null==n?void 0:n.previousElementSibling)||void 0===o?void 0:o.getAttribute("data-node-id"):e.previousElementSibling.getAttribute("data-node-id"),parentID:(null==n?void 0:n.parentElement.getAttribute("data-node-id"))||t.block.parentID}),r.push({id:l,action:"delete"})}})),(0,l.transaction)(t,s,r)}},1858:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keydown=void 0;const i=n(5378),a=n(7954),o=n(4640),s=n(3607),r=n(4403),l=n(6520),c=n(7422),u=n(8835),d=n(2287),p=n(6840),h=n(3174),f=n(4921),g=n(8349),m=n(9173),y=n(9516),b=n(3429),v=n(407),w=n(6075),_=n(8120),E=n(8792),k=n(7870),C=n(2640),D=n(734),x=n(7010),S=n(8592),A=n(3110),L=n(5680),T=n(1248),B=n(7731);t.keydown=(e,t)=>{t.addEventListener("keydown",(n=>{var P,I,M,F,N,$,O,H,R,q,j,U,z,W,G,V,Y,K,Z;if("protyle-html"===n.target.localName)return void n.stopPropagation();if(e.disabled||!e.selectElement.classList.contains("fn__none"))return n.stopPropagation(),void n.preventDefault();e.wysiwyg.preventKeyup=!1,(0,i.hideElements)(["util"],e),n.shiftKey&&n.key.indexOf("Arrow")>-1||n.repeat||(0,i.hideElements)(["toolbar"],e);const J=(0,o.getEditorRange)(e.wysiwyg.element),X=(0,s.hasClosestBlock)(J.startContainer);if(!X)return;if(X.classList.contains("protyle-wysiwyg--select")&&!(0,a.isCtrl)(n)&&!n.shiftKey&&!n.altKey){if("a"===n.key.toLowerCase())return n.stopPropagation(),n.preventDefault(),e.wysiwyg.element.blur(),setTimeout((()=>{(0,m.insertEmptyBlock)(e,"afterend")}),100),!1;if("b"===n.key.toLowerCase())return n.stopPropagation(),n.preventDefault(),e.wysiwyg.element.blur(),setTimeout((()=>{(0,m.insertEmptyBlock)(e,"beforebegin")}),100),!1}if(n.isComposing)return void n.stopPropagation();if((0,a.isCtrl)(n)||n.shiftKey||n.altKey||("Slash"===n.code?e.hint.enableSlash=!0:"Backslash"===n.code&&(e.hint.enableSlash=!1,(0,i.hideElements)(["hint"],e))),"PageUp"===n.key||"PageDown"===n.key||"Home"===n.key||"End"===n.key||-1!==n.key.indexOf("Arrow")||"Escape"===n.key||"Shift"===n.key||"Meta"===n.key||"Alt"===n.key||"Control"===n.key||"CapsLock"===n.key||/^F\d{1,2}$/.test(n.key)||void 0!==e.wysiwyg.lastHTMLs[X.getAttribute("data-node-id")]||(J.insertNode(document.createElement("wbr")),e.wysiwyg.lastHTMLs[X.getAttribute("data-node-id")]=X.outerHTML,X.querySelector("wbr").remove()),(0,C.bindMenuKeydown)(n))return n.stopPropagation(),void n.preventDefault();if("Escape"!==n.key&&window.siyuan.menus.menu.remove(),["Alt","Meta","Shift","Control","CapsLock","Escape"].includes(n.key)||e.breadcrumb.hide(),!(n.altKey||n.shiftKey||(0,a.isCtrl)(n)||"ArrowDown"!==n.key&&"ArrowUp"!==n.key)){const t=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(t.length>0){if(n.preventDefault(),n.stopPropagation(),t.forEach((e=>{e.classList.remove("protyle-wysiwyg--select")})),"ArrowDown"===n.key){const n=t[t.length-1];let i=(0,l.getNextBlock)(n);if(i)if(0===i.getBoundingClientRect().width){const e=(0,s.hasTopClosestByAttribute)(i,"fold","1");e?(i=(0,l.getNextBlock)(e),i=i?(0,l.getFirstBlock)(i):n):i=n}else"1"===i.getAttribute("fold")&&(i.classList.contains("sb")||i.classList.contains("bq"))||(i=(0,l.getFirstBlock)(i));else i=n;i.classList.add("protyle-wysiwyg--select"),(0,B.countBlockWord)([i.getAttribute("data-node-id")]);const a=i.getBoundingClientRect().bottom-e.contentElement.getBoundingClientRect().bottom;a>0&&(e.contentElement.scrollTop=e.contentElement.scrollTop+a,e.scroll.lastScrollTop=e.contentElement.scrollTop-1),(0,o.focusBlock)(i)}else if("ArrowUp"===n.key){let n=(0,l.getPreviousBlock)(t[0]);if(n){if(n=(0,l.getLastBlock)(n),0===n.getBoundingClientRect().width){const e=(0,s.hasTopClosestByAttribute)(n,"fold","1");n=e?(0,l.getFirstBlock)(e):t[0]}else if(n){const e=(0,s.hasTopClosestByAttribute)(n,"fold","1");e&&(e.classList.contains("sb")||e.classList.contains("bq"))&&(n=e)}}else!e.title||"true"!==e.wysiwyg.element.firstElementChild.getAttribute("data-eof")&&0!==e.contentElement.scrollTop?0!==e.contentElement.scrollTop?(e.contentElement.scrollTop=0,e.scroll.lastScrollTop=8):n=t[0]:e.title.editElement.focus();if(n){n.classList.add("protyle-wysiwyg--select"),(0,B.countBlockWord)([n.getAttribute("data-node-id")]);const t=n.getBoundingClientRect().top-e.contentElement.getBoundingClientRect().top;t<0&&(e.contentElement.scrollTop=e.contentElement.scrollTop+t,e.scroll.lastScrollTop=e.contentElement.scrollTop+1),(0,o.focusBlock)(n)}}return}}if(!("PageUp"===n.key||"PageDown"===n.key||"Home"===n.key||"End"===n.key||-1!==n.key.indexOf("Arrow")||(0,a.isCtrl)(n)||"Escape"===n.key||n.shiftKey||n.altKey||/^F\d{1,2}$/.test(n.key)||"Enter"===n.key||"Tab"===n.key||"Backspace"===n.key||"Delete"===n.key))return n.stopPropagation(),(0,i.hideElements)(["select"],e),!1;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.collapse.custom,n)){const t=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");return t.length>0?(0,v.setFold)(e,t[0]):"NodeListItem"===X.parentElement.getAttribute("data-type")?X.parentElement.childElementCount>3?(0,v.setFold)(e,X.parentElement):(0,v.setFold)(e,X):"NodeHeading"===X.getAttribute("data-type")?(0,v.setFold)(e,X):(0,v.setFold)(e,(0,l.getTopAloneElement)(X)),n.stopPropagation(),n.preventDefault(),!1}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.expand.custom,n)){const t=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");return t.length>0?(0,v.setFold)(e,t[0],!0):"NodeListItem"===X.parentElement.getAttribute("data-type")?X.parentElement.childElementCount>3?(0,v.setFold)(e,X.parentElement,!0):(0,v.setFold)(e,X,!0):"NodeHeading"===X.getAttribute("data-type")?(0,v.setFold)(e,X,!0):(0,v.setFold)(e,(0,l.getTopAloneElement)(X),!0),n.stopPropagation(),void n.preventDefault()}if((0,c.matchHotKey)("⇧←",n)||(0,c.matchHotKey)("⇧→",n)){if(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").length>0)return n.stopPropagation(),void n.preventDefault()}if((0,c.matchHotKey)("⇧↑",n)){const a=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(a.length>0)n.stopPropagation(),n.preventDefault();else{const e=(0,o.getSelectionOffset)(X,t,J).start;if(0!==e){const t=(0,l.getContenteditableElement)(X);if("TABLE"!==t.tagName){const i=t.textContent.indexOf("\n");return-1===i||e<=i||e===t.textContent.replace("\n"," ").indexOf("\n")?((0,o.setFirstNodeRange)(t,J),n.stopPropagation(),void n.preventDefault()):void 0}{const e=(0,s.hasClosestByMatchTag)(J.startContainer,"TH")||(0,s.hasClosestByMatchTag)(J.startContainer,"TD")||t.querySelector("th, td");if(0!==(0,o.getSelectionOffset)(e,e,J).start)return(0,o.setFirstNodeRange)(e,J),n.stopPropagation(),void n.preventDefault()}}}if(J.collapse(!0),(0,i.hideElements)(["toolbar"],e),0===a.length)X.classList.add("protyle-wysiwyg--select");else{const t=a[0].previousElementSibling;if(t&&t.getAttribute("data-node-id")){t.classList.add("protyle-wysiwyg--select");const n=t.getBoundingClientRect().top-e.contentElement.getBoundingClientRect().top;n<0&&(e.contentElement.scrollTop=e.contentElement.scrollTop+n,e.scroll.lastScrollTop=e.contentElement.scrollTop+1)}else a[0].parentElement.classList.contains("protyle-wysiwyg")||((0,i.hideElements)(["select"],e),a[0].parentElement.classList.add("protyle-wysiwyg--select"))}const r=[];return e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach((e=>{r.push(e.getAttribute("data-node-id"))})),(0,B.countBlockWord)(r),n.stopPropagation(),void n.preventDefault()}if((0,c.matchHotKey)("⇧↓",n)){const a=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(a.length>0)n.stopPropagation(),n.preventDefault();else{const e=(0,l.getContenteditableElement)(X),i=(0,o.getSelectionOffset)(X,t,J).end;if(i<e.textContent.length)return i>e.textContent.lastIndexOf("\n")?((0,o.setLastNodeRange)(e,J,!1),n.stopPropagation(),void n.preventDefault()):void 0}J.collapse(!1),(0,i.hideElements)(["toolbar"],e);const s=a[a.length-1];if(0===a.length)X.classList.add("protyle-wysiwyg--select");else{const t=s.nextElementSibling;if(t&&t.getAttribute("data-node-id")){t.classList.add("protyle-wysiwyg--select");const n=t.getBoundingClientRect().bottom-e.contentElement.getBoundingClientRect().bottom;n>0&&(e.contentElement.scrollTop=e.contentElement.scrollTop+n,e.scroll.lastScrollTop=e.contentElement.scrollTop-1)}else s.parentElement.classList.contains("protyle-wysiwyg")||((0,i.hideElements)(["select"],e),s.parentElement.classList.add("protyle-wysiwyg--select"))}const r=[];return e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach((e=>{r.push(e.getAttribute("data-node-id"))})),(0,B.countBlockWord)(r),n.stopPropagation(),void n.preventDefault()}if((0,c.matchHotKey)(window.siyuan.config.keymap.general.enter.custom,n)){let t=(0,l.getTopAloneElement)(X);return t.parentElement.classList.contains("li")&&t.parentElement.parentElement.classList.contains("list")&&(null===(P=t.nextElementSibling)||void 0===P?void 0:P.classList.contains("list"))&&t.previousElementSibling.classList.contains("protyle-action")&&(t=t.parentElement),(0,v.zoomOut)(e,t.getAttribute("data-node-id")),n.preventDefault(),void n.stopPropagation()}if((0,c.matchHotKey)(window.siyuan.config.keymap.general.enterBack.custom,n)){if(e.block.showAll)(0,v.zoomOut)(e,e.block.parent2ID,X.getAttribute("data-node-id"));else{const t=e.path.split("/");t.length>2&&(0,y.openFileById)({id:t[t.length-2],action:[E.Constants.CB_GET_FOCUS,E.Constants.CB_GET_SCROLL]})}return n.preventDefault(),void n.stopPropagation()}if(!n.altKey&&!(0,a.isCtrl)(n)&&("Home"===n.key||"End"===n.key)&&(0,a.isMac)()){const e=(0,l.getContenteditableElement)(X);return e&&"TABLE"!==e.tagName&&(n.shiftKey?"Home"===n.key&&e.firstChild?J.setStartBefore(e.firstChild):J.setEndAfter(e.lastChild):(J.selectNodeContents(e),J.collapse("Home"===n.key))),n.stopPropagation(),void n.preventDefault()}if(!n.altKey&&!n.shiftKey&&(0,a.isCtrl)(n)&&"Home"===n.key)return"0"===e.wysiwyg.element.firstElementChild.getAttribute("data-node-index")||"true"===e.wysiwyg.element.firstElementChild.getAttribute("data-eof")?((0,o.focusBlock)(e.wysiwyg.element.firstElementChild),e.contentElement.scrollTop=0,e.scroll.lastScrollTop=1):(0,D.fetchPost)("/api/filetree/getDoc",{id:e.block.rootID,mode:0,size:E.Constants.SIZE_GET},(t=>{(0,x.onGet)(t,e,[E.Constants.CB_GET_FOCUS])})),n.stopPropagation(),void n.preventDefault();if(!n.altKey&&!n.shiftKey&&(0,a.isCtrl)(n)&&"End"===n.key)return e.scroll.element.classList.contains("fn__none")||"true"===e.wysiwyg.element.lastElementChild.getAttribute("data-eof")?(e.contentElement.scrollTop=e.contentElement.scrollHeight,e.scroll.lastScrollTop=e.contentElement.scrollTop,(0,o.focusBlock)(e.wysiwyg.element.lastElementChild,void 0,!1)):(0,D.fetchPost)("/api/filetree/getDoc",{id:e.block.rootID,mode:4,size:E.Constants.SIZE_GET},(t=>{(0,x.onGet)(t,e,[E.Constants.CB_GET_FOCUS])})),n.stopPropagation(),void n.preventDefault();if(!(n.altKey||n.shiftKey||(0,a.isCtrl)(n)||"PageUp"!==n.key&&"PageDown"!==n.key)){"PageUp"===n.key?(e.contentElement.scrollTop=e.contentElement.scrollTop-e.contentElement.clientHeight,e.scroll.lastScrollTop=e.contentElement.scrollTop+1):(e.contentElement.scrollTop=e.contentElement.scrollTop+e.contentElement.clientHeight,e.scroll.lastScrollTop=e.contentElement.scrollTop-1);const t=e.contentElement.getBoundingClientRect();let i=document.elementFromPoint(t.x+t.width/2,t.y+t.height/2);i.classList.contains("protyle-wysiwyg")&&(i=document.elementFromPoint(t.x+t.width/2,t.y+t.height/2+E.Constants.SIZE_TOOLBAR_HEIGHT));const a=(0,s.hasClosestBlock)(i);return a&&!a.isSameNode(X)&&(0,o.focusBlock)(a,void 0,!1),n.stopPropagation(),void n.preventDefault()}if(!n.altKey&&!n.shiftKey&&!(0,a.isCtrl)(n)&&(n.key.indexOf("Arrow")>-1||"Enter"===n.key)&&!e.hint.element.classList.contains("fn__none")&&e.hint.select(n,e))return n.stopPropagation(),void n.preventDefault();if((0,c.matchHotKey)("⌘/",n)){n.stopPropagation(),n.preventDefault();const t=(0,s.hasClosestByAttribute)(J.startContainer,"data-type",null);if(t){const n=t.getAttribute("data-type").split(" ");if(n.includes("block-ref"))return void(0,v.refMenu)(e,t);if(n.includes("inline-memo"))return void e.toolbar.showRender(e,t);if(n.includes("file-annotation-ref"))return void e.toolbar.showFileAnnotationRef(e,t);if(n.includes("a"))return void(0,v.linkMenu)(e,t)}if(0===J.startOffset&&3===J.startContainer.nodeType){const t=(0,l.hasPreviousSibling)(J.startContainer);if(t&&3!==t.nodeType&&t.getAttribute("data-type").indexOf("inline-math")>-1)return void e.toolbar.showRender(e,t);if(!t&&J.startContainer.parentElement.previousSibling.isSameNode(J.startContainer.parentElement.previousElementSibling)&&J.startContainer.parentElement.previousElementSibling.getAttribute("data-type").indexOf("inline-math")>-1)return void e.toolbar.showRender(e,J.startContainer.parentElement.previousElementSibling)}const i=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");let a=X;i.length>0&&(a=i[0]),e.gutter.renderMenu(e,a);const o=X.getBoundingClientRect();return void window.siyuan.menus.menu.popup({x:o.left,y:o.top},!0)}if((0,d.fixTable)(e,n,J))return void n.preventDefault();if(!n.altKey&&!n.shiftKey&&!(0,a.isCtrl)(n)&&!n.isComposing&&n.key.indexOf("Arrow")>-1){e.hint.enableEmoji=!1;const t=(0,l.getContenteditableElement)(X)||X,i=(0,o.getSelectionOffset)(t,e.wysiwyg.element,J),a=(0,s.hasClosestByMatchTag)(J.startContainer,"TD");if("ArrowDown"===n.key&&-1===(null==t?void 0:t.textContent.trimRight().substr(i.start).indexOf("\n"))&&(a&&!a.parentElement.nextElementSibling&&"NodeTable"===X.getAttribute("data-type")&&!(0,l.getNextBlock)(X)||"NodeCodeBlock"===X.getAttribute("data-type")&&!(0,l.getNextBlock)(X)||"NodeBlockquote"===X.parentElement.getAttribute("data-type")&&X.nextElementSibling.classList.contains("protyle-attr")&&!(0,l.getNextBlock)(X.parentElement)))"NodeBlockquote"===X.parentElement.getAttribute("data-type")?(0,m.insertEmptyBlock)(e,"afterend",X.parentElement.getAttribute("data-node-id")):(0,m.insertEmptyBlock)(e,"afterend",X.getAttribute("data-node-id"));else if("ArrowUp"===n.key){const a=(0,l.getContenteditableElement)(e.wysiwyg.element.firstElementChild);if(!(0,l.getPreviousBlock)(X)&&X.contains(a)||!a&&X.isSameNode(e.wysiwyg.element.firstElementChild))-1===(null==t?void 0:t.textContent.substr(0,i.end).indexOf("\n"))&&(!e.title||"true"!==e.wysiwyg.element.firstElementChild.getAttribute("data-eof")&&0!==e.contentElement.scrollTop?(e.contentElement.scrollTop=0,e.scroll.lastScrollTop=8):e.title.editElement.focus());else if(-1===(null==t?void 0:t.textContent.substr(0,i.end).indexOf("\n"))){let t=(0,l.getPreviousBlock)(X);if(t&&(t=(0,l.getLastBlock)(t),t)){const i=(0,s.hasClosestByAttribute)(t,"fold","1");(null===(I=(0,l.getContenteditableElement)(t))||void 0===I?void 0:I.textContent.endsWith("\n"))&&!i?((0,o.focusBlock)(t,void 0,!1),(0,S.scrollCenter)(e,t),n.stopPropagation(),n.preventDefault()):i&&"NodeListItem"!==i.getAttribute("data-type")&&(i.scrollTop=0,(0,o.focusBlock)(i,void 0,!0),(0,S.scrollCenter)(e,i),n.stopPropagation(),n.preventDefault())}}}else if(""!==J.toString()||"ArrowDown"!==n.key&&"ArrowRight"!==n.key||!X.isSameNode((0,l.getLastBlock)(e.wysiwyg.element.lastElementChild))||(0,s.hasClosestByMatchTag)(J.startContainer,"TD")||(0,s.hasClosestByMatchTag)(J.startContainer,"TH")){if(""===J.toString()&&"ArrowLeft"===n.key&&X.isSameNode((0,l.getFirstBlock)(e.wysiwyg.element.firstElementChild))){const e=(0,l.getContenteditableElement)(X);e&&0===(0,o.getSelectionOffset)(e,void 0,J).start&&(n.stopPropagation(),n.preventDefault(),(0,o.focusByRange)(J))}}else{const e=(0,l.getContenteditableElement)(X);e&&e.textContent.replace(/\n$/,"").length<=(0,o.getSelectionOffset)(e,void 0,J).end&&(n.stopPropagation(),n.preventDefault(),(0,o.focusByRange)(J))}if("ArrowDown"===n.key){const a=(0,s.hasClosestByAttribute)(J.startContainer,"fold","1");if(a){let t=(0,l.getNextBlock)(a);t&&("1"===t.getAttribute("fold")&&(t.classList.contains("sb")||t.classList.contains("bq"))||(t=(0,l.getFirstBlock)(t)),(0,o.focusBlock)(t),(0,S.scrollCenter)(e,t)),n.stopPropagation(),n.preventDefault()}else if(-1===(null==t?void 0:t.textContent.substr(i.end+1).indexOf("\n"))){const t=(0,l.getNextBlock)(X);t&&"1"===t.getAttribute("fold")&&((0,o.focusBlock)(t),(0,S.scrollCenter)(e,t),n.stopPropagation(),n.preventDefault())}}return}const Q=J.toString();if(!(n.altKey||n.shiftKey||"Backspace"!==n.key&&"Delete"!==n.key)){(0,B.countBlockWord)([]);const t=(0,l.hasPreviousSibling)(J.startContainer);1===J.startOffset&&J.startContainer.textContent===E.Constants.ZWSP&&t&&3!==t.nodeType&&t.classList.contains("img")&&t.classList.add("img--select");const i=e.wysiwyg.element.querySelector(".img--select");if(e.wysiwyg.element.querySelector(".protyle-wysiwyg--select"))return(0,r.removeBlock)(e,X,J),n.stopPropagation(),void n.preventDefault();if(i){i.insertAdjacentHTML("afterend","<wbr>"),i.classList.remove("img--select");const t=X.outerHTML;return i.remove(),(0,p.updateTransaction)(e,X.getAttribute("data-node-id"),X.outerHTML,t),(0,o.focusByWbr)(X,J),n.stopPropagation(),void n.preventDefault()}if(""===Q){const t=(0,l.getContenteditableElement)(X);if(!t)return X.classList.add("protyle-wysiwyg--select"),(0,r.removeBlock)(e,X,J),n.stopPropagation(),void n.preventDefault();const i=(0,o.getSelectionOffset)(t,e.wysiwyg.element,J);if("Delete"===n.key){if(i.end===t.textContent.length){const t=(0,l.getNextBlock)((0,l.getTopAloneElement)(X));if(t){const i=(0,o.focusBlock)(t);if(i){const t=(0,s.hasClosestBlock)(i.startContainer);t&&(0,r.removeBlock)(e,t,i)}return n.stopPropagation(),void n.preventDefault()}}else if(i.end===t.textContent.length-1&&"NodeCodeBlock"===X.getAttribute("data-type"))return n.stopPropagation(),void n.preventDefault()}else{const t=J.startContainer.childNodes[J.startOffset-1];if(0===i.start&&(0===J.startOffset||t&&3===t.nodeType&&!(0,l.hasPreviousSibling)(t)&&""===t.textContent))return(0,r.removeBlock)(e,X,J),n.stopPropagation(),void n.preventDefault();if(3!==J.startContainer.nodeType&&"NodeTable"===X.getAttribute("data-type")&&"TABLE"===(null===(M=J.startContainer.children[J.startOffset-1])||void 0===M?void 0:M.tagName))return X.classList.add("protyle-wysiwyg--select"),(0,r.removeBlock)(e,X,J),n.stopPropagation(),void n.preventDefault();if(t&&3!==t.nodeType&&t.classList.contains("img")){J.insertNode(document.createElement("wbr"));const i=X.outerHTML;return t.remove(),(0,p.updateTransaction)(e,X.getAttribute("data-node-id"),X.outerHTML,i),(0,o.focusByWbr)(X,J),n.stopPropagation(),void n.preventDefault()}if(X.classList.contains("code-block")&&3===J.startContainer.nodeType&&"\n"===J.startContainer.textContent.substring(J.startOffset-1,J.startOffset))return n.stopPropagation(),void n.preventDefault()}}}if((0,c.matchHotKey)("⇧↩",n)&&""===J.toString()){let t=J.startContainer;const i=(0,l.hasNextSibling)(t);if(i&&3!==i.nodeType&&i.classList.contains("img")){i.insertAdjacentHTML("beforebegin","<wbr>");const a=X.outerHTML;i.previousElementSibling.remove();const o=document.createTextNode("\n");return t.after(document.createTextNode(E.Constants.ZWSP)),t.after(o),J.selectNode(o),J.collapse(!1),(0,p.updateTransaction)(e,X.getAttribute("data-node-id"),X.outerHTML,a),n.stopPropagation(),void n.preventDefault()}if(3===t.nodeType&&(t=t.parentElement),t&&e.toolbar.getCurrentType(J).length>0&&(0,o.getSelectionOffset)(t,t,J).end===t.textContent.length){t.insertAdjacentHTML("afterend","<wbr>");const i=X.outerHTML;t.nextElementSibling.remove(),(0,l.hasNextSibling)(t)||t.after(document.createTextNode("\n"));const a=document.createTextNode("\n");return t.after(a),J.selectNode(a),J.collapse(!1),(0,p.updateTransaction)(e,X.getAttribute("data-node-id"),X.outerHTML,i),n.stopPropagation(),void n.preventDefault()}if("ios"===window.siyuan.config.system.container){t=J.startContainer;const e=(0,l.hasNextSibling)(t);if(e&&""!==e.textContent.trim())return document.execCommand("insertHTML",!1,"\n"),n.stopPropagation(),void n.preventDefault();e||t.after(document.createTextNode("\n"));const i=document.createTextNode("\n");t.after(i);const a=(0,l.hasNextSibling)(i);return a&&"\n"===a.textContent?J.setStart(a,0):J.setStart(i,0),J.collapse(!1),(0,o.focusByRange)(J),n.stopPropagation(),void n.preventDefault()}}if(!n.altKey&&!n.shiftKey&&!(0,a.isCtrl)(n)&&"Enter"===n.key)return n.stopPropagation(),n.preventDefault(),void(0,u.enter)(X,J,e);if((0,c.matchHotKey)("⌘A",n))return n.preventDefault(),(0,o.selectAll)(e,X,J),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.undo.custom,n))return e.undo.undo(e),n.preventDefault(),void n.stopPropagation();if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.redo.custom,n))return e.undo.redo(e),n.preventDefault(),void n.stopPropagation();if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.copyProtocol.custom,n)){const t=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");let i;return i=1===t.length?t[0]:X,(0,a.writeText)(`siyuan://blocks/${i.getAttribute("data-node-id")}`),n.preventDefault(),n.stopPropagation(),!0}if((0,b.commonHotkey)(e,n))return!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.copyID.custom,n))return(0,a.writeText)(X.getAttribute("data-node-id")),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.copyBlockRef.custom,n)){const t=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");let i;i=1===t.length?t[0]:X;const o=i.getAttribute("data-node-id");return""!==Q?(0,a.writeText)(`((${o} "${Q}"))`):(0,D.fetchPost)("/api/block/getRefText",{id:o},(e=>{(0,a.writeText)(`((${o} '${e.data}'))`)})),n.preventDefault(),n.stopPropagation(),!0}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.copyBlockEmbed.custom,n)){const t=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");let i;return i=1===t.length?t[0]:X,(0,a.writeText)(`{{select * from blocks where id='${i.getAttribute("data-node-id")}'}}`),n.preventDefault(),n.stopPropagation(),!0}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.attr.custom,n)){const t=(0,l.getTopAloneElement)(X);if(""===Q){const n=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");let i;i=1===n.length?n[0]:t,(0,_.openAttr)(i,e)}else{const n=t.outerHTML,i=Lute.EscapeHTMLStr(Q),a=t.lastElementChild.querySelector(".protyle-attr--name");a?a.innerHTML=`<svg><use xlink:href="#iconN"></use></svg>${i}`:t.lastElementChild.insertAdjacentHTML("afterbegin",`<div class="protyle-attr--name"><svg><use xlink:href="#iconN"></use></svg>${i}</div>`),t.setAttribute("name",i),(0,p.updateTransaction)(e,t.getAttribute("data-node-id"),t.outerHTML,n)}return n.preventDefault(),n.stopPropagation(),!0}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.rename.custom,n))return""===Q?(0,D.fetchPost)("/api/block/getDocInfo",{id:e.block.rootID},(t=>{(0,g.rename)({notebookId:e.notebookId,path:e.path,name:t.data.ial.title,range:J,type:"file"})})):(0,D.fetchPost)("/api/filetree/renameDoc",{notebook:e.notebookId,path:e.path,title:(0,g.replaceFileName)(Q)}),n.preventDefault(),void n.stopPropagation();if(Q.trim()&&(0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.newNameFile.custom,n))return(0,g.newFileBySelect)(Q,e),n.preventDefault(),void n.stopPropagation();if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.newContentFile.custom,n))return(0,g.newFileContentBySelect)(e),n.preventDefault(),void n.stopPropagation();if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.alignLeft.custom,n)){const t=X.querySelectorAll(".img--select");if(t.length>0){const n=X.outerHTML;t.forEach((e=>{e.style.display="",(0,l.hasNextSibling)(e)||e.insertAdjacentText("afterend",E.Constants.ZWSP)})),(0,p.updateTransaction)(e,X.getAttribute("data-node-id"),X.outerHTML,n)}else{let t=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));0===t.length&&(t=[X]),(0,p.updateBatchTransaction)(t,e,(e=>{e.style.textAlign="left"}))}return n.stopPropagation(),void n.preventDefault()}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.alignCenter.custom,n)){const t=X.querySelectorAll(".img--select");if(t.length>0){const n=X.outerHTML;t.forEach((e=>{e.style.display="block";let t=e.nextSibling;for(;t;){if(""!==t.textContent){if(t.textContent===E.Constants.ZWSP){t.textContent="";break}break}t=t.nextSibling}})),(0,p.updateTransaction)(e,X.getAttribute("data-node-id"),X.outerHTML,n)}else{let t=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));0===t.length&&(t=[X]),(0,p.updateBatchTransaction)(t,e,(e=>{e.style.textAlign="center"}))}return n.stopPropagation(),void n.preventDefault()}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.alignRight.custom,n)){let t=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));return 0===t.length&&(t=[X]),(0,p.updateBatchTransaction)(t,e,(e=>{e.style.textAlign="right"})),n.stopPropagation(),void n.preventDefault()}if("Escape"===n.key)return e.toolbar.element.classList.contains("fn__none")&&e.hint.element.classList.contains("fn__none")&&e.toolbar.subElement.classList.contains("fn__none")?X.classList.contains("protyle-wysiwyg--select")?((0,i.hideElements)(["select"],e),(0,B.countBlockWord)([])):window.siyuan.menus.menu.element.classList.contains("fn__none")?(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach((e=>{e.classList.remove("protyle-wysiwyg--select")})),J.collapse(!1),X.classList.add("protyle-wysiwyg--select"),(0,B.countBlockWord)([X.getAttribute("data-node-id")])):window.siyuan.menus.menu.remove():((0,i.hideElements)(["toolbar","hint","util"],e),e.hint.enableEmoji=!1),void n.preventDefault();if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.heading.paragraph.custom,n))return(0,p.turnsIntoTransaction)({protyle:e,nodeElement:X,type:"Blocks2Ps"}),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.heading.heading1.custom,n))return(0,p.turnsIntoTransaction)({protyle:e,nodeElement:X,type:"Blocks2Hs",level:1}),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.heading.heading2.custom,n))return(0,p.turnsIntoTransaction)({protyle:e,nodeElement:X,type:"Blocks2Hs",level:2}),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.heading.heading3.custom,n))return(0,p.turnsIntoTransaction)({protyle:e,nodeElement:X,type:"Blocks2Hs",level:3}),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.heading.heading4.custom,n))return(0,p.turnsIntoTransaction)({protyle:e,nodeElement:X,type:"Blocks2Hs",level:4}),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.heading.heading5.custom,n))return(0,p.turnsIntoTransaction)({protyle:e,nodeElement:X,type:"Blocks2Hs",level:5}),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.heading.heading6.custom,n))return(0,p.turnsIntoTransaction)({protyle:e,nodeElement:X,type:"Blocks2Hs",level:6}),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.insert.code.custom,n)&&"NodeCodeBlock"!==X.getAttribute("data-type")){const t=X.getAttribute("data-node-id"),i=X.outerHTML,a=(0,l.getContenteditableElement)(X);a.innerHTML="```"+(localStorage.getItem(E.Constants.LOCAL_CODELANG)||"")+"\n"+a.textContent+"<wbr>\n```";const o=e.lute.SpinBlockDOM(X.outerHTML);X.outerHTML=o;const s=e.wysiwyg.element.querySelector(`[data-node-id="${t}"]`);return(0,p.updateTransaction)(e,t,o,i),(0,T.highlightRender)(s),n.preventDefault(),n.stopPropagation(),!0}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.insert.lastUsed.custom,n))return e.toolbar.range=J,(0,h.fontEvent)(e),n.stopPropagation(),void n.preventDefault();if(!X.classList.contains("code-block")){if(e.options.toolbar.find((t=>!!t.hotkey&&((0,c.matchHotKey)(t.hotkey,n)?(e.toolbar.range=(0,o.getEditorRange)(e.wysiwyg.element),e.toolbar.setInlineMark(e,t.name,"range"),!0):void 0))))return n.preventDefault(),n.stopPropagation(),e.wysiwyg.preventKeyup=!0,!0}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.list.outdent.custom,n)){const t=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(t.length>0&&"NodeListItem"===t[0].getAttribute("data-type"))return(0,f.listOutdent)(e,Array.from(t),J),n.preventDefault(),n.stopPropagation(),!0;if(X.parentElement.classList.contains("li")&&"NodeCodeBlock"!==X.getAttribute("data-type"))return(0,f.listOutdent)(e,[X.parentElement],J),n.preventDefault(),n.stopPropagation(),!0}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.list.indent.custom,n)){const t=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(t.length>0&&"NodeListItem"===t[0].getAttribute("data-type"))return(0,f.listIndent)(e,Array.from(t),J),n.preventDefault(),n.stopPropagation(),!0;if(X.parentElement.classList.contains("li")&&"NodeCodeBlock"!==X.getAttribute("data-type"))return(0,f.listIndent)(e,[X.parentElement],J),n.preventDefault(),n.stopPropagation(),!0}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.insert.check.custom,n))return e.hint.splitChar="/",e.hint.lastIndex=-1,e.hint.fill("* [ ] "+Lute.Caret,e),n.preventDefault(),void n.stopPropagation();if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.insert.table.custom,n))return e.hint.splitChar="/",e.hint.lastIndex=-1,e.hint.fill(`| col1${Lute.Caret} | col2 | col3 |\n| --- | --- | --- |\n|  |  |  |\n|  |  |  |`,e),n.preventDefault(),void n.stopPropagation();if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.list.checkToggle.custom,n)){const t=(0,s.hasClosestByAttribute)(J.startContainer,"data-subtype","t");if(!t)return;const i=t.outerHTML;return t.classList.contains("protyle-task--done")?(t.querySelector("use").setAttribute("xlink:href","#iconUncheck"),t.classList.remove("protyle-task--done")):(t.querySelector("use").setAttribute("xlink:href","#iconCheck"),t.classList.add("protyle-task--done")),t.setAttribute("updated",L().format("YYYYMMDDHHmmss")),(0,p.updateTransaction)(e,t.getAttribute("data-node-id"),t.outerHTML,i),n.preventDefault(),void n.stopPropagation()}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.insertBefore.custom,n))return(0,m.insertEmptyBlock)(e,"beforebegin"),n.preventDefault(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.insertAfter.custom,n))return(0,m.insertEmptyBlock)(e,"afterend"),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.jumpToParentNext.custom,n))return(0,m.jumpToParentNext)(e,X),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.moveToUp.custom,n)){let t;n.preventDefault(),n.stopPropagation();let i=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(0===i.length){let e=(0,l.getTopAloneElement)(X);const t=(0,s.hasClosestByAttribute)(e,"fold","1");t&&(e=t),(null===(F=e.previousElementSibling)||void 0===F?void 0:F.classList.contains("protyle-action"))&&(e=(0,l.getTopAloneElement)(e.parentElement)),i=[e]}const a=i[0].getAttribute("data-type");if("NodeListItem"===a&&!i[0].previousElementSibling&&(null===($=null===(N=i[0].parentElement.previousElementSibling)||void 0===N?void 0:N.previousElementSibling)||void 0===$?void 0:$.classList.contains("protyle-action"))&&((null===(O=i[0].parentElement.parentElement.previousElementSibling)||void 0===O?void 0:O.classList.contains("li"))&&(t=i[0].parentElement.parentElement.previousElementSibling.querySelector(".list")),!t))return;if("NodeList"===a&&(null===(R=null===(H=i[0].previousElementSibling)||void 0===H?void 0:H.previousElementSibling)||void 0===R?void 0:R.classList.contains("protyle-action"))&&((null===(q=i[0].parentElement.previousElementSibling)||void 0===q?void 0:q.classList.contains("li"))&&(t=i[0].parentElement.previousElementSibling.querySelector(".list")),!t))return;if(t){t=t.lastElementChild.previousElementSibling;const n=i[0].classList.contains("list")?i[0]:i[0].parentElement;J.insertNode(document.createElement("wbr"));const a=t.parentElement.parentElement.parentElement.outerHTML;return i.reverse().forEach((e=>{e.classList.contains("list")?t.after(e.firstElementChild):t.after(e)})),1===n.childElementCount?n.remove():"o"===n.getAttribute("data-subtype")&&n.classList.contains("list")&&(0,f.updateListOrder)(n,1),"o"===t.getAttribute("data-subtype")&&(0,f.updateListOrder)(t.parentElement),(0,p.updateTransaction)(e,t.parentElement.parentElement.parentElement.getAttribute("data-node-id"),t.parentElement.parentElement.parentElement.outerHTML,a),(0,k.preventScroll)(e),(0,S.scrollCenter)(e),void(0,o.focusByWbr)(t.parentElement,J)}if(!i[0].previousElementSibling||(null===(j=i[0].previousElementSibling)||void 0===j?void 0:j.classList.contains("protyle-action")))return;if(t=i[0].previousElementSibling,"o"===i[0].getAttribute("data-subtype")&&"NodeListItem"===a){const n=i[0].parentElement.outerHTML;i[i.length-1].after(t),(0,f.updateListOrder)(i[0].parentElement,1),(0,p.updateTransaction)(e,i[0].parentElement.getAttribute("data-node-id"),i[0].parentElement.outerHTML,n)}else{const n=t.getAttribute("data-node-id");(0,p.transaction)(e,[{action:"move",id:n,previousID:i[i.length-1].getAttribute("data-node-id")}],[{action:"move",id:n,previousID:null===(U=t.previousElementSibling)||void 0===U?void 0:U.getAttribute("data-node-id"),parentID:t.parentElement.getAttribute("data-node-id")||e.block.parentID}]),i[i.length-1].after(t)}return(0,k.preventScroll)(e),void(0,S.scrollCenter)(e)}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.moveToDown.custom,n)){let t;n.preventDefault(),n.stopPropagation();let i=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(0===i.length){let e=(0,l.getTopAloneElement)(X);const t=(0,s.hasClosestByAttribute)(e,"fold","1");t&&(e=t),(null===(z=e.previousElementSibling)||void 0===z?void 0:z.classList.contains("protyle-action"))&&(e=(0,l.getTopAloneElement)(e.parentElement)),i=[e]}const a=i[0].getAttribute("data-type");if("NodeListItem"===a&&i[i.length-1].nextElementSibling.classList.contains("protyle-attr")&&(null===(W=i[0].parentElement.parentElement)||void 0===W?void 0:W.classList.contains("li"))&&((null===(G=i[0].parentElement.parentElement.nextElementSibling)||void 0===G?void 0:G.classList.contains("li"))&&(t=i[0].parentElement.parentElement.nextElementSibling.querySelector(".list > .li")),!t))return;if("NodeList"===a&&i[i.length-1].nextElementSibling.classList.contains("protyle-attr")&&(null===(V=i[0].parentElement)||void 0===V?void 0:V.classList.contains("li"))&&((null===(Y=i[0].parentElement.nextElementSibling)||void 0===Y?void 0:Y.classList.contains("li"))&&(t=i[0].parentElement.nextElementSibling.querySelector(".list > .li")),!t))return;if(t){const n=i[0].classList.contains("list")?i[0]:i[0].parentElement;J.insertNode(document.createElement("wbr"));const a=t.parentElement.parentElement.parentElement.outerHTML;return i.forEach((e=>{e.classList.contains("list")?t.before(e.firstElementChild):t.before(e)})),1===n.childElementCount?n.remove():"o"===n.getAttribute("data-subtype")&&n.classList.contains("list")&&(0,f.updateListOrder)(n,1),"o"===t.getAttribute("data-subtype")&&(0,f.updateListOrder)(t.parentElement,1),(0,p.updateTransaction)(e,t.parentElement.parentElement.parentElement.getAttribute("data-node-id"),t.parentElement.parentElement.parentElement.outerHTML,a),(0,k.preventScroll)(e),(0,S.scrollCenter)(e),void(0,o.focusByWbr)(t.parentElement,J)}if(!i[i.length-1].nextElementSibling||(null===(K=i[i.length-1].nextElementSibling)||void 0===K?void 0:K.classList.contains("protyle-attr")))return;if(t=i[i.length-1].nextElementSibling,"o"===t.getAttribute("data-subtype")&&"NodeListItem"===t.getAttribute("data-type")){const n=t.parentElement.outerHTML;i[0].before(t),(0,f.updateListOrder)(t.parentElement,1),(0,p.updateTransaction)(e,t.parentElement.getAttribute("data-node-id"),t.parentElement.outerHTML,n)}else{const n=t.getAttribute("data-node-id");(0,p.transaction)(e,[{action:"move",id:n,previousID:null===(Z=i[0].previousElementSibling)||void 0===Z?void 0:Z.getAttribute("data-node-id"),parentID:t.parentElement.getAttribute("data-node-id")||e.block.parentID}],[{action:"move",id:n,previousID:i[i.length-1].getAttribute("data-node-id")}]),i[0].before(t)}return(0,k.preventScroll)(e),void(0,S.scrollCenter)(e)}if((0,l.isNotEditBlock)(X)&&"NodeHTMLBlock"!==X.getAttribute("data-type")&&(0,c.matchHotKey)("⌘C",n)){let t="";e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach((e=>{t+=(0,w.removeEmbed)(e)})),(0,a.writeText)(e.lute.BlockDOM2StdMd(t).trimEnd())}if((0,l.isNotEditBlock)(X)&&(0,c.matchHotKey)("⌘X",n)){let t="";X.classList.add("protyle-wysiwyg--select");const i=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");i.forEach((e=>{t+=(0,w.removeEmbed)(e)})),(0,a.writeText)(e.lute.BlockDOM2StdMd(t).trimEnd());const s=(0,l.getNextBlock)(i[i.length-1]);(0,r.removeBlock)(e,X,J),s&&(0,o.focusBlock)(s),n.preventDefault(),n.stopPropagation()}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.copyPlainText.custom,n)){if(""===J.toString()){const t=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));let n="";0===t.length&&t.push(X),t.forEach((e=>{e.querySelectorAll('[contenteditable="true"]').forEach((e=>{const t=e.cloneNode(!0);t.querySelectorAll('[data-type="backslash"]').forEach((e=>{e.firstElementChild.remove()})),n+=t.textContent+"\n"}))})),(0,a.writeText)(n.trimEnd())}else{const e=J.cloneContents();e.querySelectorAll('[data-type="backslash"]').forEach((e=>{e.firstElementChild.remove()})),(0,a.writeText)(e.textContent)}return n.preventDefault(),void n.stopPropagation()}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.vLayout.custom,n)){n.preventDefault(),n.stopPropagation();const t=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(t.length<2)return;return void(0,p.turnsIntoOneTransaction)({protyle:e,selectsElement:t,type:"BlocksMergeSuperBlock",level:"row"})}if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.hLayout.custom,n)){n.preventDefault(),n.stopPropagation();const t=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(t.length<2)return;return void(0,p.turnsIntoOneTransaction)({protyle:e,selectsElement:t,type:"BlocksMergeSuperBlock",level:"col"})}if("Tab"===n.key&&!n.ctrlKey&&!(0,a.isCtrl)(n)&&!n.altKey){n.preventDefault();const t=0===window.siyuan.config.editor.codeTabSpaces?"\t":"".padStart(window.siyuan.config.editor.codeTabSpaces," ");if("NodeCodeBlock"===X.getAttribute("data-type")&&""!==Q){const i=document.createElement("wbr");J.insertNode(i),J.setStartAfter(i);const a=X.outerHTML;let o="";n.shiftKey?J.extractContents().textContent.split("\n").forEach((e=>{e.startsWith(t)?o+=e.replace(t,"")+"\n":o+=e+"\n"})):J.extractContents().textContent.split("\n").forEach((e=>{o+=t+e+"\n"}));const s=document.createElement("span");let r=X.querySelector(".protyle-action__language").textContent;return hljs.getLanguage(r)||(r="plaintext"),s.innerHTML=hljs.highlight(o.substr(0,o.length-1),{language:r,ignoreIllegals:!0}).value,J.insertNode(s),(0,p.updateTransaction)(e,X.getAttribute("data-node-id"),X.outerHTML,a),void i.remove()}if(!n.shiftKey){const n=document.createElement("wbr");J.insertNode(n);const i=X.outerHTML;return J.extractContents(),J.insertNode(document.createTextNode(t)),J.collapse(!1),(0,o.focusByRange)(J),n.remove(),(0,p.updateTransaction)(e,X.getAttribute("data-node-id"),X.outerHTML,i),!0}}const ee=(0,s.hasClosestByAttribute)(J.startContainer,"data-type","block-ref");if(ee){const e=ee.getAttribute("data-id");if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.openBy.custom,n))return(0,D.fetchPost)("/api/block/checkBlockFold",{id:e},(t=>{(0,y.openFileById)({id:e,action:t.data?[E.Constants.CB_GET_FOCUS,E.Constants.CB_GET_ALL]:[E.Constants.CB_GET_FOCUS,E.Constants.CB_GET_CONTEXT],zoomIn:t.data})})),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.refTab.custom,n))return(0,D.fetchPost)("/api/block/checkBlockFold",{id:e},(t=>{(0,y.openFileById)({id:e,action:t.data?[E.Constants.CB_GET_FOCUS,E.Constants.CB_GET_ALL]:[E.Constants.CB_GET_HL,E.Constants.CB_GET_CONTEXT],keepCursor:!0,zoomIn:t.data})})),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.insertRight.custom,n))return(0,D.fetchPost)("/api/block/checkBlockFold",{id:e},(t=>{(0,y.openFileById)({id:e,position:"right",action:t.data?[E.Constants.CB_GET_FOCUS,E.Constants.CB_GET_ALL]:[E.Constants.CB_GET_FOCUS,E.Constants.CB_GET_CONTEXT],zoomIn:t.data})})),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.insertBottom.custom,n))return(0,D.fetchPost)("/api/block/checkBlockFold",{id:e},(t=>{(0,y.openFileById)({id:e,position:"bottom",action:t.data?[E.Constants.CB_GET_FOCUS,E.Constants.CB_GET_ALL]:[E.Constants.CB_GET_FOCUS,E.Constants.CB_GET_CONTEXT],zoomIn:t.data})})),n.preventDefault(),n.stopPropagation(),!0;if((0,c.matchHotKey)(window.siyuan.config.keymap.editor.general.refPopover.custom,n))return window.siyuan.blockPanels.push(new A.BlockPanel({targetElement:ee,nodeIds:[e]})),n.preventDefault(),n.stopPropagation(),!0}(0,a.isCtrl)(n)||"Backspace"===n.key||"Escape"===n.key||"Delete"===n.key||n.shiftKey||n.altKey||"Enter"===n.key||(0,i.hideElements)(["select"],e)}))}},4921:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listOutdent=t.breakList=t.listIndent=t.genListItemElement=t.updateListOrder=void 0;const i=n(4640),a=n(6840),o=n(9173),s=n(5680),r=n(8792);t.updateListOrder=(e,t)=>{if("o"!==e.getAttribute("data-subtype"))return;let n;Array.from(e.children).forEach(((e,i)=>{0===i?t?(n=t,e.setAttribute("data-marker",n+"."),e.querySelector(".protyle-action--order").textContent=n+"."):n=parseInt(e.getAttribute("data-marker")):e.classList.contains("li")&&(n++,e.setAttribute("data-marker",n+"."),e.querySelector(".protyle-action--order").textContent=n+".")}))};t.genListItemElement=(e,t=0,n=!1)=>{const i=document.createElement("template"),a=e.getAttribute("data-subtype");if("o"===a){const s=parseInt(e.getAttribute("data-marker"))+t;i.innerHTML=`<div data-marker="${s+1}." data-subtype="${a}" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div contenteditable="false" class="protyle-action protyle-action--order" draggable="true">${s+1}.</div>${(0,o.genEmptyBlock)(!1,n)}<div class="protyle-attr" contenteditable="false"></div></div>`}else i.innerHTML="t"===a?`<div data-marker="*" data-subtype="${a}" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#iconUncheck"></use></svg></div>${(0,o.genEmptyBlock)(!1,n)}<div class="protyle-attr" contenteditable="false"></div></div>`:`<div data-marker="*" data-subtype="${a}" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div>${(0,o.genEmptyBlock)(!1,n)}<div class="protyle-attr" contenteditable="false"></div></div>`;return i.content.firstElementChild};t.listIndent=(e,n,o)=>{const s=n[0].previousElementSibling;if(!s)return;o.collapse(!1),o.insertNode(document.createElement("wbr")),n.forEach((e=>{e.classList.remove("protyle-wysiwyg--select")}));const r=s.parentElement.outerHTML;if("NodeList"===s.lastElementChild.previousElementSibling.getAttribute("data-type")){const i=s.lastElementChild.previousElementSibling.outerHTML,o=[],r=[],l=s.lastElementChild.previousElementSibling.getAttribute("data-subtype");let c=s.lastElementChild.previousElementSibling.lastElementChild.previousElementSibling.getAttribute("data-node-id");n.forEach(((e,t)=>{o.push({action:"move",id:e.getAttribute("data-node-id"),previousID:c}),r.push({action:"move",id:e.getAttribute("data-node-id"),previousID:0===t?s.getAttribute("data-node-id"):c}),c=e.getAttribute("data-node-id"),e.setAttribute("data-subtype",l);const n=e.querySelector(".protyle-action");"o"===l?(n.classList.add("protyle-action--order"),n.classList.remove("protyle-action--task"),s.lastElementChild.previousElementSibling.lastElementChild.before(e)):"t"===l?(e.setAttribute("data-marker","*"),n.innerHTML='<svg><use xlink:href="#iconUncheck"></use></svg>',n.classList.remove("protyle-action--order"),n.classList.add("protyle-action--task"),s.lastElementChild.previousElementSibling.lastElementChild.before(e)):(e.setAttribute("data-marker","*"),n.innerHTML='<svg><use xlink:href="#iconDot"></use></svg>',n.classList.remove("protyle-action--order","protyle-action--task"),s.lastElementChild.previousElementSibling.lastElementChild.before(e))})),"o"===l?((0,t.updateListOrder)(s.lastElementChild.previousElementSibling),(0,t.updateListOrder)(s.parentElement)):"o"===s.getAttribute("data-subtype")&&(0,t.updateListOrder)(s.parentElement),s.parentElement.classList.contains("protyle-wysiwyg")&&(o.push({action:"update",data:s.lastElementChild.previousElementSibling.outerHTML,id:s.lastElementChild.previousElementSibling.getAttribute("data-node-id")}),r.push({action:"update",data:i,id:s.lastElementChild.previousElementSibling.getAttribute("data-node-id")}),(0,a.transaction)(e,o,r))}else{const i=s.outerHTML,o=n[0].getAttribute("data-subtype"),r=document.createElement("div"),l=Lute.NewNodeID();r.setAttribute("data-node-id",l),r.setAttribute("data-type","NodeList"),r.setAttribute("class","list"),r.setAttribute("data-subtype",o),r.innerHTML='<div class="protyle-attr" contenteditable="false"></div>';const c=[{action:"insert",data:r.outerHTML,id:l,previousID:s.lastElementChild.previousElementSibling.getAttribute("data-node-id")}];s.lastElementChild.before(r);const u=[];let d;n.forEach(((e,t)=>{c.push({action:"move",id:e.getAttribute("data-node-id"),parentID:l,previousID:d}),u.push({action:"move",id:e.getAttribute("data-node-id"),previousID:0===t?s.getAttribute("data-node-id"):d}),d=e.getAttribute("data-node-id"),r.lastElementChild.before(e)})),u.push({action:"delete",id:l}),"o"===o&&((0,t.updateListOrder)(r,1),(0,t.updateListOrder)(s.parentElement)),s.parentElement.classList.contains("protyle-wysiwyg")&&(c.push({action:"update",data:s.outerHTML,id:s.getAttribute("data-node-id")}),u.push({action:"update",data:i,id:s.getAttribute("data-node-id")}),(0,a.transaction)(e,c,u))}s.parentElement.classList.contains("protyle-wysiwyg")||(0,a.updateTransaction)(e,s.parentElement.getAttribute("data-node-id"),s.parentElement.outerHTML,r),(0,i.focusByWbr)(s,o)};t.breakList=(e,t,n)=>{var o,l;const c=t.parentElement,u=c.getAttribute("data-node-id"),d=[],p=[];n.insertNode(document.createElement("wbr"));const h=Lute.NewNodeID();let f="",g=0;Array.from(c.parentElement.children).forEach((e=>{!g&&e.isSameNode(c)?g=1:g&&!e.classList.contains("protyle-attr")&&(p.push({id:e.getAttribute("data-node-id"),action:"move",previousID:u}),d.push({id:e.getAttribute("data-node-id"),action:"delete"}),"o"===e.getAttribute("data-subtype")&&(p.push({id:e.getAttribute("data-node-id"),action:"update",data:e.outerHTML}),e.setAttribute("data-marker",g+"."),e.firstElementChild.innerHTML=g+"."),f+=e.outerHTML,e.remove(),g++)})),p.reverse(),f=`<div data-subtype="${c.getAttribute("data-subtype")}" data-node-id="${h}" data-type="NodeList" class="list" updated="${s().format("YYYYMMDDHHmmss")}">${f}<div class="protyle-attr" contenteditable="false">${r.Constants.ZWSP}</div></div>`,c.parentElement.insertAdjacentHTML("afterend",f),d.push({id:h,action:"insert",previousID:c.parentElement.getAttribute("data-node-id"),data:f}),p.push({id:h,action:"delete"}),Array.from(c.children).reverse().forEach((e=>{e.classList.contains("protyle-action")||e.classList.contains("protyle-attr")||(d.push({id:e.getAttribute("data-node-id"),action:"move",previousID:c.parentElement.getAttribute("data-node-id")}),p.push({id:e.getAttribute("data-node-id"),action:"move",parentID:u}),c.parentElement.after(e))}));const m=c.parentElement.getAttribute("data-node-id");2===c.parentElement.childElementCount?(p.splice(0,0,{id:m,action:"insert",data:c.parentElement.outerHTML,previousID:null===(o=c.parentElement.previousElementSibling)||void 0===o?void 0:o.getAttribute("data-node-id"),parentID:c.parentElement.parentElement.getAttribute("data-node-id")||e.block.rootID}),c.parentElement.remove(),d.push({id:m,action:"delete"})):(p.splice(0,0,{id:u,action:"insert",data:c.outerHTML,previousID:null===(l=c.previousElementSibling)||void 0===l?void 0:l.getAttribute("data-node-id"),parentID:m}),c.remove(),d.push({id:u,action:"delete"})),(0,a.transaction)(e,d,p),(0,i.focusByWbr)(e.wysiwyg.element,n)};t.listOutdent=(e,n,o)=>{var s,r;const l=n[0].parentElement,c=l.getAttribute("data-node-id");if(!c)return;const u=l.parentElement;if(u.classList.contains("protyle-wysiwyg")||u.classList.contains("sb")||u.classList.contains("bq")){const r=[],d=[];let p;o.collapse(!1),o.insertNode(document.createElement("wbr")),n[0].previousElementSibling||"o"!==l.getAttribute("data-subtype")||(p=parseInt(n[0].getAttribute("data-marker")));let h=c,f=l;n.forEach((t=>{t.classList.remove("protyle-wysiwyg--select"),Array.from(t.children).forEach(((n,i)=>{const a=n.getAttribute("data-node-id");a&&(r.push({action:"move",id:a,previousID:h,parentID:u.getAttribute("data-node-id")||e.block.parentID}),d.push({action:"move",id:a,previousID:1===i?void 0:h,parentID:t.getAttribute("data-node-id"),data:n.contains(o.startContainer)?"focus":""}),h=a,f.after(n),f=n)}))}));const g=l.outerHTML;return n.forEach((e=>{e.remove()})),1===l.childElementCount?(r.push({action:"delete",id:c}),d.splice(0,0,{action:"insert",data:g,id:c,previousID:null===(s=l.previousElementSibling)||void 0===s?void 0:s.getAttribute("data-node-id"),parentID:u.getAttribute("data-node-id")||e.block.parentID}),l.remove()):("o"===l.getAttribute("data-subtype")&&(0,t.updateListOrder)(l,p),r.push({action:"update",id:c,data:l.outerHTML}),d.splice(0,0,{action:"update",id:c,data:g})),(0,a.transaction)(e,r,d),void(0,i.focusByWbr)(u,o)}if(2===l.childElementCount&&3===u.childElementCount){o.collapse(!1),o.insertNode(document.createElement("wbr"));const t=u.outerHTML;return n[0].firstElementChild.remove(),n[0].lastElementChild.remove(),l.outerHTML=n[0].innerHTML,(0,a.updateTransaction)(e,u.getAttribute("data-node-id"),u.outerHTML,t),void(0,i.focusByWbr)(u,o)}o.collapse(!1),o.insertNode(document.createElement("wbr"));const d=[],p=[],h=null===(r=n[0].previousElementSibling)||void 0===r?void 0:r.getAttribute("data-node-id");let f;n.forEach((e=>{e.classList.remove("protyle-wysiwyg--select")})),n[0].previousElementSibling||"o"!==l.getAttribute("data-subtype")||(f=parseInt(n[0].getAttribute("data-marker")));const g=u.parentElement.outerHTML;n.reverse().forEach((e=>{const t=e.getAttribute("data-node-id");d.push({action:"move",id:t,previousID:u.getAttribute("data-node-id")}),p.push({action:"move",id:t,previousID:h,parentID:l.getAttribute("data-node-id")}),u.after(e),"o"!==e.getAttribute("data-subtype")&&"t"!==e.getAttribute("data-subtype")||"u"!==u.getAttribute("data-subtype")?"u"!==e.getAttribute("data-subtype")&&"t"!==e.getAttribute("data-subtype")||"o"!==u.getAttribute("data-subtype")?"u"!==e.getAttribute("data-subtype")&&"0"!==e.getAttribute("data-subtype")||"t"!==u.getAttribute("data-subtype")||(p.push({action:"update",id:t,data:e.outerHTML}),e.querySelector(".protyle-action").outerHTML='<div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#iconUncheck"></use></svg></div>',e.setAttribute("data-subtype","t"),e.setAttribute("data-marker","*"),d.push({action:"update",id:t,data:e.outerHTML})):(p.push({action:"update",id:t,data:e.outerHTML}),e.querySelector(".protyle-action").outerHTML='<div contenteditable="false" draggable="true" class="protyle-action protyle-action--order">1.</div>',e.setAttribute("data-subtype","o"),e.setAttribute("data-marker","1."),d.push({action:"update",id:t,data:e.outerHTML})):(p.push({action:"update",id:t,data:e.outerHTML}),e.querySelector(".protyle-action").outerHTML='<div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div>',e.setAttribute("data-subtype","u"),e.setAttribute("data-marker","*"),d.push({action:"update",id:t,data:e.outerHTML}))})),1===l.childElementCount?(d.push({action:"delete",id:l.getAttribute("data-node-id")}),p.splice(0,0,{action:"insert",id:l.getAttribute("data-node-id"),data:l.outerHTML,previousID:l.previousElementSibling.getAttribute("data-node-id")}),l.remove()):"o"===l.getAttribute("data-subtype")&&(p.splice(0,0,{action:"update",data:l.outerHTML,id:l.getAttribute("data-node-id")}),(0,t.updateListOrder)(l,f),d.push({action:"update",data:l.outerHTML,id:l.getAttribute("data-node-id")})),u.parentElement.classList.contains("protyle-wysiwyg")?(0,a.transaction)(e,d,p):("o"===u.getAttribute("data-subtype")&&(0,t.updateListOrder)(u.parentElement),(0,a.updateTransaction)(e,u.parentElement.getAttribute("data-node-id"),u.parentElement.outerHTML,g)),(0,i.focusByWbr)(u.parentElement,o)}},4403:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeBlock=void 0;const i=n(4640),a=n(6520),o=n(6840),s=n(9173),r=n(4921),l=n(407),c=n(7870),u=n(5378),d=n(8792);t.removeBlock=(e,n,p)=>{var h,f,g,m,y,b;(0,c.preventScroll)(e);const v=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if((null==v?void 0:v.length)>0){const t=[],n=[];let c,h,f=v[0].previousElementSibling||v[v.length-1].nextElementSibling;if(v.find((i=>{i.classList.remove("protyle-wysiwyg--select");const o=(0,a.getTopAloneElement)(i);h=o.parentElement;const s=o.getAttribute("data-node-id");if(t.push({action:"delete",id:s}),f=(0,a.getPreviousBlock)(o)||(0,a.getNextBlock)(o)||o.parentElement||e.wysiwyg.element.firstElementChild,"NodeHeading"===o.getAttribute("data-type")&&"1"===o.getAttribute("fold")){(0,l.setFold)(e,o,void 0,!0),n.push({action:"insert",data:o.outerHTML,id:s,previousID:v[0].previousElementSibling?v[0].previousElementSibling.getAttribute("data-node-id"):"",parentID:o.parentElement.getAttribute("data-node-id")||e.block.parentID}),o.firstElementChild.removeAttribute("contenteditable");const t=o.nextElementSibling;if(t){const e=t.getAttribute("data-type");if("NodeHeading"!==e||"NodeHeading"===e&&t.getAttribute("data-subtype")>o.getAttribute("data-subtype"))return!0}}else n.push({action:"insert",data:e.lute.SpinBlockDOM(o.outerHTML),id:s,previousID:o.previousElementSibling?o.previousElementSibling.getAttribute("data-node-id"):"",parentID:o.parentElement.getAttribute("data-node-id")||e.block.parentID}),c="o"===o.getAttribute("data-subtype")&&o.classList.contains("li")?o.parentElement:void 0,o.remove()})),f)if(e.block.showAll&&f.classList.contains("protyle-wysiwyg")&&0===e.wysiwyg.element.childElementCount)setTimeout((()=>{(0,l.zoomOut)(e,e.block.parent2ID,e.block.parent2ID)}),2*d.Constants.TIMEOUT_INPUT+100);else{if(f.classList.contains("protyle-wysiwyg")&&0===e.wysiwyg.element.childElementCount){const a=Lute.NewNodeID(),o=(0,s.genEmptyElement)(!1,!0,a);f.insertAdjacentElement("afterbegin",o),t.push({action:"insert",data:o.outerHTML,id:a,parentID:f.getAttribute("data-node-id")||e.block.parentID}),n.push({action:"delete",id:a}),f=void 0,(0,i.focusByWbr)(o,p)}(0,i.focusBlock)(f,void 0,!1),c&&(n.push({action:"update",id:c.getAttribute("data-node-id"),data:c.outerHTML}),(0,r.updateListOrder)(c,1),t.push({action:"update",id:c.getAttribute("data-node-id"),data:c.outerHTML}))}if(t.length>0)if(h&&"NodeSuperBlock"===h.getAttribute("data-type")&&2===h.childElementCount){const i=(0,s.cancelSB)(e,h);(0,o.transaction)(e,t.concat(i.doOperations),i.undoOperations.concat(n.reverse()))}else(0,o.transaction)(e,t,n.reverse());return void(0,u.hideElements)(["util"],e)}if("NodeCodeBlock"===n.getAttribute("data-type")&&""===(0,a.getContenteditableElement)(n).textContent.trim())return n.classList.add("protyle-wysiwyg--select"),void(0,t.removeBlock)(e,n,p);if("NodeCodeBlock"===n.getAttribute("data-type")||"NodeTable"===n.getAttribute("data-type"))return void(n.previousElementSibling&&(0,i.focusBlock)(n.previousElementSibling,void 0,!1));if("NodeHeading"===n.getAttribute("data-type")){const t=n.getAttribute("data-node-id"),r=(0,s.genEmptyElement)(!1,!1,t);"1"===n.getAttribute("fold")&&(0,l.setFold)(e,n),(0,a.getContenteditableElement)(r).innerHTML="<wbr>"+(0,a.getContenteditableElement)(n).textContent;const c=n.outerHTML;return n.parentElement.replaceChild(r,n),(0,o.updateTransaction)(e,t,r.outerHTML,c),void(0,i.focusByWbr)(r,p)}if(!n.previousElementSibling&&"NodeBlockquote"===n.parentElement.getAttribute("data-type")){p.insertNode(document.createElement("wbr"));const t=n.parentElement;return t.insertAdjacentElement("beforebegin",n),1===t.childElementCount?((0,o.transaction)(e,[{action:"move",id:n.getAttribute("data-node-id"),previousID:null===(h=n.previousElementSibling)||void 0===h?void 0:h.getAttribute("data-node-id"),parentID:t.parentElement.getAttribute("data-node-id")||e.block.parentID},{action:"delete",id:t.getAttribute("data-node-id")}],[{action:"insert",id:t.getAttribute("data-node-id"),data:t.outerHTML,previousID:null===(f=n.previousElementSibling)||void 0===f?void 0:f.getAttribute("data-node-id"),parentID:t.parentElement.getAttribute("data-node-id")||e.block.parentID},{action:"move",id:n.getAttribute("data-node-id"),parentID:t.getAttribute("data-node-id")}]),t.remove()):(0,o.transaction)(e,[{action:"move",id:n.getAttribute("data-node-id"),previousID:null===(g=n.previousElementSibling)||void 0===g?void 0:g.getAttribute("data-node-id"),parentID:t.parentElement.getAttribute("data-node-id")||e.block.parentID}],[{action:"move",id:n.getAttribute("data-node-id"),parentID:t.getAttribute("data-node-id")}]),void(0,i.focusByWbr)(n,p)}if(n.parentElement.classList.contains("li")&&n.previousElementSibling.classList.contains("protyle-action"))return void((e,t,n)=>{if(!t.parentElement.previousElementSibling&&t.parentElement.nextElementSibling&&t.parentElement.nextElementSibling.classList.contains("protyle-attr"))return void(0,r.listOutdent)(e,[t.parentElement],n);if(!t.parentElement.previousElementSibling&&t.parentElement.parentElement.parentElement.classList.contains("list")){n.insertNode(document.createElement("wbr"));const a=t.parentElement.parentElement,s=a.outerHTML,l=t.parentElement.parentElement.previousElementSibling.lastElementChild,c=l.parentElement.outerHTML;return t.parentElement.firstElementChild.remove(),t.parentElement.lastElementChild.remove(),l.insertAdjacentHTML("beforebegin",t.parentElement.innerHTML),t.parentElement.remove(),"o"===a.getAttribute("data-subtype")&&(0,r.updateListOrder)(a),(0,o.transaction)(e,[{action:"update",id:a.getAttribute("data-node-id"),data:a.outerHTML},{action:"update",data:l.parentElement.outerHTML,id:l.parentElement.getAttribute("data-node-id")}],[{action:"update",data:c,id:l.parentElement.getAttribute("data-node-id")},{action:"update",data:s,id:a.getAttribute("data-node-id")}]),void(0,i.focusByWbr)(l.parentElement,n)}if(!t.parentElement.previousElementSibling){if(t.parentElement.parentElement.classList.contains("protyle-wysiwyg"))return;n.insertNode(document.createElement("wbr"));const a=t.parentElement.parentElement,s=a.outerHTML;t.parentElement.firstElementChild.remove(),t.parentElement.lastElementChild.remove();const l=document.createElement("div");l.innerHTML=t.parentElement.innerHTML;const c=[],u=[];return Array.from(l.children).forEach(((t,n)=>{var i;c.push({action:"insert",id:t.getAttribute("data-node-id"),data:t.outerHTML,previousID:0===n?null===(i=a.previousElementSibling)||void 0===i?void 0:i.getAttribute("data-node-id"):c[n-1].id,parentID:a.parentElement.getAttribute("data-node-id")||e.block.parentID}),u.push({action:"delete",id:t.getAttribute("data-node-id")})})),a.insertAdjacentHTML("beforebegin",t.parentElement.innerHTML),t.parentElement.remove(),"o"===a.getAttribute("data-subtype")&&(0,r.updateListOrder)(a,parseInt(a.firstElementChild.getAttribute("data-marker"))-1),c.splice(0,0,{action:"update",id:a.getAttribute("data-node-id"),data:a.outerHTML}),u.push({action:"update",data:s,id:a.getAttribute("data-node-id")}),(0,o.transaction)(e,c,u),void(0,i.focusByWbr)(e.wysiwyg.element,n)}const s=t.parentElement,l=s.getAttribute("data-node-id"),c=s.parentElement;n.insertNode(document.createElement("wbr"));const u=c.outerHTML,d=[],p=[{action:"insert",id:l,data:"",previousID:s.previousElementSibling.getAttribute("data-node-id")}],h=s.previousElementSibling.lastElementChild;if("1"===s.previousElementSibling.getAttribute("fold")){if(""!==(0,a.getContenteditableElement)(t).textContent.trim())return n.selectNodeContents((0,a.getContenteditableElement)(s.previousElementSibling)),void n.collapse(!1);d.push({action:"delete",id:l}),p[0].data=s.outerHTML,n.selectNodeContents((0,a.getContenteditableElement)(s.previousElementSibling)),n.collapse(!1),s.remove()}else{let e=h.previousElementSibling.getAttribute("data-node-id");Array.from(t.parentElement.children).forEach(((t,n)=>{if(t.classList.contains("protyle-action")||t.classList.contains("protyle-attr"))return;const i=t.getAttribute("data-node-id");d.push({action:"move",id:i,previousID:e}),p.push({action:"move",id:i,previousID:1===n?void 0:e,parentID:l}),e=i,h.before(t)})),d.push({action:"delete",id:l}),p[0].data=s.outerHTML,s.remove()}c.classList.contains("protyle-wysiwyg")?(0,o.transaction)(e,d,p):("o"===c.getAttribute("data-subtype")&&(0,r.updateListOrder)(c),(0,o.updateTransaction)(e,c.getAttribute("data-node-id"),c.outerHTML,u)),(0,i.focusByWbr)(h.parentElement,n)})(e,n,p);const w=(0,a.getPreviousBlock)(n);if(!w){if(e.wysiwyg.element.childElementCount>1&&""===(0,a.getContenteditableElement)(n).textContent){(0,i.focusBlock)(e.wysiwyg.element.firstElementChild.nextElementSibling);const t=(0,a.getTopAloneElement)(n);(0,o.transaction)(e,[{action:"delete",id:t.getAttribute("data-node-id")}],[{action:"insert",data:t.outerHTML,id:t.getAttribute("data-node-id"),parentID:e.block.parentID}]),t.remove()}return}const _=n.parentElement,E=(0,a.getContenteditableElement)(n),k=(0,a.getLastBlock)(w),C=k&&(k.classList.contains("table")||k.classList.contains("render-node")||k.classList.contains("iframe")||k.classList.contains("hr")||k.classList.contains("code-block")),D=k.getAttribute("data-node-id");if(C){if(k.classList.contains("code-block")){if(""===E.textContent.trim()){const t=n.getAttribute("data-node-id"),a=[{action:"delete",id:t}],r=[{action:"insert",data:n.outerHTML,id:t,previousID:null===(m=n.previousElementSibling)||void 0===m?void 0:m.getAttribute("data-node-id"),parentID:n.parentElement.getAttribute("data-node-id")}];if(n.remove(),"NodeSuperBlock"===_.getAttribute("data-type")&&2===_.childElementCount){const t=(0,s.cancelSB)(e,_);(0,o.transaction)(e,a.concat(t.doOperations),t.undoOperations.concat(r))}else(0,o.transaction)(e,a,r);(0,i.focusBlock)(e.wysiwyg.element.querySelector(`[data-node-id="${D}"]`),void 0,!1)}else(0,i.focusBlock)(k,void 0,!1);return}if(""!==E.textContent)return void(0,i.focusBlock)(k,void 0,!1)}const x=(0,a.getTopEmptyElement)(n),S=x.getAttribute("data-node-id");p.insertNode(document.createElement("wbr"));const A=[{action:"update",data:k.outerHTML,id:D},{action:"insert",data:x.outerHTML,id:S,previousID:null===(y=n.previousElementSibling)||void 0===y?void 0:y.getAttribute("data-node-id"),parentID:_.getAttribute("data-node-id")}],L=[{action:"delete",id:S}];if(C)x.remove(),(0,i.focusBlock)(k,void 0,!1);else{const t=(0,a.getContenteditableElement)(k);if(E&&""!==E.textContent&&(p.setEndAfter(E.lastChild),(null===(b=null==t?void 0:t.lastElementChild)||void 0===b?void 0:b.getAttribute("data-type").indexOf("inline-math"))>-1)){const e=(0,a.hasNextSibling)(null==t?void 0:t.lastElementChild);e&&"\n"===e.textContent&&e.remove()}const n=e.contentElement.scrollTop,i=p.extractContents();p.selectNodeContents(t),p.collapse(!1),p.insertNode(i),x.remove(),e.contentElement.scrollTop=n,e.scroll.lastScrollTop=n-1,L.push({action:"update",data:k.outerHTML,id:D})}if("NodeSuperBlock"===_.getAttribute("data-type")&&2===_.childElementCount){const t=(0,s.cancelSB)(e,_);(0,o.transaction)(e,L.concat(t.doOperations),t.undoOperations.concat(A))}else(0,o.transaction)(e,L,A);(0,i.focusByWbr)(e.wysiwyg.element,p)}},6075:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeEmbed=void 0;t.removeEmbed=(e,t="outerHTML")=>{if(!e.querySelector("[data-type='block-render']"))return e[t];const n=e.cloneNode(!0);return n.querySelectorAll("span[data-render='1'][data-type='block-render']").forEach((e=>{e.innerHTML="",e.setAttribute("data-render","2")})),n[t]}},6840:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateBatchTransaction=t.updateTransaction=t.transaction=t.turnsIntoTransaction=t.turnsIntoOneTransaction=t.onTransaction=t.promiseTransactions=void 0;const i=n(734),a=n(4640),o=n(6520),s=n(8792),r=n(7822),l=n(6057),c=n(1248),u=n(3607),d=n(1754),p=n(407),h=n(1384),f=n(7010),g=n(2892),m=n(6919),y=n(9173),b=n(5378),v=(e,n)=>{const i=(0,o.getTopAloneElement)(e),a=[];if(i.isSameNode(e)||(e.remove(),a.push({action:"delete",id:i.getAttribute("data-node-id")})),i.remove(),n.block.rootID===n.block.id&&0===n.wysiwyg.element.childElementCount){const e=Lute.NewNodeID(),t=(0,y.genEmptyElement)(!1,!1,e);a.push({action:"insert",data:t.outerHTML,id:e,parentID:n.block.parentID}),n.wysiwyg.element.innerHTML=t.outerHTML}a.length>0&&(0,t.transaction)(n,a,[])},w=()=>{const e=window.siyuan.transactions[0].protyle,n=window.siyuan.transactions[0].doOperations,o=window.siyuan.transactions[0].undoOperations;window.siyuan.transactions.splice(0,1),(0,i.fetchPost)("/api/transactions",{session:e.id,app:s.Constants.SIYUAN_APPID,transactions:[{doOperations:n,undoOperations:o}]},(o=>{if(0===window.siyuan.transactions.length?(0,t.promiseTransactions)():w(),1!==o.code)if(1!==n.length||"unfoldHeading"!==n[0].action&&"foldHeading"!==n[0].action&&"setAttrs"!==n[0].action)n.forEach((t=>"update"===t.action?(_(e,t),void k(e,t.id)):"delete"===t.action||"append"===t.action?(e.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach((n=>{n.querySelector(`[data-node-id="${t.id}"]`)&&(n.removeAttribute("data-render"),(0,r.blockRender)(e,n))})),void e.wysiwyg.element.querySelectorAll(`[data-type~="block-ref"][data-id="${t.id}"]`).forEach((e=>{"d"===e.getAttribute("data-subtype")&&(e.textContent="block not found")}))):void("move"!==t.action?k(e,t.id):e.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach((n=>{n.querySelector(`[data-node-id="${t.id}"]`)&&(n.removeAttribute("data-render"),(0,r.blockRender)(e,n))})))));else{const t=e.gutter.element.querySelector('[data-type="fold"]');if(t&&t.removeAttribute("disabled"),"unfoldHeading"===n[0].action){const t=e.contentElement.scrollTop;e.wysiwyg.element.querySelectorAll(`[data-node-id="${n[0].id}"]`).forEach((t=>{if(t.lastElementChild.classList.contains("protyle-attr")||t.lastElementChild.remove(),E(o.data[0].doOperations[0].retData,e),t.insertAdjacentHTML("afterend",o.data[0].doOperations[0].retData),"remove"===n[0].data){const e=getSelection();e.rangeCount>0&&t.contains(e.getRangeAt(0).startContainer)&&(0,a.focusBlock)(t.nextElementSibling,void 0,!0),t.remove()}})),(0,l.processRender)(e.wysiwyg.element),(0,c.highlightRender)(e.wysiwyg.element),(0,r.blockRender)(e,e.wysiwyg.element),e.contentElement.scrollTop=t,e.scroll.lastScrollTop=t}else"foldHeading"===n[0].action&&("true"===e.wysiwyg.element.lastElementChild.getAttribute("data-eof")||e.scroll.element.classList.contains("fn__none")||(0,i.fetchPost)("/api/filetree/getDoc",{id:e.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),mode:2,k:e.options.key||"",size:s.Constants.SIZE_GET},(t=>{(0,f.onGet)(t,e,[s.Constants.CB_GET_APPEND,s.Constants.CB_GET_UNCHANGEID])})))}else(0,d.lockFile)(e.block.rootID)}))},_=(e,t)=>{let n=!1;e.wysiwyg.element.querySelectorAll(`[data-type="NodeBlockQueryEmbed"] [data-node-id="${t.id}"]`).forEach((e=>{const i=document.createElement("div");i.innerHTML=t.data,i.querySelectorAll('[contenteditable="true"]').forEach((e=>{e.setAttribute("contenteditable","false")}));const a=i.querySelector("wbr");a&&a.remove(),e.outerHTML=i.innerHTML,n=!0})),n&&((0,l.processRender)(e.wysiwyg.element),(0,c.highlightRender)(e.wysiwyg.element))};t.promiseTransactions=()=>{window.siyuan.transactionsTimeout=window.setInterval((()=>{0!==window.siyuan.transactions.length&&(window.clearInterval(window.siyuan.transactionsTimeout),w())}),2*s.Constants.TIMEOUT_INPUT)};t.onTransaction=(e,t,n)=>{var o,d;let p;if(Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.id}"]`)).find((e=>{if(!(0,u.hasClosestByAttribute)(e.parentElement,"data-type","NodeBlockQueryEmbed"))return p=e,!0})),"setAttrs"!==t.action){if("unfoldHeading"===t.action){const n=e.contentElement.scrollTop;return e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.id}"]`).forEach((n=>{t.retData&&(E(t.retData,e),n.insertAdjacentHTML("afterend",t.retData)),n.removeAttribute("fold"),"remove"===t.data&&n.remove()})),void(t.retData&&((0,l.processRender)(e.wysiwyg.element),(0,c.highlightRender)(e.wysiwyg.element),(0,r.blockRender)(e,e.wysiwyg.element),e.contentElement.scrollTop=n,e.scroll.lastScrollTop=n))}if("foldHeading"===t.action)return e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.id}"]`).forEach((e=>{e.setAttribute("fold","1"),t.retData||(0,m.removeFoldHeading)(e)})),void(t.retData&&t.retData.forEach((t=>{e.wysiwyg.element.querySelectorAll(`[data-node-id="${t}"]`).forEach((e=>{e.remove()}))})));if("delete"===t.action)return p&&(n&&(0,a.focusSideBlock)(p),p.remove()),e.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach((n=>{n.querySelector(`[data-node-id="${t.id}"]`)&&(n.removeAttribute("data-render"),(0,r.blockRender)(e,n))})),void e.wysiwyg.element.querySelectorAll(`[data-type~="block-ref"][data-id="${t.id}"]`).forEach((e=>{"d"===e.getAttribute("data-subtype")&&(e.textContent="block not found")}));if("update"===t.action){if(p){p.outerHTML=t.data,Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.id}"]`)).find((e=>{if("NodeBlockQueryEmbed"===e.getAttribute("data-type")||!(0,u.hasClosestByAttribute)(e,"data-type","NodeBlockQueryEmbed"))return p=e,!0}));const i=p.querySelector("wbr");if(n){const e=(0,a.getEditorRange)(p);i?(0,a.focusByWbr)(p,e):(0,a.focusBlock)(p)}else i&&i.remove();(0,l.processRender)(p),(0,c.highlightRender)(p),(0,r.blockRender)(e,p)}return _(e,t),void k(e,t.id)}if("updateAttrs"!==t.action){if("move"===t.action){let i,s;if(n&&getSelection().rangeCount>0&&(s=getSelection().getRangeAt(0),i={startContainer:s.startContainer,startOffset:s.startOffset,endContainer:s.endContainer,endOffset:s.endOffset}),p||(0,g.getAllModels)().editor.forEach((e=>{const n=e.editor.protyle.wysiwyg.element.querySelector(`[data-node-id="${t.id}"]`);n&&(p=n.cloneNode(!0))})),t.previousID){let n;Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.previousID}"]`)).find((e=>{if(!(0,u.hasClosestByAttribute)(e.parentElement,"data-type","NodeBlockQueryEmbed"))return n=e,!0})),n&&p?n.after(p):p&&p.parentElement&&v(p,e)}else{let n;Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.parentID}"]`)).find((e=>{if(!(0,u.hasClosestByAttribute)(e.parentElement,"data-type","NodeBlockQueryEmbed"))return n=e,!0})),n&&p?(null===(o=n.firstElementChild)||void 0===o?void 0:o.classList.contains("protyle-action"))?n.firstElementChild.after(p):n.prepend(p):t.parentID===e.block.parentID&&p?e.wysiwyg.element.prepend(p):p&&p.parentElement&&v(p,e)}return n&&i&&s&&("focus"===t.data?(0,a.focusBlock)(p):(s.setStart(i.startContainer,i.startOffset),s.setEnd(i.endContainer,i.endOffset),(0,a.focusByRange)(s))),void e.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach((n=>{n.querySelector(`[data-node-id="${t.id}"]`)&&(n.removeAttribute("data-render"),(0,r.blockRender)(e,n))}))}if("insert"===t.action){let i;if(t.previousID){let n;Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.previousID}"]`)).find((t=>{const i=(0,u.hasClosestByAttribute)(t.parentElement,"data-type","NodeBlockQueryEmbed");if(!i)return n=t,!0;i.removeAttribute("data-render"),(0,r.blockRender)(e,i)})),n&&(n.insertAdjacentHTML("afterend",t.data),i=n.nextElementSibling)}else{let n;Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.parentID}"]`)).find((e=>{if(!(0,u.hasClosestByAttribute)(e.parentElement,"data-type","NodeBlockQueryEmbed"))return n=e,!0})),n?(null===(d=n.firstElementChild)||void 0===d?void 0:d.classList.contains("protyle-action"))?(n.firstElementChild.insertAdjacentHTML("afterend",t.data),i=n.firstElementChild.nextElementSibling):(n.insertAdjacentHTML("afterbegin",t.data),i=n.firstElementChild):t.parentID===e.block.parentID&&(e.wysiwyg.element.insertAdjacentHTML("afterbegin",t.data),i=e.wysiwyg.element.firstElementChild)}if(!i)return;(0,l.processRender)(i),(0,c.highlightRender)(i),(0,r.blockRender)(e,i),e.wysiwyg.element.querySelectorAll('[data-type="NodeHeading"]').forEach((e=>{"1"===e.lastElementChild.getAttribute("spin")&&e.lastElementChild.remove()}));const o=i.querySelector("wbr");if(n){const e=(0,a.getEditorRange)(i);o?(0,a.focusByWbr)(i,e):(0,a.focusBlock)(i)}else o&&o.remove();return e.wysiwyg.element.querySelectorAll(`[data-type="NodeBlockQueryEmbed"][data-node-id="${t.id}"]`).forEach((t=>{t.removeAttribute("data-render"),(0,r.blockRender)(e,t)})),e.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach((n=>{n.querySelector(`[data-node-id="${t.id}"]`)&&(n.removeAttribute("data-render"),(0,r.blockRender)(e,n))})),void k(e,t.id)}"append"===t.action&&((0,h.addLoading)(e),(0,i.fetchPost)("/api/filetree/getDoc",{id:e.block.id,mode:0,size:s.Constants.SIZE_GET},(t=>{(0,f.onGet)(t,e)})))}else{let n="";const i=t.data,a={};if(Object.keys(i.new).forEach((e=>{a[e]=i.new[e];const t=i.new[e];"bookmark"===e?n+=`<div class="protyle-attr--bookmark">${t}</div>`:"name"===e?n+=`<div class="protyle-attr--name"><svg><use xlink:href="#iconN"></use></svg>${t}</div>`:"alias"===e?n+=`<div class="protyle-attr--alias"><svg><use xlink:href="#iconA"></use></svg>${t}</div>`:"memo"===e&&(n+=`<div class="protyle-attr--memo b3-tooltips b3-tooltips__sw" aria-label="${t}"><svg><use xlink:href="#iconM"></use></svg></div>`)})),e.block.rootID===t.id){const t=e.title.element.querySelector(".protyle-attr--refcount");return t&&(n+=t.outerHTML),e.title.element.querySelector(".protyle-attr").innerHTML=n,void e.wysiwyg.renderCustom(a)}e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.id}"]`).forEach((e=>{Object.keys(i.old).forEach((t=>{e.removeAttribute(t)})),Object.keys(i.new).forEach((t=>{e.setAttribute(t,i.new[t])}));const t=e.lastElementChild.querySelector(".protyle-attr--refcount");t&&(n+=t.outerHTML),e.lastElementChild.innerHTML=n+s.Constants.ZWSP}))}}else e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.id}"]`).forEach((e=>{"1"===JSON.parse(t.data).fold?e.setAttribute("fold","1"):e.removeAttribute("fold")}))};t.turnsIntoOneTransaction=e=>{let n;const i=Lute.NewNodeID();if("BlocksMergeSuperBlock"===e.type)n=(0,y.genSBElement)(e.level,i);else if("Blocks2Blockquote"===e.type)n=document.createElement("div"),n.classList.add("bq"),n.setAttribute("data-node-id",i),n.setAttribute("data-type","NodeBlockquote"),n.innerHTML='<div class="protyle-attr" contenteditable="false"></div>';else if(e.type.endsWith("Ls")){n=document.createElement("div"),n.classList.add("list"),n.setAttribute("data-node-id",i),n.setAttribute("data-type","NodeList"),"Blocks2ULs"===e.type?n.setAttribute("data-subtype","u"):"Blocks2OLs"===e.type?n.setAttribute("data-subtype","o"):n.setAttribute("data-subtype","t");let t="";e.selectsElement.forEach(((n,i)=>{"Blocks2ULs"===e.type?t+=`<div data-marker="*" data-subtype="u" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div class="protyle-attr" contenteditable="false"></div></div>`:"Blocks2OLs"===e.type?t+=`<div data-marker="${i+1}." data-subtype="o" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">${i+1}.</div><div class="protyle-attr" contenteditable="false"></div></div>`:t+=`<div data-marker="*" data-subtype="t" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#iconUncheck"></use></svg></div><div class="protyle-attr" contenteditable="false"></div></div>`})),n.innerHTML=t+'<div class="protyle-attr" contenteditable="false"></div>'}const o=e.selectsElement[0].previousElementSibling?e.selectsElement[0].previousElementSibling.getAttribute("data-node-id"):void 0,s=e.selectsElement[0].parentElement.getAttribute("data-node-id")||e.protyle.block.parentID,r=[{action:"insert",id:i,data:n.outerHTML,previousID:o,parentID:s}],l=[];let c;e.selectsElement[0].previousElementSibling?e.selectsElement[0].before(n):e.selectsElement[0].parentElement.prepend(n),e.selectsElement.forEach(((t,a)=>{t.classList.remove("protyle-wysiwyg--select");const u=t.getAttribute("data-node-id");l.push({action:"move",id:u,previousID:c||o,parentID:s}),e.type.endsWith("Ls")?(r.push({action:"move",id:u,parentID:n.children[a].getAttribute("data-node-id")}),n.children[a].firstElementChild.after(t)):(r.push({action:"move",id:u,previousID:c,parentID:i}),n.lastElementChild.before(t)),c=t.getAttribute("data-node-id"),a===e.selectsElement.length-1&&l.push({action:"delete",id:i})})),(0,t.transaction)(e.protyle,r,l),(0,a.focusBlock)(e.protyle.wysiwyg.element.querySelector(`[data-node-id="${e.selectsElement[0].getAttribute("data-node-id")}"]`)),(0,b.hideElements)(["gutter"],e.protyle)};const E=(e,t)=>{const n=document.createElement("template");n.innerHTML=e,Array.from(n.content.children).forEach((e=>{var n;null===(n=t.wysiwyg.element.querySelector(`:scope > [data-node-id="${e.getAttribute("data-node-id")}"]`))||void 0===n||n.remove()}))};t.turnsIntoTransaction=e=>{let n,i=e.selectsElement;if(e.nodeElement){n=getSelection().getRangeAt(0),n.insertNode(document.createElement("wbr")),i=Array.from(e.protyle.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select")),0===i.length&&(i=[e.nodeElement]);let t=!1,a=!1,o=!1;if(i.find(((e,n)=>{if(e.classList.contains("li"))return o=!0,!0;if((e.classList.contains("bq")||e.classList.contains("sb")||e.classList.contains("p"))&&(a=!0),e.nextElementSibling&&i[n+1]&&e.nextElementSibling.isSameNode(i[n+1]))t=!0;else if(n!==i.length-1)return t=!1,!0})),o||a&&"Blocks2Ps"===e.type)return;1===i.length&&"Blocks2Hs"===e.type&&"NodeHeading"===i[0].getAttribute("data-type")&&e.level===parseInt(i[0].getAttribute("data-subtype").substr(1))&&(e.type="Blocks2Ps"),e.isContinue=t}let o="";const s=[],u=[];i.forEach(((t,n)=>{"Blocks2Ps"!==e.type&&"Blocks2Hs"!==e.type||"NodeHeading"!==t.getAttribute("data-type")||"1"!==t.getAttribute("fold")||(0,p.setFold)(e.protyle,t),t.classList.remove("protyle-wysiwyg--select"),o+=t.outerHTML;const a=t.getAttribute("data-node-id");if(u.push({action:"update",id:a,data:t.outerHTML}),"Blocks2Ps"!==e.type&&"Blocks2Hs"!==e.type||e.isContinue)if(n===i.length-1){const n=document.createElement("div");n.innerHTML=e.protyle.lute[e.type](o,e.level),t.outerHTML=n.innerHTML}else t.remove();else t.outerHTML=e.protyle.lute[e.type](t.outerHTML,e.level)})),u.forEach((t=>{const n=e.protyle.wysiwyg.element.querySelector(`[data-node-id="${t.id}"]`);s.push({action:"update",id:t.id,data:n.outerHTML})})),(0,t.transaction)(e.protyle,s,u),(0,l.processRender)(e.protyle.wysiwyg.element),(0,c.highlightRender)(e.protyle.wysiwyg.element),(0,r.blockRender)(e.protyle,e.protyle.wysiwyg.element),n?(0,a.focusByWbr)(e.protyle.wysiwyg.element,n):(0,a.focusBlock)(e.protyle.wysiwyg.element.querySelector(`[data-node-id="${i[0].getAttribute("data-node-id")}"]`)),(0,b.hideElements)(["gutter"],e.protyle)};const k=(e,t,n=0)=>{n>6||e.wysiwyg.element.querySelectorAll(`[data-type~="block-ref"][data-id="${t}"]`).forEach((a=>{"d"===a.getAttribute("data-subtype")&&(0,i.fetchPost)("/api/block/getRefText",{id:t},(t=>{a.innerHTML=t.data;const i=(0,u.hasClosestBlock)(a);i&&k(e,i.getAttribute("data-node-id"),n+1)}))}))};t.transaction=(e,t,n)=>{const i=window.siyuan.transactions[window.siyuan.transactions.length-1];let a=!1;const o=(new Date).getTime();i&&1===i.doOperations.length&&"update"===i.doOperations[0].action&&1===t.length&&"update"===t[0].action&&i.doOperations[0].id===t[0].id&&e.transactionTime-o<s.Constants.TIMEOUT_INPUT&&(a=!0),e.wysiwyg.lastHTMLs={},n&&(window.siyuan.config.fileTree.openFilesUseCurrentTab&&e.model&&e.model.headElement.classList.remove("item--unupdate"),e.updated=!0,a?e.undo.replace(t):e.undo.add(t,n)),a?(window.siyuan.transactions[window.siyuan.transactions.length-1].protyle=e,window.siyuan.transactions[window.siyuan.transactions.length-1].doOperations=t):window.siyuan.transactions.push({protyle:e,doOperations:t,undoOperations:n}),e.transactionTime=o};t.updateTransaction=(e,n,i,a)=>{i!==a&&(0,t.transaction)(e,[{id:n,data:i,action:"update"}],[{id:n,data:a,action:"update"}])};t.updateBatchTransaction=(e,n,i)=>{const a=[],o=[];e.forEach((e=>{const t=e.getAttribute("data-node-id");e.classList.remove("protyle-wysiwyg--select"),o.push({action:"update",id:t,data:e.outerHTML}),i(e),a.push({action:"update",id:t,data:e.outerHTML})})),(0,t.transaction)(n,a,o)}},7729:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Search=void 0;const i=n(7924),a=n(2009),o=n(8792),s=n(1308),r=n(8813),l=n(3371),c=n(3863),u=n(734),d=n(7010),p=n(9516),h=n(1384),f=n(7640);class g extends i.Model{constructor(e){super({id:e.tab.id}),this.element=e.tab.panelElement,this.text=e.text,e.tab.updateTitle(this.text),this.element.innerHTML=`<div class="fn__flex-column" style="height: 100%">\n    <div class="fn__flex-1 fn__flex-column" style="min-height: 50%;">\n        <div class="fn__flex" style="padding: 4px 8px;position: relative">\n            <span style="opacity: 1" class="block__icon fn__flex-center" id="searchHistoryBtn" data-menu="true">\n                <svg><use xlink:href="#iconSearch"></use></svg>\n                <svg style="height: 8px;"><use xlink:href="#iconDown"></use></svg>\n            </span>\n            <div class="fn__space"></div>\n            <input class="b3-text-field fn__flex-1">\n            <span class="fn__space"></span>\n            <span style="opacity: 1" class="block__icon fn__flex-center b3-tooltips b3-tooltips__w" id="globalSearchReload" aria-label="${window.siyuan.languages.refresh}">\n                <svg><use xlink:href="#iconRefresh"></use></svg>\n            </span>\n            <div id="searchHistoryList" data-close="false" class="fn__none b3-menu b3-list b3-list--background" style="position: absolute;top: 30px;max-height: 50vh;overflow: auto"></div>\n        </div>\n        <div id="globalSearchResult" class="b3-list-item ft__smaller ft__on-surface"></div>\n        <div id="globalSearchList" class="fn__flex-1 b3-list b3-list--background"></div>\n        <div class="fn__loading fn__loading--top"><img width="120px" src="/stage/loading-pure.svg"></div>\n    </div>\n    <div class="fn__flex-1" id="searchPreview"></div>\n</div>`;const t=this.element.querySelector("#searchHistoryList"),n=this.element.querySelector(".b3-text-field");n.value=this.text,n.addEventListener("compositionend",(e=>{this.inputEvent(n,e)})),n.addEventListener("input",(e=>{this.inputEvent(n,e)})),n.addEventListener("blur",(()=>{this.setLocalStorage(n.value)}));const i=this.element.querySelector("#globalSearchList");let a;n.addEventListener("keydown",(e=>{let t=i.querySelector(".b3-list-item--focus");if(t&&!e.isComposing)if("ArrowDown"===e.key)t.classList.remove("b3-list-item--focus"),t.nextElementSibling?t.nextElementSibling.classList.add("b3-list-item--focus"):i.children[0].classList.add("b3-list-item--focus"),t=i.querySelector(".b3-list-item--focus"),(i.scrollTop<t.offsetTop-i.clientHeight+30||i.scrollTop>t.offsetTop)&&(i.scrollTop=t.offsetTop-i.clientHeight+30),this.getArticle(t.getAttribute("data-node-id"),n.value),e.preventDefault();else if("ArrowUp"===e.key){if(t.classList.remove("b3-list-item--focus"),t.previousElementSibling)t.previousElementSibling.classList.add("b3-list-item--focus");else{const e=i.children.length;i.children[e-1].classList.add("b3-list-item--focus")}t=i.querySelector(".b3-list-item--focus"),(i.scrollTop<t.offsetTop-i.clientHeight+30||i.scrollTop>t.offsetTop-60)&&(i.scrollTop=t.offsetTop-60),this.getArticle(t.getAttribute("data-node-id"),n.value),e.preventDefault()}})),n.select(),this.inputEvent(n),this.element.addEventListener("click",(e=>{(0,l.setPanelFocus)(this.element.parentElement.parentElement);let i=e.target,s=!0;for(;i&&!i.isEqualNode(this.element);){if("globalSearchReload"===i.id)this.inputEvent(n);else{if(i.classList.contains("b3-list-item")){if(i.getAttribute("data-node-id")){if(1===e.detail)a=window.setTimeout((()=>{if(window.siyuan.altIsPressed){const e=i.getAttribute("data-node-id");(0,u.fetchPost)("/api/block/checkBlockFold",{id:e},(t=>{(0,p.openFileById)({id:e,action:t.data?[o.Constants.CB_GET_FOCUS,o.Constants.CB_GET_ALL]:[o.Constants.CB_GET_FOCUS,o.Constants.CB_GET_CONTEXT],zoomIn:t.data,position:"right"})}))}else this.element.querySelectorAll(".b3-list-item--focus").forEach((e=>{e.classList.remove("b3-list-item--focus")})),i.classList.add("b3-list-item--focus"),this.getArticle(i.getAttribute("data-node-id"),n.value)}),o.Constants.TIMEOUT_DBLCLICK);else if(2===e.detail){clearTimeout(a);const e=i.getAttribute("data-node-id");(0,u.fetchPost)("/api/block/checkBlockFold",{id:e},(t=>{(0,p.openFileById)({id:e,action:t.data?[o.Constants.CB_GET_FOCUS,o.Constants.CB_GET_ALL]:[o.Constants.CB_GET_FOCUS,o.Constants.CB_GET_CONTEXT],zoomIn:t.data})}))}window.siyuan.menus.menu.remove()}else this.text=i.textContent,this.parent.updateTitle(this.text),n.value=this.text,n.select(),this.inputEvent(n);e.preventDefault(),e.stopPropagation();break}if("searchHistoryBtn"===i.id){s=!1;let i="";JSON.parse(localStorage.getItem(o.Constants.LOCAL_SEARCHETABDATA)||"[]").forEach((e=>{e!==n.value&&(i+=`<div class="b3-list-item">${(0,c.escapeHtml)(e)}</div>`)})),t.classList.remove("fn__none"),t.innerHTML=i,e.preventDefault(),e.stopPropagation();break}}i=i.parentElement}s&&t.classList.add("fn__none")}),!1)}getArticle(e,t){(0,u.fetchPost)("/api/block/checkBlockFold",{id:e},(n=>{this.protyle?(this.protyle.protyle.element.classList.remove("fn__none"),this.protyle.protyle.scroll.lastScrollTop=0,(0,h.addLoading)(this.protyle.protyle),(0,u.fetchPost)("/api/filetree/getDoc",{id:e,k:t,mode:n.data?0:3,size:n.data?o.Constants.SIZE_GET_MAX:o.Constants.SIZE_GET},(t=>{(0,d.onGet)(t,this.protyle.protyle,n.data?[o.Constants.CB_GET_ALL,o.Constants.CB_GET_HTML]:[o.Constants.CB_GET_HL,o.Constants.CB_GET_HTML]);const i=this.protyle.protyle.wysiwyg.element.querySelector(`div[data-node-id="${e}"] span[data-type="search-mark"]`);i&&i.scrollIntoView()}))):this.protyle=new a.default(this.element.querySelector("#searchPreview"),{blockId:e,action:n.data?[o.Constants.CB_GET_HL,o.Constants.CB_GET_ALL,o.Constants.CB_GET_HTML]:[o.Constants.CB_GET_HL,o.Constants.CB_GET_CONTEXT,o.Constants.CB_GET_HTML],key:t,render:{gutter:!0,breadcrumbDocName:!0},after:()=>{setTimeout((()=>{const t=this.protyle.protyle.wysiwyg.element.querySelector(`div[data-node-id="${e}"] span[data-type="search-mark"]`);t&&t.scrollIntoView()}),o.Constants.TIMEOUT_SEARCH)}})}))}setLocalStorage(e){if(!e)return;let t=JSON.parse(localStorage.getItem(o.Constants.LOCAL_SEARCHETABDATA)||"[]");t.splice(0,0,e),t=Array.from(new Set(t)),t.length>window.siyuan.config.search.limit&&t.splice(window.siyuan.config.search.limit,t.length-window.siyuan.config.search.limit),localStorage.setItem(o.Constants.LOCAL_SEARCHETABDATA,JSON.stringify(t))}inputEvent(e,t){if(t&&t.isComposing)return;clearTimeout(this.inputTimeout);const n=this.element.querySelector(".fn__loading--top");this.inputTimeout=window.setTimeout((()=>{this.text=e.value,this.parent.updateTitle(this.text),n.classList.remove("fn__none"),(0,u.fetchPost)("/api/search/fullTextSearchBlock",{query:this.text},(e=>{this.onSearch(e.data.blocks),this.element.querySelector("#globalSearchResult").innerHTML=window.siyuan.languages.findInDoc.replace("${x}",e.data.matchedRootCount).replace("${y}",e.data.matchedBlockCount),n.classList.add("fn__none")}))}),o.Constants.TIMEOUT_SEARCH)}updateSearch(e,t){const n=this.element.querySelector(".b3-text-field");if(""===e)return void n.select();const i=n.value;i!==e&&(t||(i.indexOf(e)>-1?e=i.replace(e+" ","").replace(" "+e,""):""!==i&&(e=i+" "+e)),this.text=e,this.parent.updateTitle(this.text),n.value=this.text,n.select(),this.inputEvent(n),this.setLocalStorage(e))}onSearch(e){let t="";e.forEach(((e,n)=>{const i=(0,c.escapeHtml)((0,r.getNotebookName)(e.box))+(0,r.getDisplayName)(e.hPath,!1);t+=`<div data-type="search-item" class="b3-list-item${0===n?" b3-list-item--focus":""}" data-url="${e.box}" data-path="${e.path}" data-node-id="${e.id}">\n    <svg class="b3-list-item__graphic"><use xlink:href="#${(0,s.getIconByType)(e.type)}"></use></svg>\n    <span class="b3-list-item__text">${(0,f.unicode2Emoji)(e.ial.icon)}${e.ial.icon?"&nbsp;":""}${e.content}</span>\n    <span class="b3-list-item__meta b3-list-item__meta--ellipsis" title="${Lute.EscapeHTMLStr(i)}">${Lute.EscapeHTMLStr(i)}</span>\n</div>`})),this.element.querySelector("#globalSearchList").innerHTML=t||`<div class="b3-list--empty">${window.siyuan.languages.emptyContent}</div>`,0!==e.length?this.getArticle(e[0].id,this.element.querySelector(".b3-text-field").value):this.protyle&&this.protyle.protyle.element.classList.add("fn__none")}}t.Search=g},5031:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.openSearch=void 0;const a=n(3863),o=n(1308),s=n(8813),r=n(8792),l=n(2009),c=n(9866),u=n(734),d=n(7010),p=n(9516),h=n(1384),f=n(2892),g=n(1890),m=n(4640),y=n(5961),b=n(7640);let v;t.openSearch=(e,t,n,o)=>i(void 0,void 0,void 0,(function*(){const i=window.siyuan.dialogs.find((t=>{if(t.element.querySelector("#searchList")){const n=t.element.getAttribute("data-key"),i=t.element.querySelectorAll(".search__header")[1];if(n!==e&&e===window.siyuan.config.keymap.general.replace.custom&&i.classList.contains("fn__none"))return i.classList.remove("fn__none"),t.element.setAttribute("data-key",e),!0;const a=t.element.querySelector("#searchPathCheck");if(n!==e&&e===window.siyuan.config.keymap.general.globalSearch.custom){if(!a.classList.contains("b3-button--cancel"))return a.dispatchEvent(new CustomEvent("click")),t.element.setAttribute("data-key",e),!0;if(!i.classList.contains("fn__none"))return i.classList.add("fn__none"),t.element.setAttribute("data-key",e),!0}if(n!==e&&e===window.siyuan.config.keymap.general.search.custom){if(a.classList.contains("b3-button--cancel"))return a.dispatchEvent(new CustomEvent("click")),t.element.setAttribute("data-key",e),!0;if(!i.classList.contains("fn__none"))return i.classList.add("fn__none"),t.element.setAttribute("data-key",e),!0}return t.destroy(),!0}}));if(i)return;v=void 0;const l=JSON.parse(localStorage.getItem(r.Constants.LOCAL_SEARCHEDATA)||"{}");if(l.idPath||(l.idPath=""),l.hPath||(l.hPath=""),t&&(l.k=t),l.types||(l.types={document:window.siyuan.config.search.document,heading:window.siyuan.config.search.heading,list:window.siyuan.config.search.list,listItem:window.siyuan.config.search.listItem,codeBlock:window.siyuan.config.search.codeBlock,htmlBlock:window.siyuan.config.search.htmlBlock,mathBlock:window.siyuan.config.search.mathBlock,table:window.siyuan.config.search.table,blockquote:window.siyuan.config.search.blockquote,superBlock:window.siyuan.config.search.superBlock,paragraph:window.siyuan.config.search.paragraph}),n&&(l.hPath=(0,a.escapeHtml)((0,s.getNotebookName)(n)),l.idPath=n),o&&"/"!==o){const e=yield(0,u.fetchSyncPost)("/api/filetree/getHPathByPath",{notebook:n,path:o.endsWith(".sy")?o:o+".sy"});l.hPath=(0,s.pathPosix)().join(l.hPath,(0,a.escapeHtml)(e.data)),l.idPath=(0,s.pathPosix)().join(l.idPath,o)}let d;n&&localStorage.setItem(r.Constants.LOCAL_SEARCHEDATA,JSON.stringify(l)),getSelection().rangeCount>0&&(d=getSelection().getRangeAt(0));const h=new c.Dialog({content:`<div class="fn__flex">\n    <div class="fn__flex-column" style="height:70vh;width:80vw;border-radius: 4px;overflow: hidden;">\n    <div class="b3-form__icon search__header">\n        <span class="fn__a" id="searchHistoryBtn">\n            <svg data-menu="true" class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>\n            <svg class="search__arrowdown"><use xlink:href="#iconDown"></use></svg>\n        </span>\n        <input id="searchInput" class="b3-text-field b3-text-field--text fn__block b3-form__icon-input">\n        <div id="searchHistoryList" data-close="false" class="fn__none b3-menu b3-list b3-list--background"></div>\n    </div>\n    <div class="b3-form__icon search__header${e===window.siyuan.config.keymap.general.replace.custom?"":" fn__none"}">\n        <span class="fn__a" id="replaceHistoryBtn">\n            <svg data-menu="true" class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>\n            <svg class="search__arrowdown"><use xlink:href="#iconDown"></use></svg>\n        </span>\n        <input id="replaceInput" class="b3-text-field b3-text-field--text fn__block b3-form__icon-input">\n        <svg class="fn__rotate fn__none svg" style="padding: 0 8px;align-self: center;"><use xlink:href="#iconRefresh"></use></svg>\n        <button id="replaceAllBtn" class="b3-button b3-button--outline fn__flex-center">${window.siyuan.languages.replaceAll}</button>\n        <div class="fn__space"></div>\n        <button id="replaceBtn" class="b3-button b3-button--outline fn__flex-center">${window.siyuan.languages.replace}</button>\n        <div class="fn__space"></div>\n        <div id="replaceHistoryList" data-close="false" class="fn__none b3-menu b3-list b3-list--background"></div>\n    </div>\n    <div class="fn__flex b3-form__space--small">\n        <span id="searchResult" style="white-space: nowrap;"></span>\n        <span class="fn__space"></span>\n        <span class="fn__flex-1"></span>\n        <span id="searchPathInput" class="ft__on-surface fn__flex-center ft__smaller fn__ellipsis" style="white-space: nowrap;" title="${l.hPath}">${l.hPath}</span>\n        <span class="fn__space"></span>\n        <button id="searchPathCheck" class="b3-button b3-button--small${n?"":" b3-button--cancel"}">${window.siyuan.languages.specifyPath}</button>\n        <span class="fn__space"></span>\n        <button id="includeChildCheck" class="b3-button b3-button--small${n&&l.idPath&&!l.idPath.endsWith(".sy")?"":" b3-button--cancel"}">${window.siyuan.languages.includeChildDoc}</button>\n        <span class="fn__space"></span>\n        <button id="searchSyntaxCheck" class="b3-button b3-button--small${l.querySyntax?"":" b3-button--cancel"}">${window.siyuan.languages.querySyntax}</button>\n        <span class="fn__space"></span>\n        <span aria-label="${window.siyuan.languages.type}" class="b3-tooltips b3-tooltips__nw">\n            <svg class="svg ft__on-surface" id="searchFilter" style="height: 19px;float: left"><use xlink:href="#iconSettings"></use></svg>\n        </span>\n    </div>\n    <div id="searchList" style="position:relative;height:calc(50% - 69px);overflow: auto" class="b3-list b3-list--background search__list"></div>\n    <div id="searchPreview" class="fn__flex-1 spread-search__preview"></div></div>\n    <div id="searchFilterPanel" class="fn__none spread-search__filter">\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.math}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="mathBlock" type="checkbox"${l.types.mathBlock?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.table}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="table" type="checkbox"${l.types.table?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.quote}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="blockquote" type="checkbox"${l.types.blockquote?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.superBlock}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="superBlock" type="checkbox"${l.types.superBlock?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.paragraph}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="paragraph" type="checkbox"${l.types.paragraph?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.doc}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="document" type="checkbox"${l.types.document?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.headings}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="heading" type="checkbox"${l.types.heading?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.list1}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="list" type="checkbox"${l.types.list?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.listItem}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="listItem" type="checkbox"${l.types.listItem?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                ${window.siyuan.languages.code}\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="codeBlock" type="checkbox"${l.types.codeBlock?" checked":""}/>\n        </label>\n        <label class="fn__flex">\n            <div class="fn__flex-1 b3-label__text">\n                HTML\n            </div>\n            <span class="fn__space"></span>\n            <input class="b3-switch fn__flex-center" id="htmlBlock" type="checkbox"${l.types.htmlBlock?" checked":""}/>\n        </label>\n    </div>\n    <div class="fn__loading fn__loading--top"><img width="120px" src="/stage/loading-pure.svg"></div>\n</div>`,width:"80vw",destroyCallback:()=>{d&&(0,m.focusByRange)(d),v&&v.destroy()}});h.element.setAttribute("data-key",e),h.element.firstElementChild.setAttribute("style","z-index:199");const b=h.element.querySelector("#searchFilter"),k=h.element.querySelector("#searchFilterPanel");b.addEventListener("click",(()=>{k.classList.contains("fn__none")?(b.classList.add("ft__primary"),k.classList.remove("fn__none")):(b.classList.remove("ft__primary"),k.classList.add("fn__none"))})),k.querySelectorAll("input").forEach((e=>{e.addEventListener("change",(()=>{M(),l.types={document:h.element.querySelector("#document").checked,heading:h.element.querySelector("#heading").checked,list:h.element.querySelector("#list").checked,listItem:h.element.querySelector("#listItem").checked,codeBlock:h.element.querySelector("#codeBlock").checked,htmlBlock:h.element.querySelector("#htmlBlock").checked,mathBlock:h.element.querySelector("#mathBlock").checked,table:h.element.querySelector("#table").checked,blockquote:h.element.querySelector("#blockquote").checked,superBlock:h.element.querySelector("#superBlock").checked,paragraph:h.element.querySelector("#paragraph").checked},localStorage.setItem(r.Constants.LOCAL_SEARCHEDATA,JSON.stringify(l))}))}));const C=h.element.querySelector("#includeChildCheck"),D=h.element.querySelector("#searchPathCheck");D.addEventListener("click",(()=>{D.classList.toggle("b3-button--cancel"),D.classList.contains("b3-button--cancel")&&!C.classList.contains("b3-button--cancel")&&C.classList.add("b3-button--cancel"),M()})),C.addEventListener("click",(()=>{C.classList.toggle("b3-button--cancel");let e=!1;C.classList.contains("b3-button--cancel")?l.idPath.endsWith(".sy")||(l.idPath=l.idPath+".sy",e=!0):(D.classList.contains("b3-button--cancel")&&(D.classList.remove("b3-button--cancel"),e=!0),l.idPath.endsWith(".sy")&&(l.idPath=l.idPath.replace(".sy",""),e=!0)),e&&(localStorage.setItem(r.Constants.LOCAL_SEARCHEDATA,JSON.stringify(l)),M())}));const x=h.element.querySelector("#searchSyntaxCheck");x.addEventListener("click",(()=>{x.classList.toggle("b3-button--cancel"),l.querySyntax=!x.classList.contains("b3-button--cancel"),M(),localStorage.setItem(r.Constants.LOCAL_SEARCHEDATA,JSON.stringify(l))}));const S=h.element.querySelector("#searchList"),A=h.element.querySelector("#searchInput"),L=h.element.querySelector("#replaceInput");A.value=l.k||"",L.value=l.r||"",A.select();const T=h.element.querySelector("#searchHistoryList");T.addEventListener("click",(e=>{e.target.classList.contains("b3-list-item")&&(A.value=e.target.textContent,A.dispatchEvent(new CustomEvent("blur")),T.classList.add("fn__none"),M())})),h.element.querySelector("#searchHistoryBtn").addEventListener("click",(()=>{let e="";(l.list||[]).forEach((t=>{t!==A.value&&(e+=`<div class="b3-list-item">${(0,a.escapeHtml)(t)}</div>`)})),T.classList.remove("fn__none"),T.innerHTML=e,B.classList.add("fn__none")}));const B=h.element.querySelector("#replaceHistoryList");B.addEventListener("click",(e=>{e.target.classList.contains("b3-list-item")&&(L.value=e.target.textContent,B.classList.add("fn__none"))})),h.element.querySelector("#replaceHistoryBtn").addEventListener("click",(()=>{let e="";(l.replaceList||[]).forEach((t=>{t!==L.value&&(e+=`<div class="b3-list-item">${(0,a.escapeHtml)(t)}</div>`)})),B.classList.remove("fn__none"),B.innerHTML=e,T.classList.add("fn__none")}));let P=0;const I=h.element.querySelector(".fn__loading--top"),M=e=>{e&&e.isComposing||(clearTimeout(P),P=window.setTimeout((()=>{I.classList.remove("fn__none");const e=A.value;""===e?(0,u.fetchPost)("/api/block/getRecentUpdatedBlocks",{},(e=>{E(e.data,h),I.classList.add("fn__none"),h.element.querySelector("#searchResult").innerHTML=""})):(0,u.fetchPost)("/api/search/fullTextSearchBlock",{query:e,querySyntax:l.querySyntax,types:{document:h.element.querySelector("#document").checked,heading:h.element.querySelector("#heading").checked,list:h.element.querySelector("#list").checked,listItem:h.element.querySelector("#listItem").checked,codeBlock:h.element.querySelector("#codeBlock").checked,htmlBlock:h.element.querySelector("#htmlBlock").checked,mathBlock:h.element.querySelector("#mathBlock").checked,table:h.element.querySelector("#table").checked,blockquote:h.element.querySelector("#blockquote").checked,superBlock:h.element.querySelector("#superBlock").checked,paragraph:h.element.querySelector("#paragraph").checked},path:D.classList.contains("b3-button--cancel")?"":l.idPath},(e=>{E(e.data.blocks,h),h.element.querySelector("#searchResult").innerHTML=window.siyuan.languages.findInDoc.replace("${x}",e.data.matchedRootCount).replace("${y}",e.data.matchedBlockCount),I.classList.add("fn__none")}))}),r.Constants.TIMEOUT_SEARCH))};A.addEventListener("compositionend",(e=>{M(e)})),A.addEventListener("input",(e=>{M(e)})),A.addEventListener("blur",(()=>{let e=l.list||[];e.splice(0,0,A.value),e=Array.from(new Set(e)),e.length>window.siyuan.config.search.limit&&e.splice(window.siyuan.config.search.limit,e.length-window.siyuan.config.search.limit),l.list=e,l.k=A.value,localStorage.setItem(r.Constants.LOCAL_SEARCHEDATA,JSON.stringify(l))})),A.addEventListener("focus",(()=>{T.classList.add("fn__none"),B.classList.add("fn__none")}));const F=28;A.addEventListener("keydown",(e=>{let t=S.querySelector(".b3-list-item--focus");if(t&&!e.isComposing)if("ArrowDown"===e.key)t.classList.remove("b3-list-item--focus"),t.nextElementSibling?t.nextElementSibling.classList.add("b3-list-item--focus"):S.children[0].classList.add("b3-list-item--focus"),t=S.querySelector(".b3-list-item--focus"),(S.scrollTop<t.offsetTop-S.clientHeight+F||S.scrollTop>t.offsetTop)&&(S.scrollTop=t.offsetTop-S.clientHeight+F),_({dialog:h,id:t.getAttribute("data-node-id"),k:w(t)}),e.preventDefault();else if("ArrowUp"===e.key){if(t.classList.remove("b3-list-item--focus"),t.previousElementSibling)t.previousElementSibling.classList.add("b3-list-item--focus");else{const e=S.children.length;S.children[e-1].classList.add("b3-list-item--focus")}t=S.querySelector(".b3-list-item--focus"),(S.scrollTop<t.offsetTop-S.clientHeight+F||S.scrollTop>t.offsetTop-56)&&(S.scrollTop=t.offsetTop-56),_({dialog:h,id:t.getAttribute("data-node-id"),k:w(t)}),e.preventDefault()}else if("Enter"===e.key){const n=t.getAttribute("data-node-id");(0,u.fetchPost)("/api/block/checkBlockFold",{id:n},(e=>{(0,p.openFileById)({id:n,action:e.data?[r.Constants.CB_GET_FOCUS,r.Constants.CB_GET_ALL]:[r.Constants.CB_GET_FOCUS,r.Constants.CB_GET_CONTEXT],zoomIn:e.data}),h.destroy()})),e.preventDefault()}}));const N=e=>{const t=L.nextElementSibling;if(!t.classList.contains("fn__none"))return;let n=l.replaceList||[];n.splice(0,0,L.value),n=Array.from(new Set(n)),n.length>window.siyuan.config.search.limit&&n.splice(window.siyuan.config.search.limit,n.length-window.siyuan.config.search.limit),l.replaceList=n,l.r=L.value,localStorage.setItem(r.Constants.LOCAL_SEARCHEDATA,JSON.stringify(l));let i=S.querySelector(".b3-list-item--focus");if(!i)return;t.classList.remove("fn__none");let a=[],o=[];e?S.querySelectorAll(".b3-list-item").forEach((e=>{a.push(e.getAttribute("data-node-id")),o.push(e.getAttribute("data-root-id"))})):(a=[i.getAttribute("data-node-id")],o=[i.getAttribute("data-root-id")]),(0,u.fetchPost)("/api/search/findReplace",{k:w(i),r:L.value,ids:a,types:{document:h.element.querySelector("#document").checked,heading:h.element.querySelector("#heading").checked,list:h.element.querySelector("#list").checked,listItem:h.element.querySelector("#listItem").checked,codeBlock:h.element.querySelector("#codeBlock").checked,htmlBlock:h.element.querySelector("#htmlBlock").checked,mathBlock:h.element.querySelector("#mathBlock").checked,table:h.element.querySelector("#table").checked,blockquote:h.element.querySelector("#blockquote").checked,superBlock:h.element.querySelector("#superBlock").checked,paragraph:h.element.querySelector("#paragraph").checked}},(e=>{if(t.classList.add("fn__none"),1!==e.code){if(!(a.length>1)){if((0,f.getAllModels)().editor.forEach((e=>{o[0]===e.editor.protyle.block.rootID&&(0,y.reloadProtyle)(e.editor.protyle)})),!i.nextElementSibling&&S.children[0]?S.children[0].classList.add("b3-list-item--focus"):i.nextElementSibling.classList.add("b3-list-item--focus"),i.remove(),0===S.childElementCount)return S.innerHTML=`<div class="b3-list--empty">${window.siyuan.languages.emptyContent}</div>`,void v.protyle.element.classList.add("fn__none");i=S.querySelector(".b3-list-item--focus"),(S.scrollTop<i.offsetTop-S.clientHeight+F||S.scrollTop>i.offsetTop)&&(S.scrollTop=i.offsetTop-S.clientHeight+F),_({dialog:h,id:i.getAttribute("data-node-id"),k:w(i)})}}else(0,g.showMessage)(e.msg)}))};let $;L.addEventListener("focus",(()=>{T.classList.add("fn__none"),B.classList.add("fn__none")})),L.addEventListener("keydown",(e=>{e.isComposing||"Enter"!==e.key||(e.preventDefault(),N(!1))})),h.element.querySelector("#replaceAllBtn").addEventListener("click",(()=>{N(!0)})),h.element.querySelector("#replaceBtn").addEventListener("click",(()=>{N(!1)})),S.addEventListener("click",(e=>{let t=e.target;for(;t&&!t.isEqualNode(h.element);){if("search-item"===t.getAttribute("data-type")){if(1===e.detail)$=window.setTimeout((()=>{if(window.siyuan.altIsPressed){const e=t.getAttribute("data-node-id");(0,u.fetchPost)("/api/block/checkBlockFold",{id:e},(t=>{(0,p.openFileById)({id:e,action:t.data?[r.Constants.CB_GET_FOCUS,r.Constants.CB_GET_ALL]:[r.Constants.CB_GET_FOCUS,r.Constants.CB_GET_CONTEXT],zoomIn:t.data,position:"right"}),h.destroy()}))}else S.querySelector(".b3-list-item--focus").classList.remove("b3-list-item--focus"),t.classList.add("b3-list-item--focus"),_({dialog:h,id:t.getAttribute("data-node-id"),k:w(t)}),A.focus()}),r.Constants.TIMEOUT_DBLCLICK);else if(2===e.detail){clearTimeout($);const e=t.getAttribute("data-node-id");(0,u.fetchPost)("/api/block/checkBlockFold",{id:e},(t=>{(0,p.openFileById)({id:e,action:t.data?[r.Constants.CB_GET_FOCUS,r.Constants.CB_GET_ALL]:[r.Constants.CB_GET_FOCUS,r.Constants.CB_GET_CONTEXT],zoomIn:t.data}),h.destroy()}))}window.siyuan.menus.menu.remove(),e.preventDefault(),e.stopPropagation();break}t=t.parentElement}T.classList.add("fn__none"),B.classList.add("fn__none")}),!1),M()}));const w=e=>{const t=[];return e.querySelectorAll("mark").forEach((e=>{t.push(e.textContent)})),[...new Set(t)].join(" ")},_=e=>{(0,u.fetchPost)("/api/block/checkBlockFold",{id:e.id},(t=>{v?(v.protyle.scroll.lastScrollTop=0,(0,h.addLoading)(v.protyle),(0,u.fetchPost)("/api/filetree/getDoc",{id:e.id,k:e.k,mode:t.data?0:3,size:t.data?r.Constants.SIZE_GET_MAX:r.Constants.SIZE_GET},(n=>{(0,d.onGet)(n,v.protyle,t.data?[r.Constants.CB_GET_ALL,r.Constants.CB_GET_HTML]:[r.Constants.CB_GET_HL,r.Constants.CB_GET_HTML]);const i=v.protyle.wysiwyg.element.querySelector(`div[data-node-id="${e.id}"] span[data-type="search-mark"]`);i&&i.scrollIntoView()}))):v=new l.default(e.dialog.element.querySelector("#searchPreview"),{blockId:e.id,action:t.data?[r.Constants.CB_GET_HL,r.Constants.CB_GET_ALL,r.Constants.CB_GET_HTML]:[r.Constants.CB_GET_HL,r.Constants.CB_GET_CONTEXT,r.Constants.CB_GET_HTML],key:e.k,render:{gutter:!0,breadcrumbDocName:!0},after:()=>{setTimeout((()=>{const t=v.protyle.wysiwyg.element.querySelector(`div[data-node-id="${e.id}"] span[data-type="search-mark"]`);t&&t.scrollIntoView()}),r.Constants.TIMEOUT_SEARCH)}})}))},E=(e,t)=>{let n="";if(e.forEach(((e,t)=>{const i=(0,a.escapeHtml)((0,s.getNotebookName)(e.box))+(0,s.getDisplayName)(e.hPath,!1);n+=`<div data-type="search-item" class="b3-list-item${0===t?" b3-list-item--focus":""}" data-node-id="${e.id}" data-root-id="${e.rootID}">\n<svg class="b3-list-item__graphic"><use xlink:href="#${(0,o.getIconByType)(e.type)}"></use></svg>\n<span class="b3-list-item__text">${(0,b.unicode2Emoji)(e.ial.icon)}${e.ial.icon?"&nbsp;":""}${e.content}</span>\n<span class="b3-list-item__meta b3-list-item__meta--ellipsis" title="${Lute.EscapeHTMLStr(i)}">${Lute.EscapeHTMLStr(i)}</span>\n</div>`})),e[0]){v?v.protyle.element.classList.remove("fn__none"):t.element.querySelector("#searchPreview").classList.remove("fn__none");const n=document.createElement("div");n.innerHTML=e[0].content,_({dialog:t,id:e[0].id,k:w(n)})}else v?v.protyle.element.classList.add("fn__none"):t.element.querySelector("#searchPreview").classList.add("fn__none");t.element.querySelector("#searchList").innerHTML=n||`<div class="b3-list--empty">${window.siyuan.languages.emptyContent}</div>`}},4681:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openGlobalSearch=void 0;const i=n(2892),a=n(3371),o=n(2269),s=n(7729);t.openGlobalSearch=(e,t)=>{let n;e=e.trim();if((0,i.getAllModels)().search.find(((i,a)=>(0===a&&(n=i.parent.parent),n.switchTab(i.parent.headElement),i.updateSearch(e,t),!0))))return;n||(n=(0,a.getWndByLayout)(window.siyuan.layout.centerLayout));const r=new o.Tab({icon:"iconSearch",title:e,callback(t){const n=new s.Search({tab:t,text:e});t.addModel(n),(0,a.resizeTabs)()}});n.split("lr").addTab(r)}},5370:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncGuide=t.getSyncCloudList=t.bindSyncCloudListEvent=t.addCloudName=void 0;const i=n(8776),a=n(1890),o=n(734),s=n(9866),r=n(1377),l=n(3274),c=n(7956);t.addCloudName=e=>{const n=new s.Dialog({title:window.siyuan.languages.cloudSyncDir,content:`<div class="b3-dialog__content">\n    <input class="b3-text-field fn__block" value="main">\n    <div class="b3-label__text">${window.siyuan.languages.reposTip}</div>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:(0,l.isMobile)()?"80vw":"520px"}),i=n.element.querySelector("input"),a=n.element.querySelectorAll(".b3-button");n.bindInput(i,(()=>{a[1].click()})),i.focus(),i.select(),a[0].addEventListener("click",(()=>{n.destroy()})),a[1].addEventListener("click",(()=>{e.innerHTML='<img style="margin: 0 auto;display: block;width: 64px;height: 100%" src="/stage/loading-pure.svg">',(0,o.fetchPost)("/api/sync/createCloudSyncDir",{name:i.value},(()=>{n.destroy(),(0,t.getSyncCloudList)(e,!0)}))}))};t.bindSyncCloudListEvent=e=>{e.addEventListener("click",(n=>{let i=n.target;for(;i&&!i.isEqualNode(e);){const a=i.getAttribute("data-type");if(a){switch(a){case"addCloud":(0,t.addCloudName)(e);break;case"removeCloud":(0,r.confirmDialog)(window.siyuan.languages.confirm,`${window.siyuan.languages.confirmDeleteCloudDir} <i>${i.parentElement.getAttribute("data-name")}</i>`,(()=>{e.innerHTML='<img style="margin: 0 auto;display: block;width: 64px;height: 100%" src="/stage/loading-pure.svg">',(0,o.fetchPost)("/api/sync/removeCloudSyncDir",{name:i.parentElement.getAttribute("data-name")},(n=>{window.siyuan.config.sync.cloudName=n.data,(0,t.getSyncCloudList)(e,!0)}))}));break;case"selectCloud":e.innerHTML='<img style="margin: 0 auto;display: block;width: 64px;height: 100%" src="/stage/loading-pure.svg">',(0,o.fetchPost)("/api/sync/setCloudSyncDir",{name:i.getAttribute("data-name")},(()=>{window.siyuan.config.sync.cloudName=i.getAttribute("data-name"),(0,t.getSyncCloudList)(e,!0)}))}n.preventDefault(),n.stopPropagation();break}i=i.parentElement}}))};t.getSyncCloudList=(e,t=!1,n)=>{(t||"IMG"===e.firstElementChild.tagName)&&(0,o.fetchPost)("/api/sync/listCloudSyncDir",{},(t=>{let i=`<div class="fn__hr"></div><ul><li style="padding: 0 16px" class="b3-list--empty">${window.siyuan.languages.emptyCloudSyncList}</li></ul>`;1===t.code?i=`<div class="fn__hr"></div><ul><li style="padding: 0 16px" class="b3-list--empty ft__error">${t.msg}</li></ul>`:1!==t.code&&(i='<div class="fn__hr"></div><ul class="b3-list b3-list--background fn__flex-1" style="overflow: auto;">',t.data.syncDirs.forEach((e=>{i+=`<li data-type="selectCloud" data-name="${e.cloudName}" class="b3-list-item${(0,l.isMobile)()?"":" b3-list-item--hide-action"}">\n<input type="radio" name="cloudName"${e.cloudName===t.data.checkedSyncDir?" checked":""}/>\n<span class="fn__space"></span>\n<span>${e.cloudName}</span>\n<span class="fn__space"></span>\n<span class="ft__on-surface">${e.hSize}</span>\n<span class="b3-list-item__meta${(0,l.isMobile)()?" fn__none":""}">${e.updated}</span>\n<span class="fn__flex-1 fn__space"></span>\n<span data-type="removeCloud" class="b3-tooltips b3-tooltips__w b3-list-item__action" aria-label="${window.siyuan.languages.delete}">\n    <svg><use xlink:href="#iconTrashcan"></use></svg>\n</span></li>`})),i+=`</ul>\n<div class="fn__hr"></div>\n<div class="fn__flex">\n    <div class="fn__flex-1"></div>\n    <button class="b3-button b3-button--outline" data-type="addCloud"><svg><use xlink:href="#iconAdd"></use></svg>${window.siyuan.languages.addAttr}</button>\n</div>`),e.innerHTML=i,n&&n()}))};t.syncGuide=e=>{if(!e||!e.classList.contains("toolbar__item--active")){if((0,l.isMobile)()){if((0,i.needSubscribe)())return}else if((0,i.needSubscribe)("")){const e=new s.Dialog({title:window.siyuan.languages.account,content:`<div class="account" style="background-color: var(--b3-theme-background)">${c.account.genHTML()}</div>`,width:"80vw"});return void c.account.bindEvent(e.element.querySelector(".account"))}window.siyuan.config.repo.key?window.siyuan.config.sync.enabled?(0,o.fetchPost)("/api/sync/performSync",{}):u():d()}};const u=(e,n)=>{if(e&&(window.siyuan.config.repo.key=e),window.siyuan.config.sync.enabled)n&&n.destroy(),(0,r.confirmDialog)(window.siyuan.languages.syncConfGuide4,window.siyuan.languages.syncConfGuide5,(()=>{(0,o.fetchPost)("/api/sync/performSync",{})}));else{const e=`<div class="b3-dialog__content">\n    <div class="ft__on-surface">${window.siyuan.languages.syncConfGuide3}</div>\n    <div style="display: flex;flex-direction: column;height: 40vh;">\n        <img style="margin: 0 auto;display: block;width: 64px;height: 100%" src="/stage/loading-pure.svg">\n    </div>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button" disabled="disabled">${window.siyuan.languages.openSyncTip1}</button>\n</div>`;n?(n.element.querySelector(".b3-dialog__header").innerHTML=window.siyuan.languages.cloudSyncDir,n.element.querySelector(".b3-dialog__container").lastElementChild.innerHTML=e):n=new s.Dialog({title:window.siyuan.languages.cloudSyncDir,content:e,width:(0,l.isMobile)()?"80vw":"520px"});const i=n.element.querySelector(".b3-dialog__content").lastElementChild;(0,t.bindSyncCloudListEvent)(i);const c=n.element.querySelector(".b3-button");(0,t.getSyncCloudList)(i,!1,(()=>{i.querySelector("input[checked]")?c.removeAttribute("disabled"):c.setAttribute("disabled","disabled")})),c.addEventListener("click",(()=>{n.destroy(),(0,o.fetchPost)("/api/sync/setSyncEnable",{enabled:!0},(e=>{1===e.code?(0,a.showMessage)(e.msg):(window.siyuan.config.sync.enabled=!0,(0,r.confirmDialog)(window.siyuan.languages.syncConfGuide4,window.siyuan.languages.syncConfGuide5,(()=>{(0,o.fetchPost)("/api/sync/performSync",{})})))}))}))}},d=()=>{const e=new s.Dialog({title:window.siyuan.languages.syncConfGuide1,content:`<div class="b3-dialog__content ft__center">\n    <img style="width: 260px" src="/stage/images/sync-guide.svg"/>\n    <div class="fn__hr--b"></div>\n    <div class="ft__on-surface">${window.siyuan.languages.syncConfGuide2}</div>\n     <div class="fn__hr--b"></div>\n    <input class="b3-text-field fn__block ft__center" placeholder="${window.siyuan.languages.passphrase}">\n    <div class="fn__hr"></div>\n    <button class="b3-button fn__block" id="initKeyByPW">\n        <svg><use xlink:href="#iconHand"></use></svg>${window.siyuan.languages.genKeyByPW}\n    </button>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button>\n</div>`,width:(0,l.isMobile)()?"80vw":"520px"});e.element.querySelector(".b3-button--cancel").addEventListener("click",(()=>{e.destroy()}));const t=e.element.querySelector(".b3-text-field");e.element.querySelector("#initKeyByPW").addEventListener("click",(()=>{t.value?(0,r.confirmDialog)("🔑 "+window.siyuan.languages.genKeyByPW,window.siyuan.languages.initRepoKeyTip,(()=>{(0,o.fetchPost)("/api/repo/InitRepoKeyFromPassphrase",{pass:t.value},(t=>{u(t.data.key,e)}))})):(0,a.showMessage)(window.siyuan.languages._kernel[142])})),t.focus()}},237:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tree=void 0;const i=n(1308),a=n(3607),o=n(3274),s=n(8527),r=n(7640),l=n(8792);t.Tree=class{constructor(e){this.click=e.click,this.ctrlClick=e.ctrlClick,this.altClick=e.altClick,this.shiftClick=e.shiftClick,this.rightClick=e.rightClick,this.element=e.element,this.blockExtHTML=e.blockExtHTML,this.topExtHTML=e.topExtHTML,this.updateData(e.data),this.bindEvent()}updateData(e){this.data=e,this.data&&0!==this.data.length?(this.element.innerHTML=this.genHTML(this.data),(0,s.mathRender)(this.element)):this.element.innerHTML=`<ul class="b3-list b3-list--background"><li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li></ul>`}genHTML(e){let t=`<ul${0===e[0].depth?" class='b3-list b3-list--background'":""}>`;return e.forEach((e=>{let n='<svg class="b3-list-item__graphic"><use xlink:href="#iconFolder"></use></svg>';"bookmark"===e.type?n='<svg class="b3-list-item__graphic"><use xlink:href="#iconBookmark"></use></svg>':"tag"===e.type?n='<svg class="b3-list-item__graphic"><use xlink:href="#iconTags"></use></svg>':("backlink"===e.type||"outline"===e.type)&&(n=`<svg class="b3-list-item__graphic popover__block" data-id="${e.id}"><use xlink:href="#${(0,i.getIconByType)(e.nodeType,e.subType)}"></use></svg>`);let a="";e.count&&(a=`<span class="counter">${e.count}</span>`),t+=`<li class="b3-list-item" \n${"NodeDocument"!==e.nodeType&&"backlink"===e.type?'draggable="true"':""}\n${e.id?'data-node-id="'+e.id+'"':""} \ndata-treetype="${e.type}" \ndata-type="${e.nodeType}" \ndata-subtype="${e.subType}" \n${e.label?"data-label='"+e.label+"'":""}>\n    <span style="padding-left: ${16*e.depth}px" class="b3-list-item__toggle">\n        <svg data-id="${encodeURIComponent(e.name+e.depth)}" class="b3-list-item__arrow ${e.children&&e.children.length>0||e.blocks&&e.blocks.length>0?"b3-list-item__arrow--open":"fn__hidden"}"><use xlink:href="#iconRight"></use></svg>\n    </span>\n    ${n}\n    <span class="b3-list-item__text"${"outline"===e.type?' title="'+Lute.EscapeHTMLStr(Lute.BlockDOM2Content(e.name))+'"':""}>${e.name}</span>\n    ${a}\n    ${this.topExtHTML||""}\n</li>`,e.children&&e.children.length>0&&(t+=this.genHTML(e.children)+"</ul>"),e.blocks&&e.blocks.length>0&&(t+=this.genBlockHTML(e.blocks,!0,e.type)+"</ul>")})),t}genBlockHTML(e,t=!1,n){let a=`<ul class="${t?"":"fn__none"}">`;return e.forEach((e=>{let t,s="";e.count&&(s=`<span class="counter">${e.count}</span>`),t="NodeDocument"===e.type?`<span data-defids='["${e.defID}"]' class="b3-list-item__graphic popover__block" data-id="${e.id}">${(0,r.unicode2Emoji)(e.ial.icon||l.Constants.SIYUAN_IMAGE_FILE)}</span>`:`<svg data-defids='["${e.defID}"]' class="b3-list-item__graphic popover__block" data-id="${e.id}"><use xlink:href="#${(0,i.getIconByType)(e.type,e.subType)}"></use></svg>`,a+=`<li ${"backlink"===n?'draggable="true"':""} \nclass="b3-list-item ${(0,o.isMobile)()?"":"b3-list-item--hide-action"}"  \ndata-node-id="${e.id}" \ndata-ref-text="${encodeURIComponent(e.refText)}" \ndata-def-id="${e.defID}" \ndata-type="${e.type}" \ndata-subtype="${e.subType}" \ndata-treetype="${n}"\ndata-def-path="${e.defPath}">\n    <span style="padding-left: ${16*e.depth}px" class="b3-list-item__toggle">\n        <svg data-id="${e.id}" class="b3-list-item__arrow${e.children?"":" fn__hidden"}"><use xlink:href="#iconRight"></use></svg>\n    </span>\n    ${t}\n    <span class="b3-list-item__text" ${"outline"===n?' title="'+Lute.EscapeHTMLStr(Lute.BlockDOM2Content(e.content))+'"':""}>${e.content}</span>\n    ${s}\n    ${this.blockExtHTML||""}\n</li>`,e.children&&e.children.length>0&&(a+=this.genBlockHTML(e.children,!1,n)+"</ul>")})),a}toggleBlocks(e){if(!e.nextElementSibling)return;const t=e.firstElementChild.firstElementChild;t.classList.contains("b3-list-item__arrow--open")?(t.classList.remove("b3-list-item__arrow--open"),e.nextElementSibling.classList.add("fn__none"),e.nextElementSibling.nextElementSibling&&"UL"===e.nextElementSibling.nextElementSibling.tagName&&e.nextElementSibling.nextElementSibling.classList.add("fn__none")):(t.classList.add("b3-list-item__arrow--open"),e.nextElementSibling.classList.remove("fn__none"),e.nextElementSibling.nextElementSibling&&"UL"===e.nextElementSibling.nextElementSibling.tagName&&e.nextElementSibling.nextElementSibling.classList.remove("fn__none"))}setCurrent(e){e.classList.contains("b3-list--empty")||(this.element.querySelectorAll("li").forEach((e=>{e.classList.remove("b3-list-item--focus")})),e.classList.add("b3-list-item--focus"))}bindEvent(){this.element.addEventListener("contextmenu",(e=>{let t=e.target;for(;t&&!t.isEqualNode(this.element);){if("LI"===t.tagName&&this.rightClick){this.rightClick(t,e),e.preventDefault(),e.stopPropagation();break}t=t.parentElement}})),this.element.addEventListener("click",(e=>{let t=e.target;for(;t&&!t.isEqualNode(this.element);){if(t.classList.contains("b3-list-item__toggle")&&!t.firstElementChild.classList.contains("fn__hidden")){this.toggleBlocks(t.parentElement),this.setCurrent(t.parentElement),e.preventDefault();break}if(t.classList.contains("b3-list-item__action")&&this.click){const n=(0,a.hasClosestByMatchTag)(t,"LI");n&&this.click(n,e),e.preventDefault(),e.stopPropagation();break}if("LI"===t.tagName){this.setCurrent(t),t.getAttribute("data-node-id")||"tag"===t.getAttribute("data-treetype")?(this.ctrlClick&&window.siyuan.ctrlIsPressed?this.ctrlClick(t):this.altClick&&window.siyuan.altIsPressed?this.altClick(t):this.shiftClick&&window.siyuan.shiftIsPressed?this.shiftClick(t):this.click&&this.click(t,e),e.stopPropagation()):this.toggleBlocks(t),e.preventDefault();break}t=t.parentElement}})),this.element.addEventListener("dragstart",(e=>{const t=(0,a.hasClosestByTag)(e.target,"LI");t&&(e.dataTransfer.setData("text/html",t.outerHTML),t.style.opacity="0.1",window.siyuan.dragElement=t)})),this.element.addEventListener("dragend",(e=>{const t=(0,a.hasClosestByTag)(e.target,"LI");t&&(t.style.opacity="1"),window.siyuan.dragElement=void 0}))}expandAll(){this.element.querySelectorAll("ul").forEach((e=>{e.classList.contains("b3-list")||e.classList.remove("fn__none")})),this.element.querySelectorAll(".b3-list-item__arrow").forEach((e=>{e.classList.add("b3-list-item__arrow--open")}))}collapseAll(){this.element.querySelectorAll("ul").forEach((e=>{e.classList.contains("b3-list")||e.classList.add("fn__none")})),this.element.querySelectorAll(".b3-list-item__arrow").forEach((e=>{e.classList.remove("b3-list-item__arrow--open")}))}getExpandIds(){const e=[];return this.element.querySelectorAll(".b3-list-item__arrow--open").forEach((t=>{e.push(t.getAttribute("data-id"))})),e}setExpandIds(e){this.element.querySelectorAll(".b3-list-item__arrow").forEach((t=>{e.includes(t.getAttribute("data-id"))?(t.classList.add("b3-list-item__arrow--open"),t.parentElement.parentElement.nextElementSibling&&t.parentElement.parentElement.nextElementSibling.classList.remove("fn__none")):(t.classList.remove("b3-list-item__arrow--open"),t.parentElement.parentElement.nextElementSibling&&"UL"===t.parentElement.parentElement.nextElementSibling.tagName&&t.parentElement.parentElement.nextElementSibling.classList.add("fn__none"))}))}}},8785:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setInlineStyle=t.initAssets=t.loadAssets=void 0;const i=n(8792),a=n(6555),o=n(6649),s=n(2374),r=n(2892),l=n(3274);t.loadAssets=e=>{const t=document.getElementById("themeDefaultStyle");let n=`/appearance/themes/${1===e.mode?"midnight":"daylight"}/${e.customCSS?"custom":"theme"}.css?v=${e.customCSS?(new Date).getTime():i.Constants.SIYUAN_VERSION}`;(1===e.mode&&"midnight"!==e.themeDark||0===e.mode&&"daylight"!==e.themeLight)&&(n=`/appearance/themes/${1===e.mode?"midnight":"daylight"}/theme.css?v=${i.Constants.SIYUAN_VERSION}`),t?t.getAttribute("href").startsWith(n)||(t.remove(),(0,o.addStyle)(n,"themeDefaultStyle")):(0,o.addStyle)(n,"themeDefaultStyle");const l=document.getElementById("themeStyle");if(1===e.mode&&"midnight"!==e.themeDark||0===e.mode&&"daylight"!==e.themeLight){const t=`/appearance/themes/${1===e.mode?e.themeDark:e.themeLight}/${e.customCSS?"custom":"theme"}.css?v=${e.customCSS?(new Date).getTime():e.themeVer}`;l?l.getAttribute("href").startsWith(t)||(l.remove(),(0,o.addStyle)(t,"themeStyle")):(0,o.addStyle)(t,"themeStyle")}else l&&l.remove();(0,r.getAllModels)().graph.forEach((e=>{e.searchGraph(!1)})),(0,s.setCodeTheme)();const c=document.getElementById("themeScript"),u=`/appearance/themes/${1===e.mode?e.themeDark:e.themeLight}/theme.js?v=${e.themeVer}`;c?c.getAttribute("src").startsWith(u)||(c.remove(),(0,a.addScript)(u,"themeScript")):(0,a.addScript)(u,"themeScript");const d=document.getElementById("iconScript"),p=`/appearance/icons/${e.icon}/icon.js?v=${e.iconVer}`;d?d.getAttribute("src").startsWith(p)||(d.remove(),(0,a.addScript)(p,"iconScript")):(0,a.addScript)(p,"iconScript")};t.initAssets=()=>{const e=document.getElementById("emojiScript"),t=document.getElementById("loading");e||window.siyuan.config.appearance.nativeEmoji||(0,l.isMobile)()?t&&setTimeout((()=>{t.remove()}),160):(0,a.addScript)("/appearance/emojis/twitter-emoji.js?v=1.0.0","emojiScript").then((()=>{t&&t.remove()}))};t.setInlineStyle=(e=!0)=>{const t=Math.floor(1.625*window.siyuan.config.editor.fontSize);let n=`.b3-typography, .protyle-wysiwyg, .protyle-title {font-size:${window.siyuan.config.editor.fontSize}px !important}\n.b3-typography code:not(.hljs), .protyle-wysiwyg code:not(.hljs) { font-variant-ligatures: ${window.siyuan.config.editor.codeLigatures?"normal":"none"} }\n.li > .protyle-action {height:${t+8}px;line-height: ${t+8}px}\n.protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h1, .protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h2, .protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h3, .protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h4, .protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h5, .protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h6 {line-height:${t+8}px;}\n.protyle-wysiwyg [data-node-id].li > .protyle-action:after {height: ${window.siyuan.config.editor.fontSize}px;width: ${window.siyuan.config.editor.fontSize}px;margin:-${window.siyuan.config.editor.fontSize/2}px 0 0 -${window.siyuan.config.editor.fontSize/2}px}\n.protyle-wysiwyg [data-node-id].li > .protyle-action svg {height: ${Math.max(14,window.siyuan.config.editor.fontSize-8)}px}\n.protyle-wysiwyg [data-node-id] [spellcheck="false"] {min-height:${t}px}\n.protyle-wysiwyg .li {min-height:${t+8}px}\n.protyle-gutters button svg {height:${t}px}\n.protyle-wysiwyg img.emoji, .b3-typography img.emoji {width:${t-8}px}\n.protyle-wysiwyg .h1 img.emoji, .b3-typography h1 img.emoji {width:${Math.floor(1.75*window.siyuan.config.editor.fontSize*1.25)}px}\n.protyle-wysiwyg .h2 img.emoji, .b3-typography h2 img.emoji {width:${Math.floor(1.55*window.siyuan.config.editor.fontSize*1.25)}px}\n.protyle-wysiwyg .h3 img.emoji, .b3-typography h3 img.emoji {width:${Math.floor(1.38*window.siyuan.config.editor.fontSize*1.25)}px}\n.protyle-wysiwyg .h4 img.emoji, .b3-typography h4 img.emoji {width:${Math.floor(1.25*window.siyuan.config.editor.fontSize*1.25)}px}\n.protyle-wysiwyg .h5 img.emoji, .b3-typography h5 img.emoji {width:${Math.floor(1.13*window.siyuan.config.editor.fontSize*1.25)}px}\n.protyle-wysiwyg .h6 img.emoji, .b3-typography h6 img.emoji {width:${Math.floor(1.25*window.siyuan.config.editor.fontSize)}px}`;return window.siyuan.config.editor.fontFamily&&(n+=`.b3-typography:not(.b3-typography--default), .protyle-wysiwyg, .protyle-title, .protyle-title__input{font-family: "${window.siyuan.config.editor.fontFamily}", "quote", "Helvetica Neue", "Luxi Sans", "DejaVu Sans", "Hiragino Sans GB", "Microsoft Yahei", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol", "Android Emoji", "EmojiSymbols" !important;}`),e&&(document.getElementById("editorFontSize").innerHTML=n),n}},9039:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.pushBack=t.goForward=t.goBack=void 0;const a=n(3607),o=n(6520),s=n(4640),r=n(5378),l=n(734),c=n(8792),u=n(3371),d=n(2269),p=n(7876),h=n(7010),f=n(8592),g=n(1754),m=n(407);let y=[],b=!1;const v=e=>i(void 0,void 0,void 0,(function*(){let t;if((0,r.hideElements)(["gutter","toolbar","hint","util","dialog"],e.protyle),!e.protyle.element.parentElement){if(!(yield(0,l.fetchSyncPost)("/api/block/checkBlockExist",{id:e.protyle.block.rootID})).data)return!1;let n;const i=document.querySelector(".layout__wnd--active");if(i&&(n=(0,u.getInstanceById)(i.getAttribute("data-id"))),n||(n=(0,u.getWndByLayout)(window.siyuan.layout.centerLayout)),n){const i=yield(0,l.fetchSyncPost)("/api/block/getBlockInfo",{id:e.id});if(2===i.code)return(0,g.lockFile)(i.data),!1;const r=new d.Tab({title:i.data.rootTitle,docIcon:i.data.rootIcon,callback(e){const t=new p.Editor({tab:e,blockId:i.data.rootChildID});e.addModel(t)}});if(window.siyuan.config.fileTree.openFilesUseCurrentTab){let e;n.children.forEach((t=>{t.headElement&&t.headElement.classList.contains("item--unupdate")&&!t.headElement.classList.contains("item--pin")&&(e=t)})),n.addTab(r),e&&n.removeTab(e.id)}else n.addTab(r);return n.showHeading(),setTimeout((()=>{const n=r.model.editor.protyle;y.find((e=>{e.protyle.element.parentElement||e.protyle.block.rootID!==n.block.rootID||(e.protyle=n)})),window.siyuan.backStack.find((e=>{e.protyle.element.parentElement||e.protyle.block.rootID!==n.block.rootID||(e.protyle=n)})),n.block.rootID===e.id?(0,s.focusByOffset)(n.title.editElement,e.position.start,e.position.end):(Array.from(n.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).find((e=>{if(!(0,a.hasClosestByAttribute)(e,"data-type","NodeBlockQueryEmbed"))return t=e,!0})),(0,s.focusByOffset)((0,o.getContenteditableElement)(t),e.position.start,e.position.end),(0,f.scrollCenter)(n,t))}),500),!0}return!1}if(e.protyle.block.rootID===e.id)return 0===e.protyle.title.editElement.getBoundingClientRect().height&&e.protyle.model.parent.parent.switchTab(e.protyle.model.parent.headElement),(0,s.focusByOffset)(e.protyle.title.editElement,e.position.start,e.position.end),!0;if(Array.from(e.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).find((e=>{if(!(0,a.hasClosestByAttribute)(e,"data-type","NodeBlockQueryEmbed"))return t=e,!0})),t)return 0===t.getBoundingClientRect().height&&e.protyle.model.parent.parent.switchTab(e.protyle.model.parent.headElement),e.isZoom?((0,m.zoomOut)(e.protyle,e.id,void 0,!1),!0):t&&!e.protyle.block.showAll?((0,s.focusByOffset)((0,o.getContenteditableElement)(t),e.position.start,e.position.end),(0,f.scrollCenter)(e.protyle,t,!0),!0):((0,l.fetchPost)("/api/filetree/getDoc",{id:e.id,mode:e.isZoom?0:3,size:e.isZoom?c.Constants.SIZE_GET_MAX:c.Constants.SIZE_GET},(n=>{(0,h.onGet)(n,e.protyle),Array.from(e.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).find((e=>{if(!(0,a.hasClosestByAttribute)(e,"data-type","NodeBlockQueryEmbed"))return t=e,!0})),(0,s.focusByOffset)((0,o.getContenteditableElement)(t),e.position.start,e.position.end),setTimeout((()=>{(0,f.scrollCenter)(e.protyle,t,!0)}),c.Constants.TIMEOUT_BLOCKLOAD)})),!0);if(e.protyle.element.parentElement){if(!(yield(0,l.fetchSyncPost)("/api/block/checkBlockExist",{id:e.id})).data)return getSelection().rangeCount>0&&(0,s.focusByRange)(getSelection().getRangeAt(0)),!1;const n=yield(0,l.fetchSyncPost)("/api/block/getBlockInfo",{id:e.id});return 2===n.code?((0,g.lockFile)(n.data),!1):((0,l.fetchPost)("/api/filetree/getDoc",{id:n.data.rootChildID,mode:e.isZoom?0:3,size:e.isZoom?c.Constants.SIZE_GET_MAX:c.Constants.SIZE_GET},(n=>{(0,h.onGet)(n,e.protyle),Array.from(e.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).find((e=>{if(!(0,a.hasClosestByAttribute)(e,"data-type","NodeBlockQueryEmbed"))return t=e,!0})),(0,s.focusByOffset)((0,o.getContenteditableElement)(t),e.position.start,e.position.end),setTimeout((()=>{(0,f.scrollCenter)(e.protyle,t)}),c.Constants.TIMEOUT_INPUT)})),!0)}}));t.goBack=()=>i(void 0,void 0,void 0,(function*(){if(document.querySelector("#barBack").classList.contains("toolbar__item--disabled"))return;if(0===window.siyuan.backStack.length)return void(y.length>0&&(yield v(y[y.length-1])));document.querySelector("#barForward").classList.remove("toolbar__item--disabled"),b||y.push(window.siyuan.backStack.pop());let e=window.siyuan.backStack.pop();for(;e;){if(yield v(e)){y.push(e);break}e=window.siyuan.backStack.pop()}0===window.siyuan.backStack.length&&document.querySelector("#barBack").classList.add("toolbar__item--disabled"),b=!0}));t.goForward=()=>i(void 0,void 0,void 0,(function*(){if(document.querySelector("#barForward").classList.contains("toolbar__item--disabled"))return;if(0===y.length)return void(window.siyuan.backStack.length>0&&(yield v(window.siyuan.backStack[window.siyuan.backStack.length-1])));document.querySelector("#barBack").classList.remove("toolbar__item--disabled"),b&&window.siyuan.backStack.push(y.pop());let e=y.pop();for(;e;){if(yield v(e)){window.siyuan.backStack.push(e);break}e=y.pop()}0===y.length&&document.querySelector("#barForward").classList.add("toolbar__item--disabled"),b=!1}));t.pushBack=(e,t,n)=>{if(!e.model)return;if(!n&&t&&(n=(0,a.hasClosestBlock)(t.startContainer)),!n)return;let i;if(i=n.classList.contains("protyle-title__input")?n:(0,o.getContenteditableElement)(n),i){const a=(0,s.getSelectionOffset)(i,void 0,t),o=n.getAttribute("data-node-id")||e.block.rootID,r=window.siyuan.backStack[window.siyuan.backStack.length-1],l=e.block.id!==e.block.rootID;r&&r.id===o&&r.isZoom===l?r.position=a:(y.length>0&&(b&&window.siyuan.backStack.push(y.pop()),y=[],document.querySelector("#barForward").classList.add("toolbar__item--disabled")),window.siyuan.backStack.push({position:a,id:o,protyle:e,isZoom:l}),window.siyuan.backStack.length>c.Constants.SIZE_UNDO&&window.siyuan.backStack.shift(),b=!1),window.siyuan.backStack.length>1&&document.querySelector("#barBack").classList.remove("toolbar__item--disabled")}}},3863:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.escapeHtml=void 0;t.escapeHtml=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;")},734:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchGet=t.fetchSyncPost=t.fetchPost=void 0;const a=n(4369),o=n(1754);t.fetchPost=(e,t,n,i)=>{const s={method:"POST"};t&&(["/api/search/searchRefBlock","/api/graph/getGraph","/api/graph/getLocalGraph"].includes(e)&&(window.siyuan.reqIds[e]=(new Date).getTime(),t.reqId=window.siyuan.reqIds[e]),t instanceof FormData?s.body=t:s.body=JSON.stringify(t)),i&&(s.headers=i),fetch(e,s).then((e=>e.json())).then((t=>{["/api/search/searchRefBlock","/api/graph/getGraph","/api/graph/getLocalGraph"].includes(e)&&t.data.reqId&&window.siyuan.reqIds[e]&&window.siyuan.reqIds[e]>t.data.reqId||(0,a.processMessage)(t)&&n&&n(t)})).catch((t=>{console.warn("fetch post error",t),"/api/transactions"!==e||"Failed to fetch"!==t.message&&"Unexpected end of JSON input"!==t.message||(0,o.kernelError)()}))};t.fetchSyncPost=(e,t)=>i(void 0,void 0,void 0,(function*(){const n={method:"POST"};t&&(n.body=JSON.stringify(t));const i=yield fetch(e,n),o=yield i.json();return(0,a.processMessage)(o),o}));t.fetchGet=(e,t)=>{fetch(e).then((e=>e.json())).then((e=>{t(e)}))}},3274:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFileAnnotation=t.isDynamicRef=t.isBrowser=t.getSearch=t.getRandom=t.isArrayEqual=t.isMobile=void 0;t.isMobile=()=>!document.getElementById("dockBottom");t.isArrayEqual=(e,t)=>e.length===t.length&&e.every((e=>t.includes(e)));t.getRandom=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;t.getSearch=(e,t=window.location.search)=>{if(-1===t.indexOf("?"))return"";let n="";return t.split("?")[1].split("&").find((t=>{const i=t.split("=");if(i[0]===e)return n=i[1],!0})),n};t.isBrowser=()=>!0;t.isDynamicRef=e=>/^\(\(\d{14}-\w{7} '.*'\)\)$/.test(e);t.isFileAnnotation=e=>/^<<assets\/.+\/\d{14}-\w{7} ".+">>$/.test(e)},8303:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genUUID=void 0;t.genUUID=()=>([1e7].toString()+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(parseInt(e,10)^window.crypto.getRandomValues(new Uint32Array(1))[0]&15>>parseInt(e,10)/4).toString(16)))},7550:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genOptions=void 0;t.genOptions=(e,t)=>{let n="";return e.forEach((e=>{n+="string"==typeof e?`<option value="${e}" ${t===e?"selected":""}>${e}</option>`:`<option value="${e.name}" ${t===e.name?"selected":""}>${e.label}</option>`})),n}},1389:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.globalShortcut=void 0;const i=n(7954),a=n(7422),o=n(5031),s=n(3607),r=n(4779),l=n(8792),c=n(3559),u=n(3371),d=n(7876),p=n(2319),h=n(8349),f=n(4275),g=n(5378),m=n(734),y=n(9039),b=n(7010),v=n(8813),w=n(1377),_=n(9516),E=n(2892),k=n(4681),C=n(2287),D=n(4640),x=n(9472),S=n(2640),A=n(1890),L=n(1574),T=n(9866),B=n(7640),P=n(2509),I=n(3863),M=n(5370),F=(e,t,n)=>{let i=1,a=e;for(;a&&(a.classList.contains("list")||a.classList.contains("li"));)a=document.elementFromPoint(t+73*i,n),a=(0,s.hasClosestBlock)(a),i++;return a},N=(e,t)=>{e.preventDefault(),e.stopPropagation();let n=e.target;for(;!n.isSameNode(t.element);){if(n.classList.contains("b3-list-item")){const e=n.getAttribute("data-type");if(e)(0,u.getDockByType)(e).toggleModel(e,!0);else{const e=n.getAttribute("data-id");(0,E.getAllTabs)().find((t=>{if(t.id===e)return t.parent.switchTab(t.headElement),(0,u.setPanelFocus)(t.headElement.parentElement.parentElement),!0}))}t.destroy(),t=void 0;break}n=n.parentElement}};t.globalShortcut=()=>{let e;window.addEventListener("mousemove",(e=>{window.siyuan.hideBreadcrumb&&((0,E.getAllModels)().editor.forEach((e=>{e.editor.protyle.breadcrumb.show()})),window.siyuan.blockPanels.forEach((e=>{e.editors.forEach((e=>{e.protyle.breadcrumb.show()}))})));const t=e.composedPath()[0];if(t&&3!==t.nodeType&&t.classList.contains("protyle-wysiwyg")&&t.style.paddingLeft){const n=document.elementFromPoint(t.getBoundingClientRect().left+parseInt(t.style.paddingLeft)+13,e.clientY),i=(0,s.hasClosestBlock)(n);if(i){const n=F(i,i.getBoundingClientRect().left+1,e.clientY);if(!n)return;(0,E.getAllModels)().editor.find((e=>{if(e.editor.protyle.wysiwyg.element.isSameNode(t))return e.editor.protyle.gutter.render(n,e.editor.protyle.wysiwyg.element),!0}))||window.siyuan.blockPanels.find((e=>{if(e.editors.find((e=>{if(e.protyle.wysiwyg.element.contains(t))return e.protyle.gutter.render(n,e.protyle.wysiwyg.element),!0})))return!0}))}return}if(t&&3!==t.nodeType&&(t.classList.contains("li")||t.classList.contains("list"))){const n=F(t,t.getBoundingClientRect().left+1,e.clientY);if(!n)return;return void((0,E.getAllModels)().editor.find((e=>{if(e.editor.protyle.wysiwyg.element.contains(t))return e.editor.protyle.gutter.render(n,e.editor.protyle.wysiwyg.element),!0}))||window.siyuan.blockPanels.find((e=>{if(e.editors.find((e=>{if(e.protyle.wysiwyg.element.contains(t))return e.protyle.gutter.render(n,e.protyle.wysiwyg.element),!0})))return!0})))}const n=e.target,i=(0,s.hasClosestBlock)(n);if(i&&"col-resize"!==i.style.cursor&&!(0,s.hasClosestByClassName)(i,"protyle-wysiwyg__embed")){const t=(0,s.hasClosestByMatchTag)(n,"TH")||(0,s.hasClosestByMatchTag)(n,"TD");if(t){const n=i.querySelector("table"),a=i.querySelector("table").clientHeight,o=i.querySelector(".table__resize");"center"===i.style.textAlign||"right"===i.style.textAlign?o.parentElement.style.left=n.offsetLeft+"px":o.parentElement.style.left="";const s=t.getBoundingClientRect();s.right-e.clientX<3&&s.right-e.clientX>0?(o.setAttribute("data-col-index",((0,C.getColIndex)(t)+t.colSpan-1).toString()),o.setAttribute("style",`height:${a}px;left: ${Math.round(t.offsetWidth+t.offsetLeft-i.firstElementChild.scrollLeft-3)}px;display:block`)):e.clientX-s.left<3&&e.clientX-s.left>0&&t.previousElementSibling&&(o.setAttribute("data-col-index",((0,C.getColIndex)(t)-1).toString()),o.setAttribute("style",`height:${a}px;left: ${Math.round(t.offsetLeft-i.firstElementChild.scrollLeft-3)}px;display:block`))}}})),window.addEventListener("mouseup",(e=>{3===e.button?(e.stopPropagation(),e.preventDefault(),(0,y.goBack)()):4===e.button&&(e.stopPropagation(),e.preventDefault(),(0,y.goForward)())})),window.addEventListener("keyup",(t=>{if(window.siyuan.ctrlIsPressed=!1,window.siyuan.shiftIsPressed=!1,window.siyuan.altIsPressed=!1,e&&e.element.parentElement)if("Tab"===t.key){let n=e.element.querySelector(".b3-list-item--focus");if(n.classList.remove("b3-list-item--focus"),t.shiftKey?n.previousElementSibling?n.previousElementSibling.classList.add("b3-list-item--focus"):n.getAttribute("data-original")?(n.parentElement.lastElementChild.classList.add("b3-list-item--focus"),n.removeAttribute("data-original")):n.parentElement.nextElementSibling?n.parentElement.nextElementSibling.lastElementChild?n.parentElement.nextElementSibling.lastElementChild.classList.add("b3-list-item--focus"):n.parentElement.lastElementChild.classList.add("b3-list-item--focus"):n.parentElement.previousElementSibling&&n.parentElement.previousElementSibling.lastElementChild.classList.add("b3-list-item--focus"):n.nextElementSibling?n.nextElementSibling.classList.add("b3-list-item--focus"):n.getAttribute("data-original")?(n.parentElement.firstElementChild.classList.add("b3-list-item--focus"),n.removeAttribute("data-original")):n.parentElement.nextElementSibling?n.parentElement.nextElementSibling.firstElementChild?n.parentElement.nextElementSibling.firstElementChild.classList.add("b3-list-item--focus"):n.parentElement.firstElementChild.classList.add("b3-list-item--focus"):n.parentElement.previousElementSibling&&n.parentElement.previousElementSibling.firstElementChild.classList.add("b3-list-item--focus"),n=e.element.querySelector(".b3-list-item--focus"),n){const e=n.getAttribute("data-node-id");e?(0,m.fetchPost)("/api/filetree/getFullHPathByID",{id:e},(e=>{n.parentElement.parentElement.nextElementSibling.innerHTML=(0,I.escapeHtml)(e.data)})):n.parentElement.parentElement.nextElementSibling.innerHTML=n.querySelector(".b3-list-item__text").innerHTML}}else if("Control"===t.key){let n=e.element.querySelector(".b3-list-item--focus");n.getAttribute("data-original")&&(n.classList.remove("b3-list-item--focus"),t.shiftKey?n.previousElementSibling?n.previousElementSibling.classList.add("b3-list-item--focus"):(n.parentElement.lastElementChild.classList.add("b3-list-item--focus"),n.removeAttribute("data-original")):n.nextElementSibling?n.nextElementSibling.classList.add("b3-list-item--focus"):n.parentElement.firstElementChild.classList.add("b3-list-item--focus"),n.removeAttribute("data-original"),n=e.element.querySelector(".b3-list-item--focus"));const i=n.getAttribute("data-type");if(i){(0,u.getDockByType)(i).toggleModel(i,!0);const e=t.target;(e.classList.contains("protyle-wysiwyg")||e.classList.contains("protyle-title__input")||"INPUT"===e.tagName||"TEXTAREA"===e.tagName)&&e.blur()}else{const e=n.getAttribute("data-id");(0,E.getAllTabs)().find((t=>{if(t.id===e)return t.parent.switchTab(t.headElement),(0,u.setPanelFocus)(t.headElement.parentElement.parentElement),!0}))}e.destroy(),e=void 0}})),window.addEventListener("keydown",(t=>{if(document.getElementById("errorLog")||t.isComposing)return;if(!(t.ctrlKey||(0,i.isCtrl)(t)||"Escape"===t.key||t.shiftKey||t.altKey||/^F\d{1,2}$/.test(t.key)||-1!==t.key.indexOf("Arrow")||"Enter"===t.key||"Backspace"===t.key||"Delete"===t.key))return;if(t.altKey||t.shiftKey||!(0,i.isCtrl)(t)||("Meta"===t.key||"Control"===t.key||t.ctrlKey||t.metaKey?window.siyuan.ctrlIsPressed=!0:window.siyuan.ctrlIsPressed=!1),t.altKey||!t.shiftKey||(0,i.isCtrl)(t)||("Shift"===t.key?window.siyuan.shiftIsPressed=!0:window.siyuan.shiftIsPressed=!1),!t.altKey||t.shiftKey||(0,i.isCtrl)(t)||("Alt"===t.key?window.siyuan.altIsPressed=!0:window.siyuan.altIsPressed=!1),t.ctrlKey&&!t.metaKey&&"Tab"===t.key){if(e&&e.element.parentElement)return;let t="",n=document.querySelector(".layout__wnd--active .layout-tab-bar > .item--focus");if(n||(n=document.querySelector(".layout-tab-bar > .item--focus")),n){const e=n.getAttribute("data-id");(0,E.getAllTabs)().sort(((e,t)=>e.headElement.getAttribute("data-activetime")>t.headElement.getAttribute("data-activetime")?-1:1)).forEach((n=>{let i=`<svg class="b3-list-item__graphic"><use xlink:href="#${n.icon}"></use></svg>`,a="";n.model instanceof d.Editor&&(a=` data-node-id="${n.model.editor.protyle.block.rootID}"`,i=`<span class="b3-list-item__graphic">${(0,B.unicode2Emoji)(n.docIcon||l.Constants.SIYUAN_IMAGE_FILE)}</span>`),t+=`<li data-id="${n.id}"${a} class="b3-list-item${e===n.id?" b3-list-item--focus":""}"${e===n.id?' data-original="true"':""}>${i}<span class="b3-list-item__text">${(0,I.escapeHtml)(n.title)}</span></li>`}))}let a="";return(0,E.getAllDocks)().forEach((e=>{a+=`<li data-type="${e.type}" class="b3-list-item${t||a?"":" b3-list-item--focus"}">\n    <svg class="b3-list-item__graphic"><use xlink:href="#${e.icon}"></use></svg>\n    <span class="b3-list-item__text">${window.siyuan.languages[e.hotkeyLangId]}</span>\n    <span class="b3-list-item__meta">${(0,i.updateHotkeyTip)(window.siyuan.config.keymap.general[e.hotkeyLangId].custom)}</span>\n</li>`})),e=new T.Dialog({content:`<div class="fn__flex-column b3-dialog--switch">\n    <div class="fn__hr"></div>\n    <div class="fn__flex">\n        <ul class="b3-list b3-list--background">${a}</ul>\n        <ul class="b3-list b3-list--background">${t}</ul>\n    </div>\n    <div class="dialog__path"></div>\n</div>`,disableClose:!0,disableAnimation:!0,transparent:!0}),(0,i.isMac)()&&e.element.addEventListener("contextmenu",(t=>{N(t,e)})),void e.element.addEventListener("click",(t=>{N(t,e)}))}if((0,a.matchHotKey)(window.siyuan.config.keymap.general.syncNow.custom,t))return t.preventDefault(),t.stopPropagation(),void(0,M.syncGuide)(document.querySelector("#barSync"));if((0,a.matchHotKey)(window.siyuan.config.keymap.general.lockScreen.custom,t))return(0,u.exportLayout)(!1,(()=>{(0,m.fetchPost)("/api/system/logoutAuth",{},(()=>{window.location.href="/"}))})),t.preventDefault(),void t.stopPropagation();if((0,a.matchHotKey)(window.siyuan.config.keymap.general.history.custom,t))return(0,L.openHistory)(),t.preventDefault(),void t.stopPropagation();if(!window.siyuan.config.readonly&&(0,a.matchHotKey)(window.siyuan.config.keymap.general.config.custom,t))return(0,c.openSetting)(),t.preventDefault(),void t.stopPropagation();const n=t.target;if((0,a.matchHotKey)("⌘A",t)&&"INPUT"!==n.tagName&&"TEXTAREA"!==n.tagName)return void t.preventDefault();if((0,E.getAllDocks)().find((e=>{if((0,a.matchHotKey)(window.siyuan.config.keymap.general[e.hotkeyLangId].custom,t))return(0,u.getDockByType)(e.type).toggleModel(e.type),(n.classList.contains("protyle-wysiwyg")||n.classList.contains("protyle-title__input")||"INPUT"===n.tagName||"TEXTAREA"===n.tagName)&&n.blur(),t.preventDefault(),t.stopPropagation(),!0})))return;if((0,a.matchHotKey)(window.siyuan.config.keymap.general.dailyNote.custom,t))return(0,f.newDailyNote)(),(n.classList.contains("protyle-wysiwyg")||n.classList.contains("protyle-title__input")||"INPUT"===n.tagName||"TEXTAREA"===n.tagName)&&n.blur(),t.preventDefault(),void t.stopPropagation();if((0,a.matchHotKey)(window.siyuan.config.keymap.general.newFile.custom,t))return(0,r.newFile)(void 0,void 0,!0),t.preventDefault(),void t.stopPropagation();if("Escape"===t.key&&!t.isComposing){const e=document.querySelector(".protyle-img");if(e)return void e.remove();if(!window.siyuan.menus.menu.element.classList.contains("fn__none"))return void window.siyuan.menus.menu.remove();if(window.siyuan.dialogs.length>0)return void(0,g.hideElements)(["dialog"]);const n={oid:0};window.siyuan.blockPanels.forEach((e=>{if(e.targetElement&&"true"===e.element.getAttribute("data-pin")){const t=parseInt(e.element.getAttribute("data-level")),i=e.element.getAttribute("data-oid");n[i]?t>n[i]&&(n[i]=t):n[i]=1}}));let i,a=!1;for(let e=0;e<window.siyuan.blockPanels.length;e++){const t=window.siyuan.blockPanels[e];t.targetElement&&"false"===t.element.getAttribute("data-pin")&&parseInt(t.element.getAttribute("data-level"))>(n[t.element.getAttribute("data-oid")]||0)&&(t.destroy(),t.esc&&t.esc(),a=!0,e--)}if(a)return;if(getSelection().rangeCount>0){i=getSelection().getRangeAt(0);if((0,s.hasClosestByClassName)(i.startContainer,"protyle-content",!0))return void(0,D.focusByRange)(i)}else i=document.createRange();const o=window.siyuan.backStack[window.siyuan.backStack.length-1];if(o&&o.protyle.toolbar.range)(0,D.focusByRange)(o.protyle.toolbar.range);else{const e=(0,E.getAllModels)().editor[0];e&&(0,D.focusBlock)(e.editor.protyle.wysiwyg.element.firstElementChild)}return void t.preventDefault()}if((0,a.matchHotKey)(window.siyuan.config.keymap.general.goForward.custom,t))return(0,y.goForward)(),t.stopPropagation(),void t.preventDefault();if((0,a.matchHotKey)(window.siyuan.config.keymap.general.goBack.custom,t))return(0,y.goBack)(),t.stopPropagation(),void t.preventDefault();const p=document.querySelector("#confirmDialogConfirmBtn");if(p&&"Enter"===t.key)return p.dispatchEvent(new CustomEvent("click")),void t.preventDefault();if((0,a.matchHotKey)(window.siyuan.config.keymap.editor.general.collapse.custom,t)||(0,a.matchHotKey)(window.siyuan.config.keymap.editor.general.expand.custom,t)){let e=document.querySelector(".block__icons--active");return e||Array.from(document.querySelectorAll(".layout__wnd--active .layout-tab-container > div")).forEach((t=>{if(!t.classList.contains("fn__none"))return e=t,!0})),e&&((0,a.matchHotKey)(window.siyuan.config.keymap.editor.general.collapse.custom,t)?e.querySelector('.block__icon[data-type="collapse"]')&&e.querySelector('.block__icon[data-type="collapse"]').dispatchEvent(new CustomEvent("click")):(0,a.matchHotKey)(window.siyuan.config.keymap.editor.general.expand.custom,t)&&e.querySelector('.block__icon[data-type="expand"]')&&e.querySelector('.block__icon[data-type="expand"]').dispatchEvent(new CustomEvent("click"))),t.stopPropagation(),void t.preventDefault()}if((0,a.matchHotKey)(window.siyuan.config.keymap.general.closeTab.custom,t)&&!t.repeat){t.preventDefault(),t.stopPropagation();let e=document.querySelector(".block__icons--active");if(e&&e.getBoundingClientRect().width>0){let t;return Array.from(e.parentElement.classList).find((e=>{if(e.startsWith("sy__"))return t=e.replace("sy__",""),!0})),void(t&&(0,u.getDockByType)(t).toggleModel(t,!1,!0))}if(e=document.querySelector(".layout__wnd--active .item--focus"),e){const t=(0,u.getInstanceById)(e.getAttribute("data-id"));return void t.parent.removeTab(t.id)}return void(0,E.getAllTabs)().find((e=>{var t;if(null===(t=e.headElement)||void 0===t?void 0:t.classList.contains("item--focus"))return e.parent.removeTab(e.id),!0}))}if((0,a.matchHotKey)(window.siyuan.config.keymap.general.stickSearch.custom,t)){if(getSelection().rangeCount>0){const e=getSelection().getRangeAt(0);(0,k.openGlobalSearch)(e.toString(),!1)}else(0,k.openGlobalSearch)("",!1);return t.preventDefault(),void t.stopPropagation()}if($(t))return;if(O(t))return;let h="";if((0,a.matchHotKey)(window.siyuan.config.keymap.general.replace.custom,t)?h=window.siyuan.config.keymap.general.replace.custom:!(0,s.hasClosestByClassName)(n,"pdf__outer")&&(0,a.matchHotKey)(window.siyuan.config.keymap.general.search.custom,t)?h=window.siyuan.config.keymap.general.search.custom:(0,a.matchHotKey)(window.siyuan.config.keymap.general.globalSearch.custom,t)&&(h=window.siyuan.config.keymap.general.globalSearch.custom),h){if(getSelection().rangeCount>0){const e=getSelection().getRangeAt(0);(0,o.openSearch)(h,e.toString())}else(0,o.openSearch)(h);return t.preventDefault(),void t.stopPropagation()}return(0,a.matchHotKey)("⌘S",t)?(t.preventDefault(),t.stopPropagation(),!0):void 0})),window.addEventListener("blur",(()=>{window.siyuan.ctrlIsPressed=!1,window.siyuan.shiftIsPressed=!1,window.siyuan.altIsPressed=!1})),window.addEventListener("click",(e=>{window.siyuan.menus.menu.element.contains(e.target)||(0,s.hasClosestByAttribute)(e.target,"data-menu","true")||getSelection().rangeCount>0&&window.siyuan.menus.menu.element.contains(getSelection().getRangeAt(0).startContainer)||window.siyuan.menus.menu.remove(),(0,s.hasClosestByClassName)(e.target,"pdf__outer")||document.querySelectorAll(".pdf__util").forEach((e=>{e.classList.add("fn__none")}));const t=(0,s.hasTopClosestByClassName)(e.target,"protyle-action__copy");if(t&&((0,i.writeText)(t.parentElement.nextElementSibling.textContent.trimEnd()),(0,A.showMessage)(window.siyuan.languages.copied,2e3),e.preventDefault(),e.stopPropagation()),(0,s.hasClosestByAttribute)(e.target,"id","secondaryToolbarToggle")||(0,s.hasClosestByAttribute)(e.target,"id","viewFind")||(0,s.hasClosestByAttribute)(e.target,"id","findbar"))return;let n;(0,E.getAllModels)().asset.find((e=>{if(e.pdfObject&&!e.pdfObject.appConfig.appContainer.classList.contains("fn__none"))return n=e.pdfObject,!0})),n&&(n.secondaryToolbar.isOpen&&n.secondaryToolbar.close(),!n.supportsIntegratedFind&&n.findBar.opened&&n.findBar.close())}))};const $=e=>{const t=document.querySelector(".layout__wnd--active .item--focus");let n;if(t){const e=(0,u.getInstanceById)(t.getAttribute("data-id"));if(!(e.model instanceof d.Editor))return!1;n=e.model.editor.protyle}else{const e=(0,E.getAllModels)().editor.find((e=>{if(e.parent.headElement.classList.contains("item--focus"))return!0}));if(!e)return!1;n=e.editor.protyle}const i=document.querySelector(".block__icons--active");let r=!1;i&&i.parentElement.classList.contains("sy__file")&&(r=!0);let c="";if((0,a.matchHotKey)(window.siyuan.config.keymap.general.replace.custom,e)?c=window.siyuan.config.keymap.general.replace.custom:(0,a.matchHotKey)(window.siyuan.config.keymap.general.search.custom,e)&&(c=window.siyuan.config.keymap.general.search.custom),!r&&c){let t;return getSelection().rangeCount>0&&(t=getSelection().getRangeAt(0)),t&&n.element.contains(t.startContainer)?(0,o.openSearch)(c,t.toString(),n.notebookId,n.path):(0,o.openSearch)(c),e.preventDefault(),e.stopPropagation(),!0}if(!r&&(0,a.matchHotKey)(window.siyuan.config.keymap.general.move.custom,e)){let t,i;return getSelection().rangeCount>0&&(t=getSelection().getRangeAt(0),i=(0,s.hasClosestBlock)(t.startContainer)),i&&t&&n.element.contains(t.startContainer)?n.toolbar.showFile(n,[i],t):(0,v.movePathTo)(n.notebookId,n.path),e.preventDefault(),e.stopPropagation(),!0}const h=e.target;return"INPUT"!==h.tagName&&"TEXTAREA"!==h.tagName&&!(0,s.hasClosestByAttribute)(h,"contenteditable",null)&&((0,a.matchHotKey)(window.siyuan.config.keymap.editor.general.preview.custom,e)?((0,p.setEditMode)(n,"preview"),e.preventDefault(),e.stopPropagation(),!0):(0,a.matchHotKey)(window.siyuan.config.keymap.editor.general.wysiwyg.custom,e)?((0,p.setEditMode)(n,"wysiwyg"),n.scroll.lastScrollTop=0,(0,m.fetchPost)("/api/filetree/getDoc",{id:n.block.parentID,size:l.Constants.SIZE_GET},(e=>{(0,b.onGet)(e,n)})),e.preventDefault(),e.stopPropagation(),!0):(0,a.matchHotKey)(window.siyuan.config.keymap.editor.general.undo.custom,e)?(n.undo.undo(n),e.preventDefault(),e.stopPropagation(),!0):!!(0,a.matchHotKey)(window.siyuan.config.keymap.editor.general.redo.custom,e)&&(n.undo.redo(n),e.preventDefault(),e.stopPropagation(),!0))},O=e=>{const t=(0,u.getDockByType)("file");if(!t)return!1;const n=t.data.file;if((0,a.matchHotKey)(window.siyuan.config.keymap.general.selectOpen1.custom,e)){e.preventDefault(),e.stopPropagation();const i=document.querySelector(".layout__wnd--active > .fn__flex > .layout-tab-bar > .item--focus")||document.querySelector(".layout-tab-bar > .item--focus");if(i){const e=(0,u.getInstanceById)(i.getAttribute("data-id"));e&&e.model instanceof d.Editor&&(e.model.editor.protyle.wysiwyg.element.blur(),e.model.editor.protyle.title.editElement.blur(),n.selectItem(e.model.editor.protyle.notebookId,e.model.editor.protyle.path))}return void t.toggleModel("file",!0)}if(!n.element.previousElementSibling.classList.contains("block__icons--active"))return!1;let r=n.element.querySelector(".b3-list-item--focus");if(!r)return e.key.startsWith("Arrow")&&(r=n.element.querySelector(".b3-list-item"),r&&r.classList.add("b3-list-item--focus"),e.preventDefault()),!1;const c=(0,s.hasTopClosestByTag)(r,"UL");if(!c)return!1;const p=c.getAttribute("data-url"),f=r.getAttribute("data-path"),g="navigation-file"===r.getAttribute("data-type");if((0,a.matchHotKey)(window.siyuan.config.keymap.editor.general.rename.custom,e))return(0,h.rename)({notebookId:p,path:f,name:g?(0,v.getDisplayName)(r.getAttribute("data-name"),!1,!0):(0,v.getNotebookName)(p),type:g?"file":"notebook"}),e.preventDefault(),e.stopPropagation(),!0;if((0,a.matchHotKey)("⌘/",e)){const e=r.getBoundingClientRect();return g?(0,x.initFileMenu)(p,f,r).popup({x:e.right-15,y:e.top+15}):(0,x.initNavigationMenu)(r).popup({x:e.right-15,y:e.top+15}),!0}if(g&&(0,a.matchHotKey)(window.siyuan.config.keymap.general.move.custom,e))return(0,v.movePathTo)(p,f,!1),e.preventDefault(),e.stopPropagation(),!0;let y="";if((0,a.matchHotKey)(window.siyuan.config.keymap.general.replace.custom,e)?y=window.siyuan.config.keymap.general.replace.custom:(0,a.matchHotKey)(window.siyuan.config.keymap.general.search.custom,e)&&(y=window.siyuan.config.keymap.general.search.custom),y)return g?(0,o.openSearch)(y,void 0,p,(0,v.getDisplayName)(f,!1,!0)):(0,o.openSearch)(y,void 0,p),e.preventDefault(),e.stopPropagation(),!0;const b=e.target;if("INPUT"===b.tagName||"TEXTAREA"===b.tagName||(0,s.hasClosestByAttribute)(b,"contenteditable",null))return!1;if((0,S.bindMenuKeydown)(e))return e.stopPropagation(),e.preventDefault(),!0;if("ArrowRight"===e.key&&!r.querySelector(".b3-list-item__arrow--open")&&!r.querySelector(".b3-list-item__toggle").classList.contains("fn__hidden")||"ArrowLeft"===e.key&&r.querySelector(".b3-list-item__arrow--open"))return n.getLeaf(r,p),e.preventDefault(),!0;const E=n.element.getBoundingClientRect();if("ArrowLeft"===e.key){let t=r.parentElement.previousElementSibling;if(t){"LI"!==t.tagName&&(t=n.element.querySelector(".b3-list-item")),r.classList.remove("b3-list-item--focus"),t.classList.add("b3-list-item--focus");const e=t.getBoundingClientRect();(e.top<E.top||e.bottom>E.bottom)&&t.scrollIntoView(e.top<E.top)}return e.preventDefault(),!0}if("ArrowDown"===e.key||"ArrowRight"===e.key){let t=r;for(;t;){if(t.nextElementSibling){t="UL"===t.nextElementSibling.tagName?t.nextElementSibling.firstElementChild:t.nextElementSibling;break}if(t.parentElement.classList.contains("fn__flex-1"))break;t=t.parentElement}if(t.classList.contains("b3-list-item")){r.classList.remove("b3-list-item--focus"),t.classList.add("b3-list-item--focus");const e=t.getBoundingClientRect();(e.top<E.top||e.bottom>E.bottom)&&t.scrollIntoView(e.top<E.top)}return e.preventDefault(),!0}if("ArrowUp"===e.key){let t=r;for(;t;){if(t.previousElementSibling){if("LI"===t.previousElementSibling.tagName)t=t.previousElementSibling;else{const e=t.previousElementSibling.querySelectorAll(".b3-list-item");t=e[e.length-1]}break}if(t.parentElement.classList.contains("fn__flex-1"))break;t=t.parentElement}if(t.classList.contains("b3-list-item")){r.classList.remove("b3-list-item--focus"),t.classList.add("b3-list-item--focus");const e=t.getBoundingClientRect();(e.top<E.top||e.bottom>E.bottom)&&t.scrollIntoView(e.top<E.top)}return e.preventDefault(),!0}return"Delete"===e.key||"Backspace"===e.key&&(0,i.isMac)()?(window.siyuan.menus.menu.remove(),g?(0,P.deleteFile)(p,f,(0,v.getDisplayName)(r.getAttribute("data-name"),!1,!0)):(0,w.confirmDialog)(window.siyuan.languages.delete,`${window.siyuan.languages.confirmDelete} <b>${Lute.EscapeHTMLStr((0,v.getNotebookName)(p))}</b>?`,(()=>{(0,m.fetchPost)("/api/notebook/removeNotebook",{notebook:p,callback:l.Constants.CB_MOUNT_REMOVE})})),!0):"Enter"===e.key?(g?(0,_.openFileById)({id:r.getAttribute("data-node-id"),action:[l.Constants.CB_GET_FOCUS]}):n.getLeaf(r,p),!0):void 0}},8592:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scrollCenter=t.highlightById=void 0;const i=n(3607),a=n(4640),o=e=>{e.classList.add("protyle-wysiwyg--hl"),setTimeout((function(){e.classList.remove("protyle-wysiwyg--hl")}),1024)};t.highlightById=(e,n,a=!1)=>{let s;const r=e.wysiwyg.element;return e.preview.element.classList.contains("fn__none")?(Array.from(r.querySelectorAll(`[data-node-id="${n}"]`)).find((e=>{if(!(0,i.hasClosestByAttribute)(e,"data-type","block-render",!0))return s=e,!0})),s?((0,t.scrollCenter)(e,s,a),o(s),s):n===e.block.rootID&&e.options.render.title?(o(e.title.editElement),e.title.editElement):void 0):(s=document.getElementById(n),void(s&&(e.preview.element.scrollTop=s.offsetTop,o(s))))};t.scrollCenter=(e,t,n=!1)=>{if(!n&&getSelection().rangeCount>0&&(0,i.hasClosestBlock)(getSelection().getRangeAt(0).startContainer)){const t=e.contentElement,n=(0,a.getSelectionPosition)(t).top-t.getBoundingClientRect().top;return void(n<0?t.scrollTop=t.scrollTop+n:n>t.clientHeight-34&&(t.scrollTop=t.scrollTop+(n+34-t.clientHeight)))}if(t||(t=(0,i.hasClosestBlock)((0,a.getEditorRange)(e.wysiwyg.element).startContainer)),!t)return;let o=0,s=t;for(;!s.classList.contains("protyle-wysiwyg");)o+=s.offsetTop,s=s.parentElement;n||e.contentElement.scrollTop>o-32?e.contentElement.scrollTop=o-32:e.contentElement.scrollTop+e.contentElement.clientHeight<o+t.clientHeight-32&&(e.contentElement.scrollTop=o+t.clientHeight-32-e.contentElement.clientHeight)}},1574:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openHistory=void 0;const i=n(9866),a=n(1377),o=n(734),s=n(8792),r=n(3863),l=n(3274),c=n(3607),u=n(4382),d=n(2009),p=n(7010);let h;const f=(e,t)=>{const n=e.querySelector('[data-type="docprevious"]'),i=e.querySelector('[data-type="docnext"]');e.setAttribute("data-page",t.toString()),t>1?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled");const a=e.querySelector(".b3-text-field"),l=e.querySelector('.b3-select[data-type="opselect"]'),c=e.querySelector('.b3-select[data-type="typeselect"]'),u=e.querySelector('.b3-select[data-type="notebookselect"]');window.localStorage.setItem(s.Constants.LOCAL_HISTORYNOTEID,u.value);const d=e.querySelector('.history__text[data-type="docPanel"]'),p=e.querySelector('.history__text[data-type="assetPanel"]'),h=e.querySelector('.history__text[data-type="mdPanel"]');d.classList.add("fn__none"),h.classList.add("fn__none"),"0"===c.value?(l.removeAttribute("disabled"),u.removeAttribute("disabled"),p.classList.add("fn__none")):(l.setAttribute("disabled","disabled"),u.setAttribute("disabled","disabled"),p.classList.remove("fn__none")),(0,o.fetchPost)("/api/history/searchHistory",{notebook:u.value,query:a.value,page:t,op:l.value,type:parseInt(c.value)},(n=>{if(t<n.data.pageCount?i.removeAttribute("disabled"):i.setAttribute("disabled","disabled"),0===n.data.histories.length)return e.lastElementChild.lastElementChild.previousElementSibling.classList.add("fn__none"),e.lastElementChild.lastElementChild.classList.add("fn__none"),void(e.lastElementChild.firstElementChild.innerHTML=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`);let a="";n.data.histories.forEach(((e,t)=>{a+=`<li class="b3-list-item" data-type="toggle" style="padding-left: 0">\n    <span style="padding-left: 8px" class="b3-list-item__toggle"><svg class="b3-list-item__arrow${0===t?" b3-list-item__arrow--open":""}${e.items.length>0?"":" fn__hidden"}"><use xlink:href="#iconRight"></use></svg></span>\n    <span class="b3-list-item__text">${e.hCreated}</span>\n</li>`,e.items.length>0&&(a+=`<ul class="${0===t?"":"fn__none"}">`,e.items.forEach((e=>{a+=`<li title="${(0,r.escapeHtml)(e.title)}" data-type="${"1"===c.value?"assets":"doc"}" data-path="${e.path}" class="b3-list-item b3-list-item--hide-action" style="padding-left: 32px">\n    <span class="b3-list-item__text">${(0,r.escapeHtml)(e.title)}</span>\n    <span class="fn__space"></span>\n    <span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="rollback" aria-label="${window.siyuan.languages.rollback}">\n        <svg><use xlink:href="#iconUndo"></use></svg>\n    </span>\n</li>`})),a+="</ul>")})),e.lastElementChild.firstElementChild.innerHTML=a}))},g=(e,t,n)=>{if(0===e.data.snapshots.length)return void(t.lastElementChild.innerHTML=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`);let i="";"cloudTag"===n?i=`<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="downloadSnapshot" aria-label="${window.siyuan.languages.download}"><svg><use xlink:href="#iconDownload"></use></svg></span>\n<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="removeCloudRepoTagSnapshot" aria-label="${window.siyuan.languages.remove}"><svg><use xlink:href="#iconTrashcan"></use></svg></span>`:"localTag"===n?i=`<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="uploadSnapshot" aria-label="${window.siyuan.languages.upload}"><svg><use xlink:href="#iconUpload"></use></svg></span>\n<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="rollback" aria-label="${window.siyuan.languages.rollback}"><svg><use xlink:href="#iconUndo"></use></svg></span>\n<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="removeRepoTagSnapshot" aria-label="${window.siyuan.languages.remove}"><svg><use xlink:href="#iconTrashcan"></use></svg></span>`:"local"===n&&(i=`<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="genTag" aria-label="${window.siyuan.languages.tagSnapshot}"><svg><use xlink:href="#iconTags"></use></svg></span>\n<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="rollback" aria-label="${window.siyuan.languages.rollback}"><svg><use xlink:href="#iconUndo"></use></svg></span>`);let a="";e.data.snapshots.forEach((e=>{(0,l.isMobile)()?a+=`<li class="b3-list-item b3-list-item--two">\n    <div class="b3-list-item__first">\n        <span class="b3-list-item__text">${(0,r.escapeHtml)(e.memo)}</span>\n        <span class="b3-chip b3-chip--secondary${e.tag?"":" fn__none"}">${e.tag}</span>\n    </div>\n    <div>\n        <span class="ft__smaller ft__on-surface">${e.hCreated}</span>\n        <span class="b3-list-item__meta">${e.hSize}</span>\n        <span class="b3-list-item__meta">${window.siyuan.languages.fileCount}${e.count}</span>\n    </div>\n    <div class="fn__flex" style="justify-content: flex-end;" data-id="${e.id}" data-tag="${e.tag}">${i}</div>\n</li>`:a+=`<li class="b3-list-item b3-list-item--hide-action" data-id="${e.id}" data-tag="${e.tag}">\n    <div class="fn__flex-1">\n        <div class="b3-list-item__text">\n            ${(0,r.escapeHtml)(e.memo)}\n            <span class="b3-chip b3-chip--secondary${e.tag?"":" fn__none"}">${e.tag}</span>\n        </div>\n        <div>\n            <span class="ft__smaller ft__on-surface">${e.hCreated}</span>\n            <span class="b3-list-item__meta">${e.hSize}</span>\n            <span class="b3-list-item__meta">${window.siyuan.languages.fileCount}${e.count}</span>\n        </div>\n    </div>\n    ${i}\n</li>`})),t.lastElementChild.innerHTML=`${a}`},m=(e,t)=>{e.lastElementChild.innerHTML='<li style="position: relative;height: 100%;"><div class="fn__loading"><img width="64px" src="/stage/loading-pure.svg"></div></li>';const n=e.querySelector('[data-type="previous"]'),i=e.querySelector('[data-type="next"]');t<0?(-1===t&&(0,o.fetchPost)("/api/repo/getRepoTagSnapshots",{},(t=>{g(t,e,"localTag")})),-2===t&&(0,o.fetchPost)("/api/repo/getCloudRepoTagSnapshots",{},(t=>{g(t,e,"cloudTag")})),n.classList.add("fn__none"),i.classList.add("fn__none")):(n.classList.remove("fn__none"),i.classList.remove("fn__none"),e.setAttribute("data-init","true"),e.setAttribute("data-page",t.toString()),t>1?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled"),(0,o.fetchPost)("/api/repo/getRepoSnapshots",{page:t},(n=>{t<n.data.pageCount?i.removeAttribute("disabled"):i.setAttribute("disabled","disabled"),g(n,e,"local")})))};t.openHistory=()=>{if(window.siyuan.dialogs.find((e=>{if(e.element.querySelector("#historyContainer"))return e.destroy(),!0})))return;const e=localStorage.getItem(s.Constants.LOCAL_HISTORYNOTEID);let t="";window.siyuan.notebooks.forEach((n=>{n.closed||(t+=` <option value="${n.id}"${n.id===e?" selected":""}>${n.name}</option>`)}));const n=new i.Dialog({content:`<div class="fn__flex-column" style="height: 100%;">\n    <div class="layout-tab-bar fn__flex" style="border-radius: 4px 4px 0 0">\n        <div data-type="doc" class="item item--focus"><span class="item__text">${window.siyuan.languages.fileHistory}</span></div>\n        <div data-type="notebook" class="item"><span class="item__text">${window.siyuan.languages.removedNotebook}</span></div>\n        <div data-type="repo" class="item"><span class="item__text">${window.siyuan.languages.dataSnapshot}</span></div>\n    </div>\n    <div class="fn__flex-1 fn__flex" id="historyContainer">\n        <div data-type="doc" class="history__repo fn__block" data-init="true">\n            <div class="fn__flex history__repoheader">\n                <span data-type="docprevious" class="block__icon b3-tooltips b3-tooltips__se" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href='#iconLeft'></use></svg></span>\n                <span class="fn__space"></span>\n                <span data-type="docnext" class="block__icon b3-tooltips b3-tooltips__se" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href='#iconRight'></use></svg></span>\n                <div class="fn__flex-1"></div>\n                <div style="position: relative">\n                    <svg class="b3-form__icon-icon ft__on-surface"><use xlink:href="#iconSearch"></use></svg>\n                    <input class="b3-text-field b3-form__icon-input">\n                </div>\n                <span class="fn__space"></span>\n                <select data-type="typeselect" class="b3-select" style="min-width: auto">\n                    <option value="0" selected>${window.siyuan.languages.doc}</option>\n                    <option value="1">${window.siyuan.languages.assets}</option>\n                </select>\n                <span class="fn__space"></span>\n                <select data-type="opselect" class="b3-select" style="min-width: auto">\n                    <option value="all" selected>${window.siyuan.languages.allOp}</option>\n                    <option value="clean">clean</option>\n                    <option value="update">update</option>\n                    <option value="delete">delete</option>\n                    <option value="format">format</option>\n                    <option value="sync">sync</option>\n                </select>\n                <span class="fn__space"></span>\n                <select data-type="notebookselect" class="b3-select" style="min-width: auto">\n                    ${t}\n                </select>\n                <span class="fn__space"></span>\n                <button data-type="rebuildIndex" class="b3-button b3-button--outline">${window.siyuan.languages.rebuildIndex}</button>\n            </div>\n            <div class="fn__flex fn__flex-1"${(0,l.isMobile)()?' style="flex-direction: column;"':""}>\n                <ul style="${(0,l.isMobile)()?"height: 30%":"width:200px"};overflow: auto;" class="b3-list b3-list--background">\n                    <li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>\n                </ul>\n                <div class="fn__flex-1 history__text fn__none" data-type="assetPanel"></div>\n                <textarea class="fn__flex-1 history__text fn__none" data-type="mdPanel"></textarea>\n                <div class="fn__flex-1 history__text fn__none" style="padding: 0" data-type="docPanel"></div>\n            </div>\n        </div>\n        <ul data-type="notebook" style="background-color: var(--b3-theme-background);border-radius: 0 0 4px 4px" class="fn__none b3-list b3-list--background">\n            <li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>\n        </ul>\n        <div data-type="repo" class="fn__none history__repo">\n            <div class="fn__flex history__repoheader">\n                <span data-type="previous" class="block__icon b3-tooltips b3-tooltips__se" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href='#iconLeft'></use></svg></span>\n                <span class="fn__space"></span>\n                <span data-type="next" class="block__icon b3-tooltips b3-tooltips__se" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href='#iconRight'></use></svg></span>\n                <div class="fn__flex-1"></div>\n                <select class="b3-select" style="min-width: auto">\n                    <option value="0">${window.siyuan.languages.localSnapshot}</option>\n                    <option value="1">${window.siyuan.languages.localTagSnapshot}</option>\n                    <option value="2">${window.siyuan.languages.cloudTagSnapshot}</option>\n                </select>\n                <span class="fn__space"></span>\n                <button class="b3-button b3-button--outline" data-type="genRepo">\n                    <svg><use xlink:href="#iconAdd"></use></svg>${window.siyuan.languages.createSnapshot}\n                </button>\n            </div>    \n            <ul style="background: var(--b3-theme-background);" class="b3-list b3-list--background fn__flex-1">\n                <li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>\n            </ul>\n        </div>\n    </div>\n</div>`,width:"80vw",height:"80vh"}),g=n.element.querySelector("#historyContainer [data-type=doc]");g.querySelectorAll(".b3-select").forEach((e=>{e.addEventListener("change",(()=>{f(g,1)}))})),g.querySelector(".b3-text-field").addEventListener("input",(e=>{e.isComposing||f(g,1)})),g.querySelector(".b3-text-field").addEventListener("compositionend",(()=>{f(g,1)}));const y=g.querySelector('.history__text[data-type="docPanel"]'),b=g.querySelector('.history__text[data-type="assetPanel"]'),v=g.querySelector('.history__text[data-type="mdPanel"]');f(g,1),h=new d.default(y,{blockId:"",action:[s.Constants.CB_GET_HISTORY],render:{background:!1,title:!1,gutter:!1,scroll:!1,breadcrumb:!1,breadcrumbDocName:!1,breadcrumbContext:!1},typewriterMode:!1});const w=n.element.querySelector('#historyContainer [data-type="repo"]'),_=w.querySelector(".b3-select");_.addEventListener("change",(()=>{const e=_.value;"0"===e?m(w,1):"1"===e?m(w,-1):"2"===e&&m(w,-2)})),n.element.addEventListener("click",(e=>{let t=e.target;for(;t&&!t.isEqualNode(n.element);){const e=t.getAttribute("data-type");if(t.classList.contains("item")){t.parentElement.querySelector(".item--focus").classList.remove("item--focus"),Array.from(n.element.querySelector("#historyContainer").children).forEach((n=>{var i;n.getAttribute("data-type")===e?(n.classList.remove("fn__none"),n.classList.add("fn__block"),t.classList.add("item--focus"),"true"!==n.getAttribute("data-init")&&("notebook"===e?((i=n).setAttribute("data-init","true"),(0,o.fetchPost)("/api/history/getNotebookHistory",{},(e=>{if(0===e.data.histories.length)return void(i.innerHTML=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`);let t="";e.data.histories.forEach(((e,n)=>{t+=`<li class="b3-list-item" style="padding-left: 0" data-type="toggle">\n    <span style="padding-left: 8px" class="b3-list-item__toggle"><svg class="b3-list-item__arrow${0===n?" b3-list-item__arrow--open":""}${e.items.length>0?"":" fn__hidden"}"><use xlink:href="#iconRight"></use></svg></span>\n    <span class="b3-list-item__text">${e.hCreated}</span>\n</li>`,e.items.length>0&&(t+=`<ul class="${0===n?"":"fn__none"}">`,e.items.forEach((e=>{t+=`<li data-type="notebook" data-path="${e.path}" class="b3-list-item" style="padding-left: 32px">\n    <span class="b3-list-item__text">${(0,r.escapeHtml)(e.title)}</span>\n    <span class="fn__space"></span>\n    <span class="b3-list-item__action" data-type="rollback">\n        <svg><use xlink:href="#iconUndo"></use></svg><span class="fn__space"></span>${window.siyuan.languages.rollback}\n    </span>\n</li>`})),t+="</ul>")})),i.innerHTML=t}))):"repo"===e&&m(n,1))):(n.classList.add("fn__none"),n.classList.remove("fn__block"))}));break}if(t.classList.contains("b3-list-item__action")&&"rollback"===e&&!window.siyuan.config.readonly){(0,a.confirmDialog)("⚠️ "+window.siyuan.languages.rollback,`${window.siyuan.languages.rollbackConfirm.replace("${date}",t.parentElement.textContent.trim())}`,(()=>{const e=t.parentElement.getAttribute("data-type");"assets"===e?(0,o.fetchPost)("/api/history/rollbackAssetsHistory",{historyPath:t.parentElement.getAttribute("data-path")}):"doc"===e?(0,o.fetchPost)("/api/history/rollbackDocHistory",{notebook:g.querySelector('.b3-select[data-type="notebookselect"]').value,historyPath:t.parentElement.getAttribute("data-path")}):"notebook"===e?(0,o.fetchPost)("/api/history/rollbackNotebookHistory",{historyPath:t.parentElement.getAttribute("data-path")}):(0,o.fetchPost)("/api/repo/checkoutRepo",{id:t.parentElement.getAttribute("data-id")})}));break}if("toggle"===e){t.nextElementSibling.classList.toggle("fn__none"),t.firstElementChild.firstElementChild.classList.toggle("b3-list-item__arrow--open");break}if(t.classList.contains("b3-list-item")&&("assets"===e||"doc"===e)){const n=t.getAttribute("data-path");"assets"===e?b.innerHTML=(0,u.renderAssetsPreview)(n):"doc"===e&&(0,o.fetchPost)("/api/history/getDocHistoryContent",{historyPath:n,k:g.querySelector(".b3-text-field").value},(e=>{e.data.isLargeDoc?(v.value=e.data.content,v.classList.remove("fn__none"),y.classList.add("fn__none")):(v.classList.add("fn__none"),y.classList.remove("fn__none"),(0,p.onGet)(e,h.protyle,[s.Constants.CB_GET_HISTORY,s.Constants.CB_GET_HTML]))}));let i=(0,c.hasClosestByClassName)(t,"b3-list");i&&(i=i.querySelector(".b3-list-item--focus"),i&&i.classList.remove("b3-list-item--focus")),t.classList.add("b3-list-item--focus");break}if("genRepo"===e){const e=new i.Dialog({title:window.siyuan.languages.snapshotMemo,content:`<div class="b3-dialog__content">\n    <textarea class="b3-text-field fn__block" placeholder="${window.siyuan.languages.snapshotMemoTip}"></textarea>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:(0,l.isMobile)()?"80vw":"520px"}),t=e.element.querySelector("textarea");t.focus();const n=e.element.querySelectorAll(".b3-button");e.bindInput(t,(()=>{n[1].click()})),n[0].addEventListener("click",(()=>{e.destroy()})),n[1].addEventListener("click",(()=>{(0,o.fetchPost)("/api/repo/createSnapshot",{memo:t.value},(()=>{m(w,1)})),e.destroy()}));break}if("removeRepoTagSnapshot"===e||"removeCloudRepoTagSnapshot"===e){const n=t.parentElement.getAttribute("data-tag");(0,a.confirmDialog)(window.siyuan.languages.delete,`${window.siyuan.languages.confirmDelete} <i>${n}</i>?`,(()=>{(0,o.fetchPost)("/api/repo/"+e,{tag:n},(()=>{m(w,"removeRepoTagSnapshot"===e?-1:-2)}))}));break}if("uploadSnapshot"===e){(0,o.fetchPost)("/api/repo/uploadCloudSnapshot",{tag:t.parentElement.getAttribute("data-tag"),id:t.parentElement.getAttribute("data-id")});break}if("downloadSnapshot"===e){(0,o.fetchPost)("/api/repo/downloadCloudSnapshot",{tag:t.parentElement.getAttribute("data-tag"),id:t.parentElement.getAttribute("data-id")});break}if("genTag"===e){const e=new i.Dialog({title:window.siyuan.languages.tagSnapshot,content:`<div class="b3-dialog__content">\n    <input class="b3-text-field fn__block" placeholder="${window.siyuan.languages.tagSnapshotTip}">\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:(0,l.isMobile)()?"80vw":"520px"}),n=e.element.querySelector(".b3-text-field");n.focus();const a=e.element.querySelectorAll(".b3-button");a[0].addEventListener("click",(()=>{e.destroy()})),e.bindInput(n,(()=>{a[1].click()})),a[1].addEventListener("click",(()=>{(0,o.fetchPost)("/api/repo/tagSnapshot",{id:t.parentElement.getAttribute("data-id"),name:n.value},(()=>{m(w,1)})),e.destroy()}));break}if(("previous"===e||"next"===e)&&"disabled"!==t.getAttribute("disabled")){const t=parseInt(w.getAttribute("data-page"));m(w,"previous"===e?t-1:t+1);break}if(("docprevious"===e||"docnext"===e)&&"disabled"!==t.getAttribute("disabled")){const t=parseInt(g.getAttribute("data-page"));f(g,"docprevious"===e?t-1:t+1);break}if("rebuildIndex"===e){(0,o.fetchPost)("/api/history/reindexHistory",{},(()=>{f(g,1)}));break}t=t.parentElement}}))}},4275:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newNotebook=t.mountHelp=t.newDailyNote=void 0;const i=n(8792),a=n(1890),o=n(3274),s=n(734),r=n(9866),l=n(8813),c=n(8349);t.newDailyNote=()=>{const e=(0,l.getOpenNotebookCount)();if(0===e)return void(0,a.showMessage)(window.siyuan.languages.newFileTip);if(1===e){let e="";return window.siyuan.notebooks.find((t=>{t.closed||(e=t.id)})),void(0,s.fetchPost)("/api/filetree/createDailyNote",{notebook:e})}const t=window.localStorage.getItem(i.Constants.LOCAL_DAILYNOTEID);if(t&&(0,l.getNotebookName)(t)&&!(0,o.isMobile)())(0,s.fetchPost)("/api/filetree/createDailyNote",{notebook:t});else{let e="";window.siyuan.notebooks.forEach((t=>{t.closed||(e+=`<option value="${t.id}">${t.name}</option>`)}));const n=new r.Dialog({content:`<div class="b3-dialog__content">\n    <select class="b3-select fn__block">${e}</select>\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:(0,o.isMobile)()?"80vw":"520px"}),a=n.element.querySelectorAll(".b3-button"),l=n.element.querySelector(".b3-select");l.value=t,a[0].addEventListener("click",(()=>{n.destroy()})),a[1].addEventListener("click",(()=>{const e=l.value;window.localStorage.setItem(i.Constants.LOCAL_DAILYNOTEID,e),(0,s.fetchPost)("/api/filetree/createDailyNote",{notebook:e}),n.destroy()}))}};t.mountHelp=()=>{const e=i.Constants.HELP_PATH[window.siyuan.config.appearance.lang];(0,s.fetchPost)("/api/notebook/removeNotebook",{notebook:e,callback:i.Constants.CB_MOUNT_REMOVE},(()=>{(0,s.fetchPost)("/api/notebook/openNotebook",{callback:i.Constants.CB_MOUNT_HELP,notebook:e})}))};t.newNotebook=()=>{const e=new r.Dialog({title:window.siyuan.languages.newNotebook,content:`<div class="b3-dialog__content">\n    <input placeholder="${window.siyuan.languages.notebookName}" class="b3-text-field fn__block">\n</div>\n<div class="b3-dialog__action">\n    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>\n    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>\n</div>`,width:(0,o.isMobile)()?"80vw":"520px"}),t=e.element.querySelectorAll(".b3-button");e.bindInput(e.element.querySelector("input"),(()=>{t[1].dispatchEvent(new CustomEvent("click"))})),t[0].addEventListener("click",(()=>{e.destroy()})),t[1].addEventListener("click",(()=>{const t=e.element.querySelector("input").value;if(!(0,c.validateName)(t))return!1;(0,s.fetchPost)("/api/notebook/createNotebook",{name:t}),e.destroy()}))}},8776:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.needSubscribe=void 0;const i=n(1890);t.needSubscribe=(e=window.siyuan.languages._kernel[29])=>(!window.siyuan.user||!(-1===window.siyuan.user.userSiYuanProExpireTime||window.siyuan.user.userSiYuanProExpireTime>0))&&(e&&(e===window.siyuan.languages._kernel[29]&&"ios"===window.siyuan.config.system.container?(0,i.showMessage)(window.siyuan.languages._kernel[122]):(0,i.showMessage)(e)),!0)},4779:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSavePath=t.newFile=void 0;const i=n(1890),a=n(2892),o=n(3607),s=n(3371),r=n(1034),l=n(9516),c=n(734),u=n(8813),d=n(8792);t.newFile=(e,t,n,p)=>{if(0!==(0,u.getOpenNotebookCount)()){if(!e&&((0,a.getAllModels)().editor.find((n=>{const i=n.parent.headElement;if(i.classList.contains("item--focus")&&(e=n.editor.protyle.notebookId,t=(0,u.pathPosix)().dirname(n.editor.protyle.path),i.parentElement.parentElement.classList.contains("layout__wnd--active")))return!0})),!e)){const n=(0,s.getDockByType)("file").data.file;if(n instanceof r.Files){const i=n.element.querySelector(".b3-list-item--focus");if(i){const n=(0,o.hasTopClosestByTag)(i,"UL");n&&(e=n.getAttribute("data-url"));const a=i.getAttribute("data-path");t=(0,u.pathPosix)().dirname(a)}}}e||window.siyuan.notebooks.find((n=>{if(!n.closed)return e=n.id,t="/",!0})),(0,c.fetchPost)("/api/filetree/getDocNameTemplate",{notebook:e},(i=>{const a=Lute.NewNodeID(),o=(0,u.pathPosix)().join((0,u.getDisplayName)(t,!1,!0),a+".sy");p&&(p[p.indexOf(void 0)]=o),(0,c.fetchPost)("/api/filetree/createDoc",{notebook:e,path:o,title:i.data.name||"Untitled",md:"",sorts:p},(()=>{n&&(0,l.openFileById)({id:a,action:[d.Constants.CB_GET_HL,d.Constants.CB_GET_CONTEXT]})}))}))}else(0,i.showMessage)(window.siyuan.languages.newFileTip)};t.getSavePath=(e,t,n)=>{(0,c.fetchPost)("/api/notebook/getNotebookConf",{notebook:t},(i=>{let a=i.data.conf.refCreateSavePath;a||(a=window.siyuan.config.fileTree.refCreateSavePath),a?a.startsWith("/")?n((0,u.getDisplayName)(a,!1,!0)):(0,c.fetchPost)("/api/filetree/getHPathByPath",{notebook:t,path:e},(e=>{n((0,u.getDisplayName)((0,u.pathPosix)().join(e.data,a),!1,!0))})):(0,c.fetchPost)("/api/filetree/getHPathByPath",{notebook:t,path:e},(e=>{n((0,u.getDisplayName)(e.data,!1,!0))}))}))}},1535:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onGetConfig=t.setProxy=void 0;const i=n(5031),a=n(3371),o=n(7954),s=n(8792),r=n(2186),l=n(1389),c=n(734),u=n(4275),d=n(2640),p=n(8785),h=n(9039),f=n(8813),g=(n(4640),n(3559)),m=n(1574),y=n(7731),b=n(5370),v=(e,t,n)=>{if("general"===t){if(!window.siyuan.config.keymap[t])return window.siyuan.config.keymap[t]=e,!1}else{if(!window.siyuan.config.keymap[t])return window.siyuan.config.keymap[t]=s.Constants.SIYUAN_KEYMAP.editor,!1;if(!window.siyuan.config.keymap[t][n])return window.siyuan.config.keymap[t][n]=e,!1}let i=!0;return Object.keys(e).forEach((a=>{"general"===t?window.siyuan.config.keymap[t][a]&&window.siyuan.config.keymap[t][a].default===e[a].default||(i=!1,window.siyuan.config.keymap[t][a]=e[a]):window.siyuan.config.keymap[t][n][a]&&window.siyuan.config.keymap[t][n][a].default===e[a].default||(i=!1,window.siyuan.config.keymap[t][n][a]=e[a])})),i},w=(e,t,n)=>{let i=!0;return"editor"===t?Object.keys(window.siyuan.config.keymap[t][n]).length!==Object.keys(s.Constants.SIYUAN_KEYMAP[t][n]).length&&Object.keys(window.siyuan.config.keymap[t][n]).forEach((e=>{s.Constants.SIYUAN_KEYMAP[t][n][e]||(i=!1,delete window.siyuan.config.keymap[t][n][e])})):Object.keys(window.siyuan.config.keymap[t]).length!==Object.keys(s.Constants.SIYUAN_KEYMAP[t]).length&&Object.keys(window.siyuan.config.keymap[t]).forEach((e=>{s.Constants.SIYUAN_KEYMAP[t][e]||(i=!1,delete window.siyuan.config.keymap[t][e])})),i};t.setProxy=()=>{};t.onGetConfig=e=>{const t=v(s.Constants.SIYUAN_KEYMAP.general,"general"),n=v(s.Constants.SIYUAN_KEYMAP.editor.general,"editor","general"),i=v(s.Constants.SIYUAN_KEYMAP.editor.insert,"editor","insert"),o=v(s.Constants.SIYUAN_KEYMAP.editor.heading,"editor","heading"),d=v(s.Constants.SIYUAN_KEYMAP.editor.list,"editor","list"),h=v(s.Constants.SIYUAN_KEYMAP.editor.table,"editor","table"),f=w(s.Constants.SIYUAN_KEYMAP.general,"general"),g=w(s.Constants.SIYUAN_KEYMAP.editor.general,"editor","general"),m=w(s.Constants.SIYUAN_KEYMAP.editor.insert,"editor","insert"),b=w(s.Constants.SIYUAN_KEYMAP.editor.heading,"editor","heading"),k=w(s.Constants.SIYUAN_KEYMAP.editor.list,"editor","list"),C=w(s.Constants.SIYUAN_KEYMAP.editor.table,"editor","table");window.siyuan.config.readonly||t&&n&&i&&o&&d&&h||f&&g&&m&&b&&k&&C||(0,c.fetchPost)("/api/setting/setKeymap",{data:window.siyuan.config.keymap},(()=>{})),(!window.siyuan.config.uiLayout||window.siyuan.config.uiLayout&&!window.siyuan.config.uiLayout.left)&&(window.siyuan.config.uiLayout=s.Constants.SIYUAN_EMPTY_LAYOUT),(0,l.globalShortcut)(),(0,c.fetchPost)("/api/system/getEmojiConf",{},(t=>{window.siyuan.emojis=t.data;try{(0,a.JSONToLayout)(e)}catch(e){(0,c.fetchPost)("/api/system/setUILayout",{layout:{}},(()=>{window.location.reload()}))}})),_(),(0,y.initStatus)(),E(),r.appearance.onSetappearance(window.siyuan.config.appearance),(0,p.initAssets)(),(0,p.setInlineStyle)();let D=0;window.addEventListener("resize",(()=>{window.clearTimeout(D),D=window.setTimeout((()=>{(0,a.resizeTabs)(),(0,a.resizeDrag)()}),200)})),window.siyuan.config.newbie&&(0,u.mountHelp)()};const _=()=>{document.querySelector(".toolbar").innerHTML=`<div id="toolbarVIP" class="fn__flex"></div>\n<div id="barDailyNote" data-menu="true" aria-label="${window.siyuan.languages.dailyNote} ${(0,o.updateHotkeyTip)(window.siyuan.config.keymap.general.dailyNote.custom)}" class="toolbar__item b3-tooltips b3-tooltips__se${window.siyuan.config.readonly?" fn__none":""}">\n    <svg>\n        <use xlink:href="#iconCalendar"></use>\n    </svg>\n</div>\n<div id="barSearch" class="toolbar__item b3-tooltips b3-tooltips__se" aria-label="${window.siyuan.languages.globalSearch} ${(0,o.updateHotkeyTip)(window.siyuan.config.keymap.general.globalSearch.custom)}">\n    <svg>\n        <use xlink:href="#iconSearch"></use>\n    </svg>\n</div>\n<div id="barThemeMode" class="toolbar__item b3-tooltips b3-tooltips__se${1===window.siyuan.config.appearance.mode?" toolbar__item--active":""}" aria-label="${1===window.siyuan.config.appearance.mode?window.siyuan.languages.themeLight:window.siyuan.languages.themeDark}">\n    <svg>\n        <use xlink:href="#iconMoon"></use>\n    </svg>\n</div>\n<div id="barHistory" class="toolbar__item b3-tooltips b3-tooltips__se" aria-label="${window.siyuan.languages.dataHistory} ${(0,o.updateHotkeyTip)(window.siyuan.config.keymap.general.history.custom)}">\n    <svg>\n        <use xlink:href="#iconVideo"></use>\n    </svg>\n</div>\n<div id="barSetting" class="toolbar__item b3-tooltips b3-tooltips__se${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.config} ${(0,o.updateHotkeyTip)(window.siyuan.config.keymap.general.config.custom)}">\n    <svg>\n        <use xlink:href="#iconSettings"></use>\n    </svg>\n</div>\n<div id="barSync" class="toolbar__item b3-tooltips b3-tooltips__se" aria-label="${window.siyuan.config.sync.stat||window.siyuan.languages.syncNow+" "+(0,o.updateHotkeyTip)(window.siyuan.config.keymap.general.syncNow.custom)}">\n    <svg><use xlink:href="#iconCloud"></use></svg>\n</div>\n<button id="barBack" data-menu="true" class="toolbar__item toolbar__item--disabled b3-tooltips b3-tooltips__se" aria-label="${window.siyuan.languages.goBack} ${(0,o.updateHotkeyTip)(window.siyuan.config.keymap.general.goBack.custom)}">\n    <svg>\n        <use xlink:href="#iconLeft"></use>\n    </svg>\n</button>\n<button id="barForward" data-menu="true" class="toolbar__item toolbar__item--disabled b3-tooltips b3-tooltips__se" aria-label="${window.siyuan.languages.goForward} ${(0,o.updateHotkeyTip)(window.siyuan.config.keymap.general.goForward.custom)}">\n    <svg>\n        <use xlink:href="#iconRight"></use>\n    </svg>\n</button>\n<div class="fn__flex-1 fn__ellipsis" id="drag"><span class="fn__none">开发版，使用前请进行备份 Development version, please backup before use</span></div>\n<div class="fn__flex" style="top: -1px;z-index: 502;right: -1px;position: relative;" id="windowControls"></div>`,document.querySelector(".toolbar").addEventListener("click",(e=>{let t=e.target;for(;!t.classList.contains("toolbar");){if("barBack"===t.id){(0,h.goBack)(),e.stopPropagation();break}if("barSync"===t.id){(0,b.syncGuide)(t),e.stopPropagation();break}if("barForward"===t.id){(0,h.goForward)(),e.stopPropagation();break}if("barHistory"===t.id){(0,m.openHistory)(),e.stopPropagation();break}if("barSetting"===t.id){(0,g.openSetting)(),e.stopPropagation();break}if("toolbarVIP"===t.id){(0,g.openSetting)().element.querySelector('.b3-tab-bar [data-name="account"]').dispatchEvent(new CustomEvent("click")),e.stopPropagation();break}if("barSearch"===t.id){(0,i.openSearch)(window.siyuan.config.keymap.general.globalSearch.custom),e.stopPropagation();break}if("barThemeMode"===t.id){if(t.getAttribute("disabled"))return;t.classList.contains("toolbar__item--active")?(t.classList.remove("toolbar__item--active"),t.setAttribute("aria-label",window.siyuan.languages.themeDark)):(t.classList.add("toolbar__item--active"),t.setAttribute("aria-label",window.siyuan.languages.themeLight)),t.setAttribute("disabled","disabled"),(0,c.fetchPost)("/api/system/setAppearanceMode",{mode:t.classList.contains("toolbar__item--active")?1:0},(e=>{window.siyuan.config.appearance.themeJS?(0,a.exportLayout)(!0):(window.siyuan.config.appearance=e.data.appearance,t.removeAttribute("disabled"),(0,p.loadAssets)(e.data.appearance))})),e.stopPropagation();break}if("barDailyNote"===t.id){(0,f.getOpenNotebookCount)()<2?(0,u.newDailyNote)():(window.siyuan.menus.menu.remove(),window.siyuan.notebooks.forEach((e=>{e.closed||window.siyuan.menus.menu.append(new d.MenuItem({label:e.name,click:()=>{(0,c.fetchPost)("/api/filetree/createDailyNote",{notebook:e.id}),window.localStorage.setItem(s.Constants.LOCAL_DAILYNOTEID,e.id)}}).element)})),window.siyuan.menus.menu.popup({x:e.clientX,y:e.clientY})),e.stopPropagation();break}t=t.parentElement}})),(0,t.setProxy)()},E=()=>{document.querySelector(".toolbar").classList.add("toolbar--browser"),window.addEventListener("beforeunload",(()=>{(0,a.exportLayout)(!1)}),!1)}},8813:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setNoteBook=t.getOpenNotebookCount=t.setNotebookName=t.getNotebookName=t.movePathTo=t.pathPosix=t.isLocalPath=t.getAssetName=t.getDisplayName=t.addBaseURL=void 0;const a=n(2005),o=n(734),s=n(9866),r=n(3863),l=n(3274),c=n(4640),u=n(3607),d=n(7640),p=n(8792);t.addBaseURL=()=>{let e=document.getElementById("baseURL");e||(e=document.createElement("base"),e.id="baseURL"),e.setAttribute("href",location.origin),document.getElementsByTagName("head")[0].appendChild(e)};t.getDisplayName=(e,n=!0,i=!1)=>{let a=e;return n&&(a=(0,t.pathPosix)().basename(e)),i&&a.endsWith(".sy")&&(a=a.substr(0,a.length-3)),a};t.getAssetName=e=>e.substring(7,e.length-(0,t.pathPosix)().extname(e).length-23);t.isLocalPath=e=>!!e&&(e.startsWith("assets/")||e.startsWith("file://"));t.pathPosix=()=>a.posix?a.posix:a;const h=(e,t,n,i,a)=>{(0,o.fetchPost)("/api/filetree/moveDoc",{fromNotebook:e,toNotebook:n,fromPath:t,toPath:i}),a.destroy()};t.movePathTo=(e,n,a=!0)=>i(void 0,void 0,void 0,(function*(){if(window.siyuan.dialogs.find((e=>{if(e.element.querySelector("#foldList"))return e.destroy(),!0})))return;const i=yield(0,o.fetchSyncPost)("/api/filetree/getHPathByPath",{notebook:e,path:n});let f;getSelection().rangeCount>0&&(f=getSelection().getRangeAt(0));const g=new s.Dialog({title:`${window.siyuan.languages.move} <span class="ft__smaller ft__on-surface">${(0,r.escapeHtml)((0,t.pathPosix)().join((0,t.getNotebookName)(e),i.data))}</span>`,content:`<div class="b3-form__icon b3-form__space">\n    <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>\n    <input class="b3-text-field fn__block b3-form__icon-input" value="" placeholder="${window.siyuan.languages.search}">\n</div>\n<ul id="foldList" class="b3-list b3-list--background" style="height: 50vh;overflow: auto;position: relative"></ul>`,width:(0,l.isMobile)()?"80vw":"50vw",destroyCallback(){f&&a&&(0,c.focusByRange)(f)}}),m=g.element.querySelector("#foldList"),y=g.element.querySelector(".b3-text-field");y.focus();const b=e=>{e&&e.isComposing||(0,o.fetchPost)("/api/filetree/searchDocs",{k:y.value},(e=>{let i="";e.data.forEach((e=>{e.path!==(0,t.pathPosix)().dirname(n)+"/"&&e.path!==n&&(i+=`<li class="b3-list-item${""===i?" b3-list-item--focus":""}" data-path="${e.path}" data-box="${e.box}">\n    <span class="b3-list-item__icon">${(0,d.unicode2Emoji)(e.boxIcon||p.Constants.SIYUAN_IMAGE_NOTE)}</span>\n    <span class="b3-list-item__showall">${(0,r.escapeHtml)(e.hPath)}</span>\n</li>`)})),m.innerHTML=i}))};b(),y.addEventListener("compositionend",(e=>{b(e)})),y.addEventListener("input",(e=>{b(e)}));y.addEventListener("keydown",(t=>{let i=g.element.querySelector(".b3-list-item--focus");if(i)if("ArrowDown"===t.key)i.classList.remove("b3-list-item--focus"),i.nextElementSibling?i.nextElementSibling.classList.add("b3-list-item--focus"):m.children[0].classList.add("b3-list-item--focus"),i=m.querySelector(".b3-list-item--focus"),(m.scrollTop<i.offsetTop-m.clientHeight+28||m.scrollTop>i.offsetTop)&&(m.scrollTop=i.offsetTop-m.clientHeight+28),t.preventDefault();else if("ArrowUp"===t.key){if(i.classList.remove("b3-list-item--focus"),i.previousElementSibling)i.previousElementSibling.classList.add("b3-list-item--focus");else{const e=m.children.length;m.children[e-1].classList.add("b3-list-item--focus")}i=m.querySelector(".b3-list-item--focus"),(m.scrollTop<i.offsetTop-m.clientHeight+28||m.scrollTop>i.offsetTop-56)&&(m.scrollTop=i.offsetTop-56),t.preventDefault()}else"Enter"===t.key&&(h(e,n,i.getAttribute("data-box"),i.getAttribute("data-path"),g),t.preventDefault())})),g.element.addEventListener("click",(t=>{const i=t.target,a=(0,u.hasClosestByClassName)(i,"b3-list-item");a&&h(e,n,a.getAttribute("data-box"),a.getAttribute("data-path"),g)}))}));t.getNotebookName=e=>{let t="";return window.siyuan.notebooks.find((n=>{if(n.id===e)return t=n.name,!0})),t};t.setNotebookName=(e,t)=>{window.siyuan.notebooks.find((n=>{if(n.id===e)return n.name=t,!0}))};t.getOpenNotebookCount=()=>{let e=0;return window.siyuan.notebooks.forEach((t=>{t.closed||e++})),e};t.setNoteBook=e=>{(0,o.fetchPost)("/api/notebook/lsNotebooks",{},(t=>{window.siyuan.notebooks=t.data.notebooks,e&&e(t.data.notebooks)}))}},4369:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processMessage=void 0;const i=n(1890),a=n(3371);t.processMessage=e=>{if("msg"===e.cmd)return(0,i.showMessage)(e.msg,e.data.closeTimeout,0===e.code?"info":"error",e.data.id),!1;if("cmsg"===e.cmd)return(0,i.hideMessage)(e.data.id),!1;if("cprogress"===e.cmd){const e=document.getElementById("progress");return e&&e.remove(),!1}return"reloadui"===e.cmd?((0,a.exportLayout)(!0),!1):e.code<0?((0,i.showMessage)(e.msg,e.data&&e.data.closeTimeout||0,-1===e.code?"error":"info"),!1):e}},6224:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setPosition=void 0;const i=n(8792);t.setPosition=(e,t,n,a=0,o=0)=>{e.style.top=n+"px",e.style.left=t+"px";const s=e.getBoundingClientRect();if(s.bottom>window.innerHeight||s.top<0){const t=n-s.height-a;t>0&&t+s.height<window.innerHeight-0?e.style.top=t+"px":e.style.top=t<=0?"0px":Math.max(i.Constants.SIZE_TOOLBAR_HEIGHT,window.innerHeight-s.height)+"px"}s.right>window.innerWidth?e.style.left=window.innerWidth-s.width-o+"px":s.left<0&&(e.style.left="0")}},9398:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.upDownHint=void 0;t.upDownHint=(e,t)=>{let n=e.querySelector(".b3-list-item--focus");if("ArrowDown"===t.key)return t.preventDefault(),t.stopPropagation(),n.classList.remove("b3-list-item--focus"),n.nextElementSibling?n.nextElementSibling.classList.contains("b3-list-item")?n.nextElementSibling.classList.add("b3-list-item--focus"):n.nextElementSibling.nextElementSibling.classList.add("b3-list-item--focus"):e.children[0].classList.add("b3-list-item--focus"),n=e.querySelector(".b3-list-item--focus"),(e.scrollTop<n.offsetTop-e.clientHeight+n.clientHeight||e.scrollTop>n.offsetTop)&&(e.scrollTop=n.offsetTop-e.clientHeight+n.clientHeight),n;if("ArrowUp"===t.key){if(t.preventDefault(),t.stopPropagation(),n.classList.remove("b3-list-item--focus"),n.previousElementSibling)n.previousElementSibling.classList.contains("b3-list-item")?n.previousElementSibling.classList.add("b3-list-item--focus"):n.previousElementSibling.previousElementSibling.classList.add("b3-list-item--focus");else{const t=e.children.length;e.children[t-1].classList.add("b3-list-item--focus")}return n=e.querySelector(".b3-list-item--focus"),(e.scrollTop<n.offsetTop-e.clientHeight+n.clientHeight||e.scrollTop>n.offsetTop-2*n.clientHeight)&&(e.scrollTop=n.offsetTop-2*n.clientHeight),n}}},4981:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=4981,e.exports=t}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};(()=>{"use strict";const e=n(8792),t=n(3024),i=n(7924),a=n(1535);n(8456);const o=n(5473),s=n(7956),r=n(6555),l=n(8303),c=n(734),u=n(8813),d=n(9516),p=n(1754),h=n(6840),f=n(1890),g=n(3371);new class{constructor(){(0,r.addScriptSync)(`${e.Constants.PROTYLE_CDN}/js/lute/lute.min.js?v=${e.Constants.SIYUAN_VERSION}`,"protyleLuteScript"),(0,r.addScript)(`${e.Constants.PROTYLE_CDN}/js/protyle-html.js?v=${e.Constants.SIYUAN_VERSION}`,"protyleWcHtmlScript"),(0,u.addBaseURL)(),window.siyuan={transactions:[],reqIds:{},backStack:[],layout:{},dialogs:[],blockPanels:[],ctrlIsPressed:!1,altIsPressed:!1,ws:new i.Model({id:(0,l.genUUID)(),type:"main",msgCallback:t=>{if(t)switch(t.cmd){case"progress":(0,p.progressLoading)(t);break;case"statusbar":(0,p.progressStatus)(t);break;case"downloadProgress":(0,p.downloadProgress)(t.data);break;case"txerr":(0,p.transactionError)(t);break;case"syncing":0===t.code?document.querySelector("#barSync").classList.add("toolbar__item--active"):document.querySelector("#barSync").classList.remove("toolbar__item--active"),document.querySelector("#barSync").setAttribute("aria-label",t.msg);break;case"refreshtheme":1===window.siyuan.config.appearance.mode&&"midnight"!==window.siyuan.config.appearance.themeDark||0===window.siyuan.config.appearance.mode&&"daylight"!==window.siyuan.config.appearance.themeLight?document.getElementById("themeStyle").href=t.data.theme:document.getElementById("themeDefaultStyle").href=t.data.theme;break;case"createdailynote":(0,d.openFileById)({id:t.data.id,action:[e.Constants.CB_GET_FOCUS]})}}}),menus:new t.Menus},(0,c.fetchPost)("/api/system/getConf",{},(t=>{window.siyuan.config=t.data.conf,(0,c.fetchGet)(`/appearance/langs/${window.siyuan.config.appearance.lang}.json?v=${e.Constants.SIYUAN_VERSION}`,(e=>{window.siyuan.languages=e,(0,p.bootSync)(),(0,c.fetchPost)("/api/setting/getCloudUser",{},(e=>{window.siyuan.user=e.data,(0,a.onGetConfig)(t.data.start),s.account.onSetaccount(),(0,g.resizeDrag)(),(0,p.setTitle)(window.siyuan.languages.siyuanNote),(0,f.initMessage)()}))}))})),(0,u.setNoteBook)(),(0,o.initBlockPopover)(),(0,h.promiseTransactions)()}}})()})();